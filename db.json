{"meta":{"version":1,"warehouse":"5.0.1"},"models":{"Asset":[{"_id":"source/img/7579449-9b4f591d793547b6.webp","path":"img/7579449-9b4f591d793547b6.webp","modified":0,"renderable":0},{"_id":"source/img/7579449-a8a0b3970380eeeb.webp","path":"img/7579449-a8a0b3970380eeeb.webp","modified":0,"renderable":0},{"_id":"source/img/7579449-b2ab8dfe80fe828d.webp","path":"img/7579449-b2ab8dfe80fe828d.webp","modified":0,"renderable":0},{"_id":"source/img/Garbled.png","path":"img/Garbled.png","modified":0,"renderable":0},{"_id":"source/img/blockchain-basic-core.png","path":"img/blockchain-basic-core.png","modified":0,"renderable":0},{"_id":"source/img/callAndapply.jpg","path":"img/callAndapply.jpg","modified":0,"renderable":0},{"_id":"source/img/curious.jpg","path":"img/curious.jpg","modified":0,"renderable":0},{"_id":"source/img/diff-diagram.png","path":"img/diff-diagram.png","modified":0,"renderable":0},{"_id":"source/img/diff.png","path":"img/diff.png","modified":0,"renderable":0},{"_id":"source/img/dom.png","path":"img/dom.png","modified":0,"renderable":0},{"_id":"source/img/dom1.png","path":"img/dom1.png","modified":0,"renderable":0},{"_id":"source/img/functionnal.gif","path":"img/functionnal.gif","modified":0,"renderable":0},{"_id":"source/img/github-pages.png","path":"img/github-pages.png","modified":0,"renderable":0},{"_id":"source/img/inheritAttrs1.webp","path":"img/inheritAttrs1.webp","modified":0,"renderable":0},{"_id":"source/img/inheritAttrs2.webp","path":"img/inheritAttrs2.webp","modified":0,"renderable":0},{"_id":"source/img/inheritAttrs3.webp","path":"img/inheritAttrs3.webp","modified":0,"renderable":0},{"_id":"source/img/jy.png","path":"img/jy.png","modified":0,"renderable":0},{"_id":"source/img/lazyload.gif","path":"img/lazyload.gif","modified":0,"renderable":0},{"_id":"source/img/libuv.png","path":"img/libuv.png","modified":0,"renderable":0},{"_id":"source/img/location.jpeg","path":"img/location.jpeg","modified":0,"renderable":0},{"_id":"source/img/nerve.png","path":"img/nerve.png","modified":0,"renderable":0},{"_id":"source/img/nerve1.png","path":"img/nerve1.png","modified":0,"renderable":0},{"_id":"source/img/ownership.png","path":"img/ownership.png","modified":0,"renderable":0},{"_id":"source/img/ownership1.png","path":"img/ownership1.png","modified":0,"renderable":0},{"_id":"source/img/sameVnode.png","path":"img/sameVnode.png","modified":0,"renderable":0},{"_id":"source/img/slot.jpeg","path":"img/slot.jpeg","modified":0,"renderable":0},{"_id":"source/img/updateChildren.png","path":"img/updateChildren.png","modified":0,"renderable":0},{"_id":"source/img/urlimg.png","path":"img/urlimg.png","modified":0,"renderable":0},{"_id":"source/img/vuejs2.png","path":"img/vuejs2.png","modified":0,"renderable":0},{"_id":"source/img/vuejs3.png","path":"img/vuejs3.png","modified":0,"renderable":0},{"_id":"source/img/vuejs4.png","path":"img/vuejs4.png","modified":0,"renderable":0},{"_id":"source/img/vuejs5.png","path":"img/vuejs5.png","modified":0,"renderable":0},{"_id":"source/img/vuejs6.png","path":"img/vuejs6.png","modified":0,"renderable":0},{"_id":"source/img/vuejs7.png","path":"img/vuejs7.png","modified":0,"renderable":0},{"_id":"themes/hexo-theme-next-master/source/images/algolia_logo.svg","path":"images/algolia_logo.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next-master/source/css/main.styl","path":"css/main.styl","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next-master/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next-master/source/images/avatar.gif","path":"images/avatar.gif","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next-master/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next-master/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next-master/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next-master/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next-master/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next-master/source/images/cc-by.svg","path":"images/cc-by.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next-master/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next-master/source/images/favicon-16x16-next.png","path":"images/favicon-16x16-next.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next-master/source/images/favicon-32x32-next.png","path":"images/favicon-32x32-next.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next-master/source/images/logo.svg","path":"images/logo.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next-master/source/js/algolia-search.js","path":"js/algolia-search.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next-master/source/js/bookmark.js","path":"js/bookmark.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next-master/source/js/local-search.js","path":"js/local-search.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next-master/source/js/motion.js","path":"js/motion.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next-master/source/js/next-boot.js","path":"js/next-boot.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next-master/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next-master/source/lib/anime.min.js","path":"lib/anime.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next-master/source/js/schemes/pisces.js","path":"js/schemes/pisces.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next-master/source/js/schemes/muse.js","path":"js/schemes/muse.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next-master/source/lib/velocity/velocity.min.js","path":"lib/velocity/velocity.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next-master/source/lib/velocity/velocity.ui.min.js","path":"lib/velocity/velocity.ui.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next-master/source/lib/font-awesome/css/all.min.css","path":"lib/font-awesome/css/all.min.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next-master/source/lib/font-awesome/webfonts/fa-brands-400.woff2","path":"lib/font-awesome/webfonts/fa-brands-400.woff2","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next-master/source/lib/font-awesome/webfonts/fa-regular-400.woff2","path":"lib/font-awesome/webfonts/fa-regular-400.woff2","modified":0,"renderable":1},{"_id":"themes/hexo-theme-next-master/source/lib/font-awesome/webfonts/fa-solid-900.woff2","path":"lib/font-awesome/webfonts/fa-solid-900.woff2","modified":0,"renderable":1}],"Cache":[{"_id":"source/_posts/CommonJs-AMD-CMD.md","hash":"ffed1d3c5a021720aff8cb8f0e9dd526a5492803","modified":1767314597570},{"_id":"source/_posts/VUE中的inheritAttrs-attrs-listeners.md","hash":"20c422ef0255a4f13bb872e25c3a6e826be2d28c","modified":1767314597571},{"_id":"source/_posts/Vue-router核心原理.md","hash":"0c71839f504d38742efa61b4e93a31d091945e94","modified":1767314597571},{"_id":"source/_posts/Promise的使用.md","hash":"cd90617939a7cb15e2b93673bd7a7a6d58d7c3ed","modified":1767314597571},{"_id":"source/_posts/Emojis-url.md","hash":"af8cbd829da1018666b7dc36333b023f2ffc7eb8","modified":1767314597570},{"_id":"source/_posts/gulp和webpack区别.md","hash":"9e9406671e045dbe8f8ec96258f53cfe1fe1d2f0","modified":1767314597572},{"_id":"source/_posts/Vuejs源码解析.md","hash":"5c89d194bb55cd8422db89789c86309503d91cb1","modified":1767314597572},{"_id":"source/_posts/Vue双向绑定实现原理.md","hash":"b41897c82a63db8027788135f75a7ecf2ec7a818","modified":1767314597572},{"_id":"source/_posts/hexo的基本操作.md","hash":"348fa5f4931c33e0b4c96b5a9b41558b0c9baa21","modified":1767314597573},{"_id":"source/_posts/nodeJs回顾记录.md","hash":"add8bc3bbd3604f84c13eaca037f5ecc512544c6","modified":1767314597573},{"_id":"source/_posts/posts.md","hash":"36eab38d048b436b15208228d9f2f9c0dc844c8b","modified":1767314597574},{"_id":"source/_posts/slot的使用.md","hash":"47c716f6a6f8ce5a0be107c6564d13956e34a2b7","modified":1767314597574},{"_id":"source/_posts/js获取事件坐标位置.md","hash":"e334682f16531b33bb9dce71484caca4f0f7fb52","modified":1767314597573},{"_id":"source/_posts/vue-diff算法.md","hash":"28256d099e8a30505728445849d3aaf88b74c3ad","modified":1767314597574},{"_id":"source/_posts/vue-source-code.md","hash":"29f1750a56220297c33953774680e0b805dd12b7","modified":1767314597575},{"_id":"source/_posts/vue的-emit-on-once-off的使用.md","hash":"946dd342ae44948de5689bb910ecfb3edb77ef10","modified":1767314597576},{"_id":"source/_posts/webpack4-29-0.md","hash":"d128c8f359dddddfbb325bff99b6167115bbed4e","modified":1767314597576},{"_id":"source/_posts/vue的functionnal使用.md","hash":"8fe415f7502b4f38efb5d54f3829bcc4fa78fae7","modified":1767314784227},{"_id":"source/_posts/区块链技术.md","hash":"42cccc3478e557df68e2a13849c79c2458aac4c6","modified":1767314597576},{"_id":"source/_posts/图片懒加载.md","hash":"1f920e6e0afe7ee82c798d8b6402853a9908fcfd","modified":1767314597576},{"_id":"source/_posts/在mac app store下载软件提示内存不足问题.md","hash":"a2a2043e2394b2db811a950822c72c190b5ea553","modified":1767314597577},{"_id":"source/_posts/如何清除已设置的npm淘宝镜像.md","hash":"88f1a08ba107ebdc869762bcfcec11866167a7f5","modified":1767314597577},{"_id":"source/categories/index.md","hash":"dec743b743e681dff87d842b7184212171db0d55","modified":1767161262351},{"_id":"source/_posts/探究call-和-apply-的原理.md","hash":"e38e220aa15835ac2de0bcda33312eaff1b8cfb6","modified":1767314597577},{"_id":"source/_posts/跨浏览器窗口-7种方式 copy.md","hash":"c7d4b3f4932e388cc8dfd6a4bf73a09175496097","modified":1767314597578},{"_id":"source/_posts/深度学习之之神经网络.md","hash":"2fa672a5087bd3f50820781a346b91f08a4ba25b","modified":1767314597578},{"_id":"source/_posts/跨浏览器窗口-7种方式.md","hash":"c7d4b3f4932e388cc8dfd6a4bf73a09175496097","modified":1767314597578},{"_id":"source/img/7579449-9b4f591d793547b6.webp","hash":"d5f60d7386872646d35798f2c24a4a517b2a804f","modified":1767161262352},{"_id":"source/img/7579449-a8a0b3970380eeeb.webp","hash":"4ab2f71cfe2ee898c8700b9e5215615ebbfe14b0","modified":1767161262352},{"_id":"source/img/7579449-b2ab8dfe80fe828d.webp","hash":"88a4480ff989f912298f8bf735512a758f81de93","modified":1767161262353},{"_id":"source/img/curious.jpg","hash":"4e9569ac72ed4099f9a8a00e9986a45440f376e7","modified":1767161262361},{"_id":"source/img/callAndapply.jpg","hash":"7019ef22aa89dec5fe21c7d85599707a0e4a9dc1","modified":1767161262361},{"_id":"source/img/inheritAttrs1.webp","hash":"4af151162e8888bbfe337a2683a983a4da82e903","modified":1767161262368},{"_id":"source/img/inheritAttrs2.webp","hash":"913203670746b751c53f9e5aa90a8a3d98bdc264","modified":1767161262369},{"_id":"source/img/lazyload.gif","hash":"b66fc917fcf1a46d531c9639ec8dde80c3838787","modified":1767161262371},{"_id":"source/img/location.jpeg","hash":"2874b3e15ea1abcec19bf1bc7020a31fee71cfd8","modified":1767161262373},{"_id":"source/img/urlimg.png","hash":"c75226d4b3ea485206e09db8d68e84a55db4434c","modified":1767161262392},{"_id":"source/img/inheritAttrs3.webp","hash":"19e6c33a334f83ac08c791063a3c91a4cd3055ff","modified":1767161262369},{"_id":"source/img/vuejs2.png","hash":"dfc2f047d2a358cbb65915418d98de18f6a20cef","modified":1767161262393},{"_id":"source/img/vuejs5.png","hash":"f48bedd65628b5ff4e494502a8e5b962991cfddb","modified":1767161262395},{"_id":"source/img/vuejs3.png","hash":"166ebe833436ce7c405bceef24eda1ce3fc7d56d","modified":1767161262393},{"_id":"source/tags/index.md","hash":"517f7f30f699cd482a204caa52b2f7249e11b9dd","modified":1767161262401},{"_id":"source/img/vuejs6.png","hash":"c5fff1d55e5b16b5b5ea43006cd203921809ced7","modified":1767161262396},{"_id":"source/img/dom.png","hash":"d15b6330a3225cb3c055e0e0357edc5438f97b34","modified":1767161262365},{"_id":"source/img/github-pages.png","hash":"a886628ff8fd3e51080f6272f93857dd25301bd3","modified":1767161262368},{"_id":"source/img/dom1.png","hash":"9f12672e2ac91aa72211ef3e3f1cae90f27a38dd","modified":1767161262366},{"_id":"source/img/libuv.png","hash":"2a1787a687f6b18d57c1244339337b57297e0eec","modified":1767161262372},{"_id":"source/img/slot.jpeg","hash":"e1aa14e832eb2f04b2c33619bbe0552d5dbbb254","modified":1767161262389},{"_id":"source/img/updateChildren.png","hash":"468e6c6cb19c9fd057d3fa67c212c1b4a1144b2a","modified":1767161262391},{"_id":"source/img/sameVnode.png","hash":"9ce03a5c5f53d34fa1a4552b98ea24cd12756f53","modified":1767161262388},{"_id":"source/img/vuejs4.png","hash":"80076921c69eeb7a288fec82292cb91ca527cfc7","modified":1767161262394},{"_id":"source/img/vuejs7.png","hash":"f140452a07d00675edb7f89f91f0522b3d93bfba","modified":1767161262398},{"_id":"source/img/functionnal.gif","hash":"626f962cbab56fd66586ef162ec9b1fc093ad461","modified":1767161262367},{"_id":"source/img/Garbled.png","hash":"c200754d68171ec372c4aa0c43fbe5660f01d0ce","modified":1767161262355},{"_id":"source/img/diff-diagram.png","hash":"bf4ab0f2da34703ff636e5dd0e023f3382977143","modified":1767161262363},{"_id":"source/img/diff.png","hash":"18e556ec4ed301bc00e428501218cda5029245db","modified":1767161262364},{"_id":"source/img/jy.png","hash":"8e0433380fd921567d13efed00660952a79fac48","modified":1767161262370},{"_id":"source/img/ownership.png","hash":"13849bf1bcac05a63a744bbffc48e4d721c2c26f","modified":1767161262384},{"_id":"source/img/nerve1.png","hash":"eeb77b5d3ac2a74646ad072c2c34688b300580ef","modified":1767161262382},{"_id":"source/img/ownership1.png","hash":"d8cbda4930ae6407be37956c05ecdf3efe0fd758","modified":1767161262387},{"_id":"source/img/nerve.png","hash":"733fd8fee312c1ecfe5be5d63f554de7ac271d5a","modified":1767161262378},{"_id":"source/img/blockchain-basic-core.png","hash":"21527b978dc583e76ef61019e374df99ed06ef58","modified":1767161262360},{"_id":"themes/hexo-theme-next-master/.editorconfig","hash":"8570735a8d8d034a3a175afd1dd40b39140b3e6a","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/.eslintrc.json","hash":"cc5f297f0322672fe3f684f823bc4659e4a54c41","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/.stylintrc","hash":"2cf4d637b56d8eb423f59656a11f6403aa90f550","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/.gitattributes","hash":"a54f902957d49356376b59287b894b1a3d7a003f","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/.gitignore","hash":"56f3470755c20311ddd30d421b377697a6e5e68b","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/.travis.yml","hash":"ecca3b919a5b15886e3eca58aa84aafc395590da","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/README.md","hash":"9b4b7d66aca47f9c65d6321b14eef48d95c4dff1","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/LICENSE.md","hash":"18144d8ed58c75af66cb419d54f3f63374cd5c5b","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/_config.yml","hash":"d273bfec0222a570adefed9b302bfe6560edeb4d","modified":1767325142310},{"_id":"themes/hexo-theme-next-master/crowdin.yml","hash":"e026078448c77dcdd9ef50256bb6635a8f83dca6","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/gulpfile.js","hash":"1b4fc262b89948937b9e3794de812a7c1f2f3592","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/package.json","hash":"62fad6de02adbbba9fb096cbe2dcc15fe25f2435","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/.github/CONTRIBUTING.md","hash":"e554931b98f251fd49ff1d2443006d9ea2c20461","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/.github/CODE_OF_CONDUCT.md","hash":"aa4cb7aff595ca628cb58160ee1eee117989ec4e","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/.github/issue-close-app.yml","hash":"7cba457eec47dbfcfd4086acd1c69eaafca2f0cd","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/.github/issue_label_bot.yaml","hash":"fca600ddef6f80c5e61aeed21722d191e5606e5b","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/.github/config.yml","hash":"1d3f4e8794986817c0fead095c74f756d45f91ed","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/.github/PULL_REQUEST_TEMPLATE.md","hash":"1a435c20ae8fa183d49bbf96ac956f7c6c25c8af","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/docs/ALGOLIA-SEARCH.md","hash":"c7a994b9542040317d8f99affa1405c143a94a38","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/.github/release-drafter.yml","hash":"3cc10ce75ecc03a5ce86b00363e2a17eb65d15ea","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/.github/mergeable.yml","hash":"0ee56e23bbc71e1e76427d2bd255a9879bd36e22","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/docs/AGPL3.md","hash":"0d2b8c5fa8a614723be0767cc3bca39c49578036","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/docs/DATA-FILES.md","hash":"cddbdc91ee9e65c37a50bec12194f93d36161616","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/docs/AUTHORS.md","hash":"10135a2f78ac40e9f46b3add3e360c025400752f","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/.github/lock.yml","hash":"61173b9522ebac13db2c544e138808295624f7fd","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/docs/LICENSE.txt","hash":"368bf2c29d70f27d8726dd914f1b3211cae4bbab","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/docs/INSTALLATION.md","hash":"af88bcce035780aaa061261ed9d0d6c697678618","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/docs/LEANCLOUD-COUNTER-SECURITY.md","hash":"94dc3404ccb0e5f663af2aa883c1af1d6eae553d","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/languages/ar.yml","hash":"9815e84e53d750c8bcbd9193c2d44d8d910e3444","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/docs/MATH.md","hash":"d645b025ec7fb9fbf799b9bb76af33b9f5b9ed93","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/languages/de.yml","hash":"74c59f2744217003b717b59d96e275b54635abf5","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/docs/UPDATE-FROM-5.1.X.md","hash":"8b6e4b2c9cfcb969833092bdeaed78534082e3e6","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/.github/support.yml","hash":"d75db6ffa7b4ca3b865a925f9de9aef3fc51925c","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/languages/es.yml","hash":"c64cf05f356096f1464b4b1439da3c6c9b941062","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/languages/fa.yml","hash":"3676b32fda37e122f3c1a655085a1868fb6ad66b","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/languages/default.yml","hash":"ea5e6aee4cb14510793ac4593a3bddffe23e530c","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/languages/en.yml","hash":"45bc5118828bdc72dcaa25282cd367c8622758cb","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/languages/ko.yml","hash":"0feea9e43cd399f3610b94d755a39fff1d371e97","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/languages/ja.yml","hash":"0cf0baa663d530f22ff380a051881216d6adcdd8","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/.github/stale.yml","hash":"fdf82de9284f8bc8e0b0712b4cc1cb081a94de59","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/languages/fr.yml","hash":"752bf309f46a2cd43890b82300b342d7218d625f","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/languages/it.yml","hash":"44759f779ce9c260b895532de1d209ad4bd144bf","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/languages/id.yml","hash":"572ed855d47aafe26f58c73b1394530754881ec2","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/languages/nl.yml","hash":"5af3473d9f22897204afabc08bb984b247493330","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/languages/hu.yml","hash":"b1ebb77a5fd101195b79f94de293bcf9001d996f","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/languages/pt-BR.yml","hash":"67555b1ba31a0242b12fc6ce3add28531160e35b","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/languages/ru.yml","hash":"e993d5ca072f7f6887e30fc0c19b4da791ca7a88","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/languages/tr.yml","hash":"2b041eeb8bd096f549464f191cfc1ea0181daca4","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/languages/pt.yml","hash":"718d131f42f214842337776e1eaddd1e9a584054","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/archive.swig","hash":"e4e31317a8df68f23156cfc49e9b1aa9a12ad2ed","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/languages/uk.yml","hash":"3a6d635b1035423b22fc86d9455dba9003724de9","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/languages/vi.yml","hash":"93393b01df148dcbf0863f6eee8e404e2d94ef9e","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_layout.swig","hash":"1726de2ad36c425b008395e422c2a1ce3a300909","modified":1767318684723},{"_id":"themes/hexo-theme-next-master/languages/zh-CN.yml","hash":"a1f15571ee7e1e84e3cc0985c3ec4ba1a113f6f8","modified":1767320834268},{"_id":"themes/hexo-theme-next-master/layout/index.swig","hash":"7f403a18a68e6d662ae3e154b2c1d3bbe0801a23","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/languages/zh-HK.yml","hash":"3789f94010f948e9f23e21235ef422a191753c65","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/page.swig","hash":"db581bdeac5c75fabb0f17d7c5e746e47f2a9168","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/category.swig","hash":"1bde61cf4d2d171647311a0ac2c5c7933f6a53b0","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/tag.swig","hash":"0dfb653bd5de980426d55a0606d1ab122bd8c017","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/post.swig","hash":"2f6d992ced7e067521fdce05ffe4fd75481f41c5","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/languages/zh-TW.yml","hash":"8c09da7c4ec3fca2c6ee897b2eea260596a2baa1","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/docs/ru/DATA-FILES.md","hash":"0bd2d696f62a997a11a7d84fec0130122234174e","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/.github/ISSUE_TEMPLATE/bug-report.md","hash":"c3e6b8196c983c40fd140bdeca012d03e6e86967","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/.github/ISSUE_TEMPLATE/feature-request.md","hash":"12d99fb8b62bd9e34d9672f306c9ae4ace7e053e","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/scripts/renderer.js","hash":"49a65df2028a1bc24814dc72fa50d52231ca4f05","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/.github/ISSUE_TEMPLATE/other.md","hash":"d3efc0df0275c98440e69476f733097916a2d579","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/docs/ru/INSTALLATION.md","hash":"9c4fe2873123bf9ceacab5c50d17d8a0f1baef27","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/.github/ISSUE_TEMPLATE/question.md","hash":"53df7d537e26aaf062d70d86835c5fd8f81412f3","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/docs/zh-CN/ALGOLIA-SEARCH.md","hash":"34b88784ec120dfdc20fa82aadeb5f64ef614d14","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/docs/ru/UPDATE-FROM-5.1.X.md","hash":"5237a368ab99123749d724b6c379415f2c142a96","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/docs/zh-CN/CODE_OF_CONDUCT.md","hash":"fb23b85db6f7d8279d73ae1f41631f92f64fc864","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/docs/ru/README.md","hash":"85dd68ed1250897a8e4a444a53a68c1d49eb7e11","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/docs/zh-CN/DATA-FILES.md","hash":"ca1030efdfca5e20f9db2e7a428998e66a24c0d0","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/docs/zh-CN/CONTRIBUTING.md","hash":"d3f03be036b75dc71cf3c366cd75aee7c127c874","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/docs/zh-CN/README.md","hash":"c038629ff8f3f24e8593c4c8ecf0bef3a35c750d","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/docs/zh-CN/MATH.md","hash":"b92585d251f1f9ebe401abb5d932cb920f9b8b10","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/docs/zh-CN/INSTALLATION.md","hash":"579c7bd8341873fb8be4732476d412814f1a3df7","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_macro/post-collapse.swig","hash":"9c8dc0b8170679cdc1ee9ee8dbcbaebf3f42897b","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/docs/zh-CN/UPDATE-FROM-5.1.X.md","hash":"d9ce7331c1236bbe0a551d56cef2405e47e65325","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/scripts/events/index.js","hash":"5743cde07f3d2aa11532a168a652e52ec28514fd","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/docs/zh-CN/LEANCLOUD-COUNTER-SECURITY.md","hash":"8b18f84503a361fc712b0fe4d4568e2f086ca97d","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_macro/sidebar.swig","hash":"71655ca21907e9061b6e8ac52d0d8fbf54d0062b","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_partials/comments.swig","hash":"db6ab5421b5f4b7cb32ac73ad0e053fdf065f83e","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_macro/post.swig","hash":"42f5e3001d9d5e3da00f168993f482db56a08411","modified":1767319569136},{"_id":"themes/hexo-theme-next-master/scripts/filters/locals.js","hash":"b193a936ee63451f09f8886343dcfdca577c0141","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/scripts/filters/minify.js","hash":"19985723b9f677ff775f3b17dcebf314819a76ac","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/scripts/filters/front-matter.js","hash":"703bdd142a671b4b67d3d9dfb4a19d1dd7e7e8f7","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/scripts/filters/default-injects.js","hash":"aec50ed57b9d5d3faf2db3c88374f107203617e0","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_partials/footer.swig","hash":"4ade30dd31a55c27592ec3a065c96fffa2059ba5","modified":1767322535444},{"_id":"themes/hexo-theme-next-master/scripts/helpers/engine.js","hash":"bdb424c3cc0d145bd0c6015bb1d2443c8a9c6cda","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/scripts/filters/post.js","hash":"44ba9b1c0bdda57590b53141306bb90adf0678db","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_partials/languages.swig","hash":"ba9e272f1065b8f0e8848648caa7dea3f02c6be1","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/scripts/helpers/font.js","hash":"40cf00e9f2b7aa6e5f33d412e03ed10304b15fd7","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_partials/pagination.swig","hash":"9876dbfc15713c7a47d4bcaa301f4757bd978269","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_partials/widgets.swig","hash":"83a40ce83dfd5cada417444fb2d6f5470aae6bb0","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/scripts/helpers/next-config.js","hash":"5e11f30ddb5093a88a687446617a46b048fa02e5","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_third-party/baidu-push.swig","hash":"b782eb2e34c0c15440837040b5d65b093ab6ec04","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_third-party/index.swig","hash":"70c3c01dd181de81270c57f3d99b6d8f4c723404","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_third-party/quicklink.swig","hash":"311e5eceec9e949f1ea8d623b083cec0b8700ff2","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/scripts/helpers/next-url.js","hash":"958e86b2bd24e4fdfcbf9ce73e998efe3491a71f","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_colors.styl","hash":"a8442520f719d3d7a19811cb3b85bcfd4a596e1f","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_third-party/rating.swig","hash":"2731e262a6b88eaee2a3ca61e6a3583a7f594702","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_mixins.styl","hash":"e31a557f8879c2f4d8d5567ee1800b3e03f91f6e","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/main.styl","hash":"a3a3bbb5a973052f0186b3523911cb2539ff7b88","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/images/algolia_logo.svg","hash":"ec119560b382b2624e00144ae01c137186e91621","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/images/avatar.gif","hash":"18c53e15eb0c84b139995f9334ed8522b40aeaf6","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/images/favicon-16x16-next.png","hash":"06f53d703ea846f88e704f9b7dd7de45869ce7d6","modified":1767325000534},{"_id":"themes/hexo-theme-next-master/source/images/favicon-32x32-next.png","hash":"9bbe6ed6528183c8ff266add9efbb73820de8220","modified":1767324991860},{"_id":"themes/hexo-theme-next-master/source/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/images/logo.svg","hash":"d29cacbae1bdc4bbccb542107ee0524fe55ad6de","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/scripts/tags/button.js","hash":"8c6b45f36e324820c919a822674703769e6da32c","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/scripts/tags/caniuse.js","hash":"94e0bbc7999b359baa42fa3731bdcf89c79ae2b3","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/scripts/tags/center-quote.js","hash":"f1826ade2d135e2f60e2d95cb035383685b3370c","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/scripts/tags/mermaid.js","hash":"983c6c4adea86160ecc0ba2204bc312aa338121d","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/scripts/tags/group-pictures.js","hash":"d902fd313e8d35c3cc36f237607c2a0536c9edf1","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/scripts/tags/label.js","hash":"fc5b267d903facb7a35001792db28b801cccb1f8","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/scripts/tags/pdf.js","hash":"8c613b39e7bff735473e35244b5629d02ee20618","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_scripts/noscript.swig","hash":"d1f2bfde6f1da51a2b35a7ab9e7e8eb6eefd1c6b","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/scripts/tags/video.js","hash":"e5ff4c44faee604dd3ea9db6b222828c4750c227","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/scripts/tags/note.js","hash":"0a02bb4c15aec41f6d5f1271cdb5c65889e265d9","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/scripts/tags/tabs.js","hash":"93d8a734a3035c1d3f04933167b500517557ba3e","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_scripts/pjax.swig","hash":"4d2c93c66e069852bb0e3ea2e268d213d07bfa3f","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/js/bookmark.js","hash":"9734ebcb9b83489686f5c2da67dc9e6157e988ad","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_scripts/vendors.swig","hash":"ef38c213679e7b6d2a4116f56c9e55d678446069","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_scripts/index.swig","hash":"cea942b450bcb0f352da78d76dc6d6f1d23d5029","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_scripts/three.swig","hash":"a4f42f2301866bd25a784a2281069d8b66836d0b","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/js/local-search.js","hash":"35ccf100d8f9c0fd6bfbb7fa88c2a76c42a69110","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/scripts/filters/comment/changyan.js","hash":"a54708fd9309b4357c423a3730eb67f395344a5e","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/js/motion.js","hash":"72df86f6dfa29cce22abeff9d814c9dddfcf13a9","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/js/next-boot.js","hash":"a1b0636423009d4a4e4cea97bcbf1842bfab582c","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/scripts/filters/comment/disqus.js","hash":"4c0c99c7e0f00849003dfce02a131104fb671137","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/lib/anime.min.js","hash":"47cb482a8a488620a793d50ba8f6752324b46af3","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/js/utils.js","hash":"730cca7f164eaf258661a61ff3f769851ff1e5da","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/scripts/filters/comment/default-config.js","hash":"7f2d93af012c1e14b8596fecbfc7febb43d9b7f5","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/scripts/filters/comment/disqusjs.js","hash":"7f8b92913d21070b489457fa5ed996d2a55f2c32","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/js/algolia-search.js","hash":"498d233eb5c7af6940baf94c1a1c36fdf1dd2636","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/scripts/filters/comment/gitalk.js","hash":"e51dc3072c1ba0ea3008f09ecae8b46242ec6021","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/scripts/filters/comment/common.js","hash":"2486f3e0150c753e5f3af1a3665d074704b8ee2c","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/scripts/filters/comment/livere.js","hash":"d5fefc31fba4ab0188305b1af1feb61da49fdeb0","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/scripts/events/lib/config.js","hash":"d34c6040b13649714939f59be5175e137de65ede","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/scripts/events/lib/injects-point.js","hash":"6661c1c91c7cbdefc6a5e6a034b443b8811235a1","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/scripts/filters/comment/valine.js","hash":"6cbd85f9433c06bae22225ccf75ac55e04f2d106","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_partials/header/brand.swig","hash":"c70f8e71e026e878a4e9d5ab3bbbf9b0b23c240c","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/scripts/events/lib/injects.js","hash":"f233d8d0103ae7f9b861344aa65c1a3c1de8a845","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_partials/header/index.swig","hash":"7dbe93b8297b746afb89700b4d29289556e85267","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_partials/header/menu-item.swig","hash":"9440d8a3a181698b80e1fa47f5104f4565d8cdf3","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_partials/head/head-unique.swig","hash":"000bad572d76ee95d9c0a78f9ccdc8d97cc7d4b4","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_partials/page/breadcrumb.swig","hash":"c851717497ca64789f2176c9ecd1dedab237b752","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_partials/head/head.swig","hash":"810d544019e4a8651b756dd23e5592ee851eda71","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_partials/post/post-copyright.swig","hash":"954ad71536b6eb08bd1f30ac6e2f5493b69d1c04","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_partials/post/post-followme.swig","hash":"ceba16b9bd3a0c5c8811af7e7e49d0f9dcb2f41e","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_partials/page/page-header.swig","hash":"9b7a66791d7822c52117fe167612265356512477","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_third-party/analytics/baidu-analytics.swig","hash":"4790058691b7d36cf6d2d6b4e93795a7b8d608ad","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_partials/header/menu.swig","hash":"d31f896680a6c2f2c3f5128b4d4dd46c87ce2130","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_partials/header/sub-menu.swig","hash":"ae2261bea836581918a1c2b0d1028a78718434e0","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_third-party/analytics/google-analytics.swig","hash":"2fa2b51d56bfac6a1ea76d651c93b9c20b01c09b","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_third-party/chat/chatra.swig","hash":"f910618292c63871ca2e6c6e66c491f344fa7b1f","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_partials/post/post-footer.swig","hash":"8f14f3f8a1b2998d5114cc56b680fb5c419a6b07","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_partials/post/post-related.swig","hash":"f79c44692451db26efce704813f7a8872b7e63a0","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_third-party/chat/tidio.swig","hash":"cba0e6e0fad08568a9e74ba9a5bee5341cfc04c1","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_partials/post/post-reward.swig","hash":"2b1a73556595c37951e39574df5a3f20b2edeaef","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_third-party/analytics/growingio.swig","hash":"5adea065641e8c55994dd2328ddae53215604928","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_partials/sidebar/site-overview.swig","hash":"c46849e0af8f8fb78baccd40d2af14df04a074af","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_partials/search/algolia-search.swig","hash":"48430bd03b8f19c9b8cdb2642005ed67d56c6e0b","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_partials/search/localsearch.swig","hash":"f48a6a8eba04eb962470ce76dd731e13074d4c45","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_third-party/analytics/index.swig","hash":"1472cabb0181f60a6a0b7fec8899a4d03dfb2040","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_third-party/math/index.swig","hash":"6c5976621efd5db5f7c4c6b4f11bc79d6554885f","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_third-party/math/katex.swig","hash":"4791c977a730f29c846efcf6c9c15131b9400ead","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_third-party/math/mathjax.swig","hash":"ecf751321e799f0fb3bf94d049e535130e2547aa","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_third-party/comments/changyan.swig","hash":"f39a5bf3ce9ee9adad282501235e0c588e4356ec","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_partials/search/index.swig","hash":"2be50f9bfb1c56b85b3b6910a7df27f51143632c","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_third-party/comments/disqus.swig","hash":"b14908644225d78c864cd0a9b60c52407de56183","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_third-party/comments/gitalk.swig","hash":"d6ceb70648555338a80ae5724b778c8c58d7060d","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_third-party/comments/disqusjs.swig","hash":"82f5b6822aa5ec958aa987b101ef860494c6cf1f","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_third-party/comments/livere.swig","hash":"f7a9eca599a682479e8ca863db59be7c9c7508c8","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_third-party/comments/valine.swig","hash":"be0a8eccf1f6dc21154af297fc79555343031277","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_third-party/statistics/busuanzi-counter.swig","hash":"4b1986e43d6abce13450d2b41a736dd6a5620a10","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_third-party/search/algolia-search.swig","hash":"d35a999d67f4c302f76fdf13744ceef3c6506481","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_third-party/statistics/firestore.swig","hash":"b26ac2bfbe91dd88267f8b96aee6bb222b265b7a","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_third-party/statistics/index.swig","hash":"5f6a966c509680dbfa70433f9d658cee59c304d7","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_third-party/search/localsearch.swig","hash":"767b6c714c22588bcd26ba70b0fc19b6810cbacd","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_third-party/statistics/cnzz-analytics.swig","hash":"a17ace37876822327a2f9306a472974442c9005d","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_third-party/tags/pdf.swig","hash":"d30b0e255a8092043bac46441243f943ed6fb09b","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_third-party/statistics/lean-analytics.swig","hash":"d56d5af427cdfecc33a0f62ee62c056b4e33d095","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_third-party/tags/mermaid.swig","hash":"f3c43664a071ff3c0b28bd7e59b5523446829576","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_third-party/search/swiftype.swig","hash":"ba0dbc06b9d244073a1c681ff7a722dcbf920b51","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_variables/Muse.styl","hash":"62df49459d552bbf73841753da8011a1f5e875c8","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_variables/Gemini.styl","hash":"f4e694e5db81e57442c7e34505a416d818b3044a","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_variables/Mist.styl","hash":"f70be8e229da7e1715c11dd0e975a2e71e453ac8","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_variables/base.styl","hash":"818508748b7a62e02035e87fe58e75b603ed56dc","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_variables/Pisces.styl","hash":"612ec843372dae709acb17112c1145a53450cc59","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_scripts/pages/schedule.swig","hash":"077b5d66f6309f2e7dcf08645058ff2e03143e6c","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_scripts/schemes/gemini.swig","hash":"1c910fc066c06d5fbbe9f2b0c47447539e029af7","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/js/schemes/pisces.js","hash":"0ac5ce155bc58c972fe21c4c447f85e6f8755c62","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/js/schemes/muse.js","hash":"1eb9b88103ddcf8827b1a7cbc56471a9c5592d53","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_scripts/schemes/muse.swig","hash":"7f14ef43d9e82bc1efc204c5adf0b1dbfc919a9f","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_scripts/schemes/mist.swig","hash":"7f14ef43d9e82bc1efc204c5adf0b1dbfc919a9f","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/layout/_scripts/schemes/pisces.swig","hash":"1c910fc066c06d5fbbe9f2b0c47447539e029af7","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_schemes/Gemini/index.styl","hash":"7785bd756e0c4acede3a47fec1ed7b55988385a5","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/components/components.styl","hash":"8e7b57a72e757cf95278239641726bb2d5b869d1","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/components/back-to-top-sidebar.styl","hash":"ca5e70662dcfb261c25191cc5db5084dcf661c76","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_schemes/Muse/_header.styl","hash":"f0131db6275ceaecae7e1a6a3798b8f89f6c850d","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_schemes/Muse/_layout.styl","hash":"4d1c17345d2d39ef7698f7acf82dfc0f59308c34","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/components/back-to-top.styl","hash":"a47725574e1bee3bc3b63b0ff2039cc982b17eff","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_schemes/Muse/_menu.styl","hash":"93db5dafe9294542a6b5f647643cb9deaced8e06","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_schemes/Muse/_sidebar.styl","hash":"2b2e7b5cea7783c9c8bb92655e26a67c266886f0","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_schemes/Muse/index.styl","hash":"6ad168288b213cec357e9b5a97674ff2ef3a910c","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_schemes/Muse/_sub-menu.styl","hash":"c48ccd8d6651fe1a01faff8f01179456d39ba9b1","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_schemes/Pisces/_header.styl","hash":"e282df938bd029f391c466168d0e68389978f120","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_schemes/Mist/_menu.styl","hash":"7104b9cef90ca3b140d7a7afcf15540a250218fc","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_schemes/Mist/_header.styl","hash":"f6516d0f7d89dc7b6c6e143a5af54b926f585d82","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_schemes/Mist/_layout.styl","hash":"bb7ace23345364eb14983e860a7172e1683a4c94","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/components/reading-progress.styl","hash":"2e3bf7baf383c9073ec5e67f157d3cb3823c0957","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_schemes/Mist/_posts-expand.styl","hash":"6136da4bbb7e70cec99f5c7ae8c7e74f5e7c261a","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_schemes/Pisces/_layout.styl","hash":"70a4324b70501132855b5e59029acfc5d3da1ebd","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_schemes/Mist/index.styl","hash":"a717969829fa6ef88225095737df3f8ee86c286b","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_schemes/Pisces/_menu.styl","hash":"85da2f3006f4bef9a2199416ecfab4d288f848c4","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_schemes/Pisces/_sidebar.styl","hash":"44f47c88c06d89d06f220f102649057118715828","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/outline/mobile.styl","hash":"681d33e3bc85bdca407d93b134c089264837378c","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/outline/outline.styl","hash":"a1690e035b505d28bdef2b4424c13fc6312ab049","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/scaffolding/base.styl","hash":"0b2c4b78eead410020d7c4ded59c75592a648df8","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_schemes/Pisces/_sub-menu.styl","hash":"e740deadcfc4f29c5cb01e40f9df6277262ba4e3","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/scaffolding/buttons.styl","hash":"a2e9e00962e43e98ec2614d6d248ef1773bb9b78","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_schemes/Pisces/index.styl","hash":"6ad168288b213cec357e9b5a97674ff2ef3a910c","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/scaffolding/comments.styl","hash":"b1f0fab7344a20ed6748b04065b141ad423cf4d9","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/scaffolding/normalize.styl","hash":"b56367ea676ea8e8783ea89cd4ab150c7da7a060","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/scaffolding/scaffolding.styl","hash":"523fb7b653b87ae37fc91fc8813e4ffad87b0d7e","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/scaffolding/pagination.styl","hash":"8f58570a1bbc34c4989a47a1b7d42a8030f38b06","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/lib/font-awesome/css/all.min.css","hash":"0038dc97c79451578b7bd48af60ba62282b4082b","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/scaffolding/tables.styl","hash":"18ce72d90459c9aa66910ac64eae115f2dde3767","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/scaffolding/toggles.styl","hash":"179e33b8ac7f4d8a8e76736a7e4f965fe9ab8b42","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/components/post/post-collapse.styl","hash":"e75693f33dbc92afc55489438267869ae2f3db54","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/lib/font-awesome/webfonts/fa-regular-400.woff2","hash":"260bb01acd44d88dcb7f501a238ab968f86bef9e","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/components/post/post-copyright.styl","hash":"f49ca072b5a800f735e8f01fc3518f885951dd8e","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/components/post/post-eof.styl","hash":"902569a9dea90548bec21a823dd3efd94ff7c133","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/components/post/post-expand.styl","hash":"ded41fd9d20a5e8db66aaff7cc50f105f5ef2952","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/components/post/post-header.styl","hash":"65cb6edb69e94e70e3291e9132408361148d41d5","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/components/post/post-followme.styl","hash":"1e4190c10c9e0c9ce92653b0dbcec21754b0b69d","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/components/post/post-gallery.styl","hash":"72d495a88f7d6515af425c12cbc67308a57d88ea","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/components/pages/breadcrumb.styl","hash":"fafc96c86926b22afba8bb9418c05e6afbc05a57","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/components/post/post-nav.styl","hash":"6a97bcfa635d637dc59005be3b931109e0d1ead5","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/components/post/post-reward.styl","hash":"d114b2a531129e739a27ba6271cfe6857aa9a865","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/components/post/post-rtl.styl","hash":"f5c2788a78790aca1a2f37f7149d6058afb539e0","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/components/pages/categories.styl","hash":"2bd0eb1512415325653b26d62a4463e6de83c5ac","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/components/pages/schedule.styl","hash":"e771dcb0b4673e063c0f3e2d73e7336ac05bcd57","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/components/third-party/gitalk.styl","hash":"8a7fc03a568b95be8d3337195e38bc7ec5ba2b23","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/components/post/post-widgets.styl","hash":"5b5649b9749e3fd8b63aef22ceeece0a6e1df605","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/components/pages/tag-cloud.styl","hash":"d21d4ac1982c13d02f125a67c065412085a92ff2","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/components/pages/pages.styl","hash":"7504dbc5c70262b048143b2c37d2b5aa2809afa2","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/components/post/post-tags.styl","hash":"99e12c9ce3d14d4837e3d3f12fc867ba9c565317","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/components/third-party/math.styl","hash":"b49e9fbd3c182b8fc066b8c2caf248e3eb748619","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/components/third-party/related-posts.styl","hash":"e2992846b39bf3857b5104675af02ba73e72eed5","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/outline/footer/footer.styl","hash":"454a4aebfabb4469b92a8cbb49f46c49ac9bf165","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/components/third-party/search.styl","hash":"9f0b93d109c9aec79450c8a0cf4a4eab717d674d","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/components/third-party/third-party.styl","hash":"9a878d0119785a2316f42aebcceaa05a120b9a7a","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/components/post/post.styl","hash":"6dc0604db8760dbe65d6ef0987e466d097d6e162","modified":1767320582395},{"_id":"themes/hexo-theme-next-master/source/css/_common/scaffolding/highlight/copy-code.styl","hash":"f71a3e86c05ea668b008cf05a81f67d92b6d65e4","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/scaffolding/highlight/diff.styl","hash":"d3f73688bb7423e3ab0de1efdf6db46db5e34f80","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/scaffolding/highlight/highlight.styl","hash":"35c871a809afa8306c8cde13651010e282548bc6","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/scaffolding/highlight/theme.styl","hash":"3b3acc5caa0b95a2598bef4eeacb21bab21bea56","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/outline/header/bookmark.styl","hash":"e2d606f1ac343e9be4f15dbbaf3464bc4df8bf81","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/outline/header/github-banner.styl","hash":"e7a9fdb6478b8674b1cdf94de4f8052843fb71d9","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/outline/sidebar/sidebar-author-links.styl","hash":"2cb1876e9e0c9ac32160888af27b1178dbcb0616","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/outline/header/headerband.styl","hash":"0caf32492692ba8e854da43697a2ec8a41612194","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/outline/header/header.styl","hash":"a793cfff86ad4af818faef04c18013077873f8f0","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/outline/header/site-meta.styl","hash":"45a239edca44acecf971d99b04f30a1aafbf6906","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/outline/header/menu.styl","hash":"5f432a6ed9ca80a413c68b00e93d4a411abf280a","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/outline/header/site-nav.styl","hash":"b2fc519828fe89a1f8f03ff7b809ad68cd46f3d7","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/outline/sidebar/sidebar-author.styl","hash":"fa0222197b5eee47e18ac864cdc6eac75678b8fe","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/outline/sidebar/sidebar-blogroll.styl","hash":"44487d9ab290dc97871fa8dd4487016deb56e123","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/outline/sidebar/sidebar-button.styl","hash":"1f0e7fbe80956f47087c2458ea880acf7a83078b","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/outline/sidebar/sidebar-dimmer.styl","hash":"9b479c2f9a9bfed77885e5093b8245cc5d768ec7","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/scaffolding/tags/blockquote-center.styl","hash":"1d2778ca5aeeeafaa690dc2766b01b352ab76a02","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/scaffolding/tags/label.styl","hash":"d7fce4b51b5f4b7c31d93a9edb6c6ce740aa0d6b","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/scaffolding/tags/group-pictures.styl","hash":"709d10f763e357e1472d6471f8be384ec9e2d983","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/outline/sidebar/sidebar-nav.styl","hash":"a960a2dd587b15d3b3fe1b59525d6fa971c6a6ec","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/outline/sidebar/sidebar-toc.styl","hash":"a05a4031e799bc864a4536f9ef61fe643cd421af","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/outline/sidebar/sidebar-toggle.styl","hash":"b3220db827e1adbca7880c2bb23e78fa7cbe95cb","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/outline/sidebar/site-state.styl","hash":"2a47f8a6bb589c2fb635e6c1e4a2563c7f63c407","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/outline/sidebar/sidebar.styl","hash":"a9cd93c36bae5af9223e7804963096274e8a4f03","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/scaffolding/tags/note.styl","hash":"e4d9a77ffe98e851c1202676940097ba28253313","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/scaffolding/tags/pdf.styl","hash":"b49c64f8e9a6ca1c45c0ba98febf1974fdd03616","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/scaffolding/tags/tabs.styl","hash":"f23670f1d8e749f3e83766d446790d8fd9620278","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/css/_common/scaffolding/tags/tags.styl","hash":"9e4c0653cfd3cc6908fa0d97581bcf80861fb1e7","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/lib/font-awesome/webfonts/fa-brands-400.woff2","hash":"509988477da79c146cb93fb728405f18e923c2de","modified":1627608806000},{"_id":"themes/hexo-theme-next-master/source/lib/font-awesome/webfonts/fa-solid-900.woff2","hash":"75a88815c47a249eadb5f0edc1675957f860cca7","modified":1627608806000},{"_id":"public/atom.xml","hash":"e343064cf93842146cfc89129afe5f84380f2db3","modified":1767325215335},{"_id":"public/search.xml","hash":"9bbb780763d06c24a492b1dcd26f7f6db5d56c25","modified":1767325215335},{"_id":"public/2021/09/01/跨浏览器窗口-7种方式 copy/index.html","hash":"1f4e70187ba7ab63397d6e94bf9263807649de10","modified":1767325215335},{"_id":"public/tags/index.html","hash":"1faf76377f7cdb884e5237f55b722c00c4016f28","modified":1767325215335},{"_id":"public/categories/index.html","hash":"e79a8fa0a8a96a47dec841b17169cf645e9313a5","modified":1767325215335},{"_id":"public/2021/09/01/跨浏览器窗口-7种方式/index.html","hash":"2968bd6be98f880d05cb68da8c7c855cf575882e","modified":1767325215335},{"_id":"public/2021/08/17/Vue-router核心原理/index.html","hash":"e050deb3f3e05c8ea2bd2cb7ec236602c7aaa86d","modified":1767325215335},{"_id":"public/2020/05/26/VUE中的inheritAttrs-attrs-listeners/index.html","hash":"ab3ef57ac3238b48c703f8660279195514515844","modified":1767325215335},{"_id":"public/2020/05/25/vue的functionnal使用/index.html","hash":"223bdb0bc82ebdeda7d411172a69361b928d779b","modified":1767325215335},{"_id":"public/2019/11/25/nodeJs回顾记录/index.html","hash":"98f584b57e23fc95974a07f1767c65952b25fdc0","modified":1767325215335},{"_id":"public/2020/05/19/如何清除已设置的npm淘宝镜像/index.html","hash":"401e95c64d27c01372eec88871cae8d6682ebf25","modified":1767325215335},{"_id":"public/2019/08/23/vue的-emit-on-once-off的使用/index.html","hash":"01e655367a5524fc52e4facc2111231702095004","modified":1767325215335},{"_id":"public/2019/08/15/在mac app store下载软件提示内存不足问题/index.html","hash":"d4059dec8d06dc4bb6e881e77f5f7b7a87e4a27b","modified":1767325215335},{"_id":"public/2019/07/09/hexo的基本操作/index.html","hash":"c78cab218f75c41c283c7fd08eaedc2751892638","modified":1767325215335},{"_id":"public/2019/07/09/Vue双向绑定实现原理/index.html","hash":"12cf6b6755b2e508c98feffd6733713cad291e71","modified":1767325215335},{"_id":"public/2019/05/31/Promise的使用/index.html","hash":"7b2dfcef49a06ea1d9935cb2103d071423a1c24e","modified":1767325215335},{"_id":"public/2019/04/22/slot的使用/index.html","hash":"283f386d99c730055908c2ea9d77adcb741736ce","modified":1767325215335},{"_id":"public/2019/02/18/探究call-和-apply-的原理/index.html","hash":"1dc5872c7d11fd41bb96cd3ad448712414c8555d","modified":1767325215335},{"_id":"public/2019/02/14/图片懒加载/index.html","hash":"896070e6458c8c2bd4f71c1ab81e6ba2da16187b","modified":1767325215335},{"_id":"public/2019/02/14/js获取事件坐标位置/index.html","hash":"a8d7c41ba41369ee83779ec1dc1b2192a351ee8d","modified":1767325215335},{"_id":"public/2019/02/04/深度学习之之神经网络/index.html","hash":"326da858c5e03308b48c714bbed5edb956166972","modified":1767325215335},{"_id":"public/2019/02/03/区块链技术/index.html","hash":"6fc6f0e92452620ed473838892ac7d279909d63a","modified":1767325215335},{"_id":"public/2019/01/31/Vuejs源码解析/index.html","hash":"a14dbd93902f41cb806de49a0f966dc4949f8909","modified":1767325215335},{"_id":"public/2019/01/30/vue-diff算法/index.html","hash":"83f2c673bc14433bebf0e8aff7122fc7cdaf8bc9","modified":1767325215335},{"_id":"public/2019/01/30/vue-source-code/index.html","hash":"1f9a567deda69807713fb1b9f87468035ba938eb","modified":1767325215335},{"_id":"public/2019/01/29/gulp和webpack区别/index.html","hash":"c0d58ade3dc64c7b0c3c9647d473332c5e3bf446","modified":1767325215335},{"_id":"public/2019/01/28/CommonJs-AMD-CMD/index.html","hash":"cc09342a42c118ac695207f314f75d0a8e291fb7","modified":1767325215335},{"_id":"public/2019/01/27/Emojis-url/index.html","hash":"2287c00213972bac46f35e8dc68ef980d8e562b7","modified":1767325215335},{"_id":"public/2019/01/25/webpack4-29-0/index.html","hash":"e64359e399792c802227bf8be07dd186fd9e5634","modified":1767325215335},{"_id":"public/2019/01/24/posts/index.html","hash":"17fcbf3ecb715ef0b813036f33bcadc50bff6975","modified":1767325215335},{"_id":"public/categories/web/index.html","hash":"4e9f906c4e675c57f4e1560f842cdb48aeb12a3e","modified":1767325215335},{"_id":"public/categories/web/page/2/index.html","hash":"a914dc058082486c21674dfa04838381b5bcf794","modified":1767325215335},{"_id":"public/categories/hexo的使用/index.html","hash":"0b3ec03c76de5c275a16699964d560939fccf73e","modified":1767325215335},{"_id":"public/categories/用机小技巧/index.html","hash":"a16dd5da8c0bbbb5fe473fb979957ef55283a0ae","modified":1767325215335},{"_id":"public/index.html","hash":"2870c4e0ff82880b48f616261ba787d762d0e6fa","modified":1767325215335},{"_id":"public/categories/区块链/index.html","hash":"210841ab98e89cf01efdc0e0eb71f6fad8a854d4","modified":1767325215335},{"_id":"public/categories/深度学习/index.html","hash":"97e21ac7a3cd3a0adbdd9d3e6688c14735661f3e","modified":1767325215335},{"_id":"public/page/2/index.html","hash":"7bf30a7163deb623b998ee400175639d7cbb6e4d","modified":1767325215335},{"_id":"public/archives/index.html","hash":"750261f9795cfdc7bd926df0d95b1dec1976071f","modified":1767325215335},{"_id":"public/archives/page/2/index.html","hash":"81192eb822601d941c9634005cb0c8792b2fdbf6","modified":1767325215335},{"_id":"public/page/3/index.html","hash":"af2022dce459c0753bb7f3b0d8b45c3a16fd3df7","modified":1767325215335},{"_id":"public/archives/page/3/index.html","hash":"1a9352d62407467f91e9e19fa5d0ee965217bedd","modified":1767325215335},{"_id":"public/archives/2019/index.html","hash":"82814f815361f798787e2da02ea675dc76d9f306","modified":1767325215335},{"_id":"public/archives/2019/page/2/index.html","hash":"a4a7fad5b9bb8df9a7bffe2553c0332e7e2238fa","modified":1767325215335},{"_id":"public/archives/2019/01/index.html","hash":"8a0e2be8c2601ee1c75462863cdbeb127a238a66","modified":1767325215335},{"_id":"public/archives/2019/02/index.html","hash":"680f81f749a17e6b249a22bb96354d9b47397ce3","modified":1767325215335},{"_id":"public/archives/2019/04/index.html","hash":"f96df1dcec1e08b6451f206196f4a16593cd4491","modified":1767325215335},{"_id":"public/archives/2019/05/index.html","hash":"05b8fea581143184e4289a816c488978efe0a3b6","modified":1767325215335},{"_id":"public/archives/2019/07/index.html","hash":"3c060fb0dc4da334978aa8ec61a2068d2a37cff5","modified":1767325215335},{"_id":"public/archives/2019/08/index.html","hash":"7a5f15d3268d8bf279e3e169f107785abea7ad05","modified":1767325215335},{"_id":"public/archives/2019/11/index.html","hash":"0f45bf51fe8858f0b3870272a9e4831fcd79ada4","modified":1767325215335},{"_id":"public/archives/2020/index.html","hash":"f42a522716a147b031ef5e0d6f526ab52aa617ec","modified":1767325215335},{"_id":"public/archives/2020/05/index.html","hash":"59986877abe1abdd23079ce11aec787e5213c82a","modified":1767325215335},{"_id":"public/archives/2021/index.html","hash":"121bd0d2cf2774889b2733db18e49d1fb284bd1c","modified":1767325215335},{"_id":"public/archives/2021/08/index.html","hash":"1251900625b20393dcc1c3aa7834950c6eebcbd3","modified":1767325215335},{"_id":"public/archives/2021/09/index.html","hash":"9784f0c03e09390cc9ab292992015c267502813b","modified":1767325215335},{"_id":"public/tags/CommonJS-AMD-CMD/index.html","hash":"cbe33328f936d5242fa56017a5c7e9cc10ed8a00","modified":1767325215335},{"_id":"public/tags/用JavaScript和Emoji-做地址栏动画/index.html","hash":"1127d3357e9bb2038fa7d0a9a5e7303e964db353","modified":1767325215335},{"_id":"public/tags/Promise的使用/index.html","hash":"0df83da2f64b279bf0da7a52f654fb7b58a949b3","modified":1767325215335},{"_id":"public/tags/Vue-router核心原理/index.html","hash":"95595af0771fa4e8208f1904d8e021b22f840f8c","modified":1767325215335},{"_id":"public/tags/—-Vue中inheritAttrs，-attrs，-listeners/index.html","hash":"66e065930aec965f076969d0abd7a0cb11e699e8","modified":1767325215335},{"_id":"public/tags/gulp和webpack区别/index.html","hash":"7e389ba8dea912978d19d975e04234e3081d7a35","modified":1767325215335},{"_id":"public/tags/hexo的基本操作/index.html","hash":"df0c90f7595871621beeb21384c918d4ee14f022","modified":1767325215335},{"_id":"public/tags/screenX-screenY/index.html","hash":"e6835e2d22bc9477f1229a67d3487b7123408172","modified":1767325215335},{"_id":"public/tags/clientX-slientY/index.html","hash":"d4cb4ee9c93a06bb0960467d3a63c3bc6e5b177c","modified":1767325215335},{"_id":"public/tags/offsetX-offsetY/index.html","hash":"0291dc04c25ee5721300afd4f195586d36e1826e","modified":1767325215335},{"_id":"public/tags/hexo/index.html","hash":"bc340fdbdd9528263c15f16eea9b2a832db9d672","modified":1767325215335},{"_id":"public/tags/nexT/index.html","hash":"253415d15da7052a454317cbd9e79695de7fd81f","modified":1767325215335},{"_id":"public/tags/搭建自己博客/index.html","hash":"aa1bb1189160ea73aab010e64f6e07f05f94fe8c","modified":1767325215335},{"_id":"public/tags/解决next主题搜索loadding问题/index.html","hash":"9a7831a227fbc3c715c73bde09b1d6739a390ac4","modified":1767325215335},{"_id":"public/tags/nodejs/index.html","hash":"6a2919021897b565aa0aebec210b9318cb672424","modified":1767325215335},{"_id":"public/tags/slot的使用/index.html","hash":"6e0bee2650001991259904af70e8de46cda4941f","modified":1767325215335},{"_id":"public/tags/vue的diff算法/index.html","hash":"b3f429fa73f3bad05173d3ba26c471397f97f520","modified":1767325215335},{"_id":"public/tags/Vue-js-内部运行机制/index.html","hash":"52571d64915a3300e50da6b6f8fce99b734bf087","modified":1767325215335},{"_id":"public/tags/patch/index.html","hash":"6884f986bdbdf1d22182cc88c07989d926400536","modified":1767325215335},{"_id":"public/tags/render-function/index.html","hash":"aafcd71efb4dc76029d505766917518c9b08e72c","modified":1767325215335},{"_id":"public/tags/diff/index.html","hash":"98b3c1eb442dce99e2f32fae9a3fa067cd060965","modified":1767325215335},{"_id":"public/tags/Vue双向绑定实现原理/index.html","hash":"2b085a8c446f705e26cfa152cb4b95fa662d7a71","modified":1767325215335},{"_id":"public/tags/vue中-emit-on-once-off的使用/index.html","hash":"e6c9c7328c7b44544c7a144e120b20b06c01af5e","modified":1767325215335},{"_id":"public/tags/vue的functionnal使用/index.html","hash":"bbaa880ef22c810c23dc861bdef4f9a9909ba8e1","modified":1767325215335},{"_id":"public/tags/webpack4/index.html","hash":"76b949e0b7caa40e5fdf854eb11d40e265195088","modified":1767325215335},{"_id":"public/tags/区块链理论和代码演示/index.html","hash":"50aae6c2b9d993257630aba8a12dc46fc3597bba","modified":1767325215335},{"_id":"public/tags/图片懒加载/index.html","hash":"af5cbac76dcdca111d3c94e0c3a8c33771a565cc","modified":1767325215335},{"_id":"public/tags/函数节流3种方式/index.html","hash":"234be2c09a1b17e36d8283bdff6aea8d4ae6c7fc","modified":1767325215335},{"_id":"public/tags/如何清除已设置的npm淘宝镜像/index.html","hash":"29848b6849946ccfb74952dff95a691ecf666e0c","modified":1767325215335},{"_id":"public/tags/探究call-和-apply-的原理/index.html","hash":"282184993894498d410f2f58442a5b1b10995f57","modified":1767325215335},{"_id":"public/tags/神经网络/index.html","hash":"f98a48e269f184f8d16256bf04dbca362209d0c5","modified":1767325215335},{"_id":"public/tags/跨浏览器窗口-7种方式/index.html","hash":"f777a9080a156272bceab803b76038dbafc5f90d","modified":1767325215335},{"_id":"public/img/7579449-a8a0b3970380eeeb.webp","hash":"4ab2f71cfe2ee898c8700b9e5215615ebbfe14b0","modified":1767325215335},{"_id":"public/img/7579449-9b4f591d793547b6.webp","hash":"d5f60d7386872646d35798f2c24a4a517b2a804f","modified":1767325215335},{"_id":"public/img/7579449-b2ab8dfe80fe828d.webp","hash":"88a4480ff989f912298f8bf735512a758f81de93","modified":1767325215335},{"_id":"public/img/curious.jpg","hash":"4e9569ac72ed4099f9a8a00e9986a45440f376e7","modified":1767325215335},{"_id":"public/img/callAndapply.jpg","hash":"7019ef22aa89dec5fe21c7d85599707a0e4a9dc1","modified":1767325215335},{"_id":"public/img/inheritAttrs1.webp","hash":"4af151162e8888bbfe337a2683a983a4da82e903","modified":1767325215335},{"_id":"public/img/inheritAttrs2.webp","hash":"913203670746b751c53f9e5aa90a8a3d98bdc264","modified":1767325215335},{"_id":"public/img/inheritAttrs3.webp","hash":"19e6c33a334f83ac08c791063a3c91a4cd3055ff","modified":1767325215335},{"_id":"public/img/lazyload.gif","hash":"b66fc917fcf1a46d531c9639ec8dde80c3838787","modified":1767325215335},{"_id":"public/img/location.jpeg","hash":"2874b3e15ea1abcec19bf1bc7020a31fee71cfd8","modified":1767325215335},{"_id":"public/img/vuejs2.png","hash":"dfc2f047d2a358cbb65915418d98de18f6a20cef","modified":1767325215335},{"_id":"public/img/urlimg.png","hash":"c75226d4b3ea485206e09db8d68e84a55db4434c","modified":1767325215335},{"_id":"public/img/vuejs3.png","hash":"166ebe833436ce7c405bceef24eda1ce3fc7d56d","modified":1767325215335},{"_id":"public/images/algolia_logo.svg","hash":"ec119560b382b2624e00144ae01c137186e91621","modified":1767325215335},{"_id":"public/img/vuejs5.png","hash":"f48bedd65628b5ff4e494502a8e5b962991cfddb","modified":1767325215335},{"_id":"public/images/avatar.gif","hash":"18c53e15eb0c84b139995f9334ed8522b40aeaf6","modified":1767325215335},{"_id":"public/img/vuejs6.png","hash":"c5fff1d55e5b16b5b5ea43006cd203921809ced7","modified":1767325215335},{"_id":"public/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1767325215335},{"_id":"public/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1767325215335},{"_id":"public/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1767325215335},{"_id":"public/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1767325215335},{"_id":"public/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1767325215335},{"_id":"public/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1767325215335},{"_id":"public/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1767325215335},{"_id":"public/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1767325215335},{"_id":"public/images/favicon-16x16-next.png","hash":"06f53d703ea846f88e704f9b7dd7de45869ce7d6","modified":1767325215335},{"_id":"public/lib/font-awesome/webfonts/fa-regular-400.woff2","hash":"260bb01acd44d88dcb7f501a238ab968f86bef9e","modified":1767325215335},{"_id":"public/img/dom.png","hash":"d15b6330a3225cb3c055e0e0357edc5438f97b34","modified":1767325215335},{"_id":"public/img/dom1.png","hash":"9f12672e2ac91aa72211ef3e3f1cae90f27a38dd","modified":1767325215335},{"_id":"public/img/github-pages.png","hash":"a886628ff8fd3e51080f6272f93857dd25301bd3","modified":1767325215335},{"_id":"public/img/libuv.png","hash":"2a1787a687f6b18d57c1244339337b57297e0eec","modified":1767325215335},{"_id":"public/img/sameVnode.png","hash":"9ce03a5c5f53d34fa1a4552b98ea24cd12756f53","modified":1767325215335},{"_id":"public/img/slot.jpeg","hash":"e1aa14e832eb2f04b2c33619bbe0552d5dbbb254","modified":1767325215335},{"_id":"public/img/updateChildren.png","hash":"468e6c6cb19c9fd057d3fa67c212c1b4a1144b2a","modified":1767325215335},{"_id":"public/img/vuejs4.png","hash":"80076921c69eeb7a288fec82292cb91ca527cfc7","modified":1767325215335},{"_id":"public/img/vuejs7.png","hash":"f140452a07d00675edb7f89f91f0522b3d93bfba","modified":1767325215335},{"_id":"public/images/favicon-32x32-next.png","hash":"9bbe6ed6528183c8ff266add9efbb73820de8220","modified":1767325215335},{"_id":"public/images/logo.svg","hash":"d29cacbae1bdc4bbccb542107ee0524fe55ad6de","modified":1767325215335},{"_id":"public/css/main.css","hash":"8842db19edff853d6b16ae1498a24ccff943c935","modified":1767325215335},{"_id":"public/js/algolia-search.js","hash":"498d233eb5c7af6940baf94c1a1c36fdf1dd2636","modified":1767325215335},{"_id":"public/js/bookmark.js","hash":"9734ebcb9b83489686f5c2da67dc9e6157e988ad","modified":1767325215335},{"_id":"public/js/next-boot.js","hash":"a1b0636423009d4a4e4cea97bcbf1842bfab582c","modified":1767325215335},{"_id":"public/js/local-search.js","hash":"35ccf100d8f9c0fd6bfbb7fa88c2a76c42a69110","modified":1767325215335},{"_id":"public/lib/anime.min.js","hash":"47cb482a8a488620a793d50ba8f6752324b46af3","modified":1767325215335},{"_id":"public/js/schemes/pisces.js","hash":"0ac5ce155bc58c972fe21c4c447f85e6f8755c62","modified":1767325215335},{"_id":"public/js/motion.js","hash":"72df86f6dfa29cce22abeff9d814c9dddfcf13a9","modified":1767325215335},{"_id":"public/js/utils.js","hash":"730cca7f164eaf258661a61ff3f769851ff1e5da","modified":1767325215335},{"_id":"public/js/schemes/muse.js","hash":"1eb9b88103ddcf8827b1a7cbc56471a9c5592d53","modified":1767325215335},{"_id":"public/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1767325215335},{"_id":"public/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1767325215335},{"_id":"public/lib/font-awesome/css/all.min.css","hash":"0038dc97c79451578b7bd48af60ba62282b4082b","modified":1767325215335},{"_id":"public/lib/font-awesome/webfonts/fa-brands-400.woff2","hash":"509988477da79c146cb93fb728405f18e923c2de","modified":1767325215335},{"_id":"public/lib/font-awesome/webfonts/fa-solid-900.woff2","hash":"75a88815c47a249eadb5f0edc1675957f860cca7","modified":1767325215335},{"_id":"public/img/functionnal.gif","hash":"626f962cbab56fd66586ef162ec9b1fc093ad461","modified":1767325215335},{"_id":"public/img/Garbled.png","hash":"c200754d68171ec372c4aa0c43fbe5660f01d0ce","modified":1767325215335},{"_id":"public/img/diff-diagram.png","hash":"bf4ab0f2da34703ff636e5dd0e023f3382977143","modified":1767325215335},{"_id":"public/img/diff.png","hash":"18e556ec4ed301bc00e428501218cda5029245db","modified":1767325215335},{"_id":"public/img/jy.png","hash":"8e0433380fd921567d13efed00660952a79fac48","modified":1767325215335},{"_id":"public/img/ownership.png","hash":"13849bf1bcac05a63a744bbffc48e4d721c2c26f","modified":1767325215335},{"_id":"public/img/nerve1.png","hash":"eeb77b5d3ac2a74646ad072c2c34688b300580ef","modified":1767325215335},{"_id":"public/img/ownership1.png","hash":"d8cbda4930ae6407be37956c05ecdf3efe0fd758","modified":1767325215335},{"_id":"public/img/nerve.png","hash":"733fd8fee312c1ecfe5be5d63f554de7ac271d5a","modified":1767325215335},{"_id":"public/img/blockchain-basic-core.png","hash":"21527b978dc583e76ef61019e374df99ed06ef58","modified":1767325215335}],"Category":[{"name":"web","_id":"cmjwbsw600004rotg9k87enwj"},{"name":"hexo的使用","_id":"cmjwbsw65000mrotgf6up3hoh"},{"name":"用机小技巧","_id":"cmjwbsw68001jrotg9k7a7ara"},{"name":"区块链","_id":"cmjwbsw69001qrotgd9i9b5nj"},{"name":"深度学习","_id":"cmjwbsw6a001xrotg4c4hdjl8"}],"Data":[],"Page":[{"date":"2017-05-27T05:47:40.000Z","type":"categories","_content":"","source":"categories/index.md","raw":"---\ndate: 2017-05-27 13:47:40\ntype: \"categories\"   #这部分是新添加的\n---\n","updated":"2025-12-31T06:07:42.351Z","path":"categories/index.html","title":"","comments":1,"layout":"page","_id":"cmjwbsw5x0000rotgcrdc9ozb","content":"","excerpt":"","more":""},{"date":"2018-08-06T14:48:29.000Z","type":"tags","_content":"\n","source":"tags/index.md","raw":"---\ndate: 2018-08-06 22:48:29\ntype: 'tags'              \n---\n\n","updated":"2025-12-31T06:07:42.401Z","path":"tags/index.html","title":"","comments":1,"layout":"page","_id":"cmjwbsw5z0002rotgd06ef7lj","content":"","excerpt":"","more":""}],"Post":[{"title":"js模块化编程弄懂CommonJS和AMD/CMD！","date":"2019-01-28T03:40:04.000Z","copyright":true,"keywords":null,"description":null,"_content":"{% cq %} 为什么模块很重要？ {% endcq %}\n因为有了模块，我们就可以更方便地使用别人的代码，想要什么功能，就加载什么模块。\n但是，这样做有一个前提，那就是大家必须以同样的方式编写模块，否则你有你的写法，我有我的写法，岂不是乱了套！\n<!--more-->\n> [原文链接](https://www.cnblogs.com/chenguangliang/p/5856701.html)\n\n# CommonJS\n   一开始大家都认为JS是辣鸡，没什么用，官方定义的API只能构建基于浏览器的应用程序，逗我呢，这太狭隘了吧(用了个高端词，嘎嘎)，CommonJS就按耐不住了，CommonJS API定义很多普通应用程序（主要指非浏览器的应用）使用的API，从而填补了这个空白。它的终极目标是提供一个类似Python，Ruby和Java标准库。这样的话，开发者可以使用CommonJS API编写应用程序，然后这些应用可以运行在不同的JavaScript解释器和不同的主机环境中。\n在兼容CommonJS的系统中，你可以使用JavaScript开发以下程序：\n\n(1).服务器端JavaScript应用程序\n(2).命令行工具\n(3).图形界面应用程序\n(4).混合应用程序（如，Titanium或Adobe AIR）\n\n2009年，美国程序员Ryan Dahl创造了node.js项目，将javascript语言用于服务器端编程。这标志\"Javascript模块化编程\"正式诞生。因为老实说，在浏览器环境下，没有模块也不是特别大的问题，毕竟网页程序的复杂性有限；但是在服务器端，一定要有模块，与操作系统和其他应用程序互动，否则根本没法编程。NodeJS是CommonJS规范的实现，webpack 也是以CommonJS的形式来书写。\n\nnode.js的[模块系统](https://nodejs.org/docs/latest/api/modules.html)，就是参照[CommonJS](http://wiki.commonjs.org/wiki/Modules/1.1)规范实现的。在CommonJS中，有一个全局性方法require()，用于加载模块。假定有一个数学模块math.js，就可以像下面这样加载。\n\nvar math = require('math');\n\n然后，就可以调用模块提供的方法：\n\n　　var math = require('math');\n\n      math.add(2,3); // 5\n\nCommonJS定义的模块分为:{模块引用(require)} {模块定义(exports)} {模块标识(module)}\n\nrequire()用来引入外部模块；exports对象用于导出当前模块的方法或变量，唯一的导出口；module对象就代表模块本身。\n\n虽说Node遵循CommonJS的规范，但是相比也是做了一些取舍，填了一些新东西的。\n\n不过，说了CommonJS也说了Node，那么我觉得也得先了解下NPM了。NPM作为Node的包管理器，不是为了帮助Node解决依赖包的安装问题嘛，那它肯定也要遵循CommonJS规范啦，它遵循包规范（还是理论）的。CommonJS WIKI讲了它的历史，还介绍了modules和packages等。\n\n下面讲讲commonJS的原理以及简易实现：\n## <font color=#0099ff size=3 face=\"黑体\">原理</font>\n浏览器不支持CommonJS原因，在于缺少四个Node.js环境变量\n> * module\n* exports\n* require\n* global\n只要能提供这4个变量，浏览器就能加载CommonJS模块\n下面一个简单示例\n\n    var module = {\n        exports : {}\n    };\n\n    (function(module,exports){\n        exports.multiply = function(n){return n*100}\n    }(module,module.exports))\n\n    var f = module.exports.multiply;\n    f(5) // 500\n上面代码向一个立即执行函数提供 module 和 exports 两个外部变量，模块就放在这个立即执行函数里面。模块的输出值放在 module.exports 之中，这样就实现了模块的加载。\n## <font color=#0099ff size=3 face=\"黑体\">Browserify 的实现</font>\n知道了原理，就能做出工具了。[Browserify](http://browserify.org/) 是目前最常用的 CommonJS 格式转换的工具。\n\n请看一个例子，main.js 模块加载 foo.js 模块。\n    {% codeblock %}\n    // foo.js\n    module.exports = function(x) {\n    console.log(x);\n    };\n\n    // main.js\n    var foo = require(\"./foo\");\n    foo(\"Hi\");{% endcodeblock %}\n\n    使用下面的命令，就能将main.js转为浏览器可用的格式。\n$ browserify main.js > compiled.js\nBrowserify到底做了什么？安装一下browser-unpack，就能看清楚了。\n$ npm install browser-unpack -g\n然后，将前面生成的compile.js解包。\n    $ browser-unpack < compiled.js\n    {% codeblock %}\n        [\n            {\n                \"id\":1,\n                \"source\":\"module.exports = function(x) {\\n  console.log(x);\\n};\",\n                \"deps\":{}\n            },\n            {\n                \"id\":2,\n                \"source\":\"var foo = require(\\\"./foo\\\");\\nfoo(\\\"Hi\\\");\",\n                \"deps\":{\"./foo\":1},\n                \"entry\":true\n            }\n        ] {% endcodeblock %}\n可以看到，browerify 将所有模块放入一个数组，id 属性是模块的编号，source 属性是模块的源码，deps 属性是模块的依赖。\n\n因为main.js加载了foo.js,所以deps属性就指定./foo对应1号模块。执行时候，浏览器遇到require(./foo)语句，就自动执行1好模块的source属性，并将执行后module.exports属性值输出   \n## <font color=#0099ff size=3 face=\"黑体\">Tiny Browser Require</font>\n虽然 Browserify 很强大，但不能在浏览器里操作，有时就很不方便。\n我根据 [mocha](https://github.com/mochajs/mocha) 的内部实现，做了一个纯浏览器的 CommonJS 模块加载器 [tiny-browser-require](https://github.com/ruanyf/tiny-browser-require) 。完全不需要命令行，直接放进浏览器即可，所有代码只有30多行。\n\n它的逻辑非常简单，就是把模块读入数组，加载路径就是模块的id。\n{% codeblock %}\n  function require(p){\n  var path = require.resolve(p); //node.js语法加载当前模块目录下的绝对路径\n  var mod = require.modules[path];\n  if (!mod) throw new Error('failed to require \"' + p + '\"');\n  if (!mod.exports) {\n    mod.exports = {};\n    mod.call(mod.exports, mod, mod.exports, require.relative(path));\n  }\n  return mod.exports;\n}\n\nrequire.modules = {};\n\nrequire.resolve = function (path){\n  var orig = path;\n  var reg = path + '.js';\n  var index = path + '/index.js';\n  return require.modules[reg] && reg\n    || require.modules[index] && index\n    || orig;\n};\n\nrequire.register = function (path, fn){\n  require.modules[path] = fn;\n};\n\nrequire.relative = function (parent) {\n  return function(p){\n    if ('.' != p.charAt(0)) return require(p);\n    var path = parent.split('/');\n    var segs = p.split('/');\n    path.pop();\n\n    for (var i = 0; i < segs.length; i++) {\n      var seg = segs[i];\n      if ('..' == seg) path.pop();\n      else if ('.' != seg) path.push(seg);\n    }\n\n    return require(path.join('/'));\n  };\n};{% endcodeblock %}\n使用的时候，先将上面的代码放入页面。然后，将模块放在如下的立即执行函数里面，就可以调用了。\n   \n    <script src=\"require.js\" />\n    <script>\n        require.register(\"moduleId\", function(module, exports, require){\n        // Module code goes here\n        });\n        var result = require(\"moduleId\");\n    </script>\n\n还是以前面的 main.js 加载 foo.js 为例。\n\n    require.register(\"./foo.js\", function(module, exports, require){\n    module.exports = function(x) {\n        console.log(x);\n        };\n    });\n\n    var foo = require(\"./foo.js\");\n    foo(\"Hi\");\n\n注意，这个库只模拟了 require 、module 、exports 三个变量，如果模块还用到了 global 或者其他 Node 专有变量（比如 process），就通过立即执行函数提供即可。\n# AMD\n基于commonJS规范的nodeJS出来以后，服务端的模块概念已经形成，很自然地，大家就想要客户端模块。而且最好两者能够兼容，一个模块不用修改，在服务器和浏览器都可以运行。但是，由于一个重大的局限，使得CommonJS规范不适用于浏览器环境。还是上面的代码，如果在浏览器中运行，会有一个很大的问题，你能看出来吗？\n\n>var math = require('math');\nmath.add(2, 3);\n\n第二行math.add(2, 3)，在第一行require('math')之后运行，因此必须等math.js加载完成。也就是说，如果加载时间很长，整个应用就会停在那里等。<font color=red>您会注意到 require 是同步的。</font>\n\n这对服务器端不是一个问题，因为所有的模块都存放在本地硬盘，可以同步加载完成，等待时间就是硬盘的读取时间。但是，对于浏览器，这却是一个大问题，因为模块都放在服务器端，等待时间取决于网速的快慢，可能要等很长时间，浏览器处于\"假死\"状态。\n\n因此，浏览器端的模块，不能采用\"同步加载\"（synchronous），只能采用\"异步加载\"（asynchronous）。这就是AMD规范诞生的背景。\n\nCommonJS是主要为了JS在后端的表现制定的，他是不适合前端的，AMD(异步模块定义)出现了，它就主要为前端JS的表现制定规范。\n\n[AMD](https://github.com/amdjs/amdjs-api/wiki/AMD)是\"Asynchronous Module Definition\"的缩写，意思就是\"异步模块定义\"。它采用异步方式加载模块，模块的加载不影响它后面语句的运行。所有依赖这个模块的语句，都定义在一个回调函数中，等到加载完成之后，这个回调函数才会运行。\n\nAMD也采用require()语句加载模块，但是不同于CommonJS，它要求两个参数：\n\n    require([module], callback);\n\n第一个参数[module]，是一个数组，里面的成员就是要加载的模块；第二个参数callback，则是加载成功之后的回调函数。如果将前面的代码改写成AMD形式，就是下面这样：\n{% codeblock %}\nrequire(['math'], function (math) {\n    math.add(2, 3);\n　});{% endcodeblock %}\n\nmath.add()与math模块加载不是同步的，浏览器不会发生假死。所以很显然，AMD比较适合浏览器环境。目前，主要有两个Javascript库实现了AMD规范：[require.js](https://requirejs.org/)和[curl.js](https://github.com/cujojs/curl)。\n<font color=red>RequireJS就是实现了AMD规范的呢。</font>\n<font size=2>详细概括：下面以RequireJS为例说明AMD规范</font>\n\n## <font color=#0099ff size=3 face=\"黑体\">为什么要用require.js？</font>\n最早的时候，所有Javascript代码都写在一个文件里面，只要加载这一个文件就够了。后来，代码越来越多，一个文件不够了，必须分成多个文件，依次加载。下面的网页代码，相信很多人都见过。\n{% codeblock %}\n    <script src=\"1.js\"></script>\n    <script src=\"2.js\"></script>\n    <script src=\"3.js\"></script>\n    <script src=\"4.js\"></script>\n    <script src=\"5.js\"></script>\n    <script src=\"6.js\"></script>\n{% endcodeblock %}\n这段代码依次加载多个js文件。\n这样的写法有很大的缺点。首先，加载的时候，浏览器会停止网页渲染，加载文件越多，网页失去响应的时间就会越长；其次，由于js文件之间存在依赖关系，因此必须严格保证加载顺序（比如上例的1.js要在2.js的前面），依赖性最大的模块一定要放到最后加载，当依赖关系很复杂的时候，代码的编写和维护都会变得困难。\n\nrequire.js的诞生，就是为了解决这两个问题：\n>(1) 实现js文件的异步加载，避免网页失去响应；\n(2) 管理模块之间的依赖性，便于代码的编写和维护。\n## <font color=#0099ff size=3 face=\"黑体\">require.js的加载</font>\n使用require.js的第一步，是先去官方网站[下载](https://requirejs.org/docs/download.html)最新版本。\n下载后，假定把它放在js子目录下面，就可以加载了。\n\n    <script src=\"js/require.js\"></script>\n\n有人可能会想到，加载这个文件，也可能造成网页失去响应。解决办法有两个，一个是把它放在网页底部加载，另一个是写成下面这样：\n\n    <script src=\"js/require.js\" defer async=\"true\" ></script>\n\nasync属性表明这个文件需要异步加载，避免网页失去响应。IE不支持这个属性，只支持defer，所以把defer也写上。\n加载require.js以后，下一步就要加载我们自己的代码了。假定我们自己的代码文件是main.js，也放在js目录下面。那么，只需要写成下面这样就行了：\n\n    <script src=\"js/require.js\" data-main=\"js/main\"></script>\n\ndata-main属性的作用是，指定网页程序的主模块。在上例中，就是js目录下面的main.js，这个文件会第一个被require.js加载。由于require.js默认的文件后缀名是js，所以可以把main.js简写成main。\n## <font color=#0099ff size=3 face=\"黑体\">主模块的写法</font>\n上一节的main.js，我把它称为\"主模块\"，意思是整个网页的入口代码。它有点像C语言的main()函数，所有代码都从这儿开始运行。\n下面就来看，怎么写main.js。\n如果我们的代码不依赖任何其他模块，那么可以直接写入javascript代码。\n\n>  // main.js\n　　alert(\"加载成功！\");\n\n但这样的话，就没必要使用require.js了。真正常见的情况是，主模块依赖于其他模块，这时就要使用AMD规范定义的的require()函数。\n\n>    // main.js\n　　require(['moduleA', 'moduleB', 'moduleC'], function (moduleA, moduleB, moduleC){\n　　　　// some code here\n　　});\n\nrequire()函数接受两个参数。第一个参数是一个数组，表示所依赖的模块，上例就是['moduleA', 'moduleB', 'moduleC']，即主模块依赖这三个模块；第二个参数是一个回调函数，当前面指定的模块都加载成功后，它将被调用。加载的模块会以参数形式传入该函数，从而在回调函数内部就可以使用这些模块。\n\nrequire()异步加载moduleA，moduleB和moduleC，浏览器不会失去响应；它指定的回调函数，只有前面的模块都加载成功后，才会运行，解决了依赖性的问题。\n\n下面，我们看一个实际的例子。\n假定主模块依赖jquery、underscore和backbone这三个模块，main.js就可以这样写：\n\n>require(['jquery', 'underscore', 'backbone'], function ($, _, Backbone){\n　　　　// some code here\n　　});\n\nrequire.js会先加载jQuery、underscore和backbone，然后再运行回调函数。主模块的代码就写在回调函数中。\n## <font color=#0099ff size=3 face=\"黑体\">模块的加载</font>\n上一节最后的示例中，主模块的依赖模块是['jquery', 'underscore', 'backbone']。默认情况下，require.js假定这三个模块与main.js在同一个目录，文件名分别为jquery.js，underscore.js和backbone.js，然后自动加载。\n\n使用require.config()方法，我们可以对模块的加载行为进行自定义。require.config()就写在主模块（main.js）的头部。参数就是一个对象，这个对象的paths属性指定各个模块的加载路径。\n\n>    require.config({\n　　　　paths: {\n　　　　　　\"jquery\": \"jquery.min\",\n　　　　　　\"underscore\": \"underscore.min\",\n　　　　　　\"backbone\": \"backbone.min\"\n　　　　}\n　　});\n\n上面的代码给出了三个模块的文件名，路径默认与main.js在同一个目录（js子目录）。如果这些模块在其他目录，比如js/lib目录，则有两种写法。一种是逐一指定路径。\n\n>    require.config({\n　　　　paths: {\n　　　　　　\"jquery\": \"lib/jquery.min\",\n　　　　　　\"underscore\": \"lib/underscore.min\",\n　　　　　　\"backbone\": \"lib/backbone.min\"\n　　　　}\n　　});\n\n另一种则是直接改变基目录（baseUrl）。\n\n>    require.config({\n　　　　baseUrl: \"js/lib\",\n　　　　paths: {\n　　　　　　\"jquery\": \"jquery.min\",\n　　　　　　\"underscore\": \"underscore.min\",\n　　　　　　\"backbone\": \"backbone.min\"\n　　　　}\n　　});\n\n如果某个模块在另一台主机上，也可以直接指定它的网址，比如：\n\n>    require.config({\n　　　　paths: {\n　　　　　　\"jquery\": \"https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min\"\n　　　　}\n　　});\n\nrequire.js要求，每个模块是一个单独的js文件。这样的话，如果加载多个模块，就会发出多次HTTP请求，会影响网页的加载速度。因此，require.js提供了一个[优化工具](https://requirejs.org/docs/optimization.html)，当模块部署完毕以后，可以用这个工具将多个模块合并在一个文件中，减少HTTP请求数。\n## <font color=#0099ff size=3 face=\"黑体\">AMD模块的写法</font>\nrequire.js加载的模块，采用AMD规范。也就是说，模块必须按照AMD的规定来写。\n\n具体来说，就是模块必须采用特定的define()函数来定义。如果一个模块不依赖其他模块，那么可以直接定义在define()函数之中。\n\n假定现在有一个math.js文件，它定义了一个math模块。那么，math.js就要这样写：\n\n>    // math.js\n　　define(function (){\n　　　　var add = function (x,y){\n　　　　　　return x+y;\n　　　　};\n　　　　return {\n　　　　　　add: add\n　　　　};\n　　});\n\n加载方法如下：\n\n>    // main.js\n　　require(['math'], function (math){\n　　　　alert(math.add(1,1));\n　　});\n\n如果这个模块还依赖其他模块，那么define()函数的第一个参数，必须是一个数组，指明该模块的依赖性。\n\n>    define(['myLib'], function(myLib){\n　　　　function foo(){\n　　　　　　myLib.doSomething();\n　　　　}\n　　　　return {\n　　　　　　foo : foo\n　　　　};\n　　});\n\n当require()函数加载上面这个模块的时候，就会先加载myLib.js文件。\n## <font color=#0099ff size=3 face=\"黑体\">加载非规范的模块</font>\n理论上，require.js加载的模块，必须是按照AMD规范、用define()函数定义的模块。但是实际上，虽然已经有一部分流行的函数库（比如jQuery）符合AMD规范，更多的库并不符合。那么，require.js是否能够加载非规范的模块呢？\n\n回答是可以的。\n\n这样的模块在用require()加载之前，要先用require.config()方法，定义它们的一些特征。\n\n举例来说，underscore和backbone这两个库，都没有采用AMD规范编写。如果要加载它们的话，必须先定义它们的特征。\n\n>    require.config({\n　　　　shim: {\n　　　　　　'underscore':{\n　　　　　　　　exports: '_'\n　　　　　　},\n　　　　　　'backbone': {\n　　　　　　　　deps: ['underscore', 'jquery'],\n　　　　　　　　exports: 'Backbone'\n　　　　　　}\n　　　　}\n　　});\n\nrequire.config()接受一个配置对象，这个对象除了有前面说过的paths属性之外，还有一个shim属性，专门用来配置不兼容的模块。具体来说，每个模块要定义（1）exports值（输出的变量名），表明这个模块外部调用时的名称；（2）deps数组，表明该模块的依赖性。\n\n比如，jQuery的插件可以这样定义：\n\n>    shim: {\n　　　　'jquery.scroll': {\n　　　　　　deps: ['jquery'],\n　　　　　　exports: 'jQuery.fn.scroll'\n　　　　}\n　　}\n\n## <font color=#0099ff size=3 face=\"黑体\">require.js插件</font>\n\nrequire.js还提供一系列[插件](https://github.com/requirejs/requirejs/wiki/Plugins)，实现一些特定的功能。\n\ndomready插件，可以让回调函数在页面DOM结构加载完成后再运行。\n\n>    require(['domready!'], function (doc){\n　　　　// called once the DOM is ready\n　　});\n\ntext和image插件，则是允许require.js加载文本和图片文件。\n\n>　　   define([\n　　　　'text!review.txt',\n　　　　'image!cat.jpg'\n　　　　],\n　　　　function(review,cat){\n　　　　　　console.log(review);\n　　　　　　document.body.appendChild(cat);\n　　　　}\n　　);\n\n类似的插件还有json和mdown，用于加载json文件和markdown文件。（完）\n\n另一个人的概括(有点简单)：\n\nAMD就只有一个接口：define(id?,dependencies?,factory);\n\n它要在声明模块的时候制定所有的依赖(dep)，并且还要当做形参传到factory中，像这样：\n>define(['dep1','dep2'],function(dep1,dep2){...});\n\n要是没什么依赖，就定义简单的模块，下面这样就可以啦：\n\n>        define(function(){\n        var exports = {};\n        exports.method = function(){...};\n        return exports;\n    });\n    \n咦，这里有define，把东西包装起来啦，那Node实现中怎么没看到有define关键字呢，它也要把东西包装起来呀，其实吧，只是Node隐式包装了而已.....\n\n这有AMD的WIKI中文版，讲了很多蛮详细的东西，用到的时候可以查看：[AMD的WIKI中文版](https://github.com/amdjs/amdjs-api/wiki/AMD-(%E4%B8%AD%E6%96%87%E7%89%88)\n\n# CMD\n大名远扬的玉伯写了seajs，就是遵循他提出的CMD规范，与AMD蛮相近的，不过用起来感觉更加方便些，最重要的是中文版，应有尽有：[seajs官方doc](http://www6.seajs.org/?s_token=1548666648.0457692136&kw=Javascript&term=learn%20javascript&term=javascript%20example&term=module%20loader&term=api%20integration&term=javascript%20online%20courses&showDomain=1&backfill=0&tdfs=1#docs)\n>define(function(require,exports,module){...});\n\n用过seajs吧，这个不陌生吧，对吧。\n\n前面说AMD，说RequireJS实现了AMD，CMD看起来与AMD好像呀，那RequireJS与SeaJS像不像呢？\n\n虽然CMD与AMD蛮像的，但区别还是挺明显的，官方非官方都有阐述和理解，我觉得吧，说的都挺好：\n\n[官方阐述SeaJS与RequireJS异同](https://github.com/seajs/seajs/issues/277)\n\n[SeaJS与RequireJS的最大异同（这个说的也挺好)](https://www.douban.com/note/283566440/)\n\n\n","source":"_posts/CommonJs-AMD-CMD.md","raw":"---\ntitle: 'js模块化编程弄懂CommonJS和AMD/CMD！'\ndate: 2019-01-28 11:40:04\ncategories: web\ntags: \n    - CommonJS/AMD/CMD\ncopyright: true\nkeywords:\ndescription:\n---\n{% cq %} 为什么模块很重要？ {% endcq %}\n因为有了模块，我们就可以更方便地使用别人的代码，想要什么功能，就加载什么模块。\n但是，这样做有一个前提，那就是大家必须以同样的方式编写模块，否则你有你的写法，我有我的写法，岂不是乱了套！\n<!--more-->\n> [原文链接](https://www.cnblogs.com/chenguangliang/p/5856701.html)\n\n# CommonJS\n   一开始大家都认为JS是辣鸡，没什么用，官方定义的API只能构建基于浏览器的应用程序，逗我呢，这太狭隘了吧(用了个高端词，嘎嘎)，CommonJS就按耐不住了，CommonJS API定义很多普通应用程序（主要指非浏览器的应用）使用的API，从而填补了这个空白。它的终极目标是提供一个类似Python，Ruby和Java标准库。这样的话，开发者可以使用CommonJS API编写应用程序，然后这些应用可以运行在不同的JavaScript解释器和不同的主机环境中。\n在兼容CommonJS的系统中，你可以使用JavaScript开发以下程序：\n\n(1).服务器端JavaScript应用程序\n(2).命令行工具\n(3).图形界面应用程序\n(4).混合应用程序（如，Titanium或Adobe AIR）\n\n2009年，美国程序员Ryan Dahl创造了node.js项目，将javascript语言用于服务器端编程。这标志\"Javascript模块化编程\"正式诞生。因为老实说，在浏览器环境下，没有模块也不是特别大的问题，毕竟网页程序的复杂性有限；但是在服务器端，一定要有模块，与操作系统和其他应用程序互动，否则根本没法编程。NodeJS是CommonJS规范的实现，webpack 也是以CommonJS的形式来书写。\n\nnode.js的[模块系统](https://nodejs.org/docs/latest/api/modules.html)，就是参照[CommonJS](http://wiki.commonjs.org/wiki/Modules/1.1)规范实现的。在CommonJS中，有一个全局性方法require()，用于加载模块。假定有一个数学模块math.js，就可以像下面这样加载。\n\nvar math = require('math');\n\n然后，就可以调用模块提供的方法：\n\n　　var math = require('math');\n\n      math.add(2,3); // 5\n\nCommonJS定义的模块分为:{模块引用(require)} {模块定义(exports)} {模块标识(module)}\n\nrequire()用来引入外部模块；exports对象用于导出当前模块的方法或变量，唯一的导出口；module对象就代表模块本身。\n\n虽说Node遵循CommonJS的规范，但是相比也是做了一些取舍，填了一些新东西的。\n\n不过，说了CommonJS也说了Node，那么我觉得也得先了解下NPM了。NPM作为Node的包管理器，不是为了帮助Node解决依赖包的安装问题嘛，那它肯定也要遵循CommonJS规范啦，它遵循包规范（还是理论）的。CommonJS WIKI讲了它的历史，还介绍了modules和packages等。\n\n下面讲讲commonJS的原理以及简易实现：\n## <font color=#0099ff size=3 face=\"黑体\">原理</font>\n浏览器不支持CommonJS原因，在于缺少四个Node.js环境变量\n> * module\n* exports\n* require\n* global\n只要能提供这4个变量，浏览器就能加载CommonJS模块\n下面一个简单示例\n\n    var module = {\n        exports : {}\n    };\n\n    (function(module,exports){\n        exports.multiply = function(n){return n*100}\n    }(module,module.exports))\n\n    var f = module.exports.multiply;\n    f(5) // 500\n上面代码向一个立即执行函数提供 module 和 exports 两个外部变量，模块就放在这个立即执行函数里面。模块的输出值放在 module.exports 之中，这样就实现了模块的加载。\n## <font color=#0099ff size=3 face=\"黑体\">Browserify 的实现</font>\n知道了原理，就能做出工具了。[Browserify](http://browserify.org/) 是目前最常用的 CommonJS 格式转换的工具。\n\n请看一个例子，main.js 模块加载 foo.js 模块。\n    {% codeblock %}\n    // foo.js\n    module.exports = function(x) {\n    console.log(x);\n    };\n\n    // main.js\n    var foo = require(\"./foo\");\n    foo(\"Hi\");{% endcodeblock %}\n\n    使用下面的命令，就能将main.js转为浏览器可用的格式。\n$ browserify main.js > compiled.js\nBrowserify到底做了什么？安装一下browser-unpack，就能看清楚了。\n$ npm install browser-unpack -g\n然后，将前面生成的compile.js解包。\n    $ browser-unpack < compiled.js\n    {% codeblock %}\n        [\n            {\n                \"id\":1,\n                \"source\":\"module.exports = function(x) {\\n  console.log(x);\\n};\",\n                \"deps\":{}\n            },\n            {\n                \"id\":2,\n                \"source\":\"var foo = require(\\\"./foo\\\");\\nfoo(\\\"Hi\\\");\",\n                \"deps\":{\"./foo\":1},\n                \"entry\":true\n            }\n        ] {% endcodeblock %}\n可以看到，browerify 将所有模块放入一个数组，id 属性是模块的编号，source 属性是模块的源码，deps 属性是模块的依赖。\n\n因为main.js加载了foo.js,所以deps属性就指定./foo对应1号模块。执行时候，浏览器遇到require(./foo)语句，就自动执行1好模块的source属性，并将执行后module.exports属性值输出   \n## <font color=#0099ff size=3 face=\"黑体\">Tiny Browser Require</font>\n虽然 Browserify 很强大，但不能在浏览器里操作，有时就很不方便。\n我根据 [mocha](https://github.com/mochajs/mocha) 的内部实现，做了一个纯浏览器的 CommonJS 模块加载器 [tiny-browser-require](https://github.com/ruanyf/tiny-browser-require) 。完全不需要命令行，直接放进浏览器即可，所有代码只有30多行。\n\n它的逻辑非常简单，就是把模块读入数组，加载路径就是模块的id。\n{% codeblock %}\n  function require(p){\n  var path = require.resolve(p); //node.js语法加载当前模块目录下的绝对路径\n  var mod = require.modules[path];\n  if (!mod) throw new Error('failed to require \"' + p + '\"');\n  if (!mod.exports) {\n    mod.exports = {};\n    mod.call(mod.exports, mod, mod.exports, require.relative(path));\n  }\n  return mod.exports;\n}\n\nrequire.modules = {};\n\nrequire.resolve = function (path){\n  var orig = path;\n  var reg = path + '.js';\n  var index = path + '/index.js';\n  return require.modules[reg] && reg\n    || require.modules[index] && index\n    || orig;\n};\n\nrequire.register = function (path, fn){\n  require.modules[path] = fn;\n};\n\nrequire.relative = function (parent) {\n  return function(p){\n    if ('.' != p.charAt(0)) return require(p);\n    var path = parent.split('/');\n    var segs = p.split('/');\n    path.pop();\n\n    for (var i = 0; i < segs.length; i++) {\n      var seg = segs[i];\n      if ('..' == seg) path.pop();\n      else if ('.' != seg) path.push(seg);\n    }\n\n    return require(path.join('/'));\n  };\n};{% endcodeblock %}\n使用的时候，先将上面的代码放入页面。然后，将模块放在如下的立即执行函数里面，就可以调用了。\n   \n    <script src=\"require.js\" />\n    <script>\n        require.register(\"moduleId\", function(module, exports, require){\n        // Module code goes here\n        });\n        var result = require(\"moduleId\");\n    </script>\n\n还是以前面的 main.js 加载 foo.js 为例。\n\n    require.register(\"./foo.js\", function(module, exports, require){\n    module.exports = function(x) {\n        console.log(x);\n        };\n    });\n\n    var foo = require(\"./foo.js\");\n    foo(\"Hi\");\n\n注意，这个库只模拟了 require 、module 、exports 三个变量，如果模块还用到了 global 或者其他 Node 专有变量（比如 process），就通过立即执行函数提供即可。\n# AMD\n基于commonJS规范的nodeJS出来以后，服务端的模块概念已经形成，很自然地，大家就想要客户端模块。而且最好两者能够兼容，一个模块不用修改，在服务器和浏览器都可以运行。但是，由于一个重大的局限，使得CommonJS规范不适用于浏览器环境。还是上面的代码，如果在浏览器中运行，会有一个很大的问题，你能看出来吗？\n\n>var math = require('math');\nmath.add(2, 3);\n\n第二行math.add(2, 3)，在第一行require('math')之后运行，因此必须等math.js加载完成。也就是说，如果加载时间很长，整个应用就会停在那里等。<font color=red>您会注意到 require 是同步的。</font>\n\n这对服务器端不是一个问题，因为所有的模块都存放在本地硬盘，可以同步加载完成，等待时间就是硬盘的读取时间。但是，对于浏览器，这却是一个大问题，因为模块都放在服务器端，等待时间取决于网速的快慢，可能要等很长时间，浏览器处于\"假死\"状态。\n\n因此，浏览器端的模块，不能采用\"同步加载\"（synchronous），只能采用\"异步加载\"（asynchronous）。这就是AMD规范诞生的背景。\n\nCommonJS是主要为了JS在后端的表现制定的，他是不适合前端的，AMD(异步模块定义)出现了，它就主要为前端JS的表现制定规范。\n\n[AMD](https://github.com/amdjs/amdjs-api/wiki/AMD)是\"Asynchronous Module Definition\"的缩写，意思就是\"异步模块定义\"。它采用异步方式加载模块，模块的加载不影响它后面语句的运行。所有依赖这个模块的语句，都定义在一个回调函数中，等到加载完成之后，这个回调函数才会运行。\n\nAMD也采用require()语句加载模块，但是不同于CommonJS，它要求两个参数：\n\n    require([module], callback);\n\n第一个参数[module]，是一个数组，里面的成员就是要加载的模块；第二个参数callback，则是加载成功之后的回调函数。如果将前面的代码改写成AMD形式，就是下面这样：\n{% codeblock %}\nrequire(['math'], function (math) {\n    math.add(2, 3);\n　});{% endcodeblock %}\n\nmath.add()与math模块加载不是同步的，浏览器不会发生假死。所以很显然，AMD比较适合浏览器环境。目前，主要有两个Javascript库实现了AMD规范：[require.js](https://requirejs.org/)和[curl.js](https://github.com/cujojs/curl)。\n<font color=red>RequireJS就是实现了AMD规范的呢。</font>\n<font size=2>详细概括：下面以RequireJS为例说明AMD规范</font>\n\n## <font color=#0099ff size=3 face=\"黑体\">为什么要用require.js？</font>\n最早的时候，所有Javascript代码都写在一个文件里面，只要加载这一个文件就够了。后来，代码越来越多，一个文件不够了，必须分成多个文件，依次加载。下面的网页代码，相信很多人都见过。\n{% codeblock %}\n    <script src=\"1.js\"></script>\n    <script src=\"2.js\"></script>\n    <script src=\"3.js\"></script>\n    <script src=\"4.js\"></script>\n    <script src=\"5.js\"></script>\n    <script src=\"6.js\"></script>\n{% endcodeblock %}\n这段代码依次加载多个js文件。\n这样的写法有很大的缺点。首先，加载的时候，浏览器会停止网页渲染，加载文件越多，网页失去响应的时间就会越长；其次，由于js文件之间存在依赖关系，因此必须严格保证加载顺序（比如上例的1.js要在2.js的前面），依赖性最大的模块一定要放到最后加载，当依赖关系很复杂的时候，代码的编写和维护都会变得困难。\n\nrequire.js的诞生，就是为了解决这两个问题：\n>(1) 实现js文件的异步加载，避免网页失去响应；\n(2) 管理模块之间的依赖性，便于代码的编写和维护。\n## <font color=#0099ff size=3 face=\"黑体\">require.js的加载</font>\n使用require.js的第一步，是先去官方网站[下载](https://requirejs.org/docs/download.html)最新版本。\n下载后，假定把它放在js子目录下面，就可以加载了。\n\n    <script src=\"js/require.js\"></script>\n\n有人可能会想到，加载这个文件，也可能造成网页失去响应。解决办法有两个，一个是把它放在网页底部加载，另一个是写成下面这样：\n\n    <script src=\"js/require.js\" defer async=\"true\" ></script>\n\nasync属性表明这个文件需要异步加载，避免网页失去响应。IE不支持这个属性，只支持defer，所以把defer也写上。\n加载require.js以后，下一步就要加载我们自己的代码了。假定我们自己的代码文件是main.js，也放在js目录下面。那么，只需要写成下面这样就行了：\n\n    <script src=\"js/require.js\" data-main=\"js/main\"></script>\n\ndata-main属性的作用是，指定网页程序的主模块。在上例中，就是js目录下面的main.js，这个文件会第一个被require.js加载。由于require.js默认的文件后缀名是js，所以可以把main.js简写成main。\n## <font color=#0099ff size=3 face=\"黑体\">主模块的写法</font>\n上一节的main.js，我把它称为\"主模块\"，意思是整个网页的入口代码。它有点像C语言的main()函数，所有代码都从这儿开始运行。\n下面就来看，怎么写main.js。\n如果我们的代码不依赖任何其他模块，那么可以直接写入javascript代码。\n\n>  // main.js\n　　alert(\"加载成功！\");\n\n但这样的话，就没必要使用require.js了。真正常见的情况是，主模块依赖于其他模块，这时就要使用AMD规范定义的的require()函数。\n\n>    // main.js\n　　require(['moduleA', 'moduleB', 'moduleC'], function (moduleA, moduleB, moduleC){\n　　　　// some code here\n　　});\n\nrequire()函数接受两个参数。第一个参数是一个数组，表示所依赖的模块，上例就是['moduleA', 'moduleB', 'moduleC']，即主模块依赖这三个模块；第二个参数是一个回调函数，当前面指定的模块都加载成功后，它将被调用。加载的模块会以参数形式传入该函数，从而在回调函数内部就可以使用这些模块。\n\nrequire()异步加载moduleA，moduleB和moduleC，浏览器不会失去响应；它指定的回调函数，只有前面的模块都加载成功后，才会运行，解决了依赖性的问题。\n\n下面，我们看一个实际的例子。\n假定主模块依赖jquery、underscore和backbone这三个模块，main.js就可以这样写：\n\n>require(['jquery', 'underscore', 'backbone'], function ($, _, Backbone){\n　　　　// some code here\n　　});\n\nrequire.js会先加载jQuery、underscore和backbone，然后再运行回调函数。主模块的代码就写在回调函数中。\n## <font color=#0099ff size=3 face=\"黑体\">模块的加载</font>\n上一节最后的示例中，主模块的依赖模块是['jquery', 'underscore', 'backbone']。默认情况下，require.js假定这三个模块与main.js在同一个目录，文件名分别为jquery.js，underscore.js和backbone.js，然后自动加载。\n\n使用require.config()方法，我们可以对模块的加载行为进行自定义。require.config()就写在主模块（main.js）的头部。参数就是一个对象，这个对象的paths属性指定各个模块的加载路径。\n\n>    require.config({\n　　　　paths: {\n　　　　　　\"jquery\": \"jquery.min\",\n　　　　　　\"underscore\": \"underscore.min\",\n　　　　　　\"backbone\": \"backbone.min\"\n　　　　}\n　　});\n\n上面的代码给出了三个模块的文件名，路径默认与main.js在同一个目录（js子目录）。如果这些模块在其他目录，比如js/lib目录，则有两种写法。一种是逐一指定路径。\n\n>    require.config({\n　　　　paths: {\n　　　　　　\"jquery\": \"lib/jquery.min\",\n　　　　　　\"underscore\": \"lib/underscore.min\",\n　　　　　　\"backbone\": \"lib/backbone.min\"\n　　　　}\n　　});\n\n另一种则是直接改变基目录（baseUrl）。\n\n>    require.config({\n　　　　baseUrl: \"js/lib\",\n　　　　paths: {\n　　　　　　\"jquery\": \"jquery.min\",\n　　　　　　\"underscore\": \"underscore.min\",\n　　　　　　\"backbone\": \"backbone.min\"\n　　　　}\n　　});\n\n如果某个模块在另一台主机上，也可以直接指定它的网址，比如：\n\n>    require.config({\n　　　　paths: {\n　　　　　　\"jquery\": \"https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min\"\n　　　　}\n　　});\n\nrequire.js要求，每个模块是一个单独的js文件。这样的话，如果加载多个模块，就会发出多次HTTP请求，会影响网页的加载速度。因此，require.js提供了一个[优化工具](https://requirejs.org/docs/optimization.html)，当模块部署完毕以后，可以用这个工具将多个模块合并在一个文件中，减少HTTP请求数。\n## <font color=#0099ff size=3 face=\"黑体\">AMD模块的写法</font>\nrequire.js加载的模块，采用AMD规范。也就是说，模块必须按照AMD的规定来写。\n\n具体来说，就是模块必须采用特定的define()函数来定义。如果一个模块不依赖其他模块，那么可以直接定义在define()函数之中。\n\n假定现在有一个math.js文件，它定义了一个math模块。那么，math.js就要这样写：\n\n>    // math.js\n　　define(function (){\n　　　　var add = function (x,y){\n　　　　　　return x+y;\n　　　　};\n　　　　return {\n　　　　　　add: add\n　　　　};\n　　});\n\n加载方法如下：\n\n>    // main.js\n　　require(['math'], function (math){\n　　　　alert(math.add(1,1));\n　　});\n\n如果这个模块还依赖其他模块，那么define()函数的第一个参数，必须是一个数组，指明该模块的依赖性。\n\n>    define(['myLib'], function(myLib){\n　　　　function foo(){\n　　　　　　myLib.doSomething();\n　　　　}\n　　　　return {\n　　　　　　foo : foo\n　　　　};\n　　});\n\n当require()函数加载上面这个模块的时候，就会先加载myLib.js文件。\n## <font color=#0099ff size=3 face=\"黑体\">加载非规范的模块</font>\n理论上，require.js加载的模块，必须是按照AMD规范、用define()函数定义的模块。但是实际上，虽然已经有一部分流行的函数库（比如jQuery）符合AMD规范，更多的库并不符合。那么，require.js是否能够加载非规范的模块呢？\n\n回答是可以的。\n\n这样的模块在用require()加载之前，要先用require.config()方法，定义它们的一些特征。\n\n举例来说，underscore和backbone这两个库，都没有采用AMD规范编写。如果要加载它们的话，必须先定义它们的特征。\n\n>    require.config({\n　　　　shim: {\n　　　　　　'underscore':{\n　　　　　　　　exports: '_'\n　　　　　　},\n　　　　　　'backbone': {\n　　　　　　　　deps: ['underscore', 'jquery'],\n　　　　　　　　exports: 'Backbone'\n　　　　　　}\n　　　　}\n　　});\n\nrequire.config()接受一个配置对象，这个对象除了有前面说过的paths属性之外，还有一个shim属性，专门用来配置不兼容的模块。具体来说，每个模块要定义（1）exports值（输出的变量名），表明这个模块外部调用时的名称；（2）deps数组，表明该模块的依赖性。\n\n比如，jQuery的插件可以这样定义：\n\n>    shim: {\n　　　　'jquery.scroll': {\n　　　　　　deps: ['jquery'],\n　　　　　　exports: 'jQuery.fn.scroll'\n　　　　}\n　　}\n\n## <font color=#0099ff size=3 face=\"黑体\">require.js插件</font>\n\nrequire.js还提供一系列[插件](https://github.com/requirejs/requirejs/wiki/Plugins)，实现一些特定的功能。\n\ndomready插件，可以让回调函数在页面DOM结构加载完成后再运行。\n\n>    require(['domready!'], function (doc){\n　　　　// called once the DOM is ready\n　　});\n\ntext和image插件，则是允许require.js加载文本和图片文件。\n\n>　　   define([\n　　　　'text!review.txt',\n　　　　'image!cat.jpg'\n　　　　],\n　　　　function(review,cat){\n　　　　　　console.log(review);\n　　　　　　document.body.appendChild(cat);\n　　　　}\n　　);\n\n类似的插件还有json和mdown，用于加载json文件和markdown文件。（完）\n\n另一个人的概括(有点简单)：\n\nAMD就只有一个接口：define(id?,dependencies?,factory);\n\n它要在声明模块的时候制定所有的依赖(dep)，并且还要当做形参传到factory中，像这样：\n>define(['dep1','dep2'],function(dep1,dep2){...});\n\n要是没什么依赖，就定义简单的模块，下面这样就可以啦：\n\n>        define(function(){\n        var exports = {};\n        exports.method = function(){...};\n        return exports;\n    });\n    \n咦，这里有define，把东西包装起来啦，那Node实现中怎么没看到有define关键字呢，它也要把东西包装起来呀，其实吧，只是Node隐式包装了而已.....\n\n这有AMD的WIKI中文版，讲了很多蛮详细的东西，用到的时候可以查看：[AMD的WIKI中文版](https://github.com/amdjs/amdjs-api/wiki/AMD-(%E4%B8%AD%E6%96%87%E7%89%88)\n\n# CMD\n大名远扬的玉伯写了seajs，就是遵循他提出的CMD规范，与AMD蛮相近的，不过用起来感觉更加方便些，最重要的是中文版，应有尽有：[seajs官方doc](http://www6.seajs.org/?s_token=1548666648.0457692136&kw=Javascript&term=learn%20javascript&term=javascript%20example&term=module%20loader&term=api%20integration&term=javascript%20online%20courses&showDomain=1&backfill=0&tdfs=1#docs)\n>define(function(require,exports,module){...});\n\n用过seajs吧，这个不陌生吧，对吧。\n\n前面说AMD，说RequireJS实现了AMD，CMD看起来与AMD好像呀，那RequireJS与SeaJS像不像呢？\n\n虽然CMD与AMD蛮像的，但区别还是挺明显的，官方非官方都有阐述和理解，我觉得吧，说的都挺好：\n\n[官方阐述SeaJS与RequireJS异同](https://github.com/seajs/seajs/issues/277)\n\n[SeaJS与RequireJS的最大异同（这个说的也挺好)](https://www.douban.com/note/283566440/)\n\n\n","slug":"CommonJs-AMD-CMD","published":1,"updated":"2026-01-02T00:43:17.570Z","comments":1,"layout":"post","photos":[],"_id":"cmjwbsw5y0001rotg6wa2er36","content":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>为什么模块很重要？ </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n<p>因为有了模块，我们就可以更方便地使用别人的代码，想要什么功能，就加载什么模块。<br>但是，这样做有一个前提，那就是大家必须以同样的方式编写模块，否则你有你的写法，我有我的写法，岂不是乱了套！</p>\n<span id=\"more\"></span>\n<blockquote>\n<p><a href=\"https://www.cnblogs.com/chenguangliang/p/5856701.html\">原文链接</a></p>\n</blockquote>\n<h1 id=\"CommonJS\"><a href=\"#CommonJS\" class=\"headerlink\" title=\"CommonJS\"></a>CommonJS</h1><p>   一开始大家都认为JS是辣鸡，没什么用，官方定义的API只能构建基于浏览器的应用程序，逗我呢，这太狭隘了吧(用了个高端词，嘎嘎)，CommonJS就按耐不住了，CommonJS API定义很多普通应用程序（主要指非浏览器的应用）使用的API，从而填补了这个空白。它的终极目标是提供一个类似Python，Ruby和Java标准库。这样的话，开发者可以使用CommonJS API编写应用程序，然后这些应用可以运行在不同的JavaScript解释器和不同的主机环境中。<br>在兼容CommonJS的系统中，你可以使用JavaScript开发以下程序：</p>\n<p>(1).服务器端JavaScript应用程序<br>(2).命令行工具<br>(3).图形界面应用程序<br>(4).混合应用程序（如，Titanium或Adobe AIR）</p>\n<p>2009年，美国程序员Ryan Dahl创造了node.js项目，将javascript语言用于服务器端编程。这标志”Javascript模块化编程”正式诞生。因为老实说，在浏览器环境下，没有模块也不是特别大的问题，毕竟网页程序的复杂性有限；但是在服务器端，一定要有模块，与操作系统和其他应用程序互动，否则根本没法编程。NodeJS是CommonJS规范的实现，webpack 也是以CommonJS的形式来书写。</p>\n<p>node.js的<a href=\"https://nodejs.org/docs/latest/api/modules.html\">模块系统</a>，就是参照<a href=\"http://wiki.commonjs.org/wiki/Modules/1.1\">CommonJS</a>规范实现的。在CommonJS中，有一个全局性方法require()，用于加载模块。假定有一个数学模块math.js，就可以像下面这样加载。</p>\n<p>var math &#x3D; require(‘math’);</p>\n<p>然后，就可以调用模块提供的方法：</p>\n<p>　　var math &#x3D; require(‘math’);</p>\n<pre><code>  math.add(2,3); // 5\n</code></pre>\n<p>CommonJS定义的模块分为:{模块引用(require)} {模块定义(exports)} {模块标识(module)}</p>\n<p>require()用来引入外部模块；exports对象用于导出当前模块的方法或变量，唯一的导出口；module对象就代表模块本身。</p>\n<p>虽说Node遵循CommonJS的规范，但是相比也是做了一些取舍，填了一些新东西的。</p>\n<p>不过，说了CommonJS也说了Node，那么我觉得也得先了解下NPM了。NPM作为Node的包管理器，不是为了帮助Node解决依赖包的安装问题嘛，那它肯定也要遵循CommonJS规范啦，它遵循包规范（还是理论）的。CommonJS WIKI讲了它的历史，还介绍了modules和packages等。</p>\n<p>下面讲讲commonJS的原理以及简易实现：</p>\n<h2 id=\"原理\"><a href=\"#原理\" class=\"headerlink\" title=\"原理\"></a><font color=#0099ff size=3 face=\"黑体\">原理</font></h2><p>浏览器不支持CommonJS原因，在于缺少四个Node.js环境变量</p>\n<blockquote>\n<ul>\n<li>module</li>\n</ul>\n</blockquote>\n<ul>\n<li><p>exports</p>\n</li>\n<li><p>require</p>\n</li>\n<li><p>global<br>只要能提供这4个变量，浏览器就能加载CommonJS模块<br>下面一个简单示例</p>\n<p>  var module &#x3D; {<br>  exports : {}<br>  };</p>\n<p>  (function(module,exports){<br>  exports.multiply &#x3D; function(n){return n*100}<br>  }(module,module.exports))</p>\n<p>  var f &#x3D; module.exports.multiply;<br>  f(5) &#x2F;&#x2F; 500</p>\n</li>\n</ul>\n<p>上面代码向一个立即执行函数提供 module 和 exports 两个外部变量，模块就放在这个立即执行函数里面。模块的输出值放在 module.exports 之中，这样就实现了模块的加载。</p>\n<h2 id=\"Browserify-的实现\"><a href=\"#Browserify-的实现\" class=\"headerlink\" title=\"Browserify 的实现\"></a><font color=#0099ff size=3 face=\"黑体\">Browserify 的实现</font></h2><p>知道了原理，就能做出工具了。<a href=\"http://browserify.org/\">Browserify</a> 是目前最常用的 CommonJS 格式转换的工具。</p>\n<p>请看一个例子，main.js 模块加载 foo.js 模块。<br>    <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// foo.js</span><br><span class=\"line\">module.exports = function(x) &#123;</span><br><span class=\"line\">console.log(x);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">// main.js</span><br><span class=\"line\">var foo = require(&quot;./foo&quot;);</span><br><span class=\"line\">foo(&quot;Hi&quot;);</span><br></pre></td></tr></table></figure></p>\n<pre><code>使用下面的命令，就能将main.js转为浏览器可用的格式。\n</code></pre>\n<p>$ browserify main.js &gt; compiled.js<br>Browserify到底做了什么？安装一下browser-unpack，就能看清楚了。<br>$ npm install browser-unpack -g<br>然后，将前面生成的compile.js解包。<br>    $ browser-unpack &lt; compiled.js<br>    <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        &quot;id&quot;:1,</span><br><span class=\"line\">        &quot;source&quot;:&quot;module.exports = function(x) &#123;\\n  console.log(x);\\n&#125;;&quot;,</span><br><span class=\"line\">        &quot;deps&quot;:&#123;&#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        &quot;id&quot;:2,</span><br><span class=\"line\">        &quot;source&quot;:&quot;var foo = require(\\&quot;./foo\\&quot;);\\nfoo(\\&quot;Hi\\&quot;);&quot;,</span><br><span class=\"line\">        &quot;deps&quot;:&#123;&quot;./foo&quot;:1&#125;,</span><br><span class=\"line\">        &quot;entry&quot;:true</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">] </span><br></pre></td></tr></table></figure><br>可以看到，browerify 将所有模块放入一个数组，id 属性是模块的编号，source 属性是模块的源码，deps 属性是模块的依赖。</p>\n<p>因为main.js加载了foo.js,所以deps属性就指定.&#x2F;foo对应1号模块。执行时候，浏览器遇到require(.&#x2F;foo)语句，就自动执行1好模块的source属性，并将执行后module.exports属性值输出   </p>\n<h2 id=\"Tiny-Browser-Require\"><a href=\"#Tiny-Browser-Require\" class=\"headerlink\" title=\"Tiny Browser Require\"></a><font color=#0099ff size=3 face=\"黑体\">Tiny Browser Require</font></h2><p>虽然 Browserify 很强大，但不能在浏览器里操作，有时就很不方便。<br>我根据 <a href=\"https://github.com/mochajs/mocha\">mocha</a> 的内部实现，做了一个纯浏览器的 CommonJS 模块加载器 <a href=\"https://github.com/ruanyf/tiny-browser-require\">tiny-browser-require</a> 。完全不需要命令行，直接放进浏览器即可，所有代码只有30多行。</p>\n<p>它的逻辑非常简单，就是把模块读入数组，加载路径就是模块的id。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  function require(p)&#123;</span><br><span class=\"line\">  var path = require.resolve(p); //node.js语法加载当前模块目录下的绝对路径</span><br><span class=\"line\">  var mod = require.modules[path];</span><br><span class=\"line\">  if (!mod) throw new Error(&#x27;failed to require &quot;&#x27; + p + &#x27;&quot;&#x27;);</span><br><span class=\"line\">  if (!mod.exports) &#123;</span><br><span class=\"line\">    mod.exports = &#123;&#125;;</span><br><span class=\"line\">    mod.call(mod.exports, mod, mod.exports, require.relative(path));</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  return mod.exports;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">require.modules = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">require.resolve = function (path)&#123;</span><br><span class=\"line\">  var orig = path;</span><br><span class=\"line\">  var reg = path + &#x27;.js&#x27;;</span><br><span class=\"line\">  var index = path + &#x27;/index.js&#x27;;</span><br><span class=\"line\">  return require.modules[reg] &amp;&amp; reg</span><br><span class=\"line\">    || require.modules[index] &amp;&amp; index</span><br><span class=\"line\">    || orig;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">require.register = function (path, fn)&#123;</span><br><span class=\"line\">  require.modules[path] = fn;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">require.relative = function (parent) &#123;</span><br><span class=\"line\">  return function(p)&#123;</span><br><span class=\"line\">    if (&#x27;.&#x27; != p.charAt(0)) return require(p);</span><br><span class=\"line\">    var path = parent.split(&#x27;/&#x27;);</span><br><span class=\"line\">    var segs = p.split(&#x27;/&#x27;);</span><br><span class=\"line\">    path.pop();</span><br><span class=\"line\"></span><br><span class=\"line\">    for (var i = 0; i &lt; segs.length; i++) &#123;</span><br><span class=\"line\">      var seg = segs[i];</span><br><span class=\"line\">      if (&#x27;..&#x27; == seg) path.pop();</span><br><span class=\"line\">      else if (&#x27;.&#x27; != seg) path.push(seg);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    return require(path.join(&#x27;/&#x27;));</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>使用的时候，先将上面的代码放入页面。然后，将模块放在如下的立即执行函数里面，就可以调用了。</p>\n<pre><code>&lt;script src=&quot;require.js&quot; /&gt;\n&lt;script&gt;\n    require.register(&quot;moduleId&quot;, function(module, exports, require)&#123;\n    // Module code goes here\n    &#125;);\n    var result = require(&quot;moduleId&quot;);\n&lt;/script&gt;\n</code></pre>\n<p>还是以前面的 main.js 加载 foo.js 为例。</p>\n<pre><code>require.register(&quot;./foo.js&quot;, function(module, exports, require)&#123;\nmodule.exports = function(x) &#123;\n    console.log(x);\n    &#125;;\n&#125;);\n\nvar foo = require(&quot;./foo.js&quot;);\nfoo(&quot;Hi&quot;);\n</code></pre>\n<p>注意，这个库只模拟了 require 、module 、exports 三个变量，如果模块还用到了 global 或者其他 Node 专有变量（比如 process），就通过立即执行函数提供即可。</p>\n<h1 id=\"AMD\"><a href=\"#AMD\" class=\"headerlink\" title=\"AMD\"></a>AMD</h1><p>基于commonJS规范的nodeJS出来以后，服务端的模块概念已经形成，很自然地，大家就想要客户端模块。而且最好两者能够兼容，一个模块不用修改，在服务器和浏览器都可以运行。但是，由于一个重大的局限，使得CommonJS规范不适用于浏览器环境。还是上面的代码，如果在浏览器中运行，会有一个很大的问题，你能看出来吗？</p>\n<blockquote>\n<p>var math &#x3D; require(‘math’);<br>math.add(2, 3);</p>\n</blockquote>\n<p>第二行math.add(2, 3)，在第一行require(‘math’)之后运行，因此必须等math.js加载完成。也就是说，如果加载时间很长，整个应用就会停在那里等。<font color=red>您会注意到 require 是同步的。</font></p>\n<p>这对服务器端不是一个问题，因为所有的模块都存放在本地硬盘，可以同步加载完成，等待时间就是硬盘的读取时间。但是，对于浏览器，这却是一个大问题，因为模块都放在服务器端，等待时间取决于网速的快慢，可能要等很长时间，浏览器处于”假死”状态。</p>\n<p>因此，浏览器端的模块，不能采用”同步加载”（synchronous），只能采用”异步加载”（asynchronous）。这就是AMD规范诞生的背景。</p>\n<p>CommonJS是主要为了JS在后端的表现制定的，他是不适合前端的，AMD(异步模块定义)出现了，它就主要为前端JS的表现制定规范。</p>\n<p><a href=\"https://github.com/amdjs/amdjs-api/wiki/AMD\">AMD</a>是”Asynchronous Module Definition”的缩写，意思就是”异步模块定义”。它采用异步方式加载模块，模块的加载不影响它后面语句的运行。所有依赖这个模块的语句，都定义在一个回调函数中，等到加载完成之后，这个回调函数才会运行。</p>\n<p>AMD也采用require()语句加载模块，但是不同于CommonJS，它要求两个参数：</p>\n<pre><code>require([module], callback);\n</code></pre>\n<p>第一个参数[module]，是一个数组，里面的成员就是要加载的模块；第二个参数callback，则是加载成功之后的回调函数。如果将前面的代码改写成AMD形式，就是下面这样：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">require([&#x27;math&#x27;], function (math) &#123;</span><br><span class=\"line\">    math.add(2, 3);</span><br><span class=\"line\">　&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>math.add()与math模块加载不是同步的，浏览器不会发生假死。所以很显然，AMD比较适合浏览器环境。目前，主要有两个Javascript库实现了AMD规范：<a href=\"https://requirejs.org/\">require.js</a>和<a href=\"https://github.com/cujojs/curl\">curl.js</a>。<br><font color=red>RequireJS就是实现了AMD规范的呢。</font><br><font size=2>详细概括：下面以RequireJS为例说明AMD规范</font></p>\n<h2 id=\"为什么要用require-js？\"><a href=\"#为什么要用require-js？\" class=\"headerlink\" title=\"为什么要用require.js？\"></a><font color=#0099ff size=3 face=\"黑体\">为什么要用require.js？</font></h2><p>最早的时候，所有Javascript代码都写在一个文件里面，只要加载这一个文件就够了。后来，代码越来越多，一个文件不够了，必须分成多个文件，依次加载。下面的网页代码，相信很多人都见过。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script src=&quot;1.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">&lt;script src=&quot;2.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">&lt;script src=&quot;3.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">&lt;script src=&quot;4.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">&lt;script src=&quot;5.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">&lt;script src=&quot;6.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n<p>这段代码依次加载多个js文件。<br>这样的写法有很大的缺点。首先，加载的时候，浏览器会停止网页渲染，加载文件越多，网页失去响应的时间就会越长；其次，由于js文件之间存在依赖关系，因此必须严格保证加载顺序（比如上例的1.js要在2.js的前面），依赖性最大的模块一定要放到最后加载，当依赖关系很复杂的时候，代码的编写和维护都会变得困难。</p>\n<p>require.js的诞生，就是为了解决这两个问题：</p>\n<blockquote>\n<p>(1) 实现js文件的异步加载，避免网页失去响应；<br>(2) 管理模块之间的依赖性，便于代码的编写和维护。</p>\n</blockquote>\n<h2 id=\"require-js的加载\"><a href=\"#require-js的加载\" class=\"headerlink\" title=\"require.js的加载\"></a><font color=#0099ff size=3 face=\"黑体\">require.js的加载</font></h2><p>使用require.js的第一步，是先去官方网站<a href=\"https://requirejs.org/docs/download.html\">下载</a>最新版本。<br>下载后，假定把它放在js子目录下面，就可以加载了。</p>\n<pre><code>&lt;script src=&quot;js/require.js&quot;&gt;&lt;/script&gt;\n</code></pre>\n<p>有人可能会想到，加载这个文件，也可能造成网页失去响应。解决办法有两个，一个是把它放在网页底部加载，另一个是写成下面这样：</p>\n<pre><code>&lt;script src=&quot;js/require.js&quot; defer async=&quot;true&quot; &gt;&lt;/script&gt;\n</code></pre>\n<p>async属性表明这个文件需要异步加载，避免网页失去响应。IE不支持这个属性，只支持defer，所以把defer也写上。<br>加载require.js以后，下一步就要加载我们自己的代码了。假定我们自己的代码文件是main.js，也放在js目录下面。那么，只需要写成下面这样就行了：</p>\n<pre><code>&lt;script src=&quot;js/require.js&quot; data-main=&quot;js/main&quot;&gt;&lt;/script&gt;\n</code></pre>\n<p>data-main属性的作用是，指定网页程序的主模块。在上例中，就是js目录下面的main.js，这个文件会第一个被require.js加载。由于require.js默认的文件后缀名是js，所以可以把main.js简写成main。</p>\n<h2 id=\"主模块的写法\"><a href=\"#主模块的写法\" class=\"headerlink\" title=\"主模块的写法\"></a><font color=#0099ff size=3 face=\"黑体\">主模块的写法</font></h2><p>上一节的main.js，我把它称为”主模块”，意思是整个网页的入口代码。它有点像C语言的main()函数，所有代码都从这儿开始运行。<br>下面就来看，怎么写main.js。<br>如果我们的代码不依赖任何其他模块，那么可以直接写入javascript代码。</p>\n<blockquote>\n<p> &#x2F;&#x2F; main.js<br>　　alert(“加载成功！”);</p>\n</blockquote>\n<p>但这样的话，就没必要使用require.js了。真正常见的情况是，主模块依赖于其他模块，这时就要使用AMD规范定义的的require()函数。</p>\n<blockquote>\n<p>   &#x2F;&#x2F; main.js<br>　　require([‘moduleA’, ‘moduleB’, ‘moduleC’], function (moduleA, moduleB, moduleC){<br>　　　　&#x2F;&#x2F; some code here<br>　　});</p>\n</blockquote>\n<p>require()函数接受两个参数。第一个参数是一个数组，表示所依赖的模块，上例就是[‘moduleA’, ‘moduleB’, ‘moduleC’]，即主模块依赖这三个模块；第二个参数是一个回调函数，当前面指定的模块都加载成功后，它将被调用。加载的模块会以参数形式传入该函数，从而在回调函数内部就可以使用这些模块。</p>\n<p>require()异步加载moduleA，moduleB和moduleC，浏览器不会失去响应；它指定的回调函数，只有前面的模块都加载成功后，才会运行，解决了依赖性的问题。</p>\n<p>下面，我们看一个实际的例子。<br>假定主模块依赖jquery、underscore和backbone这三个模块，main.js就可以这样写：</p>\n<blockquote>\n<p>require([‘jquery’, ‘underscore’, ‘backbone’], function ($, _, Backbone){<br>　　　　&#x2F;&#x2F; some code here<br>　　});</p>\n</blockquote>\n<p>require.js会先加载jQuery、underscore和backbone，然后再运行回调函数。主模块的代码就写在回调函数中。</p>\n<h2 id=\"模块的加载\"><a href=\"#模块的加载\" class=\"headerlink\" title=\"模块的加载\"></a><font color=#0099ff size=3 face=\"黑体\">模块的加载</font></h2><p>上一节最后的示例中，主模块的依赖模块是[‘jquery’, ‘underscore’, ‘backbone’]。默认情况下，require.js假定这三个模块与main.js在同一个目录，文件名分别为jquery.js，underscore.js和backbone.js，然后自动加载。</p>\n<p>使用require.config()方法，我们可以对模块的加载行为进行自定义。require.config()就写在主模块（main.js）的头部。参数就是一个对象，这个对象的paths属性指定各个模块的加载路径。</p>\n<blockquote>\n<p>   require.config({<br>　　　　paths: {<br>　　　　　　“jquery”: “jquery.min”,<br>　　　　　　“underscore”: “underscore.min”,<br>　　　　　　“backbone”: “backbone.min”<br>　　　　}<br>　　});</p>\n</blockquote>\n<p>上面的代码给出了三个模块的文件名，路径默认与main.js在同一个目录（js子目录）。如果这些模块在其他目录，比如js&#x2F;lib目录，则有两种写法。一种是逐一指定路径。</p>\n<blockquote>\n<p>   require.config({<br>　　　　paths: {<br>　　　　　　“jquery”: “lib&#x2F;jquery.min”,<br>　　　　　　“underscore”: “lib&#x2F;underscore.min”,<br>　　　　　　“backbone”: “lib&#x2F;backbone.min”<br>　　　　}<br>　　});</p>\n</blockquote>\n<p>另一种则是直接改变基目录（baseUrl）。</p>\n<blockquote>\n<p>   require.config({<br>　　　　baseUrl: “js&#x2F;lib”,<br>　　　　paths: {<br>　　　　　　“jquery”: “jquery.min”,<br>　　　　　　“underscore”: “underscore.min”,<br>　　　　　　“backbone”: “backbone.min”<br>　　　　}<br>　　});</p>\n</blockquote>\n<p>如果某个模块在另一台主机上，也可以直接指定它的网址，比如：</p>\n<blockquote>\n<p>   require.config({<br>　　　　paths: {<br>　　　　　　“jquery”: “<a href=\"https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min\">https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min</a>“<br>　　　　}<br>　　});</p>\n</blockquote>\n<p>require.js要求，每个模块是一个单独的js文件。这样的话，如果加载多个模块，就会发出多次HTTP请求，会影响网页的加载速度。因此，require.js提供了一个<a href=\"https://requirejs.org/docs/optimization.html\">优化工具</a>，当模块部署完毕以后，可以用这个工具将多个模块合并在一个文件中，减少HTTP请求数。</p>\n<h2 id=\"AMD模块的写法\"><a href=\"#AMD模块的写法\" class=\"headerlink\" title=\"AMD模块的写法\"></a><font color=#0099ff size=3 face=\"黑体\">AMD模块的写法</font></h2><p>require.js加载的模块，采用AMD规范。也就是说，模块必须按照AMD的规定来写。</p>\n<p>具体来说，就是模块必须采用特定的define()函数来定义。如果一个模块不依赖其他模块，那么可以直接定义在define()函数之中。</p>\n<p>假定现在有一个math.js文件，它定义了一个math模块。那么，math.js就要这样写：</p>\n<blockquote>\n<p>   &#x2F;&#x2F; math.js<br>　　define(function (){<br>　　　　var add &#x3D; function (x,y){<br>　　　　　　return x+y;<br>　　　　};<br>　　　　return {<br>　　　　　　add: add<br>　　　　};<br>　　});</p>\n</blockquote>\n<p>加载方法如下：</p>\n<blockquote>\n<p>   &#x2F;&#x2F; main.js<br>　　require([‘math’], function (math){<br>　　　　alert(math.add(1,1));<br>　　});</p>\n</blockquote>\n<p>如果这个模块还依赖其他模块，那么define()函数的第一个参数，必须是一个数组，指明该模块的依赖性。</p>\n<blockquote>\n<p>   define([‘myLib’], function(myLib){<br>　　　　function foo(){<br>　　　　　　myLib.doSomething();<br>　　　　}<br>　　　　return {<br>　　　　　　foo : foo<br>　　　　};<br>　　});</p>\n</blockquote>\n<p>当require()函数加载上面这个模块的时候，就会先加载myLib.js文件。</p>\n<h2 id=\"加载非规范的模块\"><a href=\"#加载非规范的模块\" class=\"headerlink\" title=\"加载非规范的模块\"></a><font color=#0099ff size=3 face=\"黑体\">加载非规范的模块</font></h2><p>理论上，require.js加载的模块，必须是按照AMD规范、用define()函数定义的模块。但是实际上，虽然已经有一部分流行的函数库（比如jQuery）符合AMD规范，更多的库并不符合。那么，require.js是否能够加载非规范的模块呢？</p>\n<p>回答是可以的。</p>\n<p>这样的模块在用require()加载之前，要先用require.config()方法，定义它们的一些特征。</p>\n<p>举例来说，underscore和backbone这两个库，都没有采用AMD规范编写。如果要加载它们的话，必须先定义它们的特征。</p>\n<blockquote>\n<p>   require.config({<br>　　　　shim: {<br>　　　　　　‘underscore’:{<br>　　　　　　　　exports: ‘_’<br>　　　　　　},<br>　　　　　　‘backbone’: {<br>　　　　　　　　deps: [‘underscore’, ‘jquery’],<br>　　　　　　　　exports: ‘Backbone’<br>　　　　　　}<br>　　　　}<br>　　});</p>\n</blockquote>\n<p>require.config()接受一个配置对象，这个对象除了有前面说过的paths属性之外，还有一个shim属性，专门用来配置不兼容的模块。具体来说，每个模块要定义（1）exports值（输出的变量名），表明这个模块外部调用时的名称；（2）deps数组，表明该模块的依赖性。</p>\n<p>比如，jQuery的插件可以这样定义：</p>\n<blockquote>\n<p>   shim: {<br>　　　　‘jquery.scroll’: {<br>　　　　　　deps: [‘jquery’],<br>　　　　　　exports: ‘jQuery.fn.scroll’<br>　　　　}<br>　　}</p>\n</blockquote>\n<h2 id=\"require-js插件\"><a href=\"#require-js插件\" class=\"headerlink\" title=\"require.js插件\"></a><font color=#0099ff size=3 face=\"黑体\">require.js插件</font></h2><p>require.js还提供一系列<a href=\"https://github.com/requirejs/requirejs/wiki/Plugins\">插件</a>，实现一些特定的功能。</p>\n<p>domready插件，可以让回调函数在页面DOM结构加载完成后再运行。</p>\n<blockquote>\n<p>   require([‘domready!’], function (doc){<br>　　　　&#x2F;&#x2F; called once the DOM is ready<br>　　});</p>\n</blockquote>\n<p>text和image插件，则是允许require.js加载文本和图片文件。</p>\n<blockquote>\n<p>　　   define([<br>　　　　‘text!review.txt’,<br>　　　　‘image!cat.jpg’<br>　　　　],<br>　　　　function(review,cat){<br>　　　　　　console.log(review);<br>　　　　　　document.body.appendChild(cat);<br>　　　　}<br>　　);</p>\n</blockquote>\n<p>类似的插件还有json和mdown，用于加载json文件和markdown文件。（完）</p>\n<p>另一个人的概括(有点简单)：</p>\n<p>AMD就只有一个接口：define(id?,dependencies?,factory);</p>\n<p>它要在声明模块的时候制定所有的依赖(dep)，并且还要当做形参传到factory中，像这样：</p>\n<blockquote>\n<p>define([‘dep1’,’dep2’],function(dep1,dep2){…});</p>\n</blockquote>\n<p>要是没什么依赖，就定义简单的模块，下面这样就可以啦：</p>\n<blockquote>\n<pre><code>   define(function()&#123;\n    var exports = &#123;&#125;;\n    exports.method = function()&#123;...&#125;;\n    return exports;\n&#125;);\n</code></pre>\n</blockquote>\n<p>咦，这里有define，把东西包装起来啦，那Node实现中怎么没看到有define关键字呢，它也要把东西包装起来呀，其实吧，只是Node隐式包装了而已…..</p>\n<p>这有AMD的WIKI中文版，讲了很多蛮详细的东西，用到的时候可以查看：<a href=\"https://github.com/amdjs/amdjs-api/wiki/AMD-(%E4%B8%AD%E6%96%87%E7%89%88\">AMD的WIKI中文版</a></p>\n<h1 id=\"CMD\"><a href=\"#CMD\" class=\"headerlink\" title=\"CMD\"></a>CMD</h1><p>大名远扬的玉伯写了seajs，就是遵循他提出的CMD规范，与AMD蛮相近的，不过用起来感觉更加方便些，最重要的是中文版，应有尽有：<a href=\"http://www6.seajs.org/?s_token=1548666648.0457692136&kw=Javascript&term=learn%20javascript&term=javascript%20example&term=module%20loader&term=api%20integration&term=javascript%20online%20courses&showDomain=1&backfill=0&tdfs=1#docs\">seajs官方doc</a></p>\n<blockquote>\n<p>define(function(require,exports,module){…});</p>\n</blockquote>\n<p>用过seajs吧，这个不陌生吧，对吧。</p>\n<p>前面说AMD，说RequireJS实现了AMD，CMD看起来与AMD好像呀，那RequireJS与SeaJS像不像呢？</p>\n<p>虽然CMD与AMD蛮像的，但区别还是挺明显的，官方非官方都有阐述和理解，我觉得吧，说的都挺好：</p>\n<p><a href=\"https://github.com/seajs/seajs/issues/277\">官方阐述SeaJS与RequireJS异同</a></p>\n<p><a href=\"https://www.douban.com/note/283566440/\">SeaJS与RequireJS的最大异同（这个说的也挺好)</a></p>\n","excerpt":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>为什么模块很重要？ </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n<p>因为有了模块，我们就可以更方便地使用别人的代码，想要什么功能，就加载什么模块。<br>但是，这样做有一个前提，那就是大家必须以同样的方式编写模块，否则你有你的写法，我有我的写法，岂不是乱了套！</p>","more":"<blockquote>\n<p><a href=\"https://www.cnblogs.com/chenguangliang/p/5856701.html\">原文链接</a></p>\n</blockquote>\n<h1 id=\"CommonJS\"><a href=\"#CommonJS\" class=\"headerlink\" title=\"CommonJS\"></a>CommonJS</h1><p>   一开始大家都认为JS是辣鸡，没什么用，官方定义的API只能构建基于浏览器的应用程序，逗我呢，这太狭隘了吧(用了个高端词，嘎嘎)，CommonJS就按耐不住了，CommonJS API定义很多普通应用程序（主要指非浏览器的应用）使用的API，从而填补了这个空白。它的终极目标是提供一个类似Python，Ruby和Java标准库。这样的话，开发者可以使用CommonJS API编写应用程序，然后这些应用可以运行在不同的JavaScript解释器和不同的主机环境中。<br>在兼容CommonJS的系统中，你可以使用JavaScript开发以下程序：</p>\n<p>(1).服务器端JavaScript应用程序<br>(2).命令行工具<br>(3).图形界面应用程序<br>(4).混合应用程序（如，Titanium或Adobe AIR）</p>\n<p>2009年，美国程序员Ryan Dahl创造了node.js项目，将javascript语言用于服务器端编程。这标志”Javascript模块化编程”正式诞生。因为老实说，在浏览器环境下，没有模块也不是特别大的问题，毕竟网页程序的复杂性有限；但是在服务器端，一定要有模块，与操作系统和其他应用程序互动，否则根本没法编程。NodeJS是CommonJS规范的实现，webpack 也是以CommonJS的形式来书写。</p>\n<p>node.js的<a href=\"https://nodejs.org/docs/latest/api/modules.html\">模块系统</a>，就是参照<a href=\"http://wiki.commonjs.org/wiki/Modules/1.1\">CommonJS</a>规范实现的。在CommonJS中，有一个全局性方法require()，用于加载模块。假定有一个数学模块math.js，就可以像下面这样加载。</p>\n<p>var math &#x3D; require(‘math’);</p>\n<p>然后，就可以调用模块提供的方法：</p>\n<p>　　var math &#x3D; require(‘math’);</p>\n<pre><code>  math.add(2,3); // 5\n</code></pre>\n<p>CommonJS定义的模块分为:{模块引用(require)} {模块定义(exports)} {模块标识(module)}</p>\n<p>require()用来引入外部模块；exports对象用于导出当前模块的方法或变量，唯一的导出口；module对象就代表模块本身。</p>\n<p>虽说Node遵循CommonJS的规范，但是相比也是做了一些取舍，填了一些新东西的。</p>\n<p>不过，说了CommonJS也说了Node，那么我觉得也得先了解下NPM了。NPM作为Node的包管理器，不是为了帮助Node解决依赖包的安装问题嘛，那它肯定也要遵循CommonJS规范啦，它遵循包规范（还是理论）的。CommonJS WIKI讲了它的历史，还介绍了modules和packages等。</p>\n<p>下面讲讲commonJS的原理以及简易实现：</p>\n<h2 id=\"原理\"><a href=\"#原理\" class=\"headerlink\" title=\"原理\"></a><font color=#0099ff size=3 face=\"黑体\">原理</font></h2><p>浏览器不支持CommonJS原因，在于缺少四个Node.js环境变量</p>\n<blockquote>\n<ul>\n<li>module</li>\n</ul>\n</blockquote>\n<ul>\n<li><p>exports</p>\n</li>\n<li><p>require</p>\n</li>\n<li><p>global<br>只要能提供这4个变量，浏览器就能加载CommonJS模块<br>下面一个简单示例</p>\n<p>  var module &#x3D; {<br>  exports : {}<br>  };</p>\n<p>  (function(module,exports){<br>  exports.multiply &#x3D; function(n){return n*100}<br>  }(module,module.exports))</p>\n<p>  var f &#x3D; module.exports.multiply;<br>  f(5) &#x2F;&#x2F; 500</p>\n</li>\n</ul>\n<p>上面代码向一个立即执行函数提供 module 和 exports 两个外部变量，模块就放在这个立即执行函数里面。模块的输出值放在 module.exports 之中，这样就实现了模块的加载。</p>\n<h2 id=\"Browserify-的实现\"><a href=\"#Browserify-的实现\" class=\"headerlink\" title=\"Browserify 的实现\"></a><font color=#0099ff size=3 face=\"黑体\">Browserify 的实现</font></h2><p>知道了原理，就能做出工具了。<a href=\"http://browserify.org/\">Browserify</a> 是目前最常用的 CommonJS 格式转换的工具。</p>\n<p>请看一个例子，main.js 模块加载 foo.js 模块。<br>    <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// foo.js</span><br><span class=\"line\">module.exports = function(x) &#123;</span><br><span class=\"line\">console.log(x);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">// main.js</span><br><span class=\"line\">var foo = require(&quot;./foo&quot;);</span><br><span class=\"line\">foo(&quot;Hi&quot;);</span><br></pre></td></tr></table></figure></p>\n<pre><code>使用下面的命令，就能将main.js转为浏览器可用的格式。\n</code></pre>\n<p>$ browserify main.js &gt; compiled.js<br>Browserify到底做了什么？安装一下browser-unpack，就能看清楚了。<br>$ npm install browser-unpack -g<br>然后，将前面生成的compile.js解包。<br>    $ browser-unpack &lt; compiled.js<br>    <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        &quot;id&quot;:1,</span><br><span class=\"line\">        &quot;source&quot;:&quot;module.exports = function(x) &#123;\\n  console.log(x);\\n&#125;;&quot;,</span><br><span class=\"line\">        &quot;deps&quot;:&#123;&#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        &quot;id&quot;:2,</span><br><span class=\"line\">        &quot;source&quot;:&quot;var foo = require(\\&quot;./foo\\&quot;);\\nfoo(\\&quot;Hi\\&quot;);&quot;,</span><br><span class=\"line\">        &quot;deps&quot;:&#123;&quot;./foo&quot;:1&#125;,</span><br><span class=\"line\">        &quot;entry&quot;:true</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">] </span><br></pre></td></tr></table></figure><br>可以看到，browerify 将所有模块放入一个数组，id 属性是模块的编号，source 属性是模块的源码，deps 属性是模块的依赖。</p>\n<p>因为main.js加载了foo.js,所以deps属性就指定.&#x2F;foo对应1号模块。执行时候，浏览器遇到require(.&#x2F;foo)语句，就自动执行1好模块的source属性，并将执行后module.exports属性值输出   </p>\n<h2 id=\"Tiny-Browser-Require\"><a href=\"#Tiny-Browser-Require\" class=\"headerlink\" title=\"Tiny Browser Require\"></a><font color=#0099ff size=3 face=\"黑体\">Tiny Browser Require</font></h2><p>虽然 Browserify 很强大，但不能在浏览器里操作，有时就很不方便。<br>我根据 <a href=\"https://github.com/mochajs/mocha\">mocha</a> 的内部实现，做了一个纯浏览器的 CommonJS 模块加载器 <a href=\"https://github.com/ruanyf/tiny-browser-require\">tiny-browser-require</a> 。完全不需要命令行，直接放进浏览器即可，所有代码只有30多行。</p>\n<p>它的逻辑非常简单，就是把模块读入数组，加载路径就是模块的id。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  function require(p)&#123;</span><br><span class=\"line\">  var path = require.resolve(p); //node.js语法加载当前模块目录下的绝对路径</span><br><span class=\"line\">  var mod = require.modules[path];</span><br><span class=\"line\">  if (!mod) throw new Error(&#x27;failed to require &quot;&#x27; + p + &#x27;&quot;&#x27;);</span><br><span class=\"line\">  if (!mod.exports) &#123;</span><br><span class=\"line\">    mod.exports = &#123;&#125;;</span><br><span class=\"line\">    mod.call(mod.exports, mod, mod.exports, require.relative(path));</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  return mod.exports;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">require.modules = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">require.resolve = function (path)&#123;</span><br><span class=\"line\">  var orig = path;</span><br><span class=\"line\">  var reg = path + &#x27;.js&#x27;;</span><br><span class=\"line\">  var index = path + &#x27;/index.js&#x27;;</span><br><span class=\"line\">  return require.modules[reg] &amp;&amp; reg</span><br><span class=\"line\">    || require.modules[index] &amp;&amp; index</span><br><span class=\"line\">    || orig;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">require.register = function (path, fn)&#123;</span><br><span class=\"line\">  require.modules[path] = fn;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">require.relative = function (parent) &#123;</span><br><span class=\"line\">  return function(p)&#123;</span><br><span class=\"line\">    if (&#x27;.&#x27; != p.charAt(0)) return require(p);</span><br><span class=\"line\">    var path = parent.split(&#x27;/&#x27;);</span><br><span class=\"line\">    var segs = p.split(&#x27;/&#x27;);</span><br><span class=\"line\">    path.pop();</span><br><span class=\"line\"></span><br><span class=\"line\">    for (var i = 0; i &lt; segs.length; i++) &#123;</span><br><span class=\"line\">      var seg = segs[i];</span><br><span class=\"line\">      if (&#x27;..&#x27; == seg) path.pop();</span><br><span class=\"line\">      else if (&#x27;.&#x27; != seg) path.push(seg);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    return require(path.join(&#x27;/&#x27;));</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>使用的时候，先将上面的代码放入页面。然后，将模块放在如下的立即执行函数里面，就可以调用了。</p>\n<pre><code>&lt;script src=&quot;require.js&quot; /&gt;\n&lt;script&gt;\n    require.register(&quot;moduleId&quot;, function(module, exports, require)&#123;\n    // Module code goes here\n    &#125;);\n    var result = require(&quot;moduleId&quot;);\n&lt;/script&gt;\n</code></pre>\n<p>还是以前面的 main.js 加载 foo.js 为例。</p>\n<pre><code>require.register(&quot;./foo.js&quot;, function(module, exports, require)&#123;\nmodule.exports = function(x) &#123;\n    console.log(x);\n    &#125;;\n&#125;);\n\nvar foo = require(&quot;./foo.js&quot;);\nfoo(&quot;Hi&quot;);\n</code></pre>\n<p>注意，这个库只模拟了 require 、module 、exports 三个变量，如果模块还用到了 global 或者其他 Node 专有变量（比如 process），就通过立即执行函数提供即可。</p>\n<h1 id=\"AMD\"><a href=\"#AMD\" class=\"headerlink\" title=\"AMD\"></a>AMD</h1><p>基于commonJS规范的nodeJS出来以后，服务端的模块概念已经形成，很自然地，大家就想要客户端模块。而且最好两者能够兼容，一个模块不用修改，在服务器和浏览器都可以运行。但是，由于一个重大的局限，使得CommonJS规范不适用于浏览器环境。还是上面的代码，如果在浏览器中运行，会有一个很大的问题，你能看出来吗？</p>\n<blockquote>\n<p>var math &#x3D; require(‘math’);<br>math.add(2, 3);</p>\n</blockquote>\n<p>第二行math.add(2, 3)，在第一行require(‘math’)之后运行，因此必须等math.js加载完成。也就是说，如果加载时间很长，整个应用就会停在那里等。<font color=red>您会注意到 require 是同步的。</font></p>\n<p>这对服务器端不是一个问题，因为所有的模块都存放在本地硬盘，可以同步加载完成，等待时间就是硬盘的读取时间。但是，对于浏览器，这却是一个大问题，因为模块都放在服务器端，等待时间取决于网速的快慢，可能要等很长时间，浏览器处于”假死”状态。</p>\n<p>因此，浏览器端的模块，不能采用”同步加载”（synchronous），只能采用”异步加载”（asynchronous）。这就是AMD规范诞生的背景。</p>\n<p>CommonJS是主要为了JS在后端的表现制定的，他是不适合前端的，AMD(异步模块定义)出现了，它就主要为前端JS的表现制定规范。</p>\n<p><a href=\"https://github.com/amdjs/amdjs-api/wiki/AMD\">AMD</a>是”Asynchronous Module Definition”的缩写，意思就是”异步模块定义”。它采用异步方式加载模块，模块的加载不影响它后面语句的运行。所有依赖这个模块的语句，都定义在一个回调函数中，等到加载完成之后，这个回调函数才会运行。</p>\n<p>AMD也采用require()语句加载模块，但是不同于CommonJS，它要求两个参数：</p>\n<pre><code>require([module], callback);\n</code></pre>\n<p>第一个参数[module]，是一个数组，里面的成员就是要加载的模块；第二个参数callback，则是加载成功之后的回调函数。如果将前面的代码改写成AMD形式，就是下面这样：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">require([&#x27;math&#x27;], function (math) &#123;</span><br><span class=\"line\">    math.add(2, 3);</span><br><span class=\"line\">　&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>math.add()与math模块加载不是同步的，浏览器不会发生假死。所以很显然，AMD比较适合浏览器环境。目前，主要有两个Javascript库实现了AMD规范：<a href=\"https://requirejs.org/\">require.js</a>和<a href=\"https://github.com/cujojs/curl\">curl.js</a>。<br><font color=red>RequireJS就是实现了AMD规范的呢。</font><br><font size=2>详细概括：下面以RequireJS为例说明AMD规范</font></p>\n<h2 id=\"为什么要用require-js？\"><a href=\"#为什么要用require-js？\" class=\"headerlink\" title=\"为什么要用require.js？\"></a><font color=#0099ff size=3 face=\"黑体\">为什么要用require.js？</font></h2><p>最早的时候，所有Javascript代码都写在一个文件里面，只要加载这一个文件就够了。后来，代码越来越多，一个文件不够了，必须分成多个文件，依次加载。下面的网页代码，相信很多人都见过。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script src=&quot;1.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">&lt;script src=&quot;2.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">&lt;script src=&quot;3.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">&lt;script src=&quot;4.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">&lt;script src=&quot;5.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">&lt;script src=&quot;6.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n<p>这段代码依次加载多个js文件。<br>这样的写法有很大的缺点。首先，加载的时候，浏览器会停止网页渲染，加载文件越多，网页失去响应的时间就会越长；其次，由于js文件之间存在依赖关系，因此必须严格保证加载顺序（比如上例的1.js要在2.js的前面），依赖性最大的模块一定要放到最后加载，当依赖关系很复杂的时候，代码的编写和维护都会变得困难。</p>\n<p>require.js的诞生，就是为了解决这两个问题：</p>\n<blockquote>\n<p>(1) 实现js文件的异步加载，避免网页失去响应；<br>(2) 管理模块之间的依赖性，便于代码的编写和维护。</p>\n</blockquote>\n<h2 id=\"require-js的加载\"><a href=\"#require-js的加载\" class=\"headerlink\" title=\"require.js的加载\"></a><font color=#0099ff size=3 face=\"黑体\">require.js的加载</font></h2><p>使用require.js的第一步，是先去官方网站<a href=\"https://requirejs.org/docs/download.html\">下载</a>最新版本。<br>下载后，假定把它放在js子目录下面，就可以加载了。</p>\n<pre><code>&lt;script src=&quot;js/require.js&quot;&gt;&lt;/script&gt;\n</code></pre>\n<p>有人可能会想到，加载这个文件，也可能造成网页失去响应。解决办法有两个，一个是把它放在网页底部加载，另一个是写成下面这样：</p>\n<pre><code>&lt;script src=&quot;js/require.js&quot; defer async=&quot;true&quot; &gt;&lt;/script&gt;\n</code></pre>\n<p>async属性表明这个文件需要异步加载，避免网页失去响应。IE不支持这个属性，只支持defer，所以把defer也写上。<br>加载require.js以后，下一步就要加载我们自己的代码了。假定我们自己的代码文件是main.js，也放在js目录下面。那么，只需要写成下面这样就行了：</p>\n<pre><code>&lt;script src=&quot;js/require.js&quot; data-main=&quot;js/main&quot;&gt;&lt;/script&gt;\n</code></pre>\n<p>data-main属性的作用是，指定网页程序的主模块。在上例中，就是js目录下面的main.js，这个文件会第一个被require.js加载。由于require.js默认的文件后缀名是js，所以可以把main.js简写成main。</p>\n<h2 id=\"主模块的写法\"><a href=\"#主模块的写法\" class=\"headerlink\" title=\"主模块的写法\"></a><font color=#0099ff size=3 face=\"黑体\">主模块的写法</font></h2><p>上一节的main.js，我把它称为”主模块”，意思是整个网页的入口代码。它有点像C语言的main()函数，所有代码都从这儿开始运行。<br>下面就来看，怎么写main.js。<br>如果我们的代码不依赖任何其他模块，那么可以直接写入javascript代码。</p>\n<blockquote>\n<p> &#x2F;&#x2F; main.js<br>　　alert(“加载成功！”);</p>\n</blockquote>\n<p>但这样的话，就没必要使用require.js了。真正常见的情况是，主模块依赖于其他模块，这时就要使用AMD规范定义的的require()函数。</p>\n<blockquote>\n<p>   &#x2F;&#x2F; main.js<br>　　require([‘moduleA’, ‘moduleB’, ‘moduleC’], function (moduleA, moduleB, moduleC){<br>　　　　&#x2F;&#x2F; some code here<br>　　});</p>\n</blockquote>\n<p>require()函数接受两个参数。第一个参数是一个数组，表示所依赖的模块，上例就是[‘moduleA’, ‘moduleB’, ‘moduleC’]，即主模块依赖这三个模块；第二个参数是一个回调函数，当前面指定的模块都加载成功后，它将被调用。加载的模块会以参数形式传入该函数，从而在回调函数内部就可以使用这些模块。</p>\n<p>require()异步加载moduleA，moduleB和moduleC，浏览器不会失去响应；它指定的回调函数，只有前面的模块都加载成功后，才会运行，解决了依赖性的问题。</p>\n<p>下面，我们看一个实际的例子。<br>假定主模块依赖jquery、underscore和backbone这三个模块，main.js就可以这样写：</p>\n<blockquote>\n<p>require([‘jquery’, ‘underscore’, ‘backbone’], function ($, _, Backbone){<br>　　　　&#x2F;&#x2F; some code here<br>　　});</p>\n</blockquote>\n<p>require.js会先加载jQuery、underscore和backbone，然后再运行回调函数。主模块的代码就写在回调函数中。</p>\n<h2 id=\"模块的加载\"><a href=\"#模块的加载\" class=\"headerlink\" title=\"模块的加载\"></a><font color=#0099ff size=3 face=\"黑体\">模块的加载</font></h2><p>上一节最后的示例中，主模块的依赖模块是[‘jquery’, ‘underscore’, ‘backbone’]。默认情况下，require.js假定这三个模块与main.js在同一个目录，文件名分别为jquery.js，underscore.js和backbone.js，然后自动加载。</p>\n<p>使用require.config()方法，我们可以对模块的加载行为进行自定义。require.config()就写在主模块（main.js）的头部。参数就是一个对象，这个对象的paths属性指定各个模块的加载路径。</p>\n<blockquote>\n<p>   require.config({<br>　　　　paths: {<br>　　　　　　“jquery”: “jquery.min”,<br>　　　　　　“underscore”: “underscore.min”,<br>　　　　　　“backbone”: “backbone.min”<br>　　　　}<br>　　});</p>\n</blockquote>\n<p>上面的代码给出了三个模块的文件名，路径默认与main.js在同一个目录（js子目录）。如果这些模块在其他目录，比如js&#x2F;lib目录，则有两种写法。一种是逐一指定路径。</p>\n<blockquote>\n<p>   require.config({<br>　　　　paths: {<br>　　　　　　“jquery”: “lib&#x2F;jquery.min”,<br>　　　　　　“underscore”: “lib&#x2F;underscore.min”,<br>　　　　　　“backbone”: “lib&#x2F;backbone.min”<br>　　　　}<br>　　});</p>\n</blockquote>\n<p>另一种则是直接改变基目录（baseUrl）。</p>\n<blockquote>\n<p>   require.config({<br>　　　　baseUrl: “js&#x2F;lib”,<br>　　　　paths: {<br>　　　　　　“jquery”: “jquery.min”,<br>　　　　　　“underscore”: “underscore.min”,<br>　　　　　　“backbone”: “backbone.min”<br>　　　　}<br>　　});</p>\n</blockquote>\n<p>如果某个模块在另一台主机上，也可以直接指定它的网址，比如：</p>\n<blockquote>\n<p>   require.config({<br>　　　　paths: {<br>　　　　　　“jquery”: “<a href=\"https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min\">https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min</a>“<br>　　　　}<br>　　});</p>\n</blockquote>\n<p>require.js要求，每个模块是一个单独的js文件。这样的话，如果加载多个模块，就会发出多次HTTP请求，会影响网页的加载速度。因此，require.js提供了一个<a href=\"https://requirejs.org/docs/optimization.html\">优化工具</a>，当模块部署完毕以后，可以用这个工具将多个模块合并在一个文件中，减少HTTP请求数。</p>\n<h2 id=\"AMD模块的写法\"><a href=\"#AMD模块的写法\" class=\"headerlink\" title=\"AMD模块的写法\"></a><font color=#0099ff size=3 face=\"黑体\">AMD模块的写法</font></h2><p>require.js加载的模块，采用AMD规范。也就是说，模块必须按照AMD的规定来写。</p>\n<p>具体来说，就是模块必须采用特定的define()函数来定义。如果一个模块不依赖其他模块，那么可以直接定义在define()函数之中。</p>\n<p>假定现在有一个math.js文件，它定义了一个math模块。那么，math.js就要这样写：</p>\n<blockquote>\n<p>   &#x2F;&#x2F; math.js<br>　　define(function (){<br>　　　　var add &#x3D; function (x,y){<br>　　　　　　return x+y;<br>　　　　};<br>　　　　return {<br>　　　　　　add: add<br>　　　　};<br>　　});</p>\n</blockquote>\n<p>加载方法如下：</p>\n<blockquote>\n<p>   &#x2F;&#x2F; main.js<br>　　require([‘math’], function (math){<br>　　　　alert(math.add(1,1));<br>　　});</p>\n</blockquote>\n<p>如果这个模块还依赖其他模块，那么define()函数的第一个参数，必须是一个数组，指明该模块的依赖性。</p>\n<blockquote>\n<p>   define([‘myLib’], function(myLib){<br>　　　　function foo(){<br>　　　　　　myLib.doSomething();<br>　　　　}<br>　　　　return {<br>　　　　　　foo : foo<br>　　　　};<br>　　});</p>\n</blockquote>\n<p>当require()函数加载上面这个模块的时候，就会先加载myLib.js文件。</p>\n<h2 id=\"加载非规范的模块\"><a href=\"#加载非规范的模块\" class=\"headerlink\" title=\"加载非规范的模块\"></a><font color=#0099ff size=3 face=\"黑体\">加载非规范的模块</font></h2><p>理论上，require.js加载的模块，必须是按照AMD规范、用define()函数定义的模块。但是实际上，虽然已经有一部分流行的函数库（比如jQuery）符合AMD规范，更多的库并不符合。那么，require.js是否能够加载非规范的模块呢？</p>\n<p>回答是可以的。</p>\n<p>这样的模块在用require()加载之前，要先用require.config()方法，定义它们的一些特征。</p>\n<p>举例来说，underscore和backbone这两个库，都没有采用AMD规范编写。如果要加载它们的话，必须先定义它们的特征。</p>\n<blockquote>\n<p>   require.config({<br>　　　　shim: {<br>　　　　　　‘underscore’:{<br>　　　　　　　　exports: ‘_’<br>　　　　　　},<br>　　　　　　‘backbone’: {<br>　　　　　　　　deps: [‘underscore’, ‘jquery’],<br>　　　　　　　　exports: ‘Backbone’<br>　　　　　　}<br>　　　　}<br>　　});</p>\n</blockquote>\n<p>require.config()接受一个配置对象，这个对象除了有前面说过的paths属性之外，还有一个shim属性，专门用来配置不兼容的模块。具体来说，每个模块要定义（1）exports值（输出的变量名），表明这个模块外部调用时的名称；（2）deps数组，表明该模块的依赖性。</p>\n<p>比如，jQuery的插件可以这样定义：</p>\n<blockquote>\n<p>   shim: {<br>　　　　‘jquery.scroll’: {<br>　　　　　　deps: [‘jquery’],<br>　　　　　　exports: ‘jQuery.fn.scroll’<br>　　　　}<br>　　}</p>\n</blockquote>\n<h2 id=\"require-js插件\"><a href=\"#require-js插件\" class=\"headerlink\" title=\"require.js插件\"></a><font color=#0099ff size=3 face=\"黑体\">require.js插件</font></h2><p>require.js还提供一系列<a href=\"https://github.com/requirejs/requirejs/wiki/Plugins\">插件</a>，实现一些特定的功能。</p>\n<p>domready插件，可以让回调函数在页面DOM结构加载完成后再运行。</p>\n<blockquote>\n<p>   require([‘domready!’], function (doc){<br>　　　　&#x2F;&#x2F; called once the DOM is ready<br>　　});</p>\n</blockquote>\n<p>text和image插件，则是允许require.js加载文本和图片文件。</p>\n<blockquote>\n<p>　　   define([<br>　　　　‘text!review.txt’,<br>　　　　‘image!cat.jpg’<br>　　　　],<br>　　　　function(review,cat){<br>　　　　　　console.log(review);<br>　　　　　　document.body.appendChild(cat);<br>　　　　}<br>　　);</p>\n</blockquote>\n<p>类似的插件还有json和mdown，用于加载json文件和markdown文件。（完）</p>\n<p>另一个人的概括(有点简单)：</p>\n<p>AMD就只有一个接口：define(id?,dependencies?,factory);</p>\n<p>它要在声明模块的时候制定所有的依赖(dep)，并且还要当做形参传到factory中，像这样：</p>\n<blockquote>\n<p>define([‘dep1’,’dep2’],function(dep1,dep2){…});</p>\n</blockquote>\n<p>要是没什么依赖，就定义简单的模块，下面这样就可以啦：</p>\n<blockquote>\n<pre><code>   define(function()&#123;\n    var exports = &#123;&#125;;\n    exports.method = function()&#123;...&#125;;\n    return exports;\n&#125;);\n</code></pre>\n</blockquote>\n<p>咦，这里有define，把东西包装起来啦，那Node实现中怎么没看到有define关键字呢，它也要把东西包装起来呀，其实吧，只是Node隐式包装了而已…..</p>\n<p>这有AMD的WIKI中文版，讲了很多蛮详细的东西，用到的时候可以查看：<a href=\"https://github.com/amdjs/amdjs-api/wiki/AMD-(%E4%B8%AD%E6%96%87%E7%89%88\">AMD的WIKI中文版</a></p>\n<h1 id=\"CMD\"><a href=\"#CMD\" class=\"headerlink\" title=\"CMD\"></a>CMD</h1><p>大名远扬的玉伯写了seajs，就是遵循他提出的CMD规范，与AMD蛮相近的，不过用起来感觉更加方便些，最重要的是中文版，应有尽有：<a href=\"http://www6.seajs.org/?s_token=1548666648.0457692136&kw=Javascript&term=learn%20javascript&term=javascript%20example&term=module%20loader&term=api%20integration&term=javascript%20online%20courses&showDomain=1&backfill=0&tdfs=1#docs\">seajs官方doc</a></p>\n<blockquote>\n<p>define(function(require,exports,module){…});</p>\n</blockquote>\n<p>用过seajs吧，这个不陌生吧，对吧。</p>\n<p>前面说AMD，说RequireJS实现了AMD，CMD看起来与AMD好像呀，那RequireJS与SeaJS像不像呢？</p>\n<p>虽然CMD与AMD蛮像的，但区别还是挺明显的，官方非官方都有阐述和理解，我觉得吧，说的都挺好：</p>\n<p><a href=\"https://github.com/seajs/seajs/issues/277\">官方阐述SeaJS与RequireJS异同</a></p>\n<p><a href=\"https://www.douban.com/note/283566440/\">SeaJS与RequireJS的最大异同（这个说的也挺好)</a></p>"},{"title":"用 JavaScript 和 Emoji 做地址栏动画","date":"2019-01-27T04:06:29.000Z","copyright":true,"keywords":null,"description":null,"_content":"{% cq %} 同样是9年义务教育，你为何这么优秀 {% endcq %}\n<!--more-->\n\n>译者：[Wpeach](https://juejin.im/post/5c49b822f265da6142743a87)\n 原文作者：Matthew Rayfield \n 原文地址：[Animating URLs with Javascript and Emojis](http://matthewrayfield.com/articles/animating-urls-with-javascript-and-emojis/)\n \n 你可以在地址栏使用 emoji（和其它图形 unicode 字符），这看着很棒，但是好像没人这么做，为什么呢？也许 emoji 对于正常的网络平台来说太过异国情调了？或许是他们因为害怕不利于SEO？\n不管什么原因，维恩图中的合理性观点“没人这么做，但这是可能的”是让我兴奋的点。所以我决定花费一些时间研究在地址栏中图形字符的可能性，特别是通过 JavaScript 给这些字符加上动画。\n循环动画\n首先，确保你页面的 JavaScript 代码是 UTF-8 编码，否则无法在你的代码中显示 emoji，这可以通过设置 HTTP 头部或页面的 META 标签来实现。你很可能不用担心这个，但你可以在这里找到更多信息：Unicode in Javascript by Flavio。\n为了达到我们想要的效果，让 emoji 像小仙女一样在地址栏里偏偏起舞，我们需要一个循环，实际上，我们所需要的只是一个循环，我们启动这个循环，它不断循环，我们的目的就达到了。这是我们的第一个循环动画，一个旋转的emoji 月亮。我猜当他们添加这个 emoji 序列时，也有这个想法吧？\n\n    var f = ['🌑', '🌒', '🌓', '🌔', '🌝', '🌖', '🌗', '🌘'];\n\n    function loop() {\n        location.hash = f[Math.floor((Date.now()/100)%f.length)];\n\n        setTimeout(loop, 50);\n    }\n\n    loop();\n复制代码运行代码，你可以在地址栏看到此循环的结果。\n如果你不喜欢旋转的月亮，你可以选择任何你喜欢的 emoji 来替换这个数组，比如一个时钟：\n\nvar f = ['🕐','🕑','🕒','🕓','🕔','🕕','🕖','🕗','🕘','🕙','🕚','🕛'];\n复制代码这是一个非常简单的例子，真的非常简单，所以我们来升级一下循环，让它显示一串 emoji ! 这次我们使用 emoji 的skin tone modifiers肤色调节属性来制作一些变色宝宝：\n\n    var e = ['🏻', '🏼', '🏽', '🏾', '🏿'];\n\n    function loop() {\n        var s = '',\n            i, m;\n\n        for (i = 0; i < 10; i ++) {\n            m = Math.floor(e.length * ((Math.sin((Date.now()/100) + i)+1)/2));\n            s += '👶' + e[m];\n        }\n\n        location.hash = s;\n\n        setTimeout(loop, 50);\n    }\n\n    loop(); \n复制代码我们可以使用时间和位置控制的正弦波来选择我们想要的颜色，这给了我们一个很好的颜色变幻效果！\n比如我们再来一次月亮旋转，使它展开，制作一个类似于加载条的动画？好的，开始实现：\n\n    var f = ['🌑', '🌘', '🌗', '🌖', '🌕', '🌔', '🌓', '🌒'],\n        d = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n        m = 0;\n\n    function loop() {\n        var s = '', x = 0;\n\n        if (!m) {\n            while (d[x] == 4) {\n                x ++;\n            }\n\n            if (x >= d.length) m = 1;\n            else {\n                d[x] ++;\n            }\n        }\n        else {\n            while (d[x] == 0) {\n                x ++;\n            }\n\n            if (x >= d.length) m = 0;\n            else {\n                d[x] ++;\n\n                if (d[x] == 8) d[x] = 0;\n            }\n        }\n\n        d.forEach(function (n) {\n            s += f[n];\n        });\n\n        location.hash = s;\n\n        setTimeout(loop, 50);\n    }\n\n    loop();\n复制代码探索其它字符\n不止是 emoji 给我们提供了一种在地址栏显示图形的方法，我们的目标中也有一些 unicode 字符。\n特别有趣的是 框线字符:\n\n它们中很多更适合二维输出，但它们在一维输出也很棒，例如，我们可以创建一个多个高度变化的块字符串，并构造一个漂亮的小波浪动画：\n\n    function loop() {\n        var i, n, s = '';\n\n        for (i = 0; i < 10; i++) {\n            n = Math.floor(Math.sin((Date.now()/200) + (i/2)) * 4) + 4;\n\n            s += String.fromCharCode(0x2581 + n);\n        }\n\n        window.location.hash = s;\n\n        setTimeout(loop, 50);\n    }\n\n    loop();\n复制代码我非常喜欢它的效果，我把它永久放在了 wavyurl.com 上。\n使用可变宽度字符，我们甚至在水平方向上摆动，创建类似于进度条的东西：\n\n    function loop() {\n        var s = '',\n            p;\n\n        p = Math.floor(((Math.sin(Date.now()/300)+1)/2) * 100);\n\n        while (p >= 8) {\n            s += '█';\n            p -= 8;\n        }\n        s += ['⠀','▏','▎','▍','▌','▋','▊','▉'][p];\n\n        location.hash = s;\n        setTimeout(loop, 50);\n    }\n复制代码进度条？这看起来，还是有用的，这让我想到了……\n在地址栏显示视频进度\n为了增加我们小实验的可能性，我提出了在地址栏中显示网络视频进度的想法。我只需附加一个函数，将我们的进度字符串定义在视频的timeupdate事件中，瞧！地址栏中的视频进度条包含时间和持续时间！\n\n    var video;\n\n    function formatTime(seconds) {\n        var minutes = Math.floor(seconds/60),\n            seconds = Math.floor(seconds - (minutes*60));\n\n        return ('0'+minutes).substr(-2) + ':' + ('0'+seconds).substr(-2);\n    }\n\n    function renderProgressBar() {\n        var s = '',\n            l = 15,\n            p = Math.floor(video.currentTime / video.duration * (l-1)),\n            i;\n\n        for (i = 0; i < l; i ++) {\n            if (i == p) s +='◯';\n            else if (i < p) s += '─';\n            else s += '┄';\n        }\n\n        location.hash = '╭'+s+'╮'+formatTime(video.currentTime)+'╱'+formatTime(video.duration);\n    }\n\n    video = document.getElementById('video');\n    video.addEventListener('timeupdate', renderProgressBar);\n复制代码我比较喜欢这个线条和圆组成的进度条，如果你喜欢别的 emoji 比如月亮，我也能让你满意：\n\n    var e = ['🌑', '🌘', '🌗', '🌖', '🌕'],\n        video;\n\n    function formatTime(seconds) {\n        var minutes = Math.floor(seconds/60),\n            seconds = Math.floor(seconds - (minutes*60));\n\n        return ('0'+minutes).substr(-2) + ':' + ('0'+seconds).substr(-2);\n    }\n\n    function renderProgressBar() {\n        var s = '',\n            c = 0,\n            l = 10,\n            p = Math.floor(video.currentTime / video.duration * ((l*5)-1)),\n            i;\n\n        while (p >= 5) {\n            s += e[4];\n            c ++;\n            p -= 5;\n        }\n        s += e[p];\n        c ++;\n\n        while (c < l) {\n            s += e[0];\n            c ++;\n        }\n\n        location.hash = s+formatTime(video.currentTime)+'╱'+formatTime(video.duration);\n    }\n\n    video = document.getElementById('video');\n    video.addEventListener('timeupdate', renderProgressBar);\n复制代码好的，将此进度条称为“有用”的延伸。 只瞄一眼，我也可以看到在视频分享 URL 中的进度。 与YouTube一样，你可以选择在特定时间创建指向视频的链接，添加视觉指示是不是很酷？嗯？\n也许我还没有提出一些更有用的“技术”实现，我会继续思考这个问题。 嘿，也许你可以尝试一些东西？\n最后\n你可能想知道为什么我使用location.hash =，而不是新且酷的HTML5 History API。 有两个原因：\n第一个问题是 History API有一个特点：它实际上更改了整个 URL 路径，而不仅仅是 hash。 因此，如果我使用 History API 并将页面更改为/🌑🌘🌗🌖🌕，它看起来会比添加 ＃ 更好。 但这也意味着我的 Web 服务器必须能够响应/🌑🌘🌗🌖🌕，否则如果用户刷新或以其他方式导航到修改后的 URL 将会失败。 这是可行的，但比使用location.hash =更复杂，需要我修改服务器配置。\n第二个问题有些出乎意料。 实际上，在我测试的3个浏览器中，有2个历史API被限制的。 如果我以极快的速度将我的波形网址推送到地址栏，我最终会在 Chrome 中收到以下错误：\n\nThrottling history state changes to prevent the browser from hanging.\n\nSafari 给我们提供了更详细的信息：\n\nSecurityError: Attempt to use history.pushState() more than 100 times per 30.000000 seconds\n\n现在，如果让我保持在这个限制下也行，但是每秒3帧只是不会影响我目前的动画效果。\n好孩子 Firefox 似乎并不在乎我推送新历史的次数和速度，这真是想得太周到了。但是，两个主要的浏览器受到影响，加上需要web服务器配置来修复第一个问题，使我更愿意忍受 URL 中的 #。\n\n ","source":"_posts/Emojis-url.md","raw":"---\ntitle: '用 JavaScript 和 Emoji 做地址栏动画'\ndate: 2019-01-27 12:06:29\ncategories: web\ntags:\n   - 用JavaScript和Emoji 做地址栏动画\ncopyright: true\nkeywords:\ndescription:\n---\n{% cq %} 同样是9年义务教育，你为何这么优秀 {% endcq %}\n<!--more-->\n\n>译者：[Wpeach](https://juejin.im/post/5c49b822f265da6142743a87)\n 原文作者：Matthew Rayfield \n 原文地址：[Animating URLs with Javascript and Emojis](http://matthewrayfield.com/articles/animating-urls-with-javascript-and-emojis/)\n \n 你可以在地址栏使用 emoji（和其它图形 unicode 字符），这看着很棒，但是好像没人这么做，为什么呢？也许 emoji 对于正常的网络平台来说太过异国情调了？或许是他们因为害怕不利于SEO？\n不管什么原因，维恩图中的合理性观点“没人这么做，但这是可能的”是让我兴奋的点。所以我决定花费一些时间研究在地址栏中图形字符的可能性，特别是通过 JavaScript 给这些字符加上动画。\n循环动画\n首先，确保你页面的 JavaScript 代码是 UTF-8 编码，否则无法在你的代码中显示 emoji，这可以通过设置 HTTP 头部或页面的 META 标签来实现。你很可能不用担心这个，但你可以在这里找到更多信息：Unicode in Javascript by Flavio。\n为了达到我们想要的效果，让 emoji 像小仙女一样在地址栏里偏偏起舞，我们需要一个循环，实际上，我们所需要的只是一个循环，我们启动这个循环，它不断循环，我们的目的就达到了。这是我们的第一个循环动画，一个旋转的emoji 月亮。我猜当他们添加这个 emoji 序列时，也有这个想法吧？\n\n    var f = ['🌑', '🌒', '🌓', '🌔', '🌝', '🌖', '🌗', '🌘'];\n\n    function loop() {\n        location.hash = f[Math.floor((Date.now()/100)%f.length)];\n\n        setTimeout(loop, 50);\n    }\n\n    loop();\n复制代码运行代码，你可以在地址栏看到此循环的结果。\n如果你不喜欢旋转的月亮，你可以选择任何你喜欢的 emoji 来替换这个数组，比如一个时钟：\n\nvar f = ['🕐','🕑','🕒','🕓','🕔','🕕','🕖','🕗','🕘','🕙','🕚','🕛'];\n复制代码这是一个非常简单的例子，真的非常简单，所以我们来升级一下循环，让它显示一串 emoji ! 这次我们使用 emoji 的skin tone modifiers肤色调节属性来制作一些变色宝宝：\n\n    var e = ['🏻', '🏼', '🏽', '🏾', '🏿'];\n\n    function loop() {\n        var s = '',\n            i, m;\n\n        for (i = 0; i < 10; i ++) {\n            m = Math.floor(e.length * ((Math.sin((Date.now()/100) + i)+1)/2));\n            s += '👶' + e[m];\n        }\n\n        location.hash = s;\n\n        setTimeout(loop, 50);\n    }\n\n    loop(); \n复制代码我们可以使用时间和位置控制的正弦波来选择我们想要的颜色，这给了我们一个很好的颜色变幻效果！\n比如我们再来一次月亮旋转，使它展开，制作一个类似于加载条的动画？好的，开始实现：\n\n    var f = ['🌑', '🌘', '🌗', '🌖', '🌕', '🌔', '🌓', '🌒'],\n        d = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n        m = 0;\n\n    function loop() {\n        var s = '', x = 0;\n\n        if (!m) {\n            while (d[x] == 4) {\n                x ++;\n            }\n\n            if (x >= d.length) m = 1;\n            else {\n                d[x] ++;\n            }\n        }\n        else {\n            while (d[x] == 0) {\n                x ++;\n            }\n\n            if (x >= d.length) m = 0;\n            else {\n                d[x] ++;\n\n                if (d[x] == 8) d[x] = 0;\n            }\n        }\n\n        d.forEach(function (n) {\n            s += f[n];\n        });\n\n        location.hash = s;\n\n        setTimeout(loop, 50);\n    }\n\n    loop();\n复制代码探索其它字符\n不止是 emoji 给我们提供了一种在地址栏显示图形的方法，我们的目标中也有一些 unicode 字符。\n特别有趣的是 框线字符:\n\n它们中很多更适合二维输出，但它们在一维输出也很棒，例如，我们可以创建一个多个高度变化的块字符串，并构造一个漂亮的小波浪动画：\n\n    function loop() {\n        var i, n, s = '';\n\n        for (i = 0; i < 10; i++) {\n            n = Math.floor(Math.sin((Date.now()/200) + (i/2)) * 4) + 4;\n\n            s += String.fromCharCode(0x2581 + n);\n        }\n\n        window.location.hash = s;\n\n        setTimeout(loop, 50);\n    }\n\n    loop();\n复制代码我非常喜欢它的效果，我把它永久放在了 wavyurl.com 上。\n使用可变宽度字符，我们甚至在水平方向上摆动，创建类似于进度条的东西：\n\n    function loop() {\n        var s = '',\n            p;\n\n        p = Math.floor(((Math.sin(Date.now()/300)+1)/2) * 100);\n\n        while (p >= 8) {\n            s += '█';\n            p -= 8;\n        }\n        s += ['⠀','▏','▎','▍','▌','▋','▊','▉'][p];\n\n        location.hash = s;\n        setTimeout(loop, 50);\n    }\n复制代码进度条？这看起来，还是有用的，这让我想到了……\n在地址栏显示视频进度\n为了增加我们小实验的可能性，我提出了在地址栏中显示网络视频进度的想法。我只需附加一个函数，将我们的进度字符串定义在视频的timeupdate事件中，瞧！地址栏中的视频进度条包含时间和持续时间！\n\n    var video;\n\n    function formatTime(seconds) {\n        var minutes = Math.floor(seconds/60),\n            seconds = Math.floor(seconds - (minutes*60));\n\n        return ('0'+minutes).substr(-2) + ':' + ('0'+seconds).substr(-2);\n    }\n\n    function renderProgressBar() {\n        var s = '',\n            l = 15,\n            p = Math.floor(video.currentTime / video.duration * (l-1)),\n            i;\n\n        for (i = 0; i < l; i ++) {\n            if (i == p) s +='◯';\n            else if (i < p) s += '─';\n            else s += '┄';\n        }\n\n        location.hash = '╭'+s+'╮'+formatTime(video.currentTime)+'╱'+formatTime(video.duration);\n    }\n\n    video = document.getElementById('video');\n    video.addEventListener('timeupdate', renderProgressBar);\n复制代码我比较喜欢这个线条和圆组成的进度条，如果你喜欢别的 emoji 比如月亮，我也能让你满意：\n\n    var e = ['🌑', '🌘', '🌗', '🌖', '🌕'],\n        video;\n\n    function formatTime(seconds) {\n        var minutes = Math.floor(seconds/60),\n            seconds = Math.floor(seconds - (minutes*60));\n\n        return ('0'+minutes).substr(-2) + ':' + ('0'+seconds).substr(-2);\n    }\n\n    function renderProgressBar() {\n        var s = '',\n            c = 0,\n            l = 10,\n            p = Math.floor(video.currentTime / video.duration * ((l*5)-1)),\n            i;\n\n        while (p >= 5) {\n            s += e[4];\n            c ++;\n            p -= 5;\n        }\n        s += e[p];\n        c ++;\n\n        while (c < l) {\n            s += e[0];\n            c ++;\n        }\n\n        location.hash = s+formatTime(video.currentTime)+'╱'+formatTime(video.duration);\n    }\n\n    video = document.getElementById('video');\n    video.addEventListener('timeupdate', renderProgressBar);\n复制代码好的，将此进度条称为“有用”的延伸。 只瞄一眼，我也可以看到在视频分享 URL 中的进度。 与YouTube一样，你可以选择在特定时间创建指向视频的链接，添加视觉指示是不是很酷？嗯？\n也许我还没有提出一些更有用的“技术”实现，我会继续思考这个问题。 嘿，也许你可以尝试一些东西？\n最后\n你可能想知道为什么我使用location.hash =，而不是新且酷的HTML5 History API。 有两个原因：\n第一个问题是 History API有一个特点：它实际上更改了整个 URL 路径，而不仅仅是 hash。 因此，如果我使用 History API 并将页面更改为/🌑🌘🌗🌖🌕，它看起来会比添加 ＃ 更好。 但这也意味着我的 Web 服务器必须能够响应/🌑🌘🌗🌖🌕，否则如果用户刷新或以其他方式导航到修改后的 URL 将会失败。 这是可行的，但比使用location.hash =更复杂，需要我修改服务器配置。\n第二个问题有些出乎意料。 实际上，在我测试的3个浏览器中，有2个历史API被限制的。 如果我以极快的速度将我的波形网址推送到地址栏，我最终会在 Chrome 中收到以下错误：\n\nThrottling history state changes to prevent the browser from hanging.\n\nSafari 给我们提供了更详细的信息：\n\nSecurityError: Attempt to use history.pushState() more than 100 times per 30.000000 seconds\n\n现在，如果让我保持在这个限制下也行，但是每秒3帧只是不会影响我目前的动画效果。\n好孩子 Firefox 似乎并不在乎我推送新历史的次数和速度，这真是想得太周到了。但是，两个主要的浏览器受到影响，加上需要web服务器配置来修复第一个问题，使我更愿意忍受 URL 中的 #。\n\n ","slug":"Emojis-url","published":1,"updated":"2026-01-02T00:43:17.570Z","comments":1,"layout":"post","photos":[],"_id":"cmjwbsw600003rotgd3psg07w","content":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>同样是9年义务教育，你为何这么优秀 </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n<span id=\"more\"></span>\n\n<blockquote>\n<p>译者：<a href=\"https://juejin.im/post/5c49b822f265da6142743a87\">Wpeach</a><br> 原文作者：Matthew Rayfield<br> 原文地址：<a href=\"http://matthewrayfield.com/articles/animating-urls-with-javascript-and-emojis/\">Animating URLs with Javascript and Emojis</a></p>\n</blockquote>\n<p> 你可以在地址栏使用 emoji（和其它图形 unicode 字符），这看着很棒，但是好像没人这么做，为什么呢？也许 emoji 对于正常的网络平台来说太过异国情调了？或许是他们因为害怕不利于SEO？<br>不管什么原因，维恩图中的合理性观点“没人这么做，但这是可能的”是让我兴奋的点。所以我决定花费一些时间研究在地址栏中图形字符的可能性，特别是通过 JavaScript 给这些字符加上动画。<br>循环动画<br>首先，确保你页面的 JavaScript 代码是 UTF-8 编码，否则无法在你的代码中显示 emoji，这可以通过设置 HTTP 头部或页面的 META 标签来实现。你很可能不用担心这个，但你可以在这里找到更多信息：Unicode in Javascript by Flavio。<br>为了达到我们想要的效果，让 emoji 像小仙女一样在地址栏里偏偏起舞，我们需要一个循环，实际上，我们所需要的只是一个循环，我们启动这个循环，它不断循环，我们的目的就达到了。这是我们的第一个循环动画，一个旋转的emoji 月亮。我猜当他们添加这个 emoji 序列时，也有这个想法吧？</p>\n<pre><code>var f = [&#39;🌑&#39;, &#39;🌒&#39;, &#39;🌓&#39;, &#39;🌔&#39;, &#39;🌝&#39;, &#39;🌖&#39;, &#39;🌗&#39;, &#39;🌘&#39;];\n\nfunction loop() &#123;\n    location.hash = f[Math.floor((Date.now()/100)%f.length)];\n\n    setTimeout(loop, 50);\n&#125;\n\nloop();\n</code></pre>\n<p>复制代码运行代码，你可以在地址栏看到此循环的结果。<br>如果你不喜欢旋转的月亮，你可以选择任何你喜欢的 emoji 来替换这个数组，比如一个时钟：</p>\n<p>var f &#x3D; [‘🕐’,’🕑’,’🕒’,’🕓’,’🕔’,’🕕’,’🕖’,’🕗’,’🕘’,’🕙’,’🕚’,’🕛’];<br>复制代码这是一个非常简单的例子，真的非常简单，所以我们来升级一下循环，让它显示一串 emoji ! 这次我们使用 emoji 的skin tone modifiers肤色调节属性来制作一些变色宝宝：</p>\n<pre><code>var e = [&#39;🏻&#39;, &#39;🏼&#39;, &#39;🏽&#39;, &#39;🏾&#39;, &#39;🏿&#39;];\n\nfunction loop() &#123;\n    var s = &#39;&#39;,\n        i, m;\n\n    for (i = 0; i &lt; 10; i ++) &#123;\n        m = Math.floor(e.length * ((Math.sin((Date.now()/100) + i)+1)/2));\n        s += &#39;👶&#39; + e[m];\n    &#125;\n\n    location.hash = s;\n\n    setTimeout(loop, 50);\n&#125;\n\nloop(); \n</code></pre>\n<p>复制代码我们可以使用时间和位置控制的正弦波来选择我们想要的颜色，这给了我们一个很好的颜色变幻效果！<br>比如我们再来一次月亮旋转，使它展开，制作一个类似于加载条的动画？好的，开始实现：</p>\n<pre><code>var f = [&#39;🌑&#39;, &#39;🌘&#39;, &#39;🌗&#39;, &#39;🌖&#39;, &#39;🌕&#39;, &#39;🌔&#39;, &#39;🌓&#39;, &#39;🌒&#39;],\n    d = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    m = 0;\n\nfunction loop() &#123;\n    var s = &#39;&#39;, x = 0;\n\n    if (!m) &#123;\n        while (d[x] == 4) &#123;\n            x ++;\n        &#125;\n\n        if (x &gt;= d.length) m = 1;\n        else &#123;\n            d[x] ++;\n        &#125;\n    &#125;\n    else &#123;\n        while (d[x] == 0) &#123;\n            x ++;\n        &#125;\n\n        if (x &gt;= d.length) m = 0;\n        else &#123;\n            d[x] ++;\n\n            if (d[x] == 8) d[x] = 0;\n        &#125;\n    &#125;\n\n    d.forEach(function (n) &#123;\n        s += f[n];\n    &#125;);\n\n    location.hash = s;\n\n    setTimeout(loop, 50);\n&#125;\n\nloop();\n</code></pre>\n<p>复制代码探索其它字符<br>不止是 emoji 给我们提供了一种在地址栏显示图形的方法，我们的目标中也有一些 unicode 字符。<br>特别有趣的是 框线字符:</p>\n<p>它们中很多更适合二维输出，但它们在一维输出也很棒，例如，我们可以创建一个多个高度变化的块字符串，并构造一个漂亮的小波浪动画：</p>\n<pre><code>function loop() &#123;\n    var i, n, s = &#39;&#39;;\n\n    for (i = 0; i &lt; 10; i++) &#123;\n        n = Math.floor(Math.sin((Date.now()/200) + (i/2)) * 4) + 4;\n\n        s += String.fromCharCode(0x2581 + n);\n    &#125;\n\n    window.location.hash = s;\n\n    setTimeout(loop, 50);\n&#125;\n\nloop();\n</code></pre>\n<p>复制代码我非常喜欢它的效果，我把它永久放在了 wavyurl.com 上。<br>使用可变宽度字符，我们甚至在水平方向上摆动，创建类似于进度条的东西：</p>\n<pre><code>function loop() &#123;\n    var s = &#39;&#39;,\n        p;\n\n    p = Math.floor(((Math.sin(Date.now()/300)+1)/2) * 100);\n\n    while (p &gt;= 8) &#123;\n        s += &#39;█&#39;;\n        p -= 8;\n    &#125;\n    s += [&#39;⠀&#39;,&#39;▏&#39;,&#39;▎&#39;,&#39;▍&#39;,&#39;▌&#39;,&#39;▋&#39;,&#39;▊&#39;,&#39;▉&#39;][p];\n\n    location.hash = s;\n    setTimeout(loop, 50);\n&#125;\n</code></pre>\n<p>复制代码进度条？这看起来，还是有用的，这让我想到了……<br>在地址栏显示视频进度<br>为了增加我们小实验的可能性，我提出了在地址栏中显示网络视频进度的想法。我只需附加一个函数，将我们的进度字符串定义在视频的timeupdate事件中，瞧！地址栏中的视频进度条包含时间和持续时间！</p>\n<pre><code>var video;\n\nfunction formatTime(seconds) &#123;\n    var minutes = Math.floor(seconds/60),\n        seconds = Math.floor(seconds - (minutes*60));\n\n    return (&#39;0&#39;+minutes).substr(-2) + &#39;:&#39; + (&#39;0&#39;+seconds).substr(-2);\n&#125;\n\nfunction renderProgressBar() &#123;\n    var s = &#39;&#39;,\n        l = 15,\n        p = Math.floor(video.currentTime / video.duration * (l-1)),\n        i;\n\n    for (i = 0; i &lt; l; i ++) &#123;\n        if (i == p) s +=&#39;◯&#39;;\n        else if (i &lt; p) s += &#39;─&#39;;\n        else s += &#39;┄&#39;;\n    &#125;\n\n    location.hash = &#39;╭&#39;+s+&#39;╮&#39;+formatTime(video.currentTime)+&#39;╱&#39;+formatTime(video.duration);\n&#125;\n\nvideo = document.getElementById(&#39;video&#39;);\nvideo.addEventListener(&#39;timeupdate&#39;, renderProgressBar);\n</code></pre>\n<p>复制代码我比较喜欢这个线条和圆组成的进度条，如果你喜欢别的 emoji 比如月亮，我也能让你满意：</p>\n<pre><code>var e = [&#39;🌑&#39;, &#39;🌘&#39;, &#39;🌗&#39;, &#39;🌖&#39;, &#39;🌕&#39;],\n    video;\n\nfunction formatTime(seconds) &#123;\n    var minutes = Math.floor(seconds/60),\n        seconds = Math.floor(seconds - (minutes*60));\n\n    return (&#39;0&#39;+minutes).substr(-2) + &#39;:&#39; + (&#39;0&#39;+seconds).substr(-2);\n&#125;\n\nfunction renderProgressBar() &#123;\n    var s = &#39;&#39;,\n        c = 0,\n        l = 10,\n        p = Math.floor(video.currentTime / video.duration * ((l*5)-1)),\n        i;\n\n    while (p &gt;= 5) &#123;\n        s += e[4];\n        c ++;\n        p -= 5;\n    &#125;\n    s += e[p];\n    c ++;\n\n    while (c &lt; l) &#123;\n        s += e[0];\n        c ++;\n    &#125;\n\n    location.hash = s+formatTime(video.currentTime)+&#39;╱&#39;+formatTime(video.duration);\n&#125;\n\nvideo = document.getElementById(&#39;video&#39;);\nvideo.addEventListener(&#39;timeupdate&#39;, renderProgressBar);\n</code></pre>\n<p>复制代码好的，将此进度条称为“有用”的延伸。 只瞄一眼，我也可以看到在视频分享 URL 中的进度。 与YouTube一样，你可以选择在特定时间创建指向视频的链接，添加视觉指示是不是很酷？嗯？<br>也许我还没有提出一些更有用的“技术”实现，我会继续思考这个问题。 嘿，也许你可以尝试一些东西？<br>最后<br>你可能想知道为什么我使用location.hash &#x3D;，而不是新且酷的HTML5 History API。 有两个原因：<br>第一个问题是 History API有一个特点：它实际上更改了整个 URL 路径，而不仅仅是 hash。 因此，如果我使用 History API 并将页面更改为&#x2F;🌑🌘🌗🌖🌕，它看起来会比添加 ＃ 更好。 但这也意味着我的 Web 服务器必须能够响应&#x2F;🌑🌘🌗🌖🌕，否则如果用户刷新或以其他方式导航到修改后的 URL 将会失败。 这是可行的，但比使用location.hash &#x3D;更复杂，需要我修改服务器配置。<br>第二个问题有些出乎意料。 实际上，在我测试的3个浏览器中，有2个历史API被限制的。 如果我以极快的速度将我的波形网址推送到地址栏，我最终会在 Chrome 中收到以下错误：</p>\n<p>Throttling history state changes to prevent the browser from hanging.</p>\n<p>Safari 给我们提供了更详细的信息：</p>\n<p>SecurityError: Attempt to use history.pushState() more than 100 times per 30.000000 seconds</p>\n<p>现在，如果让我保持在这个限制下也行，但是每秒3帧只是不会影响我目前的动画效果。<br>好孩子 Firefox 似乎并不在乎我推送新历史的次数和速度，这真是想得太周到了。但是，两个主要的浏览器受到影响，加上需要web服务器配置来修复第一个问题，使我更愿意忍受 URL 中的 #。</p>\n","excerpt":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>同样是9年义务教育，你为何这么优秀 </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>","more":"<blockquote>\n<p>译者：<a href=\"https://juejin.im/post/5c49b822f265da6142743a87\">Wpeach</a><br> 原文作者：Matthew Rayfield<br> 原文地址：<a href=\"http://matthewrayfield.com/articles/animating-urls-with-javascript-and-emojis/\">Animating URLs with Javascript and Emojis</a></p>\n</blockquote>\n<p> 你可以在地址栏使用 emoji（和其它图形 unicode 字符），这看着很棒，但是好像没人这么做，为什么呢？也许 emoji 对于正常的网络平台来说太过异国情调了？或许是他们因为害怕不利于SEO？<br>不管什么原因，维恩图中的合理性观点“没人这么做，但这是可能的”是让我兴奋的点。所以我决定花费一些时间研究在地址栏中图形字符的可能性，特别是通过 JavaScript 给这些字符加上动画。<br>循环动画<br>首先，确保你页面的 JavaScript 代码是 UTF-8 编码，否则无法在你的代码中显示 emoji，这可以通过设置 HTTP 头部或页面的 META 标签来实现。你很可能不用担心这个，但你可以在这里找到更多信息：Unicode in Javascript by Flavio。<br>为了达到我们想要的效果，让 emoji 像小仙女一样在地址栏里偏偏起舞，我们需要一个循环，实际上，我们所需要的只是一个循环，我们启动这个循环，它不断循环，我们的目的就达到了。这是我们的第一个循环动画，一个旋转的emoji 月亮。我猜当他们添加这个 emoji 序列时，也有这个想法吧？</p>\n<pre><code>var f = [&#39;🌑&#39;, &#39;🌒&#39;, &#39;🌓&#39;, &#39;🌔&#39;, &#39;🌝&#39;, &#39;🌖&#39;, &#39;🌗&#39;, &#39;🌘&#39;];\n\nfunction loop() &#123;\n    location.hash = f[Math.floor((Date.now()/100)%f.length)];\n\n    setTimeout(loop, 50);\n&#125;\n\nloop();\n</code></pre>\n<p>复制代码运行代码，你可以在地址栏看到此循环的结果。<br>如果你不喜欢旋转的月亮，你可以选择任何你喜欢的 emoji 来替换这个数组，比如一个时钟：</p>\n<p>var f &#x3D; [‘🕐’,’🕑’,’🕒’,’🕓’,’🕔’,’🕕’,’🕖’,’🕗’,’🕘’,’🕙’,’🕚’,’🕛’];<br>复制代码这是一个非常简单的例子，真的非常简单，所以我们来升级一下循环，让它显示一串 emoji ! 这次我们使用 emoji 的skin tone modifiers肤色调节属性来制作一些变色宝宝：</p>\n<pre><code>var e = [&#39;🏻&#39;, &#39;🏼&#39;, &#39;🏽&#39;, &#39;🏾&#39;, &#39;🏿&#39;];\n\nfunction loop() &#123;\n    var s = &#39;&#39;,\n        i, m;\n\n    for (i = 0; i &lt; 10; i ++) &#123;\n        m = Math.floor(e.length * ((Math.sin((Date.now()/100) + i)+1)/2));\n        s += &#39;👶&#39; + e[m];\n    &#125;\n\n    location.hash = s;\n\n    setTimeout(loop, 50);\n&#125;\n\nloop(); \n</code></pre>\n<p>复制代码我们可以使用时间和位置控制的正弦波来选择我们想要的颜色，这给了我们一个很好的颜色变幻效果！<br>比如我们再来一次月亮旋转，使它展开，制作一个类似于加载条的动画？好的，开始实现：</p>\n<pre><code>var f = [&#39;🌑&#39;, &#39;🌘&#39;, &#39;🌗&#39;, &#39;🌖&#39;, &#39;🌕&#39;, &#39;🌔&#39;, &#39;🌓&#39;, &#39;🌒&#39;],\n    d = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    m = 0;\n\nfunction loop() &#123;\n    var s = &#39;&#39;, x = 0;\n\n    if (!m) &#123;\n        while (d[x] == 4) &#123;\n            x ++;\n        &#125;\n\n        if (x &gt;= d.length) m = 1;\n        else &#123;\n            d[x] ++;\n        &#125;\n    &#125;\n    else &#123;\n        while (d[x] == 0) &#123;\n            x ++;\n        &#125;\n\n        if (x &gt;= d.length) m = 0;\n        else &#123;\n            d[x] ++;\n\n            if (d[x] == 8) d[x] = 0;\n        &#125;\n    &#125;\n\n    d.forEach(function (n) &#123;\n        s += f[n];\n    &#125;);\n\n    location.hash = s;\n\n    setTimeout(loop, 50);\n&#125;\n\nloop();\n</code></pre>\n<p>复制代码探索其它字符<br>不止是 emoji 给我们提供了一种在地址栏显示图形的方法，我们的目标中也有一些 unicode 字符。<br>特别有趣的是 框线字符:</p>\n<p>它们中很多更适合二维输出，但它们在一维输出也很棒，例如，我们可以创建一个多个高度变化的块字符串，并构造一个漂亮的小波浪动画：</p>\n<pre><code>function loop() &#123;\n    var i, n, s = &#39;&#39;;\n\n    for (i = 0; i &lt; 10; i++) &#123;\n        n = Math.floor(Math.sin((Date.now()/200) + (i/2)) * 4) + 4;\n\n        s += String.fromCharCode(0x2581 + n);\n    &#125;\n\n    window.location.hash = s;\n\n    setTimeout(loop, 50);\n&#125;\n\nloop();\n</code></pre>\n<p>复制代码我非常喜欢它的效果，我把它永久放在了 wavyurl.com 上。<br>使用可变宽度字符，我们甚至在水平方向上摆动，创建类似于进度条的东西：</p>\n<pre><code>function loop() &#123;\n    var s = &#39;&#39;,\n        p;\n\n    p = Math.floor(((Math.sin(Date.now()/300)+1)/2) * 100);\n\n    while (p &gt;= 8) &#123;\n        s += &#39;█&#39;;\n        p -= 8;\n    &#125;\n    s += [&#39;⠀&#39;,&#39;▏&#39;,&#39;▎&#39;,&#39;▍&#39;,&#39;▌&#39;,&#39;▋&#39;,&#39;▊&#39;,&#39;▉&#39;][p];\n\n    location.hash = s;\n    setTimeout(loop, 50);\n&#125;\n</code></pre>\n<p>复制代码进度条？这看起来，还是有用的，这让我想到了……<br>在地址栏显示视频进度<br>为了增加我们小实验的可能性，我提出了在地址栏中显示网络视频进度的想法。我只需附加一个函数，将我们的进度字符串定义在视频的timeupdate事件中，瞧！地址栏中的视频进度条包含时间和持续时间！</p>\n<pre><code>var video;\n\nfunction formatTime(seconds) &#123;\n    var minutes = Math.floor(seconds/60),\n        seconds = Math.floor(seconds - (minutes*60));\n\n    return (&#39;0&#39;+minutes).substr(-2) + &#39;:&#39; + (&#39;0&#39;+seconds).substr(-2);\n&#125;\n\nfunction renderProgressBar() &#123;\n    var s = &#39;&#39;,\n        l = 15,\n        p = Math.floor(video.currentTime / video.duration * (l-1)),\n        i;\n\n    for (i = 0; i &lt; l; i ++) &#123;\n        if (i == p) s +=&#39;◯&#39;;\n        else if (i &lt; p) s += &#39;─&#39;;\n        else s += &#39;┄&#39;;\n    &#125;\n\n    location.hash = &#39;╭&#39;+s+&#39;╮&#39;+formatTime(video.currentTime)+&#39;╱&#39;+formatTime(video.duration);\n&#125;\n\nvideo = document.getElementById(&#39;video&#39;);\nvideo.addEventListener(&#39;timeupdate&#39;, renderProgressBar);\n</code></pre>\n<p>复制代码我比较喜欢这个线条和圆组成的进度条，如果你喜欢别的 emoji 比如月亮，我也能让你满意：</p>\n<pre><code>var e = [&#39;🌑&#39;, &#39;🌘&#39;, &#39;🌗&#39;, &#39;🌖&#39;, &#39;🌕&#39;],\n    video;\n\nfunction formatTime(seconds) &#123;\n    var minutes = Math.floor(seconds/60),\n        seconds = Math.floor(seconds - (minutes*60));\n\n    return (&#39;0&#39;+minutes).substr(-2) + &#39;:&#39; + (&#39;0&#39;+seconds).substr(-2);\n&#125;\n\nfunction renderProgressBar() &#123;\n    var s = &#39;&#39;,\n        c = 0,\n        l = 10,\n        p = Math.floor(video.currentTime / video.duration * ((l*5)-1)),\n        i;\n\n    while (p &gt;= 5) &#123;\n        s += e[4];\n        c ++;\n        p -= 5;\n    &#125;\n    s += e[p];\n    c ++;\n\n    while (c &lt; l) &#123;\n        s += e[0];\n        c ++;\n    &#125;\n\n    location.hash = s+formatTime(video.currentTime)+&#39;╱&#39;+formatTime(video.duration);\n&#125;\n\nvideo = document.getElementById(&#39;video&#39;);\nvideo.addEventListener(&#39;timeupdate&#39;, renderProgressBar);\n</code></pre>\n<p>复制代码好的，将此进度条称为“有用”的延伸。 只瞄一眼，我也可以看到在视频分享 URL 中的进度。 与YouTube一样，你可以选择在特定时间创建指向视频的链接，添加视觉指示是不是很酷？嗯？<br>也许我还没有提出一些更有用的“技术”实现，我会继续思考这个问题。 嘿，也许你可以尝试一些东西？<br>最后<br>你可能想知道为什么我使用location.hash &#x3D;，而不是新且酷的HTML5 History API。 有两个原因：<br>第一个问题是 History API有一个特点：它实际上更改了整个 URL 路径，而不仅仅是 hash。 因此，如果我使用 History API 并将页面更改为&#x2F;🌑🌘🌗🌖🌕，它看起来会比添加 ＃ 更好。 但这也意味着我的 Web 服务器必须能够响应&#x2F;🌑🌘🌗🌖🌕，否则如果用户刷新或以其他方式导航到修改后的 URL 将会失败。 这是可行的，但比使用location.hash &#x3D;更复杂，需要我修改服务器配置。<br>第二个问题有些出乎意料。 实际上，在我测试的3个浏览器中，有2个历史API被限制的。 如果我以极快的速度将我的波形网址推送到地址栏，我最终会在 Chrome 中收到以下错误：</p>\n<p>Throttling history state changes to prevent the browser from hanging.</p>\n<p>Safari 给我们提供了更详细的信息：</p>\n<p>SecurityError: Attempt to use history.pushState() more than 100 times per 30.000000 seconds</p>\n<p>现在，如果让我保持在这个限制下也行，但是每秒3帧只是不会影响我目前的动画效果。<br>好孩子 Firefox 似乎并不在乎我推送新历史的次数和速度，这真是想得太周到了。但是，两个主要的浏览器受到影响，加上需要web服务器配置来修复第一个问题，使我更愿意忍受 URL 中的 #。</p>"},{"title":"Promise的使用","date":"2019-05-31T05:23:51.000Z","copyright":null,"keywords":null,"description":null,"_content":"{% cq %} 温故而知新，可以为师矣 {% endcq %}\n<!--more-->\n# ES6 Promise 用法讲解\n\nPromise是一个构造函数，自己身上有all、reject、resolve这几个眼熟的方法，原型上有then、catch等同样很眼熟的方法。\n## resolve参数（可以理解合格的内容）\n    ```javascript\n        <script>\n            var p = new Promise(function(resolve,reject){\n                setTimeout(() => {\n                    console.log('执行完成');\n                    resolve(\"合格的内容\")\n                },2000)\n            })\n        </script>\n        先打印出了Promise {<pending>}\n                    __proto__: Promise\n                    [[PromiseStatus]]: \"resolved\"\n                    [[PromiseValue]]: \"合格的内容\"\n        再过2秒，打印出了'执行完成'\n    ```\n## 使用.then就可以获取resovle中的内容啦\n    ```javascript\n        <script>\n             var p = new Promise(function(resolve,reject){\n                setTimeout(() => {\n                    console.log('执行完成');\n                    resolve(\"合格的内容\")\n                },2000)\n            })\n            p.then( (val) => {\n                console.log(val)\n            })\n        </script>\n        2秒钟后就相继输出了 \"执行完成\" \"合格的内容\"\n    ```\n## resolve参数（可以理解不合格的内容）可以使用.catch获取它的内容\n    ```javascript\n        function getNumber(){\n            var p = new Promise(function(resolve, reject){\n                //做一些异步操作\n                setTimeout(function(){\n                    var num = Math.ceil(Math.random()*10); //生成1-10的随机数\n                    if(num<=5){\n                        resolve(num);\n                    }\n                    else{\n                        reject('数字太大了');\n                    }\n                }, 2000);\n            });\n            return p;            \n        }\n        getNumber().then( val => {\n            console.log(val)\n        }).catch( val => {\n            console.log(val)\n        })\n        如何满足if条件，就输出相应数字，否则输出 reject中的'数字太大了'\n    ```\n## all的用法\n> 方法都调用完成再输出resolve中的内容\n    ```javascript\n        function runAsync1(){\n        var p = new Promise(function(resolve, reject){\n            //做一些异步操作\n            setTimeout(function(){\n                console.log('异步任务1执行完成');\n                resolve('随便什么数据1');\n            }, 1000);\n        });\n        return p;            \n        }\n        function runAsync2(){\n            var p = new Promise(function(resolve, reject){\n                //做一些异步操作\n                setTimeout(function(){\n                    console.log('异步任务2执行完成');\n                    resolve('随便什么数据2');\n                }, 2000);\n            });\n            return p;            \n        }\n        function runAsync3(){\n            var p = new Promise(function(resolve, reject){\n                //做一些异步操作\n                setTimeout(function(){\n                    console.log('异步任务3执行完成');\n                    resolve('随便什么数据3');\n                }, 300);\n            });\n            return p;            \n        }\n        Promise\n        .all([runAsync1(),runAsync2(),runAsync3()])  //时间短的先执行\n        .then(function(results){\n            console.log(results);  //返回值按照数据中方法顺序输出\n        });\n        // 异步任务3执行完成 异步任务1执行完成 异步任务2执行完成\n        // [\"随便什么数据1\", \"随便什么数据2\", \"随便什么数据3\"]\n    ```\n## race的用法\n> 异步执行最快的函数以后，直接输出内容，再按照执行速度依次执行\n    ```javascript\n        function runAsync1(){\n            var p = new Promise(function(resolve, reject){\n                //做一些异步操作\n                setTimeout(function(){\n                    console.log('异步任务1执行完成');\n                    resolve('随便什么数据1');\n                }, 3000);\n            });\n            return p;            \n            }\n        function runAsync2(){\n            var p = new Promise(function(resolve, reject){\n                //做一些异步操作\n                setTimeout(function(){\n                    console.log('异步任务2执行完成');\n                    resolve('随便什么数据2');\n                }, 3000);\n            });\n            return p;            \n        }\n        function runAsync3(){\n            var p = new Promise(function(resolve, reject){\n                //做一些异步操作\n                setTimeout(function(){\n                    console.log('异步任务3执行完成');\n                    resolve('随便什么数据3');\n                }, 1000);\n            });\n            return p;            \n        }\n        Promise\n        .race([runAsync1(), runAsync2(), runAsync3()])\n        .then(function(results){\n            console.log(results);\n        });\n        //异步任务3执行完成 随便什么数据3 异步任务1执行完成 异步任务2执行完成\n    ```\n\n","source":"_posts/Promise的使用.md","raw":"---\ntitle: Promise的使用\ndate: 2019-05-31 13:23:51\ncategories: web\ntags:\n    - Promise的使用\ncopyright:\nkeywords:\ndescription:\n---\n{% cq %} 温故而知新，可以为师矣 {% endcq %}\n<!--more-->\n# ES6 Promise 用法讲解\n\nPromise是一个构造函数，自己身上有all、reject、resolve这几个眼熟的方法，原型上有then、catch等同样很眼熟的方法。\n## resolve参数（可以理解合格的内容）\n    ```javascript\n        <script>\n            var p = new Promise(function(resolve,reject){\n                setTimeout(() => {\n                    console.log('执行完成');\n                    resolve(\"合格的内容\")\n                },2000)\n            })\n        </script>\n        先打印出了Promise {<pending>}\n                    __proto__: Promise\n                    [[PromiseStatus]]: \"resolved\"\n                    [[PromiseValue]]: \"合格的内容\"\n        再过2秒，打印出了'执行完成'\n    ```\n## 使用.then就可以获取resovle中的内容啦\n    ```javascript\n        <script>\n             var p = new Promise(function(resolve,reject){\n                setTimeout(() => {\n                    console.log('执行完成');\n                    resolve(\"合格的内容\")\n                },2000)\n            })\n            p.then( (val) => {\n                console.log(val)\n            })\n        </script>\n        2秒钟后就相继输出了 \"执行完成\" \"合格的内容\"\n    ```\n## resolve参数（可以理解不合格的内容）可以使用.catch获取它的内容\n    ```javascript\n        function getNumber(){\n            var p = new Promise(function(resolve, reject){\n                //做一些异步操作\n                setTimeout(function(){\n                    var num = Math.ceil(Math.random()*10); //生成1-10的随机数\n                    if(num<=5){\n                        resolve(num);\n                    }\n                    else{\n                        reject('数字太大了');\n                    }\n                }, 2000);\n            });\n            return p;            \n        }\n        getNumber().then( val => {\n            console.log(val)\n        }).catch( val => {\n            console.log(val)\n        })\n        如何满足if条件，就输出相应数字，否则输出 reject中的'数字太大了'\n    ```\n## all的用法\n> 方法都调用完成再输出resolve中的内容\n    ```javascript\n        function runAsync1(){\n        var p = new Promise(function(resolve, reject){\n            //做一些异步操作\n            setTimeout(function(){\n                console.log('异步任务1执行完成');\n                resolve('随便什么数据1');\n            }, 1000);\n        });\n        return p;            \n        }\n        function runAsync2(){\n            var p = new Promise(function(resolve, reject){\n                //做一些异步操作\n                setTimeout(function(){\n                    console.log('异步任务2执行完成');\n                    resolve('随便什么数据2');\n                }, 2000);\n            });\n            return p;            \n        }\n        function runAsync3(){\n            var p = new Promise(function(resolve, reject){\n                //做一些异步操作\n                setTimeout(function(){\n                    console.log('异步任务3执行完成');\n                    resolve('随便什么数据3');\n                }, 300);\n            });\n            return p;            \n        }\n        Promise\n        .all([runAsync1(),runAsync2(),runAsync3()])  //时间短的先执行\n        .then(function(results){\n            console.log(results);  //返回值按照数据中方法顺序输出\n        });\n        // 异步任务3执行完成 异步任务1执行完成 异步任务2执行完成\n        // [\"随便什么数据1\", \"随便什么数据2\", \"随便什么数据3\"]\n    ```\n## race的用法\n> 异步执行最快的函数以后，直接输出内容，再按照执行速度依次执行\n    ```javascript\n        function runAsync1(){\n            var p = new Promise(function(resolve, reject){\n                //做一些异步操作\n                setTimeout(function(){\n                    console.log('异步任务1执行完成');\n                    resolve('随便什么数据1');\n                }, 3000);\n            });\n            return p;            \n            }\n        function runAsync2(){\n            var p = new Promise(function(resolve, reject){\n                //做一些异步操作\n                setTimeout(function(){\n                    console.log('异步任务2执行完成');\n                    resolve('随便什么数据2');\n                }, 3000);\n            });\n            return p;            \n        }\n        function runAsync3(){\n            var p = new Promise(function(resolve, reject){\n                //做一些异步操作\n                setTimeout(function(){\n                    console.log('异步任务3执行完成');\n                    resolve('随便什么数据3');\n                }, 1000);\n            });\n            return p;            \n        }\n        Promise\n        .race([runAsync1(), runAsync2(), runAsync3()])\n        .then(function(results){\n            console.log(results);\n        });\n        //异步任务3执行完成 随便什么数据3 异步任务1执行完成 异步任务2执行完成\n    ```\n\n","slug":"Promise的使用","published":1,"updated":"2026-01-02T00:43:17.571Z","comments":1,"layout":"post","photos":[],"_id":"cmjwbsw610006rotgdbve5jpn","content":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>温故而知新，可以为师矣 </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n<span id=\"more\"></span>\n<h1 id=\"ES6-Promise-用法讲解\"><a href=\"#ES6-Promise-用法讲解\" class=\"headerlink\" title=\"ES6 Promise 用法讲解\"></a>ES6 Promise 用法讲解</h1><p>Promise是一个构造函数，自己身上有all、reject、resolve这几个眼熟的方法，原型上有then、catch等同样很眼熟的方法。</p>\n<h2 id=\"resolve参数（可以理解合格的内容）\"><a href=\"#resolve参数（可以理解合格的内容）\" class=\"headerlink\" title=\"resolve参数（可以理解合格的内容）\"></a>resolve参数（可以理解合格的内容）</h2><pre><code><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"keyword\">function</span>(<span class=\"params\">resolve,reject</span>)&#123;</span><br><span class=\"line\">        <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;执行完成&#x27;</span>);</span><br><span class=\"line\">            <span class=\"title function_\">resolve</span>(<span class=\"string\">&quot;合格的内容&quot;</span>)</span><br><span class=\"line\">        &#125;,<span class=\"number\">2000</span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&lt;/script&gt;</span><br><span class=\"line\">先打印出了<span class=\"title class_\">Promise</span> &#123;&lt;pending&gt;&#125;</span><br><span class=\"line\">            <span class=\"attr\">__proto__</span>: <span class=\"title class_\">Promise</span></span><br><span class=\"line\">            [[<span class=\"title class_\">PromiseStatus</span>]]: <span class=\"string\">&quot;resolved&quot;</span></span><br><span class=\"line\">            [[<span class=\"title class_\">PromiseValue</span>]]: <span class=\"string\">&quot;合格的内容&quot;</span></span><br><span class=\"line\">再过<span class=\"number\">2</span>秒，打印出了<span class=\"string\">&#x27;执行完成&#x27;</span></span><br></pre></td></tr></table></figure>\n</code></pre>\n<h2 id=\"使用-then就可以获取resovle中的内容啦\"><a href=\"#使用-then就可以获取resovle中的内容啦\" class=\"headerlink\" title=\"使用.then就可以获取resovle中的内容啦\"></a>使用.then就可以获取resovle中的内容啦</h2><pre><code><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">     <span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"keyword\">function</span>(<span class=\"params\">resolve,reject</span>)&#123;</span><br><span class=\"line\">        <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;执行完成&#x27;</span>);</span><br><span class=\"line\">            <span class=\"title function_\">resolve</span>(<span class=\"string\">&quot;合格的内容&quot;</span>)</span><br><span class=\"line\">        &#125;,<span class=\"number\">2000</span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    p.<span class=\"title function_\">then</span>( <span class=\"function\">(<span class=\"params\">val</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(val)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&lt;/script&gt;</span><br><span class=\"line\"><span class=\"number\">2</span>秒钟后就相继输出了 <span class=\"string\">&quot;执行完成&quot;</span> <span class=\"string\">&quot;合格的内容&quot;</span></span><br></pre></td></tr></table></figure>\n</code></pre>\n<h2 id=\"resolve参数（可以理解不合格的内容）可以使用-catch获取它的内容\"><a href=\"#resolve参数（可以理解不合格的内容）可以使用-catch获取它的内容\" class=\"headerlink\" title=\"resolve参数（可以理解不合格的内容）可以使用.catch获取它的内容\"></a>resolve参数（可以理解不合格的内容）可以使用.catch获取它的内容</h2><pre><code><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">getNumber</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>)&#123;</span><br><span class=\"line\">        <span class=\"comment\">//做一些异步操作</span></span><br><span class=\"line\">        <span class=\"built_in\">setTimeout</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> num = <span class=\"title class_\">Math</span>.<span class=\"title function_\">ceil</span>(<span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>()*<span class=\"number\">10</span>); <span class=\"comment\">//生成1-10的随机数</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(num&lt;=<span class=\"number\">5</span>)&#123;</span><br><span class=\"line\">                <span class=\"title function_\">resolve</span>(num);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                <span class=\"title function_\">reject</span>(<span class=\"string\">&#x27;数字太大了&#x27;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;, <span class=\"number\">2000</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> p;            </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"title function_\">getNumber</span>().<span class=\"title function_\">then</span>( <span class=\"function\"><span class=\"params\">val</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(val)</span><br><span class=\"line\">&#125;).<span class=\"title function_\">catch</span>( <span class=\"function\"><span class=\"params\">val</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(val)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">如何满足<span class=\"keyword\">if</span>条件，就输出相应数字，否则输出 reject中的<span class=\"string\">&#x27;数字太大了&#x27;</span></span><br></pre></td></tr></table></figure>\n</code></pre>\n<h2 id=\"all的用法\"><a href=\"#all的用法\" class=\"headerlink\" title=\"all的用法\"></a>all的用法</h2><blockquote>\n<p>方法都调用完成再输出resolve中的内容<br>    <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">runAsync1</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\"><span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>)&#123;</span><br><span class=\"line\">    <span class=\"comment\">//做一些异步操作</span></span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;异步任务1执行完成&#x27;</span>);</span><br><span class=\"line\">        <span class=\"title function_\">resolve</span>(<span class=\"string\">&#x27;随便什么数据1&#x27;</span>);</span><br><span class=\"line\">    &#125;, <span class=\"number\">1000</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"keyword\">return</span> p;            </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">runAsync2</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>)&#123;</span><br><span class=\"line\">        <span class=\"comment\">//做一些异步操作</span></span><br><span class=\"line\">        <span class=\"built_in\">setTimeout</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;异步任务2执行完成&#x27;</span>);</span><br><span class=\"line\">            <span class=\"title function_\">resolve</span>(<span class=\"string\">&#x27;随便什么数据2&#x27;</span>);</span><br><span class=\"line\">        &#125;, <span class=\"number\">2000</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> p;            </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">runAsync3</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>)&#123;</span><br><span class=\"line\">        <span class=\"comment\">//做一些异步操作</span></span><br><span class=\"line\">        <span class=\"built_in\">setTimeout</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;异步任务3执行完成&#x27;</span>);</span><br><span class=\"line\">            <span class=\"title function_\">resolve</span>(<span class=\"string\">&#x27;随便什么数据3&#x27;</span>);</span><br><span class=\"line\">        &#125;, <span class=\"number\">300</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> p;            </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"title class_\">Promise</span></span><br><span class=\"line\">.<span class=\"title function_\">all</span>([<span class=\"title function_\">runAsync1</span>(),<span class=\"title function_\">runAsync2</span>(),<span class=\"title function_\">runAsync3</span>()])  <span class=\"comment\">//时间短的先执行</span></span><br><span class=\"line\">.<span class=\"title function_\">then</span>(<span class=\"keyword\">function</span>(<span class=\"params\">results</span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(results);  <span class=\"comment\">//返回值按照数据中方法顺序输出</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"comment\">// 异步任务3执行完成 异步任务1执行完成 异步任务2执行完成</span></span><br><span class=\"line\"><span class=\"comment\">// [&quot;随便什么数据1&quot;, &quot;随便什么数据2&quot;, &quot;随便什么数据3&quot;]</span></span><br></pre></td></tr></table></figure></p>\n</blockquote>\n<h2 id=\"race的用法\"><a href=\"#race的用法\" class=\"headerlink\" title=\"race的用法\"></a>race的用法</h2><blockquote>\n<p>异步执行最快的函数以后，直接输出内容，再按照执行速度依次执行<br>    <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">runAsync1</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>)&#123;</span><br><span class=\"line\">        <span class=\"comment\">//做一些异步操作</span></span><br><span class=\"line\">        <span class=\"built_in\">setTimeout</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;异步任务1执行完成&#x27;</span>);</span><br><span class=\"line\">            <span class=\"title function_\">resolve</span>(<span class=\"string\">&#x27;随便什么数据1&#x27;</span>);</span><br><span class=\"line\">        &#125;, <span class=\"number\">3000</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> p;            </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">runAsync2</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>)&#123;</span><br><span class=\"line\">        <span class=\"comment\">//做一些异步操作</span></span><br><span class=\"line\">        <span class=\"built_in\">setTimeout</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;异步任务2执行完成&#x27;</span>);</span><br><span class=\"line\">            <span class=\"title function_\">resolve</span>(<span class=\"string\">&#x27;随便什么数据2&#x27;</span>);</span><br><span class=\"line\">        &#125;, <span class=\"number\">3000</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> p;            </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">runAsync3</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>)&#123;</span><br><span class=\"line\">        <span class=\"comment\">//做一些异步操作</span></span><br><span class=\"line\">        <span class=\"built_in\">setTimeout</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;异步任务3执行完成&#x27;</span>);</span><br><span class=\"line\">            <span class=\"title function_\">resolve</span>(<span class=\"string\">&#x27;随便什么数据3&#x27;</span>);</span><br><span class=\"line\">        &#125;, <span class=\"number\">1000</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> p;            </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"title class_\">Promise</span></span><br><span class=\"line\">.<span class=\"title function_\">race</span>([<span class=\"title function_\">runAsync1</span>(), <span class=\"title function_\">runAsync2</span>(), <span class=\"title function_\">runAsync3</span>()])</span><br><span class=\"line\">.<span class=\"title function_\">then</span>(<span class=\"keyword\">function</span>(<span class=\"params\">results</span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(results);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"comment\">//异步任务3执行完成 随便什么数据3 异步任务1执行完成 异步任务2执行完成</span></span><br></pre></td></tr></table></figure></p>\n</blockquote>\n","excerpt":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>温故而知新，可以为师矣 </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>","more":"<h1 id=\"ES6-Promise-用法讲解\"><a href=\"#ES6-Promise-用法讲解\" class=\"headerlink\" title=\"ES6 Promise 用法讲解\"></a>ES6 Promise 用法讲解</h1><p>Promise是一个构造函数，自己身上有all、reject、resolve这几个眼熟的方法，原型上有then、catch等同样很眼熟的方法。</p>\n<h2 id=\"resolve参数（可以理解合格的内容）\"><a href=\"#resolve参数（可以理解合格的内容）\" class=\"headerlink\" title=\"resolve参数（可以理解合格的内容）\"></a>resolve参数（可以理解合格的内容）</h2><pre><code><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"keyword\">function</span>(<span class=\"params\">resolve,reject</span>)&#123;</span><br><span class=\"line\">        <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;执行完成&#x27;</span>);</span><br><span class=\"line\">            <span class=\"title function_\">resolve</span>(<span class=\"string\">&quot;合格的内容&quot;</span>)</span><br><span class=\"line\">        &#125;,<span class=\"number\">2000</span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&lt;/script&gt;</span><br><span class=\"line\">先打印出了<span class=\"title class_\">Promise</span> &#123;&lt;pending&gt;&#125;</span><br><span class=\"line\">            <span class=\"attr\">__proto__</span>: <span class=\"title class_\">Promise</span></span><br><span class=\"line\">            [[<span class=\"title class_\">PromiseStatus</span>]]: <span class=\"string\">&quot;resolved&quot;</span></span><br><span class=\"line\">            [[<span class=\"title class_\">PromiseValue</span>]]: <span class=\"string\">&quot;合格的内容&quot;</span></span><br><span class=\"line\">再过<span class=\"number\">2</span>秒，打印出了<span class=\"string\">&#x27;执行完成&#x27;</span></span><br></pre></td></tr></table></figure>\n</code></pre>\n<h2 id=\"使用-then就可以获取resovle中的内容啦\"><a href=\"#使用-then就可以获取resovle中的内容啦\" class=\"headerlink\" title=\"使用.then就可以获取resovle中的内容啦\"></a>使用.then就可以获取resovle中的内容啦</h2><pre><code><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">     <span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"keyword\">function</span>(<span class=\"params\">resolve,reject</span>)&#123;</span><br><span class=\"line\">        <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;执行完成&#x27;</span>);</span><br><span class=\"line\">            <span class=\"title function_\">resolve</span>(<span class=\"string\">&quot;合格的内容&quot;</span>)</span><br><span class=\"line\">        &#125;,<span class=\"number\">2000</span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    p.<span class=\"title function_\">then</span>( <span class=\"function\">(<span class=\"params\">val</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(val)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&lt;/script&gt;</span><br><span class=\"line\"><span class=\"number\">2</span>秒钟后就相继输出了 <span class=\"string\">&quot;执行完成&quot;</span> <span class=\"string\">&quot;合格的内容&quot;</span></span><br></pre></td></tr></table></figure>\n</code></pre>\n<h2 id=\"resolve参数（可以理解不合格的内容）可以使用-catch获取它的内容\"><a href=\"#resolve参数（可以理解不合格的内容）可以使用-catch获取它的内容\" class=\"headerlink\" title=\"resolve参数（可以理解不合格的内容）可以使用.catch获取它的内容\"></a>resolve参数（可以理解不合格的内容）可以使用.catch获取它的内容</h2><pre><code><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">getNumber</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>)&#123;</span><br><span class=\"line\">        <span class=\"comment\">//做一些异步操作</span></span><br><span class=\"line\">        <span class=\"built_in\">setTimeout</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> num = <span class=\"title class_\">Math</span>.<span class=\"title function_\">ceil</span>(<span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>()*<span class=\"number\">10</span>); <span class=\"comment\">//生成1-10的随机数</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(num&lt;=<span class=\"number\">5</span>)&#123;</span><br><span class=\"line\">                <span class=\"title function_\">resolve</span>(num);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                <span class=\"title function_\">reject</span>(<span class=\"string\">&#x27;数字太大了&#x27;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;, <span class=\"number\">2000</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> p;            </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"title function_\">getNumber</span>().<span class=\"title function_\">then</span>( <span class=\"function\"><span class=\"params\">val</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(val)</span><br><span class=\"line\">&#125;).<span class=\"title function_\">catch</span>( <span class=\"function\"><span class=\"params\">val</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(val)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">如何满足<span class=\"keyword\">if</span>条件，就输出相应数字，否则输出 reject中的<span class=\"string\">&#x27;数字太大了&#x27;</span></span><br></pre></td></tr></table></figure>\n</code></pre>\n<h2 id=\"all的用法\"><a href=\"#all的用法\" class=\"headerlink\" title=\"all的用法\"></a>all的用法</h2><blockquote>\n<p>方法都调用完成再输出resolve中的内容<br>    <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">runAsync1</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\"><span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>)&#123;</span><br><span class=\"line\">    <span class=\"comment\">//做一些异步操作</span></span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;异步任务1执行完成&#x27;</span>);</span><br><span class=\"line\">        <span class=\"title function_\">resolve</span>(<span class=\"string\">&#x27;随便什么数据1&#x27;</span>);</span><br><span class=\"line\">    &#125;, <span class=\"number\">1000</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"keyword\">return</span> p;            </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">runAsync2</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>)&#123;</span><br><span class=\"line\">        <span class=\"comment\">//做一些异步操作</span></span><br><span class=\"line\">        <span class=\"built_in\">setTimeout</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;异步任务2执行完成&#x27;</span>);</span><br><span class=\"line\">            <span class=\"title function_\">resolve</span>(<span class=\"string\">&#x27;随便什么数据2&#x27;</span>);</span><br><span class=\"line\">        &#125;, <span class=\"number\">2000</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> p;            </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">runAsync3</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>)&#123;</span><br><span class=\"line\">        <span class=\"comment\">//做一些异步操作</span></span><br><span class=\"line\">        <span class=\"built_in\">setTimeout</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;异步任务3执行完成&#x27;</span>);</span><br><span class=\"line\">            <span class=\"title function_\">resolve</span>(<span class=\"string\">&#x27;随便什么数据3&#x27;</span>);</span><br><span class=\"line\">        &#125;, <span class=\"number\">300</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> p;            </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"title class_\">Promise</span></span><br><span class=\"line\">.<span class=\"title function_\">all</span>([<span class=\"title function_\">runAsync1</span>(),<span class=\"title function_\">runAsync2</span>(),<span class=\"title function_\">runAsync3</span>()])  <span class=\"comment\">//时间短的先执行</span></span><br><span class=\"line\">.<span class=\"title function_\">then</span>(<span class=\"keyword\">function</span>(<span class=\"params\">results</span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(results);  <span class=\"comment\">//返回值按照数据中方法顺序输出</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"comment\">// 异步任务3执行完成 异步任务1执行完成 异步任务2执行完成</span></span><br><span class=\"line\"><span class=\"comment\">// [&quot;随便什么数据1&quot;, &quot;随便什么数据2&quot;, &quot;随便什么数据3&quot;]</span></span><br></pre></td></tr></table></figure></p>\n</blockquote>\n<h2 id=\"race的用法\"><a href=\"#race的用法\" class=\"headerlink\" title=\"race的用法\"></a>race的用法</h2><blockquote>\n<p>异步执行最快的函数以后，直接输出内容，再按照执行速度依次执行<br>    <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">runAsync1</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>)&#123;</span><br><span class=\"line\">        <span class=\"comment\">//做一些异步操作</span></span><br><span class=\"line\">        <span class=\"built_in\">setTimeout</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;异步任务1执行完成&#x27;</span>);</span><br><span class=\"line\">            <span class=\"title function_\">resolve</span>(<span class=\"string\">&#x27;随便什么数据1&#x27;</span>);</span><br><span class=\"line\">        &#125;, <span class=\"number\">3000</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> p;            </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">runAsync2</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>)&#123;</span><br><span class=\"line\">        <span class=\"comment\">//做一些异步操作</span></span><br><span class=\"line\">        <span class=\"built_in\">setTimeout</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;异步任务2执行完成&#x27;</span>);</span><br><span class=\"line\">            <span class=\"title function_\">resolve</span>(<span class=\"string\">&#x27;随便什么数据2&#x27;</span>);</span><br><span class=\"line\">        &#125;, <span class=\"number\">3000</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> p;            </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">runAsync3</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>)&#123;</span><br><span class=\"line\">        <span class=\"comment\">//做一些异步操作</span></span><br><span class=\"line\">        <span class=\"built_in\">setTimeout</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;异步任务3执行完成&#x27;</span>);</span><br><span class=\"line\">            <span class=\"title function_\">resolve</span>(<span class=\"string\">&#x27;随便什么数据3&#x27;</span>);</span><br><span class=\"line\">        &#125;, <span class=\"number\">1000</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> p;            </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"title class_\">Promise</span></span><br><span class=\"line\">.<span class=\"title function_\">race</span>([<span class=\"title function_\">runAsync1</span>(), <span class=\"title function_\">runAsync2</span>(), <span class=\"title function_\">runAsync3</span>()])</span><br><span class=\"line\">.<span class=\"title function_\">then</span>(<span class=\"keyword\">function</span>(<span class=\"params\">results</span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(results);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"comment\">//异步任务3执行完成 随便什么数据3 异步任务1执行完成 异步任务2执行完成</span></span><br></pre></td></tr></table></figure></p>\n</blockquote>"},{"title":"Vue-router核心原理","date":"2021-08-17T10:32:29.000Z","copyright":null,"keywords":null,"description":null,"_content":"{% cq %} 知其然知其所以然 {% endcq %}\n<!--more-->\n可以使用以下代码替代vue-router进行学习\n```javascript\n    //myVueRouter.js\nlet Vue = null;\nclass HistoryRoute {\n    constructor(){\n        this.current = null\n    }\n}\nclass VueRouter{\n    constructor(options) {\n        this.mode = options.mode || \"hash\"\n        this.routes = options.routes || [] //你传递的这个路由是一个数组表\n        this.routesMap = this.createMap(this.routes)\n        this.history = new HistoryRoute();\n        this.init()\n\n    }\n    init(){\n        if (this.mode === \"hash\"){\n            // 先判断用户打开时有没有hash值，没有的话跳转到#/\n            location.hash? '':location.hash = \"/\";\n            window.addEventListener(\"load\",()=>{\n                this.history.current = location.hash.slice(1)\n            })\n            window.addEventListener(\"hashchange\",()=>{\n                this.history.current = location.hash.slice(1)\n            })\n        } else{\n            location.pathname? '':location.pathname = \"/\";\n            window.addEventListener('load',()=>{\n                this.history.current = location.pathname\n            })\n            window.addEventListener(\"popstate\",()=>{\n                this.history.current = location.pathname\n            })\n        }\n    }\n\n    createMap(routes){\n        return routes.reduce((pre,current)=>{\n            pre[current.path] = current.component\n            return pre;\n        },{})\n    }\n\n}\nVueRouter.install = function (v) {\n    Vue = v;\n    Vue.mixin({\n        beforeCreate(){\n            if (this.$options && this.$options.router){ // 如果是根组件\n                this._root = this; //把当前实例挂载到_root上\n                this._router = this.$options.router;\n                Vue.util.defineReactive(this,\"xxx\",this._router.history)\n            }else { //如果是子组件\n                this._root= this.$parent && this.$parent._root\n            }\n            Object.defineProperty(this,'$router',{\n                get(){\n                    return this._root._router\n                }\n            });\n            Object.defineProperty(this,'$route',{\n                get(){\n                    return this._root._router.history.current\n                }\n            })\n        }\n    })\n    Vue.component('router-link',{\n        props:{\n            to:String\n        },\n        render(h){\n            let mode = this._self._root._router.mode;\n            let to = mode === \"hash\"?\"#\"+this.to:this.to\n            return h('a',{attrs:{href:to}},this.$slots.default)\n        }\n    })\n    Vue.component('router-view',{\n        render(h){\n            let current = this._self._root._router.history.current\n            let routeMap = this._self._root._router.routesMap;\n            return h(routeMap[current])\n        }\n    })\n};\n\nexport default VueRouter\n\n```","source":"_posts/Vue-router核心原理.md","raw":"---\ntitle: Vue-router核心原理\ndate: 2021-08-17 18:32:29\ncategories: web\ntags:\n    - Vue-router核心原理\ncopyright:\nkeywords:\ndescription:\n---\n{% cq %} 知其然知其所以然 {% endcq %}\n<!--more-->\n可以使用以下代码替代vue-router进行学习\n```javascript\n    //myVueRouter.js\nlet Vue = null;\nclass HistoryRoute {\n    constructor(){\n        this.current = null\n    }\n}\nclass VueRouter{\n    constructor(options) {\n        this.mode = options.mode || \"hash\"\n        this.routes = options.routes || [] //你传递的这个路由是一个数组表\n        this.routesMap = this.createMap(this.routes)\n        this.history = new HistoryRoute();\n        this.init()\n\n    }\n    init(){\n        if (this.mode === \"hash\"){\n            // 先判断用户打开时有没有hash值，没有的话跳转到#/\n            location.hash? '':location.hash = \"/\";\n            window.addEventListener(\"load\",()=>{\n                this.history.current = location.hash.slice(1)\n            })\n            window.addEventListener(\"hashchange\",()=>{\n                this.history.current = location.hash.slice(1)\n            })\n        } else{\n            location.pathname? '':location.pathname = \"/\";\n            window.addEventListener('load',()=>{\n                this.history.current = location.pathname\n            })\n            window.addEventListener(\"popstate\",()=>{\n                this.history.current = location.pathname\n            })\n        }\n    }\n\n    createMap(routes){\n        return routes.reduce((pre,current)=>{\n            pre[current.path] = current.component\n            return pre;\n        },{})\n    }\n\n}\nVueRouter.install = function (v) {\n    Vue = v;\n    Vue.mixin({\n        beforeCreate(){\n            if (this.$options && this.$options.router){ // 如果是根组件\n                this._root = this; //把当前实例挂载到_root上\n                this._router = this.$options.router;\n                Vue.util.defineReactive(this,\"xxx\",this._router.history)\n            }else { //如果是子组件\n                this._root= this.$parent && this.$parent._root\n            }\n            Object.defineProperty(this,'$router',{\n                get(){\n                    return this._root._router\n                }\n            });\n            Object.defineProperty(this,'$route',{\n                get(){\n                    return this._root._router.history.current\n                }\n            })\n        }\n    })\n    Vue.component('router-link',{\n        props:{\n            to:String\n        },\n        render(h){\n            let mode = this._self._root._router.mode;\n            let to = mode === \"hash\"?\"#\"+this.to:this.to\n            return h('a',{attrs:{href:to}},this.$slots.default)\n        }\n    })\n    Vue.component('router-view',{\n        render(h){\n            let current = this._self._root._router.history.current\n            let routeMap = this._self._root._router.routesMap;\n            return h(routeMap[current])\n        }\n    })\n};\n\nexport default VueRouter\n\n```","slug":"Vue-router核心原理","published":1,"updated":"2026-01-02T00:43:17.571Z","comments":1,"layout":"post","photos":[],"_id":"cmjwbsw620007rotg3v63gzbw","content":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>知其然知其所以然 </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n<span id=\"more\"></span>\n<p>可以使用以下代码替代vue-router进行学习</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    <span class=\"comment\">//myVueRouter.js</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"title class_\">Vue</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">HistoryRoute</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">constructor</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">current</span> = <span class=\"literal\">null</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">VueRouter</span>&#123;</span><br><span class=\"line\">    <span class=\"title function_\">constructor</span>(<span class=\"params\">options</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">mode</span> = options.<span class=\"property\">mode</span> || <span class=\"string\">&quot;hash&quot;</span></span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">routes</span> = options.<span class=\"property\">routes</span> || [] <span class=\"comment\">//你传递的这个路由是一个数组表</span></span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">routesMap</span> = <span class=\"variable language_\">this</span>.<span class=\"title function_\">createMap</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">routes</span>)</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">history</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">HistoryRoute</span>();</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"title function_\">init</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title function_\">init</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">mode</span> === <span class=\"string\">&quot;hash&quot;</span>)&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 先判断用户打开时有没有hash值，没有的话跳转到#/</span></span><br><span class=\"line\">            location.<span class=\"property\">hash</span>? <span class=\"string\">&#x27;&#x27;</span>:location.<span class=\"property\">hash</span> = <span class=\"string\">&quot;/&quot;</span>;</span><br><span class=\"line\">            <span class=\"variable language_\">window</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;load&quot;</span>,<span class=\"function\">()=&gt;</span>&#123;</span><br><span class=\"line\">                <span class=\"variable language_\">this</span>.<span class=\"property\">history</span>.<span class=\"property\">current</span> = location.<span class=\"property\">hash</span>.<span class=\"title function_\">slice</span>(<span class=\"number\">1</span>)</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">            <span class=\"variable language_\">window</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;hashchange&quot;</span>,<span class=\"function\">()=&gt;</span>&#123;</span><br><span class=\"line\">                <span class=\"variable language_\">this</span>.<span class=\"property\">history</span>.<span class=\"property\">current</span> = location.<span class=\"property\">hash</span>.<span class=\"title function_\">slice</span>(<span class=\"number\">1</span>)</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            location.<span class=\"property\">pathname</span>? <span class=\"string\">&#x27;&#x27;</span>:location.<span class=\"property\">pathname</span> = <span class=\"string\">&quot;/&quot;</span>;</span><br><span class=\"line\">            <span class=\"variable language_\">window</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;load&#x27;</span>,<span class=\"function\">()=&gt;</span>&#123;</span><br><span class=\"line\">                <span class=\"variable language_\">this</span>.<span class=\"property\">history</span>.<span class=\"property\">current</span> = location.<span class=\"property\">pathname</span></span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">            <span class=\"variable language_\">window</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;popstate&quot;</span>,<span class=\"function\">()=&gt;</span>&#123;</span><br><span class=\"line\">                <span class=\"variable language_\">this</span>.<span class=\"property\">history</span>.<span class=\"property\">current</span> = location.<span class=\"property\">pathname</span></span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">createMap</span>(<span class=\"params\">routes</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> routes.<span class=\"title function_\">reduce</span>(<span class=\"function\">(<span class=\"params\">pre,current</span>)=&gt;</span>&#123;</span><br><span class=\"line\">            pre[current.<span class=\"property\">path</span>] = current.<span class=\"property\">component</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> pre;</span><br><span class=\"line\">        &#125;,&#123;&#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"title class_\">VueRouter</span>.<span class=\"property\">install</span> = <span class=\"keyword\">function</span> (<span class=\"params\">v</span>) &#123;</span><br><span class=\"line\">    <span class=\"title class_\">Vue</span> = v;</span><br><span class=\"line\">    <span class=\"title class_\">Vue</span>.<span class=\"title function_\">mixin</span>(&#123;</span><br><span class=\"line\">        <span class=\"title function_\">beforeCreate</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">$options</span> &amp;&amp; <span class=\"variable language_\">this</span>.<span class=\"property\">$options</span>.<span class=\"property\">router</span>)&#123; <span class=\"comment\">// 如果是根组件</span></span><br><span class=\"line\">                <span class=\"variable language_\">this</span>.<span class=\"property\">_root</span> = <span class=\"variable language_\">this</span>; <span class=\"comment\">//把当前实例挂载到_root上</span></span><br><span class=\"line\">                <span class=\"variable language_\">this</span>.<span class=\"property\">_router</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">$options</span>.<span class=\"property\">router</span>;</span><br><span class=\"line\">                <span class=\"title class_\">Vue</span>.<span class=\"property\">util</span>.<span class=\"title function_\">defineReactive</span>(<span class=\"variable language_\">this</span>,<span class=\"string\">&quot;xxx&quot;</span>,<span class=\"variable language_\">this</span>.<span class=\"property\">_router</span>.<span class=\"property\">history</span>)</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span> &#123; <span class=\"comment\">//如果是子组件</span></span><br><span class=\"line\">                <span class=\"variable language_\">this</span>.<span class=\"property\">_root</span>= <span class=\"variable language_\">this</span>.<span class=\"property\">$parent</span> &amp;&amp; <span class=\"variable language_\">this</span>.<span class=\"property\">$parent</span>.<span class=\"property\">_root</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"title class_\">Object</span>.<span class=\"title function_\">defineProperty</span>(<span class=\"variable language_\">this</span>,<span class=\"string\">&#x27;$router&#x27;</span>,&#123;</span><br><span class=\"line\">                <span class=\"title function_\">get</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">_root</span>.<span class=\"property\">_router</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            <span class=\"title class_\">Object</span>.<span class=\"title function_\">defineProperty</span>(<span class=\"variable language_\">this</span>,<span class=\"string\">&#x27;$route&#x27;</span>,&#123;</span><br><span class=\"line\">                <span class=\"title function_\">get</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">_root</span>.<span class=\"property\">_router</span>.<span class=\"property\">history</span>.<span class=\"property\">current</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"title class_\">Vue</span>.<span class=\"title function_\">component</span>(<span class=\"string\">&#x27;router-link&#x27;</span>,&#123;</span><br><span class=\"line\">        <span class=\"attr\">props</span>:&#123;</span><br><span class=\"line\">            <span class=\"attr\">to</span>:<span class=\"title class_\">String</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"title function_\">render</span>(<span class=\"params\">h</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> mode = <span class=\"variable language_\">this</span>.<span class=\"property\">_self</span>.<span class=\"property\">_root</span>.<span class=\"property\">_router</span>.<span class=\"property\">mode</span>;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> to = mode === <span class=\"string\">&quot;hash&quot;</span>?<span class=\"string\">&quot;#&quot;</span>+<span class=\"variable language_\">this</span>.<span class=\"property\">to</span>:<span class=\"variable language_\">this</span>.<span class=\"property\">to</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"title function_\">h</span>(<span class=\"string\">&#x27;a&#x27;</span>,&#123;<span class=\"attr\">attrs</span>:&#123;<span class=\"attr\">href</span>:to&#125;&#125;,<span class=\"variable language_\">this</span>.<span class=\"property\">$slots</span>.<span class=\"property\">default</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"title class_\">Vue</span>.<span class=\"title function_\">component</span>(<span class=\"string\">&#x27;router-view&#x27;</span>,&#123;</span><br><span class=\"line\">        <span class=\"title function_\">render</span>(<span class=\"params\">h</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> current = <span class=\"variable language_\">this</span>.<span class=\"property\">_self</span>.<span class=\"property\">_root</span>.<span class=\"property\">_router</span>.<span class=\"property\">history</span>.<span class=\"property\">current</span></span><br><span class=\"line\">            <span class=\"keyword\">let</span> routeMap = <span class=\"variable language_\">this</span>.<span class=\"property\">_self</span>.<span class=\"property\">_root</span>.<span class=\"property\">_router</span>.<span class=\"property\">routesMap</span>;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"title function_\">h</span>(routeMap[current])</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">VueRouter</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>","excerpt":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>知其然知其所以然 </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>","more":"<p>可以使用以下代码替代vue-router进行学习</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    <span class=\"comment\">//myVueRouter.js</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"title class_\">Vue</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">HistoryRoute</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">constructor</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">current</span> = <span class=\"literal\">null</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">VueRouter</span>&#123;</span><br><span class=\"line\">    <span class=\"title function_\">constructor</span>(<span class=\"params\">options</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">mode</span> = options.<span class=\"property\">mode</span> || <span class=\"string\">&quot;hash&quot;</span></span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">routes</span> = options.<span class=\"property\">routes</span> || [] <span class=\"comment\">//你传递的这个路由是一个数组表</span></span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">routesMap</span> = <span class=\"variable language_\">this</span>.<span class=\"title function_\">createMap</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">routes</span>)</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">history</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">HistoryRoute</span>();</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"title function_\">init</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title function_\">init</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">mode</span> === <span class=\"string\">&quot;hash&quot;</span>)&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 先判断用户打开时有没有hash值，没有的话跳转到#/</span></span><br><span class=\"line\">            location.<span class=\"property\">hash</span>? <span class=\"string\">&#x27;&#x27;</span>:location.<span class=\"property\">hash</span> = <span class=\"string\">&quot;/&quot;</span>;</span><br><span class=\"line\">            <span class=\"variable language_\">window</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;load&quot;</span>,<span class=\"function\">()=&gt;</span>&#123;</span><br><span class=\"line\">                <span class=\"variable language_\">this</span>.<span class=\"property\">history</span>.<span class=\"property\">current</span> = location.<span class=\"property\">hash</span>.<span class=\"title function_\">slice</span>(<span class=\"number\">1</span>)</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">            <span class=\"variable language_\">window</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;hashchange&quot;</span>,<span class=\"function\">()=&gt;</span>&#123;</span><br><span class=\"line\">                <span class=\"variable language_\">this</span>.<span class=\"property\">history</span>.<span class=\"property\">current</span> = location.<span class=\"property\">hash</span>.<span class=\"title function_\">slice</span>(<span class=\"number\">1</span>)</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            location.<span class=\"property\">pathname</span>? <span class=\"string\">&#x27;&#x27;</span>:location.<span class=\"property\">pathname</span> = <span class=\"string\">&quot;/&quot;</span>;</span><br><span class=\"line\">            <span class=\"variable language_\">window</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;load&#x27;</span>,<span class=\"function\">()=&gt;</span>&#123;</span><br><span class=\"line\">                <span class=\"variable language_\">this</span>.<span class=\"property\">history</span>.<span class=\"property\">current</span> = location.<span class=\"property\">pathname</span></span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">            <span class=\"variable language_\">window</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;popstate&quot;</span>,<span class=\"function\">()=&gt;</span>&#123;</span><br><span class=\"line\">                <span class=\"variable language_\">this</span>.<span class=\"property\">history</span>.<span class=\"property\">current</span> = location.<span class=\"property\">pathname</span></span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">createMap</span>(<span class=\"params\">routes</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> routes.<span class=\"title function_\">reduce</span>(<span class=\"function\">(<span class=\"params\">pre,current</span>)=&gt;</span>&#123;</span><br><span class=\"line\">            pre[current.<span class=\"property\">path</span>] = current.<span class=\"property\">component</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> pre;</span><br><span class=\"line\">        &#125;,&#123;&#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"title class_\">VueRouter</span>.<span class=\"property\">install</span> = <span class=\"keyword\">function</span> (<span class=\"params\">v</span>) &#123;</span><br><span class=\"line\">    <span class=\"title class_\">Vue</span> = v;</span><br><span class=\"line\">    <span class=\"title class_\">Vue</span>.<span class=\"title function_\">mixin</span>(&#123;</span><br><span class=\"line\">        <span class=\"title function_\">beforeCreate</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">$options</span> &amp;&amp; <span class=\"variable language_\">this</span>.<span class=\"property\">$options</span>.<span class=\"property\">router</span>)&#123; <span class=\"comment\">// 如果是根组件</span></span><br><span class=\"line\">                <span class=\"variable language_\">this</span>.<span class=\"property\">_root</span> = <span class=\"variable language_\">this</span>; <span class=\"comment\">//把当前实例挂载到_root上</span></span><br><span class=\"line\">                <span class=\"variable language_\">this</span>.<span class=\"property\">_router</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">$options</span>.<span class=\"property\">router</span>;</span><br><span class=\"line\">                <span class=\"title class_\">Vue</span>.<span class=\"property\">util</span>.<span class=\"title function_\">defineReactive</span>(<span class=\"variable language_\">this</span>,<span class=\"string\">&quot;xxx&quot;</span>,<span class=\"variable language_\">this</span>.<span class=\"property\">_router</span>.<span class=\"property\">history</span>)</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span> &#123; <span class=\"comment\">//如果是子组件</span></span><br><span class=\"line\">                <span class=\"variable language_\">this</span>.<span class=\"property\">_root</span>= <span class=\"variable language_\">this</span>.<span class=\"property\">$parent</span> &amp;&amp; <span class=\"variable language_\">this</span>.<span class=\"property\">$parent</span>.<span class=\"property\">_root</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"title class_\">Object</span>.<span class=\"title function_\">defineProperty</span>(<span class=\"variable language_\">this</span>,<span class=\"string\">&#x27;$router&#x27;</span>,&#123;</span><br><span class=\"line\">                <span class=\"title function_\">get</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">_root</span>.<span class=\"property\">_router</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            <span class=\"title class_\">Object</span>.<span class=\"title function_\">defineProperty</span>(<span class=\"variable language_\">this</span>,<span class=\"string\">&#x27;$route&#x27;</span>,&#123;</span><br><span class=\"line\">                <span class=\"title function_\">get</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">_root</span>.<span class=\"property\">_router</span>.<span class=\"property\">history</span>.<span class=\"property\">current</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"title class_\">Vue</span>.<span class=\"title function_\">component</span>(<span class=\"string\">&#x27;router-link&#x27;</span>,&#123;</span><br><span class=\"line\">        <span class=\"attr\">props</span>:&#123;</span><br><span class=\"line\">            <span class=\"attr\">to</span>:<span class=\"title class_\">String</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"title function_\">render</span>(<span class=\"params\">h</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> mode = <span class=\"variable language_\">this</span>.<span class=\"property\">_self</span>.<span class=\"property\">_root</span>.<span class=\"property\">_router</span>.<span class=\"property\">mode</span>;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> to = mode === <span class=\"string\">&quot;hash&quot;</span>?<span class=\"string\">&quot;#&quot;</span>+<span class=\"variable language_\">this</span>.<span class=\"property\">to</span>:<span class=\"variable language_\">this</span>.<span class=\"property\">to</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"title function_\">h</span>(<span class=\"string\">&#x27;a&#x27;</span>,&#123;<span class=\"attr\">attrs</span>:&#123;<span class=\"attr\">href</span>:to&#125;&#125;,<span class=\"variable language_\">this</span>.<span class=\"property\">$slots</span>.<span class=\"property\">default</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"title class_\">Vue</span>.<span class=\"title function_\">component</span>(<span class=\"string\">&#x27;router-view&#x27;</span>,&#123;</span><br><span class=\"line\">        <span class=\"title function_\">render</span>(<span class=\"params\">h</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> current = <span class=\"variable language_\">this</span>.<span class=\"property\">_self</span>.<span class=\"property\">_root</span>.<span class=\"property\">_router</span>.<span class=\"property\">history</span>.<span class=\"property\">current</span></span><br><span class=\"line\">            <span class=\"keyword\">let</span> routeMap = <span class=\"variable language_\">this</span>.<span class=\"property\">_self</span>.<span class=\"property\">_root</span>.<span class=\"property\">_router</span>.<span class=\"property\">routesMap</span>;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"title function_\">h</span>(routeMap[current])</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">VueRouter</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>"},{"title":"VUE中的inheritAttrs,attrs,listeners","date":"2020-05-26T03:15:22.000Z","copyright":null,"keywords":null,"description":null,"_content":"{% cq %} Vue中的inheritAttrs，$attrs，$listeners使用总结 {% endcq %}\n<!--more-->\n# 使用场景\n> 当你想向嵌套层级比较深组件数据传递，只能由父组件传递给子组件，子组件再传递给孙子组件,当传递十几个当情况，我们会在每个组件不停的props，每个必须写很多遍，除了vuex的父子组件通信，也可以通过inheritAttrs选项，以及实例属性$attrs\n\n```javascript\n      <template>\n          <div class=\"home\">\n            <mytest  :title=\"title\" :massgae=\"massgae\"></mytest>\n          </div>\n        </template>\n          export default {\n            name: 'home',\n            data () {\n              return {\n                title:'title1111',\n                massgae:'message111'\n              }\n            },\n            components:{\n              'mytest':{\n                template:`<div>这是个h1标题{{title}}</div>`,\n                props:['title'],\n                data(){\n                  return{\n                    mag:'111'\n                  }\n                },\n                created:function(){\n                  console.log(this.$attrs)//注意这里\n                }\n              }\n            }\n          }\n```\n\n  > 上边的代码，我们在组件里只是用了title这个属性，massgae属性我么是没有用的，那么下浏览器渲染出来是什么样呢？如下图：\n  <img src=\"/img/7579449-9b4f591d793547b6.webp\">\n  > 我们看到：组件内未被注册的属性将作为普通html元素属性被渲染，如果想让属性能够向下传递，即使prop组件没有被使用，你也需要在组件上注册。这样做会使组件预期功能变得模糊不清，同时也难以维护组件的DRY。在Vue2.4.0,可以在组件定义中添加inheritAttrs：false，组件将不会把未被注册的props呈现为普通的HTML属性。但是在组件里我们可以通过其$attrs可以获取到没有使用的注册属性，如果需要，我们在这也可以往下继续传递。\n  如果我们在子组件里设置 inheritAttrs: false：\n\n  ```javascript\n    components:{\n    'mytest':{\n      template:`<div>这是个h1标题{{title}}</div>`,\n      props:['title'],\n      inheritAttrs: false,\n      data(){\n        return{\n          mag:'111'\n        }\n      },\n      created:function(){\n        console.log(this.$attrs)//注意这里\n      }\n    }\n  ```\n  <img src=\"/img/7579449-a8a0b3970380eeeb.webp\">\n\n  # $attrs的使用\n  有一个页面由父组件，子组件，孙子组件构成，如下：\n  ```javascript\n    <template>\n    <div style=\"padding:50px;\">\n        <childcom :name=\"name\" :age=\"age\" :sex=\"sex\"></childcom>\n    </div>\n</template>\n<script>\nexport default {\n    'name':'test',\n    props:[],\n    data(){\n        return {\n            'name':'张三',\n            'age':'30',\n            'sex':'男'\n        }\n    },\n    components:{\n        'childcom':{\n            template:`<div>\n                <div>{{name}}</div>\n                <grandcom v-bind=\"$attrs\"></grandcom>\n            </div>`,\n            props:['name'],\n            components: {\n                'grandcom':{\n                    template:`<div>{{$attrs}}</div>`,\n                }\n            }\n        }\n    }\n}\n</script>\n  ```\n上面的代码在页面的效果是如下图\n<img src=\"/img/7579449-b2ab8dfe80fe828d.webp\">\n如果attrs被绑定在子组件childcom上后，我们就可以在孙子组件grandcom里获取到this.$attrs的值。这个{{$attrs}}的值是父组件中传递下来的props（除了子组件childcom组件中props声明的）。\n\n记住孙子组件grandcom里获取到this.$attrs的值是除了子组件childcom声明的元素！记住是除了子组件childcom声明的元素！例如上面的代码我在子组件childcom组件的props里声明了name，那么我在孙子组件grandcom里获取到的$attrs就不包含name属性，那么this.$attrs = { 'age':'30', 'sex':'男'}。\n# 说一下$attrs的优势到底在哪\n假如我们要做一个页面，有父组件，子组件，孙子组件，如下：\n```javascript\n<template>\n    <div>\n        <childcom></childcom>\n    </div>\n</template>\n<script>\nexport default {\n    'name':'test',\n    props:[],\n    data(){\n        return {\n            'name':'张三',\n            'age':'30',\n            'sex':'男'\n        }\n    },\n    components:{\n        'childcom':{\n            template:`<div>\n                <div>我是子组件</div>\n                <grandcom></grandcom>\n            </div>`,\n            components: {\n                'grandcom':{\n                    template:`<div>我是孙子组件</div>`,\n                }\n            }\n        }\n    }\n}\n</script>\n```\n如上代码，假如我想在子组件想获取到父组件的name属性值，在孙子组件获取父组件的age属性值，用props的话就必须在父组件把name和age的值通过props传递到子组件，子组件在通过props把age的值传递到孙子组件，到这里看明白了吧，孙子组件需要的age在子组件里没有用到，但是为了能让孙子组件获取到，你必须从父组件 传到子组件，在在子组件传递到孙子组件。\n\n但是用$attrs就不用那么麻烦，如下：\n```javascript\n<template>\n    <div>\n        <childcom :name=\"name\" :age=\"age\" :sex=\"sex\"></childcom>\n    </div>\n</template>\n<script>\nexport default {\n    'name':'test',\n    props:[],\n    data(){\n        return {\n            'name':'张三',\n            'age':'30',\n            'sex':'男'\n        }\n    },\n    components:{\n        'childcom':{\n            props:['name'],\n            template:`<div>\n                <div>我是子组件   {{name}}</div>\n                <grandcom v-bind=\"$attrs\"></grandcom>\n            </div>`,\n            components: {\n                'grandcom':{\n                    template:`<div>我是孙子组件{{$attrs.age}}</div>`,\n                }\n            }\n        }\n    }\n}\n</script>\n```\n子组件绑定了\"$attrs\"，孙子组件就能获取到除了name属性外所有由父组件传递下来的属性。如果孙子组件也想获取到name属性那么，在绑定个name如下，\n```javascript\n <grandcom v-bind=\"$attrs\" :name=\"name\"></grandcom>\n```\n细细体会下是不是这个道理\n\n# 补充一下：inheritAttrs属性\n关于inheritAttrs这个属性跟获取到$attrs的值没有关系，inheritAttrs通常在编写基础组件时候会用到。官网原话：默认情况下父作用域的不被认作 props 的特性绑定 (attribute bindings) 将会“回退”且作为普通的 HTML 特性应用在子组件的根元素上。当撰写包裹一个目标元素或另一个组件的组件时，这可能不会总是符合预期行为。通过设置 inheritAttrs 到 false，这些默认行为将会被去掉。而通过 (同样是 2.4 新增的) 实例属性 $attrs 可以让这些特性生效，且可以通过 v-bind 显性的绑定到非根元素上。\n\n注意：这个选项不影响 class 和 style 绑定。\n\n在Vue2.4.0之前版本，组件内未被注册的属性将作为普通html元素属性被渲染。\n\ninheritAttrs到底有啥用？到底用在哪里？看下边代码，\n\n```javascript\n<template>\n    <childcom :name=\"name\" :age=\"age\" type=\"text\"></childcom>\n</template>\n<script>\nexport default {\n    'name':'test',\n    props:[],\n    data(){\n        return {\n            'name':'张三',\n            'age':'30',\n            'sex':'男'\n        }\n    },\n    components:{\n        'childcom':{\n            props:['name','age'],\n            template:`<input type=\"number\" style=\"border:1px solid blue\">`,\n        }\n    }\n}\n</script>\n```\n上面代码你觉得input上会怎么显示？ 父组件传递了type=\"text\"，子组件里input 上type=\"number\"，那渲染到页面会是什么样？渲染图如下：\n<img src=\"/img/inheritAttrs2.webp\">\n看到没，父组件传递的type=\"text\"覆盖了input 上type=\"number\"，这岂不是把我的input数据类型都给改变了，这岂不是有问题，这不是我想要的！！！！看到这里明白了吗？回头去体会下上面官网的原话！！！\n\n需求：我需要input 上type=\"number\"类型不变，但是我还是要取到父组件的type=\"text\"的值，那么代码如下：\n```javascript\n<template>\n    <childcom :name=\"name\" :age=\"age\" type=\"text\"></childcom>\n</template>\n<script>\nexport default {\n    'name':'test',\n    props:[],\n    data(){\n        return {\n            'name':'张三',\n            'age':'30',\n            'sex':'男'\n        }\n    },\n    components:{\n        'childcom':{\n            inheritAttrs:false,\n            props:['name','age'],\n            template:`<input type=\"number\" style=\"border:1px solid blue\">`,\n            created () {\n                console.log(this.$attrs.type)\n            }\n        }\n    }\n}\n</script>\n```\n页面渲染图如下：\n<img src=\"/img/inheritAttrs1.webp\">\n\n到这，我想大家都明白了inheritAttrs的作用了吧。默认情况下vue会把父作用域的不被认作 props 的特性绑定 且作为普通的 HTML 特性应用在子组件的根元素上。绑定就绑定，显示就显示，没啥大不了的，但是怕就怕遇到一些特殊的，就比如上面的input的情况，这个时候inheritAttrs:false的作用就出来啦。\n\n# 顺道补充一下：$listeners\n父组件-子组件-孙子组件，，，，现在我要你在孙子组件里改变父组件的值，怎么改？有很多方法啦，但是$listeners给我们提供了一个新的思路。话不多说，直接上代码\n```javascript\n<template>\n    <div>\n        <childcom :name=\"name\" :age=\"age\" :sex=\"sex\" @testChangeName=\"changeName\"></childcom>\n    </div>\n</template>\n<script>\nexport default {\n    'name':'test',\n    props:[],\n    data(){\n        return {\n            'name':'张三',\n            'age':'30',\n            'sex':'男'\n        }\n    },\n    components:{\n        'childcom':{\n            props:['name'],\n            template:`<div>\n                <div>我是子组件   {{name}}</div>\n                <grandcom v-bind=\"$attrs\" v-on=\"$listeners\"></grandcom>\n            </div>`,\n           \n            components: {\n                'grandcom':{\n                    template:`<div>我是孙子组件-------<button @click=\"grandChangeName\">改变名字</button></div>`,\n                    methods:{\n                        grandChangeName(){\n                           this.$emit('testChangeName','kkkkkk')\n                        }\n                    }\n                }\n            }\n        }\n    },\n    methods:{\n        changeName(val){\n            this.name = val\n        }\n    }\n}\n</script>\n```\n页面渲染如下：\n<img src=\"/img/inheritAttrs3.webp\">\n$listeners可以让你在孙子组件改变父组件的值，是不是很方便............\n\n\n","source":"_posts/VUE中的inheritAttrs-attrs-listeners.md","raw":"---\ntitle: 'VUE中的inheritAttrs,attrs,listeners'\ndate: 2020-05-26 11:15:22\ncategories: web\ntags:\n    — Vue中inheritAttrs，$attrs，$listeners\ncopyright:\nkeywords:\ndescription:\n---\n{% cq %} Vue中的inheritAttrs，$attrs，$listeners使用总结 {% endcq %}\n<!--more-->\n# 使用场景\n> 当你想向嵌套层级比较深组件数据传递，只能由父组件传递给子组件，子组件再传递给孙子组件,当传递十几个当情况，我们会在每个组件不停的props，每个必须写很多遍，除了vuex的父子组件通信，也可以通过inheritAttrs选项，以及实例属性$attrs\n\n```javascript\n      <template>\n          <div class=\"home\">\n            <mytest  :title=\"title\" :massgae=\"massgae\"></mytest>\n          </div>\n        </template>\n          export default {\n            name: 'home',\n            data () {\n              return {\n                title:'title1111',\n                massgae:'message111'\n              }\n            },\n            components:{\n              'mytest':{\n                template:`<div>这是个h1标题{{title}}</div>`,\n                props:['title'],\n                data(){\n                  return{\n                    mag:'111'\n                  }\n                },\n                created:function(){\n                  console.log(this.$attrs)//注意这里\n                }\n              }\n            }\n          }\n```\n\n  > 上边的代码，我们在组件里只是用了title这个属性，massgae属性我么是没有用的，那么下浏览器渲染出来是什么样呢？如下图：\n  <img src=\"/img/7579449-9b4f591d793547b6.webp\">\n  > 我们看到：组件内未被注册的属性将作为普通html元素属性被渲染，如果想让属性能够向下传递，即使prop组件没有被使用，你也需要在组件上注册。这样做会使组件预期功能变得模糊不清，同时也难以维护组件的DRY。在Vue2.4.0,可以在组件定义中添加inheritAttrs：false，组件将不会把未被注册的props呈现为普通的HTML属性。但是在组件里我们可以通过其$attrs可以获取到没有使用的注册属性，如果需要，我们在这也可以往下继续传递。\n  如果我们在子组件里设置 inheritAttrs: false：\n\n  ```javascript\n    components:{\n    'mytest':{\n      template:`<div>这是个h1标题{{title}}</div>`,\n      props:['title'],\n      inheritAttrs: false,\n      data(){\n        return{\n          mag:'111'\n        }\n      },\n      created:function(){\n        console.log(this.$attrs)//注意这里\n      }\n    }\n  ```\n  <img src=\"/img/7579449-a8a0b3970380eeeb.webp\">\n\n  # $attrs的使用\n  有一个页面由父组件，子组件，孙子组件构成，如下：\n  ```javascript\n    <template>\n    <div style=\"padding:50px;\">\n        <childcom :name=\"name\" :age=\"age\" :sex=\"sex\"></childcom>\n    </div>\n</template>\n<script>\nexport default {\n    'name':'test',\n    props:[],\n    data(){\n        return {\n            'name':'张三',\n            'age':'30',\n            'sex':'男'\n        }\n    },\n    components:{\n        'childcom':{\n            template:`<div>\n                <div>{{name}}</div>\n                <grandcom v-bind=\"$attrs\"></grandcom>\n            </div>`,\n            props:['name'],\n            components: {\n                'grandcom':{\n                    template:`<div>{{$attrs}}</div>`,\n                }\n            }\n        }\n    }\n}\n</script>\n  ```\n上面的代码在页面的效果是如下图\n<img src=\"/img/7579449-b2ab8dfe80fe828d.webp\">\n如果attrs被绑定在子组件childcom上后，我们就可以在孙子组件grandcom里获取到this.$attrs的值。这个{{$attrs}}的值是父组件中传递下来的props（除了子组件childcom组件中props声明的）。\n\n记住孙子组件grandcom里获取到this.$attrs的值是除了子组件childcom声明的元素！记住是除了子组件childcom声明的元素！例如上面的代码我在子组件childcom组件的props里声明了name，那么我在孙子组件grandcom里获取到的$attrs就不包含name属性，那么this.$attrs = { 'age':'30', 'sex':'男'}。\n# 说一下$attrs的优势到底在哪\n假如我们要做一个页面，有父组件，子组件，孙子组件，如下：\n```javascript\n<template>\n    <div>\n        <childcom></childcom>\n    </div>\n</template>\n<script>\nexport default {\n    'name':'test',\n    props:[],\n    data(){\n        return {\n            'name':'张三',\n            'age':'30',\n            'sex':'男'\n        }\n    },\n    components:{\n        'childcom':{\n            template:`<div>\n                <div>我是子组件</div>\n                <grandcom></grandcom>\n            </div>`,\n            components: {\n                'grandcom':{\n                    template:`<div>我是孙子组件</div>`,\n                }\n            }\n        }\n    }\n}\n</script>\n```\n如上代码，假如我想在子组件想获取到父组件的name属性值，在孙子组件获取父组件的age属性值，用props的话就必须在父组件把name和age的值通过props传递到子组件，子组件在通过props把age的值传递到孙子组件，到这里看明白了吧，孙子组件需要的age在子组件里没有用到，但是为了能让孙子组件获取到，你必须从父组件 传到子组件，在在子组件传递到孙子组件。\n\n但是用$attrs就不用那么麻烦，如下：\n```javascript\n<template>\n    <div>\n        <childcom :name=\"name\" :age=\"age\" :sex=\"sex\"></childcom>\n    </div>\n</template>\n<script>\nexport default {\n    'name':'test',\n    props:[],\n    data(){\n        return {\n            'name':'张三',\n            'age':'30',\n            'sex':'男'\n        }\n    },\n    components:{\n        'childcom':{\n            props:['name'],\n            template:`<div>\n                <div>我是子组件   {{name}}</div>\n                <grandcom v-bind=\"$attrs\"></grandcom>\n            </div>`,\n            components: {\n                'grandcom':{\n                    template:`<div>我是孙子组件{{$attrs.age}}</div>`,\n                }\n            }\n        }\n    }\n}\n</script>\n```\n子组件绑定了\"$attrs\"，孙子组件就能获取到除了name属性外所有由父组件传递下来的属性。如果孙子组件也想获取到name属性那么，在绑定个name如下，\n```javascript\n <grandcom v-bind=\"$attrs\" :name=\"name\"></grandcom>\n```\n细细体会下是不是这个道理\n\n# 补充一下：inheritAttrs属性\n关于inheritAttrs这个属性跟获取到$attrs的值没有关系，inheritAttrs通常在编写基础组件时候会用到。官网原话：默认情况下父作用域的不被认作 props 的特性绑定 (attribute bindings) 将会“回退”且作为普通的 HTML 特性应用在子组件的根元素上。当撰写包裹一个目标元素或另一个组件的组件时，这可能不会总是符合预期行为。通过设置 inheritAttrs 到 false，这些默认行为将会被去掉。而通过 (同样是 2.4 新增的) 实例属性 $attrs 可以让这些特性生效，且可以通过 v-bind 显性的绑定到非根元素上。\n\n注意：这个选项不影响 class 和 style 绑定。\n\n在Vue2.4.0之前版本，组件内未被注册的属性将作为普通html元素属性被渲染。\n\ninheritAttrs到底有啥用？到底用在哪里？看下边代码，\n\n```javascript\n<template>\n    <childcom :name=\"name\" :age=\"age\" type=\"text\"></childcom>\n</template>\n<script>\nexport default {\n    'name':'test',\n    props:[],\n    data(){\n        return {\n            'name':'张三',\n            'age':'30',\n            'sex':'男'\n        }\n    },\n    components:{\n        'childcom':{\n            props:['name','age'],\n            template:`<input type=\"number\" style=\"border:1px solid blue\">`,\n        }\n    }\n}\n</script>\n```\n上面代码你觉得input上会怎么显示？ 父组件传递了type=\"text\"，子组件里input 上type=\"number\"，那渲染到页面会是什么样？渲染图如下：\n<img src=\"/img/inheritAttrs2.webp\">\n看到没，父组件传递的type=\"text\"覆盖了input 上type=\"number\"，这岂不是把我的input数据类型都给改变了，这岂不是有问题，这不是我想要的！！！！看到这里明白了吗？回头去体会下上面官网的原话！！！\n\n需求：我需要input 上type=\"number\"类型不变，但是我还是要取到父组件的type=\"text\"的值，那么代码如下：\n```javascript\n<template>\n    <childcom :name=\"name\" :age=\"age\" type=\"text\"></childcom>\n</template>\n<script>\nexport default {\n    'name':'test',\n    props:[],\n    data(){\n        return {\n            'name':'张三',\n            'age':'30',\n            'sex':'男'\n        }\n    },\n    components:{\n        'childcom':{\n            inheritAttrs:false,\n            props:['name','age'],\n            template:`<input type=\"number\" style=\"border:1px solid blue\">`,\n            created () {\n                console.log(this.$attrs.type)\n            }\n        }\n    }\n}\n</script>\n```\n页面渲染图如下：\n<img src=\"/img/inheritAttrs1.webp\">\n\n到这，我想大家都明白了inheritAttrs的作用了吧。默认情况下vue会把父作用域的不被认作 props 的特性绑定 且作为普通的 HTML 特性应用在子组件的根元素上。绑定就绑定，显示就显示，没啥大不了的，但是怕就怕遇到一些特殊的，就比如上面的input的情况，这个时候inheritAttrs:false的作用就出来啦。\n\n# 顺道补充一下：$listeners\n父组件-子组件-孙子组件，，，，现在我要你在孙子组件里改变父组件的值，怎么改？有很多方法啦，但是$listeners给我们提供了一个新的思路。话不多说，直接上代码\n```javascript\n<template>\n    <div>\n        <childcom :name=\"name\" :age=\"age\" :sex=\"sex\" @testChangeName=\"changeName\"></childcom>\n    </div>\n</template>\n<script>\nexport default {\n    'name':'test',\n    props:[],\n    data(){\n        return {\n            'name':'张三',\n            'age':'30',\n            'sex':'男'\n        }\n    },\n    components:{\n        'childcom':{\n            props:['name'],\n            template:`<div>\n                <div>我是子组件   {{name}}</div>\n                <grandcom v-bind=\"$attrs\" v-on=\"$listeners\"></grandcom>\n            </div>`,\n           \n            components: {\n                'grandcom':{\n                    template:`<div>我是孙子组件-------<button @click=\"grandChangeName\">改变名字</button></div>`,\n                    methods:{\n                        grandChangeName(){\n                           this.$emit('testChangeName','kkkkkk')\n                        }\n                    }\n                }\n            }\n        }\n    },\n    methods:{\n        changeName(val){\n            this.name = val\n        }\n    }\n}\n</script>\n```\n页面渲染如下：\n<img src=\"/img/inheritAttrs3.webp\">\n$listeners可以让你在孙子组件改变父组件的值，是不是很方便............\n\n\n","slug":"VUE中的inheritAttrs-attrs-listeners","published":1,"updated":"2026-01-02T00:43:17.571Z","comments":1,"layout":"post","photos":[],"_id":"cmjwbsw620008rotgdu2o6jbt","content":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>Vue中的inheritAttrs，$attrs，$listeners使用总结 </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n<span id=\"more\"></span>\n<h1 id=\"使用场景\"><a href=\"#使用场景\" class=\"headerlink\" title=\"使用场景\"></a>使用场景</h1><blockquote>\n<p>当你想向嵌套层级比较深组件数据传递，只能由父组件传递给子组件，子组件再传递给孙子组件,当传递十几个当情况，我们会在每个组件不停的props，每个必须写很多遍，除了vuex的父子组件通信，也可以通过inheritAttrs选项，以及实例属性$attrs</p>\n</blockquote>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;home&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">mytest</span>  <span class=\"attr\">:title</span>=<span class=\"string\">&quot;title&quot;</span> <span class=\"attr\">:massgae</span>=<span class=\"string\">&quot;massgae&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">mytest</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">  &lt;/template&gt;</span><br><span class=\"line\">    <span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">      <span class=\"attr\">name</span>: <span class=\"string\">&#x27;home&#x27;</span>,</span><br><span class=\"line\">      <span class=\"title function_\">data</span> () &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">          <span class=\"attr\">title</span>:<span class=\"string\">&#x27;title1111&#x27;</span>,</span><br><span class=\"line\">          <span class=\"attr\">massgae</span>:<span class=\"string\">&#x27;message111&#x27;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"attr\">components</span>:&#123;</span><br><span class=\"line\">        <span class=\"string\">&#x27;mytest&#x27;</span>:&#123;</span><br><span class=\"line\">          <span class=\"attr\">template</span>:<span class=\"string\">`&lt;div&gt;这是个h1标题&#123;&#123;title&#125;&#125;&lt;/div&gt;`</span>,</span><br><span class=\"line\">          <span class=\"attr\">props</span>:[<span class=\"string\">&#x27;title&#x27;</span>],</span><br><span class=\"line\">          <span class=\"title function_\">data</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>&#123;</span><br><span class=\"line\">              <span class=\"attr\">mag</span>:<span class=\"string\">&#x27;111&#x27;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          <span class=\"attr\">created</span>:<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">$attrs</span>)<span class=\"comment\">//注意这里</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>上边的代码，我们在组件里只是用了title这个属性，massgae属性我么是没有用的，那么下浏览器渲染出来是什么样呢？如下图：<br>  <img src=\"/img/7579449-9b4f591d793547b6.webp\"><br>我们看到：组件内未被注册的属性将作为普通html元素属性被渲染，如果想让属性能够向下传递，即使prop组件没有被使用，你也需要在组件上注册。这样做会使组件预期功能变得模糊不清，同时也难以维护组件的DRY。在Vue2.4.0,可以在组件定义中添加inheritAttrs：false，组件将不会把未被注册的props呈现为普通的HTML属性。但是在组件里我们可以通过其$attrs可以获取到没有使用的注册属性，如果需要，我们在这也可以往下继续传递。<br>  如果我们在子组件里设置 inheritAttrs: false：</p>\n</blockquote>\n  <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">components</span>:&#123;</span><br><span class=\"line\"><span class=\"string\">&#x27;mytest&#x27;</span>:&#123;</span><br><span class=\"line\">  <span class=\"attr\">template</span>:<span class=\"string\">`&lt;div&gt;这是个h1标题&#123;&#123;title&#125;&#125;&lt;/div&gt;`</span>,</span><br><span class=\"line\">  <span class=\"attr\">props</span>:[<span class=\"string\">&#x27;title&#x27;</span>],</span><br><span class=\"line\">  <span class=\"attr\">inheritAttrs</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"title function_\">data</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span>&#123;</span><br><span class=\"line\">      <span class=\"attr\">mag</span>:<span class=\"string\">&#x27;111&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">created</span>:<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">$attrs</span>)<span class=\"comment\">//注意这里</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n  <img src=\"/img/7579449-a8a0b3970380eeeb.webp\">\n\n<h1 id=\"attrs的使用\"><a href=\"#attrs的使用\" class=\"headerlink\" title=\"$attrs的使用\"></a>$attrs的使用</h1><p>  有一个页面由父组件，子组件，孙子组件构成，如下：<br>  <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    &lt;template&gt;</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;padding:50px;&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">childcom</span> <span class=\"attr\">:name</span>=<span class=\"string\">&quot;name&quot;</span> <span class=\"attr\">:age</span>=<span class=\"string\">&quot;age&quot;</span> <span class=\"attr\">:sex</span>=<span class=\"string\">&quot;sex&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">childcom</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;test&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"attr\">props</span>:[],</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"title function_\">data</span>(<span class=\"params\"></span>)&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">return</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;张三&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;age&#x27;</span>:<span class=\"string\">&#x27;30&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;sex&#x27;</span>:<span class=\"string\">&#x27;男&#x27;</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"attr\">components</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"string\">&#x27;childcom&#x27;</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">template</span>:<span class=\"string\">`&lt;div&gt;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-javascript\"><span class=\"language-xml\">                &lt;div&gt;&#123;&#123;name&#125;&#125;&lt;/div&gt;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-javascript\"><span class=\"language-xml\">                &lt;grandcom v-bind=&quot;$attrs&quot;&gt;&lt;/grandcom&gt;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-javascript\"><span class=\"language-xml\">            &lt;/div&gt;`</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">props</span>:[<span class=\"string\">&#x27;name&#x27;</span>],</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">components</span>: &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                <span class=\"string\">&#x27;grandcom&#x27;</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    <span class=\"attr\">template</span>:<span class=\"string\">`&lt;div&gt;&#123;&#123;$attrs&#125;&#125;&lt;/div&gt;`</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><br>上面的代码在页面的效果是如下图<br><img src=\"/img/7579449-b2ab8dfe80fe828d.webp\"><br>如果attrs被绑定在子组件childcom上后，我们就可以在孙子组件grandcom里获取到this.$attrs的值。这个的值是父组件中传递下来的props（除了子组件childcom组件中props声明的）。</p>\n<p>记住孙子组件grandcom里获取到this.$attrs的值是除了子组件childcom声明的元素！记住是除了子组件childcom声明的元素！例如上面的代码我在子组件childcom组件的props里声明了name，那么我在孙子组件grandcom里获取到的$attrs就不包含name属性，那么this.$attrs &#x3D; { ‘age’:’30’, ‘sex’:’男’}。</p>\n<h1 id=\"说一下-attrs的优势到底在哪\"><a href=\"#说一下-attrs的优势到底在哪\" class=\"headerlink\" title=\"说一下$attrs的优势到底在哪\"></a>说一下$attrs的优势到底在哪</h1><p>假如我们要做一个页面，有父组件，子组件，孙子组件，如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">childcom</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">childcom</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;test&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"attr\">props</span>:[],</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"title function_\">data</span>(<span class=\"params\"></span>)&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">return</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;张三&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;age&#x27;</span>:<span class=\"string\">&#x27;30&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;sex&#x27;</span>:<span class=\"string\">&#x27;男&#x27;</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"attr\">components</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"string\">&#x27;childcom&#x27;</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">template</span>:<span class=\"string\">`&lt;div&gt;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-javascript\"><span class=\"language-xml\">                &lt;div&gt;我是子组件&lt;/div&gt;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-javascript\"><span class=\"language-xml\">                &lt;grandcom&gt;&lt;/grandcom&gt;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-javascript\"><span class=\"language-xml\">            &lt;/div&gt;`</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">components</span>: &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                <span class=\"string\">&#x27;grandcom&#x27;</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    <span class=\"attr\">template</span>:<span class=\"string\">`&lt;div&gt;我是孙子组件&lt;/div&gt;`</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n<p>如上代码，假如我想在子组件想获取到父组件的name属性值，在孙子组件获取父组件的age属性值，用props的话就必须在父组件把name和age的值通过props传递到子组件，子组件在通过props把age的值传递到孙子组件，到这里看明白了吧，孙子组件需要的age在子组件里没有用到，但是为了能让孙子组件获取到，你必须从父组件 传到子组件，在在子组件传递到孙子组件。</p>\n<p>但是用$attrs就不用那么麻烦，如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">childcom</span> <span class=\"attr\">:name</span>=<span class=\"string\">&quot;name&quot;</span> <span class=\"attr\">:age</span>=<span class=\"string\">&quot;age&quot;</span> <span class=\"attr\">:sex</span>=<span class=\"string\">&quot;sex&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">childcom</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;test&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"attr\">props</span>:[],</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"title function_\">data</span>(<span class=\"params\"></span>)&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">return</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;张三&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;age&#x27;</span>:<span class=\"string\">&#x27;30&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;sex&#x27;</span>:<span class=\"string\">&#x27;男&#x27;</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"attr\">components</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"string\">&#x27;childcom&#x27;</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">props</span>:[<span class=\"string\">&#x27;name&#x27;</span>],</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">template</span>:<span class=\"string\">`&lt;div&gt;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-javascript\"><span class=\"language-xml\">                &lt;div&gt;我是子组件   &#123;&#123;name&#125;&#125;&lt;/div&gt;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-javascript\"><span class=\"language-xml\">                &lt;grandcom v-bind=&quot;$attrs&quot;&gt;&lt;/grandcom&gt;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-javascript\"><span class=\"language-xml\">            &lt;/div&gt;`</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">components</span>: &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                <span class=\"string\">&#x27;grandcom&#x27;</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    <span class=\"attr\">template</span>:<span class=\"string\">`&lt;div&gt;我是孙子组件&#123;&#123;$attrs.age&#125;&#125;&lt;/div&gt;`</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n<p>子组件绑定了”$attrs”，孙子组件就能获取到除了name属性外所有由父组件传递下来的属性。如果孙子组件也想获取到name属性那么，在绑定个name如下，</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;grandcom v-bind=<span class=\"string\">&quot;$attrs&quot;</span> :name=<span class=\"string\">&quot;name&quot;</span>&gt;&lt;/grandcom&gt;</span><br></pre></td></tr></table></figure>\n<p>细细体会下是不是这个道理</p>\n<h1 id=\"补充一下：inheritAttrs属性\"><a href=\"#补充一下：inheritAttrs属性\" class=\"headerlink\" title=\"补充一下：inheritAttrs属性\"></a>补充一下：inheritAttrs属性</h1><p>关于inheritAttrs这个属性跟获取到$attrs的值没有关系，inheritAttrs通常在编写基础组件时候会用到。官网原话：默认情况下父作用域的不被认作 props 的特性绑定 (attribute bindings) 将会“回退”且作为普通的 HTML 特性应用在子组件的根元素上。当撰写包裹一个目标元素或另一个组件的组件时，这可能不会总是符合预期行为。通过设置 inheritAttrs 到 false，这些默认行为将会被去掉。而通过 (同样是 2.4 新增的) 实例属性 $attrs 可以让这些特性生效，且可以通过 v-bind 显性的绑定到非根元素上。</p>\n<p>注意：这个选项不影响 class 和 style 绑定。</p>\n<p>在Vue2.4.0之前版本，组件内未被注册的属性将作为普通html元素属性被渲染。</p>\n<p>inheritAttrs到底有啥用？到底用在哪里？看下边代码，</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">childcom</span> <span class=\"attr\">:name</span>=<span class=\"string\">&quot;name&quot;</span> <span class=\"attr\">:age</span>=<span class=\"string\">&quot;age&quot;</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">childcom</span>&gt;</span></span></span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;test&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"attr\">props</span>:[],</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"title function_\">data</span>(<span class=\"params\"></span>)&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">return</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;张三&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;age&#x27;</span>:<span class=\"string\">&#x27;30&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;sex&#x27;</span>:<span class=\"string\">&#x27;男&#x27;</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"attr\">components</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"string\">&#x27;childcom&#x27;</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">props</span>:[<span class=\"string\">&#x27;name&#x27;</span>,<span class=\"string\">&#x27;age&#x27;</span>],</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">template</span>:<span class=\"string\">`&lt;input type=&quot;number&quot; style=&quot;border:1px solid blue&quot;&gt;`</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n<p>上面代码你觉得input上会怎么显示？ 父组件传递了type&#x3D;”text”，子组件里input 上type&#x3D;”number”，那渲染到页面会是什么样？渲染图如下：<br><img src=\"/img/inheritAttrs2.webp\"><br>看到没，父组件传递的type&#x3D;”text”覆盖了input 上type&#x3D;”number”，这岂不是把我的input数据类型都给改变了，这岂不是有问题，这不是我想要的！！！！看到这里明白了吗？回头去体会下上面官网的原话！！！</p>\n<p>需求：我需要input 上type&#x3D;”number”类型不变，但是我还是要取到父组件的type&#x3D;”text”的值，那么代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">childcom</span> <span class=\"attr\">:name</span>=<span class=\"string\">&quot;name&quot;</span> <span class=\"attr\">:age</span>=<span class=\"string\">&quot;age&quot;</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">childcom</span>&gt;</span></span></span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;test&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"attr\">props</span>:[],</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"title function_\">data</span>(<span class=\"params\"></span>)&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">return</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;张三&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;age&#x27;</span>:<span class=\"string\">&#x27;30&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;sex&#x27;</span>:<span class=\"string\">&#x27;男&#x27;</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"attr\">components</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"string\">&#x27;childcom&#x27;</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">inheritAttrs</span>:<span class=\"literal\">false</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">props</span>:[<span class=\"string\">&#x27;name&#x27;</span>,<span class=\"string\">&#x27;age&#x27;</span>],</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">template</span>:<span class=\"string\">`&lt;input type=&quot;number&quot; style=&quot;border:1px solid blue&quot;&gt;`</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"title function_\">created</span> () &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">$attrs</span>.<span class=\"property\">type</span>)</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n<p>页面渲染图如下：<br><img src=\"/img/inheritAttrs1.webp\"></p>\n<p>到这，我想大家都明白了inheritAttrs的作用了吧。默认情况下vue会把父作用域的不被认作 props 的特性绑定 且作为普通的 HTML 特性应用在子组件的根元素上。绑定就绑定，显示就显示，没啥大不了的，但是怕就怕遇到一些特殊的，就比如上面的input的情况，这个时候inheritAttrs:false的作用就出来啦。</p>\n<h1 id=\"顺道补充一下：-listeners\"><a href=\"#顺道补充一下：-listeners\" class=\"headerlink\" title=\"顺道补充一下：$listeners\"></a>顺道补充一下：$listeners</h1><p>父组件-子组件-孙子组件，，，，现在我要你在孙子组件里改变父组件的值，怎么改？有很多方法啦，但是$listeners给我们提供了一个新的思路。话不多说，直接上代码</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">childcom</span> <span class=\"attr\">:name</span>=<span class=\"string\">&quot;name&quot;</span> <span class=\"attr\">:age</span>=<span class=\"string\">&quot;age&quot;</span> <span class=\"attr\">:sex</span>=<span class=\"string\">&quot;sex&quot;</span> @<span class=\"attr\">testChangeName</span>=<span class=\"string\">&quot;changeName&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">childcom</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;test&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"attr\">props</span>:[],</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"title function_\">data</span>(<span class=\"params\"></span>)&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">return</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;张三&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;age&#x27;</span>:<span class=\"string\">&#x27;30&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;sex&#x27;</span>:<span class=\"string\">&#x27;男&#x27;</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"attr\">components</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"string\">&#x27;childcom&#x27;</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">props</span>:[<span class=\"string\">&#x27;name&#x27;</span>],</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">template</span>:<span class=\"string\">`&lt;div&gt;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-javascript\"><span class=\"language-xml\">                &lt;div&gt;我是子组件   &#123;&#123;name&#125;&#125;&lt;/div&gt;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-javascript\"><span class=\"language-xml\">                &lt;grandcom v-bind=&quot;$attrs&quot; v-on=&quot;$listeners&quot;&gt;&lt;/grandcom&gt;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-javascript\"><span class=\"language-xml\">            &lt;/div&gt;`</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">           </span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">components</span>: &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                <span class=\"string\">&#x27;grandcom&#x27;</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    <span class=\"attr\">template</span>:<span class=\"string\">`&lt;div&gt;我是孙子组件-------&lt;button @click=&quot;grandChangeName&quot;&gt;改变名字&lt;/button&gt;&lt;/div&gt;`</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    <span class=\"attr\">methods</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                        <span class=\"title function_\">grandChangeName</span>(<span class=\"params\"></span>)&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                           <span class=\"variable language_\">this</span>.$emit(<span class=\"string\">&#x27;testChangeName&#x27;</span>,<span class=\"string\">&#x27;kkkkkk&#x27;</span>)</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"attr\">methods</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"title function_\">changeName</span>(<span class=\"params\">val</span>)&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"variable language_\">this</span>.<span class=\"property\">name</span> = val</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n<p>页面渲染如下：<br><img src=\"/img/inheritAttrs3.webp\"><br>$listeners可以让你在孙子组件改变父组件的值，是不是很方便…………</p>\n","excerpt":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>Vue中的inheritAttrs，$attrs，$listeners使用总结 </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>","more":"<h1 id=\"使用场景\"><a href=\"#使用场景\" class=\"headerlink\" title=\"使用场景\"></a>使用场景</h1><blockquote>\n<p>当你想向嵌套层级比较深组件数据传递，只能由父组件传递给子组件，子组件再传递给孙子组件,当传递十几个当情况，我们会在每个组件不停的props，每个必须写很多遍，除了vuex的父子组件通信，也可以通过inheritAttrs选项，以及实例属性$attrs</p>\n</blockquote>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;home&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">mytest</span>  <span class=\"attr\">:title</span>=<span class=\"string\">&quot;title&quot;</span> <span class=\"attr\">:massgae</span>=<span class=\"string\">&quot;massgae&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">mytest</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">  &lt;/template&gt;</span><br><span class=\"line\">    <span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">      <span class=\"attr\">name</span>: <span class=\"string\">&#x27;home&#x27;</span>,</span><br><span class=\"line\">      <span class=\"title function_\">data</span> () &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">          <span class=\"attr\">title</span>:<span class=\"string\">&#x27;title1111&#x27;</span>,</span><br><span class=\"line\">          <span class=\"attr\">massgae</span>:<span class=\"string\">&#x27;message111&#x27;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"attr\">components</span>:&#123;</span><br><span class=\"line\">        <span class=\"string\">&#x27;mytest&#x27;</span>:&#123;</span><br><span class=\"line\">          <span class=\"attr\">template</span>:<span class=\"string\">`&lt;div&gt;这是个h1标题&#123;&#123;title&#125;&#125;&lt;/div&gt;`</span>,</span><br><span class=\"line\">          <span class=\"attr\">props</span>:[<span class=\"string\">&#x27;title&#x27;</span>],</span><br><span class=\"line\">          <span class=\"title function_\">data</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>&#123;</span><br><span class=\"line\">              <span class=\"attr\">mag</span>:<span class=\"string\">&#x27;111&#x27;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          <span class=\"attr\">created</span>:<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">$attrs</span>)<span class=\"comment\">//注意这里</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>上边的代码，我们在组件里只是用了title这个属性，massgae属性我么是没有用的，那么下浏览器渲染出来是什么样呢？如下图：<br>  <img src=\"/img/7579449-9b4f591d793547b6.webp\"><br>我们看到：组件内未被注册的属性将作为普通html元素属性被渲染，如果想让属性能够向下传递，即使prop组件没有被使用，你也需要在组件上注册。这样做会使组件预期功能变得模糊不清，同时也难以维护组件的DRY。在Vue2.4.0,可以在组件定义中添加inheritAttrs：false，组件将不会把未被注册的props呈现为普通的HTML属性。但是在组件里我们可以通过其$attrs可以获取到没有使用的注册属性，如果需要，我们在这也可以往下继续传递。<br>  如果我们在子组件里设置 inheritAttrs: false：</p>\n</blockquote>\n  <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">components</span>:&#123;</span><br><span class=\"line\"><span class=\"string\">&#x27;mytest&#x27;</span>:&#123;</span><br><span class=\"line\">  <span class=\"attr\">template</span>:<span class=\"string\">`&lt;div&gt;这是个h1标题&#123;&#123;title&#125;&#125;&lt;/div&gt;`</span>,</span><br><span class=\"line\">  <span class=\"attr\">props</span>:[<span class=\"string\">&#x27;title&#x27;</span>],</span><br><span class=\"line\">  <span class=\"attr\">inheritAttrs</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  <span class=\"title function_\">data</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span>&#123;</span><br><span class=\"line\">      <span class=\"attr\">mag</span>:<span class=\"string\">&#x27;111&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">created</span>:<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">$attrs</span>)<span class=\"comment\">//注意这里</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n  <img src=\"/img/7579449-a8a0b3970380eeeb.webp\">\n\n<h1 id=\"attrs的使用\"><a href=\"#attrs的使用\" class=\"headerlink\" title=\"$attrs的使用\"></a>$attrs的使用</h1><p>  有一个页面由父组件，子组件，孙子组件构成，如下：<br>  <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    &lt;template&gt;</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;padding:50px;&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">childcom</span> <span class=\"attr\">:name</span>=<span class=\"string\">&quot;name&quot;</span> <span class=\"attr\">:age</span>=<span class=\"string\">&quot;age&quot;</span> <span class=\"attr\">:sex</span>=<span class=\"string\">&quot;sex&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">childcom</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;test&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"attr\">props</span>:[],</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"title function_\">data</span>(<span class=\"params\"></span>)&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">return</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;张三&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;age&#x27;</span>:<span class=\"string\">&#x27;30&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;sex&#x27;</span>:<span class=\"string\">&#x27;男&#x27;</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"attr\">components</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"string\">&#x27;childcom&#x27;</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">template</span>:<span class=\"string\">`&lt;div&gt;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-javascript\"><span class=\"language-xml\">                &lt;div&gt;&#123;&#123;name&#125;&#125;&lt;/div&gt;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-javascript\"><span class=\"language-xml\">                &lt;grandcom v-bind=&quot;$attrs&quot;&gt;&lt;/grandcom&gt;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-javascript\"><span class=\"language-xml\">            &lt;/div&gt;`</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">props</span>:[<span class=\"string\">&#x27;name&#x27;</span>],</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">components</span>: &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                <span class=\"string\">&#x27;grandcom&#x27;</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    <span class=\"attr\">template</span>:<span class=\"string\">`&lt;div&gt;&#123;&#123;$attrs&#125;&#125;&lt;/div&gt;`</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><br>上面的代码在页面的效果是如下图<br><img src=\"/img/7579449-b2ab8dfe80fe828d.webp\"><br>如果attrs被绑定在子组件childcom上后，我们就可以在孙子组件grandcom里获取到this.$attrs的值。这个的值是父组件中传递下来的props（除了子组件childcom组件中props声明的）。</p>\n<p>记住孙子组件grandcom里获取到this.$attrs的值是除了子组件childcom声明的元素！记住是除了子组件childcom声明的元素！例如上面的代码我在子组件childcom组件的props里声明了name，那么我在孙子组件grandcom里获取到的$attrs就不包含name属性，那么this.$attrs &#x3D; { ‘age’:’30’, ‘sex’:’男’}。</p>\n<h1 id=\"说一下-attrs的优势到底在哪\"><a href=\"#说一下-attrs的优势到底在哪\" class=\"headerlink\" title=\"说一下$attrs的优势到底在哪\"></a>说一下$attrs的优势到底在哪</h1><p>假如我们要做一个页面，有父组件，子组件，孙子组件，如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">childcom</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">childcom</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;test&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"attr\">props</span>:[],</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"title function_\">data</span>(<span class=\"params\"></span>)&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">return</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;张三&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;age&#x27;</span>:<span class=\"string\">&#x27;30&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;sex&#x27;</span>:<span class=\"string\">&#x27;男&#x27;</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"attr\">components</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"string\">&#x27;childcom&#x27;</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">template</span>:<span class=\"string\">`&lt;div&gt;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-javascript\"><span class=\"language-xml\">                &lt;div&gt;我是子组件&lt;/div&gt;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-javascript\"><span class=\"language-xml\">                &lt;grandcom&gt;&lt;/grandcom&gt;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-javascript\"><span class=\"language-xml\">            &lt;/div&gt;`</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">components</span>: &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                <span class=\"string\">&#x27;grandcom&#x27;</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    <span class=\"attr\">template</span>:<span class=\"string\">`&lt;div&gt;我是孙子组件&lt;/div&gt;`</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n<p>如上代码，假如我想在子组件想获取到父组件的name属性值，在孙子组件获取父组件的age属性值，用props的话就必须在父组件把name和age的值通过props传递到子组件，子组件在通过props把age的值传递到孙子组件，到这里看明白了吧，孙子组件需要的age在子组件里没有用到，但是为了能让孙子组件获取到，你必须从父组件 传到子组件，在在子组件传递到孙子组件。</p>\n<p>但是用$attrs就不用那么麻烦，如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">childcom</span> <span class=\"attr\">:name</span>=<span class=\"string\">&quot;name&quot;</span> <span class=\"attr\">:age</span>=<span class=\"string\">&quot;age&quot;</span> <span class=\"attr\">:sex</span>=<span class=\"string\">&quot;sex&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">childcom</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;test&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"attr\">props</span>:[],</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"title function_\">data</span>(<span class=\"params\"></span>)&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">return</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;张三&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;age&#x27;</span>:<span class=\"string\">&#x27;30&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;sex&#x27;</span>:<span class=\"string\">&#x27;男&#x27;</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"attr\">components</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"string\">&#x27;childcom&#x27;</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">props</span>:[<span class=\"string\">&#x27;name&#x27;</span>],</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">template</span>:<span class=\"string\">`&lt;div&gt;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-javascript\"><span class=\"language-xml\">                &lt;div&gt;我是子组件   &#123;&#123;name&#125;&#125;&lt;/div&gt;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-javascript\"><span class=\"language-xml\">                &lt;grandcom v-bind=&quot;$attrs&quot;&gt;&lt;/grandcom&gt;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-javascript\"><span class=\"language-xml\">            &lt;/div&gt;`</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">components</span>: &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                <span class=\"string\">&#x27;grandcom&#x27;</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    <span class=\"attr\">template</span>:<span class=\"string\">`&lt;div&gt;我是孙子组件&#123;&#123;$attrs.age&#125;&#125;&lt;/div&gt;`</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n<p>子组件绑定了”$attrs”，孙子组件就能获取到除了name属性外所有由父组件传递下来的属性。如果孙子组件也想获取到name属性那么，在绑定个name如下，</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;grandcom v-bind=<span class=\"string\">&quot;$attrs&quot;</span> :name=<span class=\"string\">&quot;name&quot;</span>&gt;&lt;/grandcom&gt;</span><br></pre></td></tr></table></figure>\n<p>细细体会下是不是这个道理</p>\n<h1 id=\"补充一下：inheritAttrs属性\"><a href=\"#补充一下：inheritAttrs属性\" class=\"headerlink\" title=\"补充一下：inheritAttrs属性\"></a>补充一下：inheritAttrs属性</h1><p>关于inheritAttrs这个属性跟获取到$attrs的值没有关系，inheritAttrs通常在编写基础组件时候会用到。官网原话：默认情况下父作用域的不被认作 props 的特性绑定 (attribute bindings) 将会“回退”且作为普通的 HTML 特性应用在子组件的根元素上。当撰写包裹一个目标元素或另一个组件的组件时，这可能不会总是符合预期行为。通过设置 inheritAttrs 到 false，这些默认行为将会被去掉。而通过 (同样是 2.4 新增的) 实例属性 $attrs 可以让这些特性生效，且可以通过 v-bind 显性的绑定到非根元素上。</p>\n<p>注意：这个选项不影响 class 和 style 绑定。</p>\n<p>在Vue2.4.0之前版本，组件内未被注册的属性将作为普通html元素属性被渲染。</p>\n<p>inheritAttrs到底有啥用？到底用在哪里？看下边代码，</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">childcom</span> <span class=\"attr\">:name</span>=<span class=\"string\">&quot;name&quot;</span> <span class=\"attr\">:age</span>=<span class=\"string\">&quot;age&quot;</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">childcom</span>&gt;</span></span></span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;test&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"attr\">props</span>:[],</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"title function_\">data</span>(<span class=\"params\"></span>)&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">return</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;张三&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;age&#x27;</span>:<span class=\"string\">&#x27;30&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;sex&#x27;</span>:<span class=\"string\">&#x27;男&#x27;</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"attr\">components</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"string\">&#x27;childcom&#x27;</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">props</span>:[<span class=\"string\">&#x27;name&#x27;</span>,<span class=\"string\">&#x27;age&#x27;</span>],</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">template</span>:<span class=\"string\">`&lt;input type=&quot;number&quot; style=&quot;border:1px solid blue&quot;&gt;`</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n<p>上面代码你觉得input上会怎么显示？ 父组件传递了type&#x3D;”text”，子组件里input 上type&#x3D;”number”，那渲染到页面会是什么样？渲染图如下：<br><img src=\"/img/inheritAttrs2.webp\"><br>看到没，父组件传递的type&#x3D;”text”覆盖了input 上type&#x3D;”number”，这岂不是把我的input数据类型都给改变了，这岂不是有问题，这不是我想要的！！！！看到这里明白了吗？回头去体会下上面官网的原话！！！</p>\n<p>需求：我需要input 上type&#x3D;”number”类型不变，但是我还是要取到父组件的type&#x3D;”text”的值，那么代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">childcom</span> <span class=\"attr\">:name</span>=<span class=\"string\">&quot;name&quot;</span> <span class=\"attr\">:age</span>=<span class=\"string\">&quot;age&quot;</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">childcom</span>&gt;</span></span></span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;test&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"attr\">props</span>:[],</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"title function_\">data</span>(<span class=\"params\"></span>)&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">return</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;张三&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;age&#x27;</span>:<span class=\"string\">&#x27;30&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;sex&#x27;</span>:<span class=\"string\">&#x27;男&#x27;</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"attr\">components</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"string\">&#x27;childcom&#x27;</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">inheritAttrs</span>:<span class=\"literal\">false</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">props</span>:[<span class=\"string\">&#x27;name&#x27;</span>,<span class=\"string\">&#x27;age&#x27;</span>],</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">template</span>:<span class=\"string\">`&lt;input type=&quot;number&quot; style=&quot;border:1px solid blue&quot;&gt;`</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"title function_\">created</span> () &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">$attrs</span>.<span class=\"property\">type</span>)</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n<p>页面渲染图如下：<br><img src=\"/img/inheritAttrs1.webp\"></p>\n<p>到这，我想大家都明白了inheritAttrs的作用了吧。默认情况下vue会把父作用域的不被认作 props 的特性绑定 且作为普通的 HTML 特性应用在子组件的根元素上。绑定就绑定，显示就显示，没啥大不了的，但是怕就怕遇到一些特殊的，就比如上面的input的情况，这个时候inheritAttrs:false的作用就出来啦。</p>\n<h1 id=\"顺道补充一下：-listeners\"><a href=\"#顺道补充一下：-listeners\" class=\"headerlink\" title=\"顺道补充一下：$listeners\"></a>顺道补充一下：$listeners</h1><p>父组件-子组件-孙子组件，，，，现在我要你在孙子组件里改变父组件的值，怎么改？有很多方法啦，但是$listeners给我们提供了一个新的思路。话不多说，直接上代码</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">childcom</span> <span class=\"attr\">:name</span>=<span class=\"string\">&quot;name&quot;</span> <span class=\"attr\">:age</span>=<span class=\"string\">&quot;age&quot;</span> <span class=\"attr\">:sex</span>=<span class=\"string\">&quot;sex&quot;</span> @<span class=\"attr\">testChangeName</span>=<span class=\"string\">&quot;changeName&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">childcom</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;test&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"attr\">props</span>:[],</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"title function_\">data</span>(<span class=\"params\"></span>)&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">return</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;name&#x27;</span>:<span class=\"string\">&#x27;张三&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;age&#x27;</span>:<span class=\"string\">&#x27;30&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&#x27;sex&#x27;</span>:<span class=\"string\">&#x27;男&#x27;</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"attr\">components</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"string\">&#x27;childcom&#x27;</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">props</span>:[<span class=\"string\">&#x27;name&#x27;</span>],</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">template</span>:<span class=\"string\">`&lt;div&gt;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-javascript\"><span class=\"language-xml\">                &lt;div&gt;我是子组件   &#123;&#123;name&#125;&#125;&lt;/div&gt;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-javascript\"><span class=\"language-xml\">                &lt;grandcom v-bind=&quot;$attrs&quot; v-on=&quot;$listeners&quot;&gt;&lt;/grandcom&gt;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-javascript\"><span class=\"language-xml\">            &lt;/div&gt;`</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">           </span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">components</span>: &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                <span class=\"string\">&#x27;grandcom&#x27;</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    <span class=\"attr\">template</span>:<span class=\"string\">`&lt;div&gt;我是孙子组件-------&lt;button @click=&quot;grandChangeName&quot;&gt;改变名字&lt;/button&gt;&lt;/div&gt;`</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    <span class=\"attr\">methods</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                        <span class=\"title function_\">grandChangeName</span>(<span class=\"params\"></span>)&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                           <span class=\"variable language_\">this</span>.$emit(<span class=\"string\">&#x27;testChangeName&#x27;</span>,<span class=\"string\">&#x27;kkkkkk&#x27;</span>)</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"attr\">methods</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"title function_\">changeName</span>(<span class=\"params\">val</span>)&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"variable language_\">this</span>.<span class=\"property\">name</span> = val</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">&#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n<p>页面渲染如下：<br><img src=\"/img/inheritAttrs3.webp\"><br>$listeners可以让你在孙子组件改变父组件的值，是不是很方便…………</p>"},{"title":"gulp和webpack区别","date":"2019-01-29T01:48:44.000Z","copyright":null,"keywords":null,"description":null,"_content":"{% cq %}我愿化身石桥，受五百年风吹，五百年日晒，五百年雨淋，只求她从桥上经过{% endcq %}\n<!--more-->\n>[原文地址](https://www.cnblogs.com/lovesong/p/6413546.html)\n# gulp\n\ngulp强调的是前端开发的工作流程，我们可以通过配置一系列的task，定义task处理的事务（例如文件压缩合并、雪碧图、启动server、版本控制等），然后定义执行顺序，来让gulp执行这些task，从而构建项目的整个前端开发流程。\n\nPS：简单说就一个Task Runner\n\n# webpack\n\nwebpack是一个前端模块化方案，更侧重模块打包，我们可以把开发中的所有资源（图片、js文件、css文件等）都看成模块，通过loader（加载器）和plugins（插件）对资源进行处理，打包成符合生产环境部署的前端资源。\nPS：webpack is a module bundle\n\n# 相同功能\n\ngulp与webpack可以实现一些相同功能，如下（列举部分）：\n\n|     功能  | gulp  |  webpack  |\n| ------------- |:-------------:| -----:|\n| 文件合并与压缩（css）| 使用gulp-minify-css模块|样式合并一般用到extract-text-webpack-plugin插件压缩则使用webpack.optimize.UglifyJsPlugin  |\n| 文件合并与压缩（js） |使用gulp-uglify和gulp-concat两个模块| js合并在模块化开始就已经做,压缩则使用webpack.optimize.UglifyJsPlugin \n| sass/less预编译\t| 使用gulp-sass/gulp-less 模块\t| sass-loader/less-loader 进行预处理 \n| 启动server | 使用gulp-webserver模块 | 使用webpack-dev-server模块\n| 版本控制 | 使用gulp-rev和gulp-rev-collector两个模块 | 将生成文件加上hash值 module.exports = {plugins:[new ExtractTextPlugin(style.[hash].css\")}\n\n\n# 两者区别\n* 虽然都是前端自动化构建工具，但看他们的定位就知道不是对等的。\n* gulp严格上讲，模块化不是他强调的东西，他旨在规范前端开发流程。\n* webpack更是明显强调模块化开发，而那些文件压缩合并、预处理等功能，不过是他附带的功能。\n\n# 总结\n* gulp应该与grunt比较，而webpack应该与browserify（网上太多资料就这么说，这么说是没有错，不过单单这样一句话并不能让人清晰明了）。\n* gulp与webpack上是互补的，还是可替换的，取决于你项目的需求。如果只是个vue或react的单页应用，webpack也就够用；如果webpack某些功能使用起来麻烦甚至没有（雪碧图就没有），那就可以结合gulp一起用。","source":"_posts/gulp和webpack区别.md","raw":"---\ntitle: gulp和webpack区别\ndate: 2019-01-29 09:48:44\ncategories: web\ntags:\n    - gulp和webpack区别\ncopyright:\nkeywords:\ndescription:\n---\n{% cq %}我愿化身石桥，受五百年风吹，五百年日晒，五百年雨淋，只求她从桥上经过{% endcq %}\n<!--more-->\n>[原文地址](https://www.cnblogs.com/lovesong/p/6413546.html)\n# gulp\n\ngulp强调的是前端开发的工作流程，我们可以通过配置一系列的task，定义task处理的事务（例如文件压缩合并、雪碧图、启动server、版本控制等），然后定义执行顺序，来让gulp执行这些task，从而构建项目的整个前端开发流程。\n\nPS：简单说就一个Task Runner\n\n# webpack\n\nwebpack是一个前端模块化方案，更侧重模块打包，我们可以把开发中的所有资源（图片、js文件、css文件等）都看成模块，通过loader（加载器）和plugins（插件）对资源进行处理，打包成符合生产环境部署的前端资源。\nPS：webpack is a module bundle\n\n# 相同功能\n\ngulp与webpack可以实现一些相同功能，如下（列举部分）：\n\n|     功能  | gulp  |  webpack  |\n| ------------- |:-------------:| -----:|\n| 文件合并与压缩（css）| 使用gulp-minify-css模块|样式合并一般用到extract-text-webpack-plugin插件压缩则使用webpack.optimize.UglifyJsPlugin  |\n| 文件合并与压缩（js） |使用gulp-uglify和gulp-concat两个模块| js合并在模块化开始就已经做,压缩则使用webpack.optimize.UglifyJsPlugin \n| sass/less预编译\t| 使用gulp-sass/gulp-less 模块\t| sass-loader/less-loader 进行预处理 \n| 启动server | 使用gulp-webserver模块 | 使用webpack-dev-server模块\n| 版本控制 | 使用gulp-rev和gulp-rev-collector两个模块 | 将生成文件加上hash值 module.exports = {plugins:[new ExtractTextPlugin(style.[hash].css\")}\n\n\n# 两者区别\n* 虽然都是前端自动化构建工具，但看他们的定位就知道不是对等的。\n* gulp严格上讲，模块化不是他强调的东西，他旨在规范前端开发流程。\n* webpack更是明显强调模块化开发，而那些文件压缩合并、预处理等功能，不过是他附带的功能。\n\n# 总结\n* gulp应该与grunt比较，而webpack应该与browserify（网上太多资料就这么说，这么说是没有错，不过单单这样一句话并不能让人清晰明了）。\n* gulp与webpack上是互补的，还是可替换的，取决于你项目的需求。如果只是个vue或react的单页应用，webpack也就够用；如果webpack某些功能使用起来麻烦甚至没有（雪碧图就没有），那就可以结合gulp一起用。","slug":"gulp和webpack区别","published":1,"updated":"2026-01-02T00:43:17.572Z","comments":1,"layout":"post","photos":[],"_id":"cmjwbsw63000crotgb68h54zw","content":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>我愿化身石桥，受五百年风吹，五百年日晒，五百年雨淋，只求她从桥上经过</p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n<span id=\"more\"></span>\n<blockquote>\n<p><a href=\"https://www.cnblogs.com/lovesong/p/6413546.html\">原文地址</a></p>\n</blockquote>\n<h1 id=\"gulp\"><a href=\"#gulp\" class=\"headerlink\" title=\"gulp\"></a>gulp</h1><p>gulp强调的是前端开发的工作流程，我们可以通过配置一系列的task，定义task处理的事务（例如文件压缩合并、雪碧图、启动server、版本控制等），然后定义执行顺序，来让gulp执行这些task，从而构建项目的整个前端开发流程。</p>\n<p>PS：简单说就一个Task Runner</p>\n<h1 id=\"webpack\"><a href=\"#webpack\" class=\"headerlink\" title=\"webpack\"></a>webpack</h1><p>webpack是一个前端模块化方案，更侧重模块打包，我们可以把开发中的所有资源（图片、js文件、css文件等）都看成模块，通过loader（加载器）和plugins（插件）对资源进行处理，打包成符合生产环境部署的前端资源。<br>PS：webpack is a module bundle</p>\n<h1 id=\"相同功能\"><a href=\"#相同功能\" class=\"headerlink\" title=\"相同功能\"></a>相同功能</h1><p>gulp与webpack可以实现一些相同功能，如下（列举部分）：</p>\n<table>\n<thead>\n<tr>\n<th>功能</th>\n<th align=\"center\">gulp</th>\n<th align=\"right\">webpack</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>文件合并与压缩（css）</td>\n<td align=\"center\">使用gulp-minify-css模块</td>\n<td align=\"right\">样式合并一般用到extract-text-webpack-plugin插件压缩则使用webpack.optimize.UglifyJsPlugin</td>\n</tr>\n<tr>\n<td>文件合并与压缩（js）</td>\n<td align=\"center\">使用gulp-uglify和gulp-concat两个模块</td>\n<td align=\"right\">js合并在模块化开始就已经做,压缩则使用webpack.optimize.UglifyJsPlugin</td>\n</tr>\n<tr>\n<td>sass&#x2F;less预编译</td>\n<td align=\"center\">使用gulp-sass&#x2F;gulp-less 模块</td>\n<td align=\"right\">sass-loader&#x2F;less-loader 进行预处理</td>\n</tr>\n<tr>\n<td>启动server</td>\n<td align=\"center\">使用gulp-webserver模块</td>\n<td align=\"right\">使用webpack-dev-server模块</td>\n</tr>\n<tr>\n<td>版本控制</td>\n<td align=\"center\">使用gulp-rev和gulp-rev-collector两个模块</td>\n<td align=\"right\">将生成文件加上hash值 module.exports &#x3D; {plugins:[new ExtractTextPlugin(style.[hash].css”)}</td>\n</tr>\n</tbody></table>\n<h1 id=\"两者区别\"><a href=\"#两者区别\" class=\"headerlink\" title=\"两者区别\"></a>两者区别</h1><ul>\n<li>虽然都是前端自动化构建工具，但看他们的定位就知道不是对等的。</li>\n<li>gulp严格上讲，模块化不是他强调的东西，他旨在规范前端开发流程。</li>\n<li>webpack更是明显强调模块化开发，而那些文件压缩合并、预处理等功能，不过是他附带的功能。</li>\n</ul>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><ul>\n<li>gulp应该与grunt比较，而webpack应该与browserify（网上太多资料就这么说，这么说是没有错，不过单单这样一句话并不能让人清晰明了）。</li>\n<li>gulp与webpack上是互补的，还是可替换的，取决于你项目的需求。如果只是个vue或react的单页应用，webpack也就够用；如果webpack某些功能使用起来麻烦甚至没有（雪碧图就没有），那就可以结合gulp一起用。</li>\n</ul>\n","excerpt":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>我愿化身石桥，受五百年风吹，五百年日晒，五百年雨淋，只求她从桥上经过</p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>","more":"<blockquote>\n<p><a href=\"https://www.cnblogs.com/lovesong/p/6413546.html\">原文地址</a></p>\n</blockquote>\n<h1 id=\"gulp\"><a href=\"#gulp\" class=\"headerlink\" title=\"gulp\"></a>gulp</h1><p>gulp强调的是前端开发的工作流程，我们可以通过配置一系列的task，定义task处理的事务（例如文件压缩合并、雪碧图、启动server、版本控制等），然后定义执行顺序，来让gulp执行这些task，从而构建项目的整个前端开发流程。</p>\n<p>PS：简单说就一个Task Runner</p>\n<h1 id=\"webpack\"><a href=\"#webpack\" class=\"headerlink\" title=\"webpack\"></a>webpack</h1><p>webpack是一个前端模块化方案，更侧重模块打包，我们可以把开发中的所有资源（图片、js文件、css文件等）都看成模块，通过loader（加载器）和plugins（插件）对资源进行处理，打包成符合生产环境部署的前端资源。<br>PS：webpack is a module bundle</p>\n<h1 id=\"相同功能\"><a href=\"#相同功能\" class=\"headerlink\" title=\"相同功能\"></a>相同功能</h1><p>gulp与webpack可以实现一些相同功能，如下（列举部分）：</p>\n<table>\n<thead>\n<tr>\n<th>功能</th>\n<th align=\"center\">gulp</th>\n<th align=\"right\">webpack</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>文件合并与压缩（css）</td>\n<td align=\"center\">使用gulp-minify-css模块</td>\n<td align=\"right\">样式合并一般用到extract-text-webpack-plugin插件压缩则使用webpack.optimize.UglifyJsPlugin</td>\n</tr>\n<tr>\n<td>文件合并与压缩（js）</td>\n<td align=\"center\">使用gulp-uglify和gulp-concat两个模块</td>\n<td align=\"right\">js合并在模块化开始就已经做,压缩则使用webpack.optimize.UglifyJsPlugin</td>\n</tr>\n<tr>\n<td>sass&#x2F;less预编译</td>\n<td align=\"center\">使用gulp-sass&#x2F;gulp-less 模块</td>\n<td align=\"right\">sass-loader&#x2F;less-loader 进行预处理</td>\n</tr>\n<tr>\n<td>启动server</td>\n<td align=\"center\">使用gulp-webserver模块</td>\n<td align=\"right\">使用webpack-dev-server模块</td>\n</tr>\n<tr>\n<td>版本控制</td>\n<td align=\"center\">使用gulp-rev和gulp-rev-collector两个模块</td>\n<td align=\"right\">将生成文件加上hash值 module.exports &#x3D; {plugins:[new ExtractTextPlugin(style.[hash].css”)}</td>\n</tr>\n</tbody></table>\n<h1 id=\"两者区别\"><a href=\"#两者区别\" class=\"headerlink\" title=\"两者区别\"></a>两者区别</h1><ul>\n<li>虽然都是前端自动化构建工具，但看他们的定位就知道不是对等的。</li>\n<li>gulp严格上讲，模块化不是他强调的东西，他旨在规范前端开发流程。</li>\n<li>webpack更是明显强调模块化开发，而那些文件压缩合并、预处理等功能，不过是他附带的功能。</li>\n</ul>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><ul>\n<li>gulp应该与grunt比较，而webpack应该与browserify（网上太多资料就这么说，这么说是没有错，不过单单这样一句话并不能让人清晰明了）。</li>\n<li>gulp与webpack上是互补的，还是可替换的，取决于你项目的需求。如果只是个vue或react的单页应用，webpack也就够用；如果webpack某些功能使用起来麻烦甚至没有（雪碧图就没有），那就可以结合gulp一起用。</li>\n</ul>"},{"title":"hexo的基本操作","date":"2019-07-09T08:36:44.000Z","copyright":null,"keywords":null,"description":null,"_content":"{% cq %} 记录一下hexo的基本操作 {% endcq %}\n<!--more-->\n\n> hexo clean => hexo s => 创建 hexo new \"title\"\n\n> hexo clean（清除） => hexo g（生成） => gulp（压缩打包） => hexo d（部署git）","source":"_posts/hexo的基本操作.md","raw":"---\ntitle: hexo的基本操作\ndate: 2019-07-09 16:36:44\ncategories: ['hexo的使用']\ntags:\n    - hexo的基本操作\ncopyright:\nkeywords:\ndescription:\n---\n{% cq %} 记录一下hexo的基本操作 {% endcq %}\n<!--more-->\n\n> hexo clean => hexo s => 创建 hexo new \"title\"\n\n> hexo clean（清除） => hexo g（生成） => gulp（压缩打包） => hexo d（部署git）","slug":"hexo的基本操作","published":1,"updated":"2026-01-02T00:43:17.573Z","comments":1,"layout":"post","photos":[],"_id":"cmjwbsw63000drotg88nucui6","content":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>记录一下hexo的基本操作 </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n<span id=\"more\"></span>\n\n<blockquote>\n<p>hexo clean &#x3D;&gt; hexo s &#x3D;&gt; 创建 hexo new “title”</p>\n</blockquote>\n<blockquote>\n<p>hexo clean（清除） &#x3D;&gt; hexo g（生成） &#x3D;&gt; gulp（压缩打包） &#x3D;&gt; hexo d（部署git）</p>\n</blockquote>\n","excerpt":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>记录一下hexo的基本操作 </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>","more":"<blockquote>\n<p>hexo clean &#x3D;&gt; hexo s &#x3D;&gt; 创建 hexo new “title”</p>\n</blockquote>\n<blockquote>\n<p>hexo clean（清除） &#x3D;&gt; hexo g（生成） &#x3D;&gt; gulp（压缩打包） &#x3D;&gt; hexo d（部署git）</p>\n</blockquote>"},{"title":"js获取事件坐标位置","date":"2019-02-14T09:21:15.000Z","copyright":null,"keywords":null,"description":null,"_content":"{% cq %} 心有猛虎，细嗅蔷薇 {% endcq %}\n<!--more-->\n# 关于scrollTop,offsetTop,scrollLeft,offsetLeft用法介绍\n```javascript\n页可见区域宽： document.body.clientWidth;\n网页可见区域高： document.body.clientHeight;\n网页可见区域宽： document.body.offsetWidth (包括边线的宽);\n网页可见区域高： document.body.offsetHeight (包括边线的宽);\n网页正文全文宽： document.body.scrollWidth;\n网页正文全文高： document.body.scrollHeight;\n网页被卷去的高： document.body.scrollTop;\n网页被卷去的左： document.body.scrollLeft;\n网页正文部分上： window.screenTop;\n网页正文部分左： window.screenLeft;\n屏幕分辨率的高： window.screen.height;\n屏幕分辨率的宽： window.screen.width;\n屏幕可用工作区高度： window.screen.availHeight;\n```\n<img src=\"/img/location.jpeg\">\n\n# 事件\n## 坐标事件\n1.相对于显示屏左上角:e.screenX,e.screenY\n2.相对于文档显示区左上角:e.clientX,e.clientY\n3.相对于div左上角:e.offsetX,e.offsetY\n\n---\n\n## 页面滚动事件\nwindow.onscroll  当页面滚动时触发\n\t\t      获取滚动距离：document.body.scrollTop | |  document.documentElement.scrollTop\n      主动控制页面的滚动位置：\n\t\t\twindow.scrollTo（横向滚动到的位置，纵向滚动到的位置）\n\t\t\twindow.scrollBy(横向滚动的距离，纵向滚动的距离)\n\n# 参考资料\n[搞清clientHeight、offsetHeight、scrollHeight、offsetTop、scrollTop](https://blog.csdn.net/qq_35430000/article/details/80277587)\n","source":"_posts/js获取事件坐标位置.md","raw":"---\ntitle: js获取事件坐标位置\ndate: 2019-02-14 17:21:15\ncategories: web\ntags: \n    - screenX/screenY\n    - clientX/slientY\n    - offsetX/offsetY\n    # - onscroll/scrollTop/scrollTo/scrollBy\ncopyright:\nkeywords:\ndescription:\n---\n{% cq %} 心有猛虎，细嗅蔷薇 {% endcq %}\n<!--more-->\n# 关于scrollTop,offsetTop,scrollLeft,offsetLeft用法介绍\n```javascript\n页可见区域宽： document.body.clientWidth;\n网页可见区域高： document.body.clientHeight;\n网页可见区域宽： document.body.offsetWidth (包括边线的宽);\n网页可见区域高： document.body.offsetHeight (包括边线的宽);\n网页正文全文宽： document.body.scrollWidth;\n网页正文全文高： document.body.scrollHeight;\n网页被卷去的高： document.body.scrollTop;\n网页被卷去的左： document.body.scrollLeft;\n网页正文部分上： window.screenTop;\n网页正文部分左： window.screenLeft;\n屏幕分辨率的高： window.screen.height;\n屏幕分辨率的宽： window.screen.width;\n屏幕可用工作区高度： window.screen.availHeight;\n```\n<img src=\"/img/location.jpeg\">\n\n# 事件\n## 坐标事件\n1.相对于显示屏左上角:e.screenX,e.screenY\n2.相对于文档显示区左上角:e.clientX,e.clientY\n3.相对于div左上角:e.offsetX,e.offsetY\n\n---\n\n## 页面滚动事件\nwindow.onscroll  当页面滚动时触发\n\t\t      获取滚动距离：document.body.scrollTop | |  document.documentElement.scrollTop\n      主动控制页面的滚动位置：\n\t\t\twindow.scrollTo（横向滚动到的位置，纵向滚动到的位置）\n\t\t\twindow.scrollBy(横向滚动的距离，纵向滚动的距离)\n\n# 参考资料\n[搞清clientHeight、offsetHeight、scrollHeight、offsetTop、scrollTop](https://blog.csdn.net/qq_35430000/article/details/80277587)\n","slug":"js获取事件坐标位置","published":1,"updated":"2026-01-02T00:43:17.573Z","comments":1,"layout":"post","photos":[],"_id":"cmjwbsw64000hrotg1hafg5dv","content":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>心有猛虎，细嗅蔷薇 </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n<span id=\"more\"></span>\n<h1 id=\"关于scrollTop-offsetTop-scrollLeft-offsetLeft用法介绍\"><a href=\"#关于scrollTop-offsetTop-scrollLeft-offsetLeft用法介绍\" class=\"headerlink\" title=\"关于scrollTop,offsetTop,scrollLeft,offsetLeft用法介绍\"></a>关于scrollTop,offsetTop,scrollLeft,offsetLeft用法介绍</h1><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">页可见区域宽： <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"property\">clientWidth</span>;</span><br><span class=\"line\">网页可见区域高： <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"property\">clientHeight</span>;</span><br><span class=\"line\">网页可见区域宽： <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"property\">offsetWidth</span> (包括边线的宽);</span><br><span class=\"line\">网页可见区域高： <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"property\">offsetHeight</span> (包括边线的宽);</span><br><span class=\"line\">网页正文全文宽： <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"property\">scrollWidth</span>;</span><br><span class=\"line\">网页正文全文高： <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"property\">scrollHeight</span>;</span><br><span class=\"line\">网页被卷去的高： <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"property\">scrollTop</span>;</span><br><span class=\"line\">网页被卷去的左： <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"property\">scrollLeft</span>;</span><br><span class=\"line\">网页正文部分上： <span class=\"variable language_\">window</span>.<span class=\"property\">screenTop</span>;</span><br><span class=\"line\">网页正文部分左： <span class=\"variable language_\">window</span>.<span class=\"property\">screenLeft</span>;</span><br><span class=\"line\">屏幕分辨率的高： <span class=\"variable language_\">window</span>.<span class=\"property\">screen</span>.<span class=\"property\">height</span>;</span><br><span class=\"line\">屏幕分辨率的宽： <span class=\"variable language_\">window</span>.<span class=\"property\">screen</span>.<span class=\"property\">width</span>;</span><br><span class=\"line\">屏幕可用工作区高度： <span class=\"variable language_\">window</span>.<span class=\"property\">screen</span>.<span class=\"property\">availHeight</span>;</span><br></pre></td></tr></table></figure>\n<img src=\"/img/location.jpeg\">\n\n<h1 id=\"事件\"><a href=\"#事件\" class=\"headerlink\" title=\"事件\"></a>事件</h1><h2 id=\"坐标事件\"><a href=\"#坐标事件\" class=\"headerlink\" title=\"坐标事件\"></a>坐标事件</h2><p>1.相对于显示屏左上角:e.screenX,e.screenY<br>2.相对于文档显示区左上角:e.clientX,e.clientY<br>3.相对于div左上角:e.offsetX,e.offsetY</p>\n<hr>\n<h2 id=\"页面滚动事件\"><a href=\"#页面滚动事件\" class=\"headerlink\" title=\"页面滚动事件\"></a>页面滚动事件</h2><p>window.onscroll  当页面滚动时触发<br>              获取滚动距离：document.body.scrollTop | |  document.documentElement.scrollTop<br>      主动控制页面的滚动位置：<br>            window.scrollTo（横向滚动到的位置，纵向滚动到的位置）<br>            window.scrollBy(横向滚动的距离，纵向滚动的距离)</p>\n<h1 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h1><p><a href=\"https://blog.csdn.net/qq_35430000/article/details/80277587\">搞清clientHeight、offsetHeight、scrollHeight、offsetTop、scrollTop</a></p>\n","excerpt":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>心有猛虎，细嗅蔷薇 </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>","more":"<h1 id=\"关于scrollTop-offsetTop-scrollLeft-offsetLeft用法介绍\"><a href=\"#关于scrollTop-offsetTop-scrollLeft-offsetLeft用法介绍\" class=\"headerlink\" title=\"关于scrollTop,offsetTop,scrollLeft,offsetLeft用法介绍\"></a>关于scrollTop,offsetTop,scrollLeft,offsetLeft用法介绍</h1><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">页可见区域宽： <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"property\">clientWidth</span>;</span><br><span class=\"line\">网页可见区域高： <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"property\">clientHeight</span>;</span><br><span class=\"line\">网页可见区域宽： <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"property\">offsetWidth</span> (包括边线的宽);</span><br><span class=\"line\">网页可见区域高： <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"property\">offsetHeight</span> (包括边线的宽);</span><br><span class=\"line\">网页正文全文宽： <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"property\">scrollWidth</span>;</span><br><span class=\"line\">网页正文全文高： <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"property\">scrollHeight</span>;</span><br><span class=\"line\">网页被卷去的高： <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"property\">scrollTop</span>;</span><br><span class=\"line\">网页被卷去的左： <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"property\">scrollLeft</span>;</span><br><span class=\"line\">网页正文部分上： <span class=\"variable language_\">window</span>.<span class=\"property\">screenTop</span>;</span><br><span class=\"line\">网页正文部分左： <span class=\"variable language_\">window</span>.<span class=\"property\">screenLeft</span>;</span><br><span class=\"line\">屏幕分辨率的高： <span class=\"variable language_\">window</span>.<span class=\"property\">screen</span>.<span class=\"property\">height</span>;</span><br><span class=\"line\">屏幕分辨率的宽： <span class=\"variable language_\">window</span>.<span class=\"property\">screen</span>.<span class=\"property\">width</span>;</span><br><span class=\"line\">屏幕可用工作区高度： <span class=\"variable language_\">window</span>.<span class=\"property\">screen</span>.<span class=\"property\">availHeight</span>;</span><br></pre></td></tr></table></figure>\n<img src=\"/img/location.jpeg\">\n\n<h1 id=\"事件\"><a href=\"#事件\" class=\"headerlink\" title=\"事件\"></a>事件</h1><h2 id=\"坐标事件\"><a href=\"#坐标事件\" class=\"headerlink\" title=\"坐标事件\"></a>坐标事件</h2><p>1.相对于显示屏左上角:e.screenX,e.screenY<br>2.相对于文档显示区左上角:e.clientX,e.clientY<br>3.相对于div左上角:e.offsetX,e.offsetY</p>\n<hr>\n<h2 id=\"页面滚动事件\"><a href=\"#页面滚动事件\" class=\"headerlink\" title=\"页面滚动事件\"></a>页面滚动事件</h2><p>window.onscroll  当页面滚动时触发<br>              获取滚动距离：document.body.scrollTop | |  document.documentElement.scrollTop<br>      主动控制页面的滚动位置：<br>            window.scrollTo（横向滚动到的位置，纵向滚动到的位置）<br>            window.scrollBy(横向滚动的距离，纵向滚动的距离)</p>\n<h1 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h1><p><a href=\"https://blog.csdn.net/qq_35430000/article/details/80277587\">搞清clientHeight、offsetHeight、scrollHeight、offsetTop、scrollTop</a></p>"},{"title":"Vuejs源码解析","date":"2019-01-31T08:40:13.000Z","copyright":null,"keywords":null,"description":null,"_content":"{% cq %} 除了使用vue工具，更想揭开神秘面纱,开始一场神秘之旅吧 {% endcq %}\n<!--more-->\n[vue.js源码地址](https://github.com/vuejs/vue/blob/dev/src/core/instance/index.js)\n# 看后感觉内容不错的参考资料\n1.[Vue技术内幕](http://hcysun.me/vue-design/art/2vue-constructor.html)\n# 从一个简单的example开始\n```javascript\n    <div id=\"app\">{{test}}</div>\n\n    var vm = new Vue({\n    el: '#app',\n    data: {\n            test: 1\n        }\n    })\n    ```\n这段代码简单调用了*Vue*，传递了两个选项 *el* 和 *data*,这段代码在页面呈现的DOM如下:\n```javascript\n    <div id=\"app\">1<div>\n```\n## 接下来我们看看上面的例子到底发生了什么？\n首先当我们使用Vue构造函数的时候，第一句执行的代码到底是什么，所以我们找到Vue的构造函数，Vue的构造函数在*core/instance/index.js*\n    ```javascript\n    function Vue (options) {\n        if (process.env.NODE_ENV !== 'production' &&\n            !(this instanceof Vue)\n        ) {\n            warn('Vue is a constructor and should be called with the `new` keyword')\n        }\n        this._init(options)\n    }\n    ```\n上面的代码一目了然，当new Vue构造函数时，执行的第一句代码时this._init(options)方法，options参数内容是我们调用Vue构造函数传入的\n    ```javascript\n    options = {\n        el:'#app',\n        data:{\n            test:1\n        }\n    }\n    ```\n既然如此我们就找到 *_init方法*，_init 方法在 src/core/instance/init.js 文件被添加到 Vue 的原型上，下面我们就看看 _init 做了什么。\n_init 方法的一开始，是这两句代码：\n```javascript\n    const vm: Component = this\n    // a uid\n    vm._uid = uid++\n```\n首先声明了一个常量vm，并且在vm上添加了一个属性 *_uid*，uid的初始值是0每次实例化一个 Vue 实例之后，uid 的值都会 ++。\n\n## 接下去的代码如下\n```javascript\n    let startTag, endTag\n    /* istanbul ignore if */\n    if (process.env.NODE_ENV !== 'production' && config.performance && mark) {\n      startTag = `vue-perf-start:${vm._uid}`\n      endTag = `vue-perf-end:${vm._uid}`\n      mark(startTag)\n    }\n```\n首先声明了startTag, endTag这两个参数(parameter)，其中if括号中的意思是：在非生产环境下，并且config.performance和mark都为真，才执行里面的代码，其中 config.performance 来自于 core/config.js 文件，我们知道，Vue.config 同样引用了这个对象，在 Vue 的官方文档中可以看到如下内容：\n**Vue 提供了全局配置 Vue.config.performance，我们通过将其设置为 true，即可开启性能追踪**\n## 你可以追踪四个场景的性能\n1、组件初始化(component init)\n2、编译(compile)，将模板(template)编译成渲染函数\n3、渲染(render)，其实就是渲染函数的性能，或者说渲染函数执行且生成虚拟DOM(vnode)的性能\n4、打补丁(patch)，将虚拟DOM渲染为真实DOM的性能\n\n","source":"_posts/Vuejs源码解析.md","raw":"---\ntitle: Vuejs源码解析\ndate: 2019-01-31 16:40:13\ncategories:\ntags:\ncopyright:\nkeywords:\ndescription:\n---\n{% cq %} 除了使用vue工具，更想揭开神秘面纱,开始一场神秘之旅吧 {% endcq %}\n<!--more-->\n[vue.js源码地址](https://github.com/vuejs/vue/blob/dev/src/core/instance/index.js)\n# 看后感觉内容不错的参考资料\n1.[Vue技术内幕](http://hcysun.me/vue-design/art/2vue-constructor.html)\n# 从一个简单的example开始\n```javascript\n    <div id=\"app\">{{test}}</div>\n\n    var vm = new Vue({\n    el: '#app',\n    data: {\n            test: 1\n        }\n    })\n    ```\n这段代码简单调用了*Vue*，传递了两个选项 *el* 和 *data*,这段代码在页面呈现的DOM如下:\n```javascript\n    <div id=\"app\">1<div>\n```\n## 接下来我们看看上面的例子到底发生了什么？\n首先当我们使用Vue构造函数的时候，第一句执行的代码到底是什么，所以我们找到Vue的构造函数，Vue的构造函数在*core/instance/index.js*\n    ```javascript\n    function Vue (options) {\n        if (process.env.NODE_ENV !== 'production' &&\n            !(this instanceof Vue)\n        ) {\n            warn('Vue is a constructor and should be called with the `new` keyword')\n        }\n        this._init(options)\n    }\n    ```\n上面的代码一目了然，当new Vue构造函数时，执行的第一句代码时this._init(options)方法，options参数内容是我们调用Vue构造函数传入的\n    ```javascript\n    options = {\n        el:'#app',\n        data:{\n            test:1\n        }\n    }\n    ```\n既然如此我们就找到 *_init方法*，_init 方法在 src/core/instance/init.js 文件被添加到 Vue 的原型上，下面我们就看看 _init 做了什么。\n_init 方法的一开始，是这两句代码：\n```javascript\n    const vm: Component = this\n    // a uid\n    vm._uid = uid++\n```\n首先声明了一个常量vm，并且在vm上添加了一个属性 *_uid*，uid的初始值是0每次实例化一个 Vue 实例之后，uid 的值都会 ++。\n\n## 接下去的代码如下\n```javascript\n    let startTag, endTag\n    /* istanbul ignore if */\n    if (process.env.NODE_ENV !== 'production' && config.performance && mark) {\n      startTag = `vue-perf-start:${vm._uid}`\n      endTag = `vue-perf-end:${vm._uid}`\n      mark(startTag)\n    }\n```\n首先声明了startTag, endTag这两个参数(parameter)，其中if括号中的意思是：在非生产环境下，并且config.performance和mark都为真，才执行里面的代码，其中 config.performance 来自于 core/config.js 文件，我们知道，Vue.config 同样引用了这个对象，在 Vue 的官方文档中可以看到如下内容：\n**Vue 提供了全局配置 Vue.config.performance，我们通过将其设置为 true，即可开启性能追踪**\n## 你可以追踪四个场景的性能\n1、组件初始化(component init)\n2、编译(compile)，将模板(template)编译成渲染函数\n3、渲染(render)，其实就是渲染函数的性能，或者说渲染函数执行且生成虚拟DOM(vnode)的性能\n4、打补丁(patch)，将虚拟DOM渲染为真实DOM的性能\n\n","slug":"Vuejs源码解析","published":1,"updated":"2026-01-02T00:43:17.572Z","comments":1,"layout":"post","photos":[],"_id":"cmjwbsw64000krotg04sbf1po","content":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>除了使用vue工具，更想揭开神秘面纱,开始一场神秘之旅吧 </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n<span id=\"more\"></span>\n<p><a href=\"https://github.com/vuejs/vue/blob/dev/src/core/instance/index.js\">vue.js源码地址</a></p>\n<h1 id=\"看后感觉内容不错的参考资料\"><a href=\"#看后感觉内容不错的参考资料\" class=\"headerlink\" title=\"看后感觉内容不错的参考资料\"></a>看后感觉内容不错的参考资料</h1><p>1.<a href=\"http://hcysun.me/vue-design/art/2vue-constructor.html\">Vue技术内幕</a></p>\n<h1 id=\"从一个简单的example开始\"><a href=\"#从一个简单的example开始\" class=\"headerlink\" title=\"从一个简单的example开始\"></a>从一个简单的example开始</h1><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div id=<span class=\"string\">&quot;app&quot;</span>&gt;&#123;&#123;test&#125;&#125;&lt;/div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> vm = <span class=\"keyword\">new</span> <span class=\"title class_\">Vue</span>(&#123;</span><br><span class=\"line\"><span class=\"attr\">el</span>: <span class=\"string\">&#x27;#app&#x27;</span>,</span><br><span class=\"line\"><span class=\"attr\">data</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">test</span>: <span class=\"number\">1</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>这段代码简单调用了<em>Vue</em>，传递了两个选项 <em>el</em> 和 <em>data</em>,这段代码在页面呈现的DOM如下:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div id=<span class=\"string\">&quot;app&quot;</span>&gt;<span class=\"number\">1</span>&lt;div&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"接下来我们看看上面的例子到底发生了什么？\"><a href=\"#接下来我们看看上面的例子到底发生了什么？\" class=\"headerlink\" title=\"接下来我们看看上面的例子到底发生了什么？\"></a>接下来我们看看上面的例子到底发生了什么？</h2><p>首先当我们使用Vue构造函数的时候，第一句执行的代码到底是什么，所以我们找到Vue的构造函数，Vue的构造函数在<em>core&#x2F;instance&#x2F;index.js</em><br>    <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">Vue</span> (<span class=\"params\">options</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (process.<span class=\"property\">env</span>.<span class=\"property\">NODE_ENV</span> !== <span class=\"string\">&#x27;production&#x27;</span> &amp;&amp;</span><br><span class=\"line\">        !(<span class=\"variable language_\">this</span> <span class=\"keyword\">instanceof</span> <span class=\"title class_\">Vue</span>)</span><br><span class=\"line\">    ) &#123;</span><br><span class=\"line\">        <span class=\"title function_\">warn</span>(<span class=\"string\">&#x27;Vue is a constructor and should be called with the `new` keyword&#x27;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">_init</span>(options)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br>上面的代码一目了然，当new Vue构造函数时，执行的第一句代码时this._init(options)方法，options参数内容是我们调用Vue构造函数传入的<br>    <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">options = &#123;</span><br><span class=\"line\">    <span class=\"attr\">el</span>:<span class=\"string\">&#x27;#app&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">data</span>:&#123;</span><br><span class=\"line\">        <span class=\"attr\">test</span>:<span class=\"number\">1</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br>既然如此我们就找到 <em>_init方法</em>，_init 方法在 src&#x2F;core&#x2F;instance&#x2F;init.js 文件被添加到 Vue 的原型上，下面我们就看看 _init 做了什么。<br>_init 方法的一开始，是这两句代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">vm</span>: <span class=\"title class_\">Component</span> = <span class=\"variable language_\">this</span></span><br><span class=\"line\"><span class=\"comment\">// a uid</span></span><br><span class=\"line\">vm.<span class=\"property\">_uid</span> = uid++</span><br></pre></td></tr></table></figure>\n<p>首先声明了一个常量vm，并且在vm上添加了一个属性 <em>_uid</em>，uid的初始值是0每次实例化一个 Vue 实例之后，uid 的值都会 ++。</p>\n<h2 id=\"接下去的代码如下\"><a href=\"#接下去的代码如下\" class=\"headerlink\" title=\"接下去的代码如下\"></a>接下去的代码如下</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> startTag, endTag</span><br><span class=\"line\"><span class=\"comment\">/* istanbul ignore if */</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (process.<span class=\"property\">env</span>.<span class=\"property\">NODE_ENV</span> !== <span class=\"string\">&#x27;production&#x27;</span> &amp;&amp; config.<span class=\"property\">performance</span> &amp;&amp; mark) &#123;</span><br><span class=\"line\">  startTag = <span class=\"string\">`vue-perf-start:<span class=\"subst\">$&#123;vm._uid&#125;</span>`</span></span><br><span class=\"line\">  endTag = <span class=\"string\">`vue-perf-end:<span class=\"subst\">$&#123;vm._uid&#125;</span>`</span></span><br><span class=\"line\">  <span class=\"title function_\">mark</span>(startTag)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>首先声明了startTag, endTag这两个参数(parameter)，其中if括号中的意思是：在非生产环境下，并且config.performance和mark都为真，才执行里面的代码，其中 config.performance 来自于 core&#x2F;config.js 文件，我们知道，Vue.config 同样引用了这个对象，在 Vue 的官方文档中可以看到如下内容：<br><strong>Vue 提供了全局配置 Vue.config.performance，我们通过将其设置为 true，即可开启性能追踪</strong></p>\n<h2 id=\"你可以追踪四个场景的性能\"><a href=\"#你可以追踪四个场景的性能\" class=\"headerlink\" title=\"你可以追踪四个场景的性能\"></a>你可以追踪四个场景的性能</h2><p>1、组件初始化(component init)<br>2、编译(compile)，将模板(template)编译成渲染函数<br>3、渲染(render)，其实就是渲染函数的性能，或者说渲染函数执行且生成虚拟DOM(vnode)的性能<br>4、打补丁(patch)，将虚拟DOM渲染为真实DOM的性能</p>\n","excerpt":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>除了使用vue工具，更想揭开神秘面纱,开始一场神秘之旅吧 </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>","more":"<p><a href=\"https://github.com/vuejs/vue/blob/dev/src/core/instance/index.js\">vue.js源码地址</a></p>\n<h1 id=\"看后感觉内容不错的参考资料\"><a href=\"#看后感觉内容不错的参考资料\" class=\"headerlink\" title=\"看后感觉内容不错的参考资料\"></a>看后感觉内容不错的参考资料</h1><p>1.<a href=\"http://hcysun.me/vue-design/art/2vue-constructor.html\">Vue技术内幕</a></p>\n<h1 id=\"从一个简单的example开始\"><a href=\"#从一个简单的example开始\" class=\"headerlink\" title=\"从一个简单的example开始\"></a>从一个简单的example开始</h1><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div id=<span class=\"string\">&quot;app&quot;</span>&gt;&#123;&#123;test&#125;&#125;&lt;/div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> vm = <span class=\"keyword\">new</span> <span class=\"title class_\">Vue</span>(&#123;</span><br><span class=\"line\"><span class=\"attr\">el</span>: <span class=\"string\">&#x27;#app&#x27;</span>,</span><br><span class=\"line\"><span class=\"attr\">data</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">test</span>: <span class=\"number\">1</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>这段代码简单调用了<em>Vue</em>，传递了两个选项 <em>el</em> 和 <em>data</em>,这段代码在页面呈现的DOM如下:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div id=<span class=\"string\">&quot;app&quot;</span>&gt;<span class=\"number\">1</span>&lt;div&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"接下来我们看看上面的例子到底发生了什么？\"><a href=\"#接下来我们看看上面的例子到底发生了什么？\" class=\"headerlink\" title=\"接下来我们看看上面的例子到底发生了什么？\"></a>接下来我们看看上面的例子到底发生了什么？</h2><p>首先当我们使用Vue构造函数的时候，第一句执行的代码到底是什么，所以我们找到Vue的构造函数，Vue的构造函数在<em>core&#x2F;instance&#x2F;index.js</em><br>    <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">Vue</span> (<span class=\"params\">options</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (process.<span class=\"property\">env</span>.<span class=\"property\">NODE_ENV</span> !== <span class=\"string\">&#x27;production&#x27;</span> &amp;&amp;</span><br><span class=\"line\">        !(<span class=\"variable language_\">this</span> <span class=\"keyword\">instanceof</span> <span class=\"title class_\">Vue</span>)</span><br><span class=\"line\">    ) &#123;</span><br><span class=\"line\">        <span class=\"title function_\">warn</span>(<span class=\"string\">&#x27;Vue is a constructor and should be called with the `new` keyword&#x27;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">_init</span>(options)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br>上面的代码一目了然，当new Vue构造函数时，执行的第一句代码时this._init(options)方法，options参数内容是我们调用Vue构造函数传入的<br>    <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">options = &#123;</span><br><span class=\"line\">    <span class=\"attr\">el</span>:<span class=\"string\">&#x27;#app&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">data</span>:&#123;</span><br><span class=\"line\">        <span class=\"attr\">test</span>:<span class=\"number\">1</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br>既然如此我们就找到 <em>_init方法</em>，_init 方法在 src&#x2F;core&#x2F;instance&#x2F;init.js 文件被添加到 Vue 的原型上，下面我们就看看 _init 做了什么。<br>_init 方法的一开始，是这两句代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">vm</span>: <span class=\"title class_\">Component</span> = <span class=\"variable language_\">this</span></span><br><span class=\"line\"><span class=\"comment\">// a uid</span></span><br><span class=\"line\">vm.<span class=\"property\">_uid</span> = uid++</span><br></pre></td></tr></table></figure>\n<p>首先声明了一个常量vm，并且在vm上添加了一个属性 <em>_uid</em>，uid的初始值是0每次实例化一个 Vue 实例之后，uid 的值都会 ++。</p>\n<h2 id=\"接下去的代码如下\"><a href=\"#接下去的代码如下\" class=\"headerlink\" title=\"接下去的代码如下\"></a>接下去的代码如下</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> startTag, endTag</span><br><span class=\"line\"><span class=\"comment\">/* istanbul ignore if */</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (process.<span class=\"property\">env</span>.<span class=\"property\">NODE_ENV</span> !== <span class=\"string\">&#x27;production&#x27;</span> &amp;&amp; config.<span class=\"property\">performance</span> &amp;&amp; mark) &#123;</span><br><span class=\"line\">  startTag = <span class=\"string\">`vue-perf-start:<span class=\"subst\">$&#123;vm._uid&#125;</span>`</span></span><br><span class=\"line\">  endTag = <span class=\"string\">`vue-perf-end:<span class=\"subst\">$&#123;vm._uid&#125;</span>`</span></span><br><span class=\"line\">  <span class=\"title function_\">mark</span>(startTag)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>首先声明了startTag, endTag这两个参数(parameter)，其中if括号中的意思是：在非生产环境下，并且config.performance和mark都为真，才执行里面的代码，其中 config.performance 来自于 core&#x2F;config.js 文件，我们知道，Vue.config 同样引用了这个对象，在 Vue 的官方文档中可以看到如下内容：<br><strong>Vue 提供了全局配置 Vue.config.performance，我们通过将其设置为 true，即可开启性能追踪</strong></p>\n<h2 id=\"你可以追踪四个场景的性能\"><a href=\"#你可以追踪四个场景的性能\" class=\"headerlink\" title=\"你可以追踪四个场景的性能\"></a>你可以追踪四个场景的性能</h2><p>1、组件初始化(component init)<br>2、编译(compile)，将模板(template)编译成渲染函数<br>3、渲染(render)，其实就是渲染函数的性能，或者说渲染函数执行且生成虚拟DOM(vnode)的性能<br>4、打补丁(patch)，将虚拟DOM渲染为真实DOM的性能</p>"},{"title":"使用github和hexo搭建个人博客","date":"2019-01-24T06:16:00.000Z","copyright":true,"_content":"\n{% cq %} 所谓博客，都是孤芳自赏 {% endcq %}\n\n现在越来越多的人喜欢利用Github搭建静态网站，原因不外乎简单省钱。本人也利用hexo+github搭建了本博客，用于分享一些心得。在此过程中，折腾博客的各种配置以及功能占具了我一部分时间，在此详细记录下我是如何利用hexo+github搭建静态博客以及一些配置相关问题，以免过后遗忘，且当备份之用。\n<!--more-->\n# 准备工作\n\n 下载node.js并安装（官网下载安装），默认会安装npm。\n 下载安装git（官网下载安装）\n 下载安装hexo。方法：打开cmd 运行npm install -g hexo\n\n# 本地搭建hexo静态博客\n\n 新建一个文件夹，如MyBlog\n 进入该文件夹内，右击运行git，输入：hexo init（生成hexo模板，可能要翻墙）\n 生成完模板，运行npm install（目前貌似不用运行这一步）\n 最后运行：hexo server （运行程序，访问本地+localhost:4000可以看到博客已经搭建成功）\n\n# 站内搜索配置\n\n首先安装hexo-generator-searchdb插件\n> npm install hexo-generator-searchdb --save\n\n编辑博客根目录下的博客本地目录/_config.yml站点配置文件，新增以下内容到任意位置，search顶格放否则可能没效果：\n\n    search:\n      path: search.xml\n      field: post\n      format: html\n      limit: 10000\n\n编辑博客本地目录/themes/next/_config.yml 主题配置文件，启用本地搜索功能,将local_search:下面的enable:的值，改成true\n可以输入以下命令，先清理缓存，然后本地部署调试\n>hexo clean \nhexo s\n\n## 搜索无效、一直loading的问题\n按F12可以查看请求命令的状态，状态码200表示请求成功。但是搜索动画还是一直在转。\n1.文章中包含特殊字符，文件编码时出错\n<img src=\"/img/Garbled.png\">\n\n# 部署github\nMyBlog文件夹安装 npm install --save hexo-deployer-git\n 找到 *_config.yml*文件修改一下文件\ndeploy:\ntype: git\nrepo: https://github.com/Honey608/Honey608.github.io.git\nbranch: master\n<img style=\"width:600px;height:200px\" src=\"/img/urlimg.png\" class=\"full-image\" /> 最后运行hexo clean(清除) hexo g(生成) hexo d(部署)\n点击查看效果: https://zhanghuaxiao.github.io/\n<img style=\"width:600px;height:200px\" src=\"/img/github-pages.png\" class=\"full-image\">\n# 使用nexT主题\n 安装 [git clone](https://github.com/iissnan/hexo-theme-next themes/next) \n 修改_config.yml文件中 theme:next\n 运行\n >hexo clean \n hexo s\n# hexo和nexT中文网\n\n [hexo中文网](https://hexo.io/zh-cn/docs/helpers)\n [nexT中文官网](http://theme-next.iissnan.com/getting-started.html)\n\n# nexT主题参考文章\n\n [对nexT主题设置](https://segmentfault.com/a/1190000009544924#articleHeader2)\n [seo优化](https://www.jianshu.com/p/86557c34b671)\n [Hexo博客Next主题站内搜索模块相关，解决搜索无效、一直loading的问题](https://www.jianshu.com/p/02afabcae502)","source":"_posts/posts.md","raw":"---\ntitle: 使用github和hexo搭建个人博客\ndate: 2019-1-24 14:16\ncategories:\t['hexo的使用']\ntags: \n  - hexo\n  - nexT\n  - 搭建自己博客\n  - 解决next主题搜索loadding问题\ncopyright: true\n---\n\n{% cq %} 所谓博客，都是孤芳自赏 {% endcq %}\n\n现在越来越多的人喜欢利用Github搭建静态网站，原因不外乎简单省钱。本人也利用hexo+github搭建了本博客，用于分享一些心得。在此过程中，折腾博客的各种配置以及功能占具了我一部分时间，在此详细记录下我是如何利用hexo+github搭建静态博客以及一些配置相关问题，以免过后遗忘，且当备份之用。\n<!--more-->\n# 准备工作\n\n 下载node.js并安装（官网下载安装），默认会安装npm。\n 下载安装git（官网下载安装）\n 下载安装hexo。方法：打开cmd 运行npm install -g hexo\n\n# 本地搭建hexo静态博客\n\n 新建一个文件夹，如MyBlog\n 进入该文件夹内，右击运行git，输入：hexo init（生成hexo模板，可能要翻墙）\n 生成完模板，运行npm install（目前貌似不用运行这一步）\n 最后运行：hexo server （运行程序，访问本地+localhost:4000可以看到博客已经搭建成功）\n\n# 站内搜索配置\n\n首先安装hexo-generator-searchdb插件\n> npm install hexo-generator-searchdb --save\n\n编辑博客根目录下的博客本地目录/_config.yml站点配置文件，新增以下内容到任意位置，search顶格放否则可能没效果：\n\n    search:\n      path: search.xml\n      field: post\n      format: html\n      limit: 10000\n\n编辑博客本地目录/themes/next/_config.yml 主题配置文件，启用本地搜索功能,将local_search:下面的enable:的值，改成true\n可以输入以下命令，先清理缓存，然后本地部署调试\n>hexo clean \nhexo s\n\n## 搜索无效、一直loading的问题\n按F12可以查看请求命令的状态，状态码200表示请求成功。但是搜索动画还是一直在转。\n1.文章中包含特殊字符，文件编码时出错\n<img src=\"/img/Garbled.png\">\n\n# 部署github\nMyBlog文件夹安装 npm install --save hexo-deployer-git\n 找到 *_config.yml*文件修改一下文件\ndeploy:\ntype: git\nrepo: https://github.com/Honey608/Honey608.github.io.git\nbranch: master\n<img style=\"width:600px;height:200px\" src=\"/img/urlimg.png\" class=\"full-image\" /> 最后运行hexo clean(清除) hexo g(生成) hexo d(部署)\n点击查看效果: https://zhanghuaxiao.github.io/\n<img style=\"width:600px;height:200px\" src=\"/img/github-pages.png\" class=\"full-image\">\n# 使用nexT主题\n 安装 [git clone](https://github.com/iissnan/hexo-theme-next themes/next) \n 修改_config.yml文件中 theme:next\n 运行\n >hexo clean \n hexo s\n# hexo和nexT中文网\n\n [hexo中文网](https://hexo.io/zh-cn/docs/helpers)\n [nexT中文官网](http://theme-next.iissnan.com/getting-started.html)\n\n# nexT主题参考文章\n\n [对nexT主题设置](https://segmentfault.com/a/1190000009544924#articleHeader2)\n [seo优化](https://www.jianshu.com/p/86557c34b671)\n [Hexo博客Next主题站内搜索模块相关，解决搜索无效、一直loading的问题](https://www.jianshu.com/p/02afabcae502)","slug":"posts","published":1,"updated":"2026-01-02T00:43:17.574Z","comments":1,"layout":"post","photos":[],"_id":"cmjwbsw65000orotg127pbvkx","content":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>所谓博客，都是孤芳自赏 </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n\n<p>现在越来越多的人喜欢利用Github搭建静态网站，原因不外乎简单省钱。本人也利用hexo+github搭建了本博客，用于分享一些心得。在此过程中，折腾博客的各种配置以及功能占具了我一部分时间，在此详细记录下我是如何利用hexo+github搭建静态博客以及一些配置相关问题，以免过后遗忘，且当备份之用。</p>\n<span id=\"more\"></span>\n<h1 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h1><p> 下载node.js并安装（官网下载安装），默认会安装npm。<br> 下载安装git（官网下载安装）<br> 下载安装hexo。方法：打开cmd 运行npm install -g hexo</p>\n<h1 id=\"本地搭建hexo静态博客\"><a href=\"#本地搭建hexo静态博客\" class=\"headerlink\" title=\"本地搭建hexo静态博客\"></a>本地搭建hexo静态博客</h1><p> 新建一个文件夹，如MyBlog<br> 进入该文件夹内，右击运行git，输入：hexo init（生成hexo模板，可能要翻墙）<br> 生成完模板，运行npm install（目前貌似不用运行这一步）<br> 最后运行：hexo server （运行程序，访问本地+localhost:4000可以看到博客已经搭建成功）</p>\n<h1 id=\"站内搜索配置\"><a href=\"#站内搜索配置\" class=\"headerlink\" title=\"站内搜索配置\"></a>站内搜索配置</h1><p>首先安装hexo-generator-searchdb插件</p>\n<blockquote>\n<p>npm install hexo-generator-searchdb –save</p>\n</blockquote>\n<p>编辑博客根目录下的博客本地目录&#x2F;_config.yml站点配置文件，新增以下内容到任意位置，search顶格放否则可能没效果：</p>\n<pre><code>search:\n  path: search.xml\n  field: post\n  format: html\n  limit: 10000\n</code></pre>\n<p>编辑博客本地目录&#x2F;themes&#x2F;next&#x2F;_config.yml 主题配置文件，启用本地搜索功能,将local_search:下面的enable:的值，改成true<br>可以输入以下命令，先清理缓存，然后本地部署调试</p>\n<blockquote>\n<p>hexo clean<br>hexo s</p>\n</blockquote>\n<h2 id=\"搜索无效、一直loading的问题\"><a href=\"#搜索无效、一直loading的问题\" class=\"headerlink\" title=\"搜索无效、一直loading的问题\"></a>搜索无效、一直loading的问题</h2><p>按F12可以查看请求命令的状态，状态码200表示请求成功。但是搜索动画还是一直在转。<br>1.文章中包含特殊字符，文件编码时出错<br><img src=\"/img/Garbled.png\"></p>\n<h1 id=\"部署github\"><a href=\"#部署github\" class=\"headerlink\" title=\"部署github\"></a>部署github</h1><p>MyBlog文件夹安装 npm install –save hexo-deployer-git<br> 找到 <em>_config.yml</em>文件修改一下文件<br>deploy:<br>type: git<br>repo: <a href=\"https://github.com/Honey608/Honey608.github.io.git\">https://github.com/Honey608/Honey608.github.io.git</a><br>branch: master<br><img style=\"width:600px;height:200px\" src=\"/img/urlimg.png\" class=\"full-image\" /> 最后运行hexo clean(清除) hexo g(生成) hexo d(部署)<br>点击查看效果: <a href=\"https://zhanghuaxiao.github.io/\">https://zhanghuaxiao.github.io/</a><br><img style=\"width:600px;height:200px\" src=\"/img/github-pages.png\" class=\"full-image\"></p>\n<h1 id=\"使用nexT主题\"><a href=\"#使用nexT主题\" class=\"headerlink\" title=\"使用nexT主题\"></a>使用nexT主题</h1><p> 安装 [git clone](<a href=\"https://github.com/iissnan/hexo-theme-next\">https://github.com/iissnan/hexo-theme-next</a> themes&#x2F;next)<br> 修改_config.yml文件中 theme:next<br> 运行</p>\n<blockquote>\n<p>hexo clean<br> hexo s</p>\n</blockquote>\n<h1 id=\"hexo和nexT中文网\"><a href=\"#hexo和nexT中文网\" class=\"headerlink\" title=\"hexo和nexT中文网\"></a>hexo和nexT中文网</h1><p> <a href=\"https://hexo.io/zh-cn/docs/helpers\">hexo中文网</a><br> <a href=\"http://theme-next.iissnan.com/getting-started.html\">nexT中文官网</a></p>\n<h1 id=\"nexT主题参考文章\"><a href=\"#nexT主题参考文章\" class=\"headerlink\" title=\"nexT主题参考文章\"></a>nexT主题参考文章</h1><p> <a href=\"https://segmentfault.com/a/1190000009544924#articleHeader2\">对nexT主题设置</a><br> <a href=\"https://www.jianshu.com/p/86557c34b671\">seo优化</a><br> <a href=\"https://www.jianshu.com/p/02afabcae502\">Hexo博客Next主题站内搜索模块相关，解决搜索无效、一直loading的问题</a></p>\n","excerpt":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>所谓博客，都是孤芳自赏 </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n\n<p>现在越来越多的人喜欢利用Github搭建静态网站，原因不外乎简单省钱。本人也利用hexo+github搭建了本博客，用于分享一些心得。在此过程中，折腾博客的各种配置以及功能占具了我一部分时间，在此详细记录下我是如何利用hexo+github搭建静态博客以及一些配置相关问题，以免过后遗忘，且当备份之用。</p>","more":"<h1 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h1><p> 下载node.js并安装（官网下载安装），默认会安装npm。<br> 下载安装git（官网下载安装）<br> 下载安装hexo。方法：打开cmd 运行npm install -g hexo</p>\n<h1 id=\"本地搭建hexo静态博客\"><a href=\"#本地搭建hexo静态博客\" class=\"headerlink\" title=\"本地搭建hexo静态博客\"></a>本地搭建hexo静态博客</h1><p> 新建一个文件夹，如MyBlog<br> 进入该文件夹内，右击运行git，输入：hexo init（生成hexo模板，可能要翻墙）<br> 生成完模板，运行npm install（目前貌似不用运行这一步）<br> 最后运行：hexo server （运行程序，访问本地+localhost:4000可以看到博客已经搭建成功）</p>\n<h1 id=\"站内搜索配置\"><a href=\"#站内搜索配置\" class=\"headerlink\" title=\"站内搜索配置\"></a>站内搜索配置</h1><p>首先安装hexo-generator-searchdb插件</p>\n<blockquote>\n<p>npm install hexo-generator-searchdb –save</p>\n</blockquote>\n<p>编辑博客根目录下的博客本地目录&#x2F;_config.yml站点配置文件，新增以下内容到任意位置，search顶格放否则可能没效果：</p>\n<pre><code>search:\n  path: search.xml\n  field: post\n  format: html\n  limit: 10000\n</code></pre>\n<p>编辑博客本地目录&#x2F;themes&#x2F;next&#x2F;_config.yml 主题配置文件，启用本地搜索功能,将local_search:下面的enable:的值，改成true<br>可以输入以下命令，先清理缓存，然后本地部署调试</p>\n<blockquote>\n<p>hexo clean<br>hexo s</p>\n</blockquote>\n<h2 id=\"搜索无效、一直loading的问题\"><a href=\"#搜索无效、一直loading的问题\" class=\"headerlink\" title=\"搜索无效、一直loading的问题\"></a>搜索无效、一直loading的问题</h2><p>按F12可以查看请求命令的状态，状态码200表示请求成功。但是搜索动画还是一直在转。<br>1.文章中包含特殊字符，文件编码时出错<br><img src=\"/img/Garbled.png\"></p>\n<h1 id=\"部署github\"><a href=\"#部署github\" class=\"headerlink\" title=\"部署github\"></a>部署github</h1><p>MyBlog文件夹安装 npm install –save hexo-deployer-git<br> 找到 <em>_config.yml</em>文件修改一下文件<br>deploy:<br>type: git<br>repo: <a href=\"https://github.com/Honey608/Honey608.github.io.git\">https://github.com/Honey608/Honey608.github.io.git</a><br>branch: master<br><img style=\"width:600px;height:200px\" src=\"/img/urlimg.png\" class=\"full-image\" /> 最后运行hexo clean(清除) hexo g(生成) hexo d(部署)<br>点击查看效果: <a href=\"https://zhanghuaxiao.github.io/\">https://zhanghuaxiao.github.io/</a><br><img style=\"width:600px;height:200px\" src=\"/img/github-pages.png\" class=\"full-image\"></p>\n<h1 id=\"使用nexT主题\"><a href=\"#使用nexT主题\" class=\"headerlink\" title=\"使用nexT主题\"></a>使用nexT主题</h1><p> 安装 [git clone](<a href=\"https://github.com/iissnan/hexo-theme-next\">https://github.com/iissnan/hexo-theme-next</a> themes&#x2F;next)<br> 修改_config.yml文件中 theme:next<br> 运行</p>\n<blockquote>\n<p>hexo clean<br> hexo s</p>\n</blockquote>\n<h1 id=\"hexo和nexT中文网\"><a href=\"#hexo和nexT中文网\" class=\"headerlink\" title=\"hexo和nexT中文网\"></a>hexo和nexT中文网</h1><p> <a href=\"https://hexo.io/zh-cn/docs/helpers\">hexo中文网</a><br> <a href=\"http://theme-next.iissnan.com/getting-started.html\">nexT中文官网</a></p>\n<h1 id=\"nexT主题参考文章\"><a href=\"#nexT主题参考文章\" class=\"headerlink\" title=\"nexT主题参考文章\"></a>nexT主题参考文章</h1><p> <a href=\"https://segmentfault.com/a/1190000009544924#articleHeader2\">对nexT主题设置</a><br> <a href=\"https://www.jianshu.com/p/86557c34b671\">seo优化</a><br> <a href=\"https://www.jianshu.com/p/02afabcae502\">Hexo博客Next主题站内搜索模块相关，解决搜索无效、一直loading的问题</a></p>"},{"title":"nodeJs回顾记录","date":"2019-11-25T06:11:50.000Z","copyright":true,"keywords":null,"description":null,"_content":"{% cq %} Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行时 {% endcq %}\n<img style=\"height: 176px;width: 50%;\" src=\"/img/libuv.png\">\n<!--more-->\n\n1. **在node_modules下的文件直接使用 require('nav') 使用** \n```\n    node_modules下创建nav文件夹再创建nav.js\n    //nav.js *** 主要使用nmp init -y 初始化 package.json文件中 \"main\": \"nav.js\" ***\n\n        const str = 'hello world come from nav.js'\n        module.exports = str\n\n    //其他js文件\n        const nav = require('nav')\n        console.log(nav)  //hello world come from nav.js\n```\n\n2. ***常用的fs模块API使用***\n```\n    const fs = require('fs')\n\n    // 1. 异步读取文件\n    fs.readFile('./demo.txt',function(err,fd){\n        if(err){\n            return console.error(err)\n        }\n        console.log(fd.toString())\n    })\n\n    // 2. 打开文件夹\n    fs.open('./demo.txt',function(err,fd){\n        if(err){\n            return console.error(err)\n        }\n        console.log(fd)\n    })\n\n    // 3. 获取文件信息\n    fs.stat('./demo.txt',function(err,fd){\n        if(err){\n            return console.error(err)\n        }\n        console.log(fd.isFile())\n    })\n\n    // 4. 写入文件\n    fs.writeFile('log.js', '写入日志3', function (err) {\n        if (err) {\n            return console.error(err)\n        }\n    })\n\n    // 5. 写入内容\n    fs.appendFile('./log.js','使用appendFile写入内容\\n',function(err){\n        if (err) {\n            return console.error(err)\n        }\n        console.log('写入成功')\n    })\n\n    // 6. 读取目录 把目录下面的文件和文件夹都获取到\n    fs.readdir('./src',function(err,fl){\n        if (err) {\n            return console.error(err)\n        }\n        console.log(fl)\n    })\n\n    // 7. fs.rename 1.重命名 2.剪切\n    fs.rename('./src/rename.js','./src/rename1.js',function(err,res){\n        if (err) {\n            return console.error(err)\n        }\n        console.log('重命名成功')\n    })\n    fs.rename('./src/index.html','./static/index.js',function(err,re){\n        if (err) {\n            return console.error(err)\n        }\n        console.log('剪切成功')\n    })\n\n    // 8. fs.rmdir 删除目录\n    fs.rmdir('index.html', function (err, re) {\n        if (err) {\n            return console.error(err)\n        }\n        console.log('删除目录成功')\n    })\n\n    //9. fs.unlink 删除文件\n    fs.unlink('index.html', function (err, re) {\n        if (err) {\n            return console.error(err)\n        }\n        console.log('删除文件成功')\n    })\n```\n\n2.1 *** 练习（打印src下是目录的文件)***\n```\n    //因为是异步操作，所以使用递归加匿名函数自调解决\n    fs.readdir('src',function(err,files){\n    var allFile = []\n    if(err){\n        return console.error(err)\n    }else{\n        (function a(i){\n            if(files.length == i){\n                console.log(allFile)\n                return false\n            }\n            fs.stat('src/'+files[i],function(err,fd){\n                if(fd.isDirectory()){\n                    allFile.push(files[i])\n                }\n                a(i+1)\n            })\n        })(0)\n    }\n})\n```\n\n3. *** 读入流、写入流和管道读取 ***\n```\n    const fs = require('fs');\n\n    //文件读取流（就是一段段读取）\n    var readStream = fs.createReadStream('demo.txt');\n    var str = '';\n    var count = 0;\n    readStream.on('data',function(chunk){\n        str += chunk;\n        count++;\n    })\n    readStream.on('end',function(chunk){\n        console.log(count)\n        console.log(str)\n    })\n\n    //文件写入流\n    var writeStream = fs.createWriteStream('input.txt');\n    var data = '使用createWriteStream流写入文件\\n'\n    //也可以使用for写入\n    for(var i=0;i<90;i++){\n        writeStream.write(data,'utf-8');\n    }\n    writeStream.end(); //标记写入完成 能触发以下方法\n    // 成功\n    writeStream.on('finish',function(){\n        console.log('写入完成')\n    })\n    //失败\n    writeStream.on('error',function(){\n        console.log('写入完成')\n    })\n\n    //读取一个文件内容写入到另一个文件中\n    var readerStream = fs.createReadStream('demo.txt'); //读取文件\n    var writeStream = fs.createWriteStream('input.txt'); //创建一个可写入流\n    readerStream.pipe(writeStream)\n    console.log('程序执行完毕')\n\n```\n\n4. *** 写一个简单的web服务器，可以根据输入同url返回相应的文件内容 ***\n```\n    const http = require('http');\n    const fs = require('fs');\n    const path = require('path');\n    const mime = require('./static/model/mime');\n\n    http.createServer(function (req, res) {\n        var pathname = req.url;\n        pathname == '/' ? pathname = './index.html' : \"\";\n        //获取文件的后缀名\n        let exname = path.extname(pathname)\n        if (pathname != '/favicon.ico') {\n            fs.readFile('static/' + pathname, function (err, fd) {\n                if (err) {\n                    return console.error(err)\n                } else {\n                    var mimeName = mime.getMime(exname) //使用自己写的方法返回text-html,text-css等\n                    res.writeHead(200, {\n                        \"Content-Type\": \"mimeName;chart=utf-8\"\n                    })\n                    res.end(fd)\n                }\n            })\n        }\n    }).listen(8888)\n```\n4.1 *** 使用回调函数解决异步问题 ***\n```\n    const fs = require('fs');\n    console.log(1)\n    function getMime(callback){\n        fs.readFile('input.txt',function(err,fd){\n            if(err){\n                return console.error(err)\n            }\n            callback(fd)\n        })\n    }\n    getMime(function(data){\n        console.log(data.toString())\n    })\n```\n4.2 *** 使用nodejs自带的events方法解决异步问题 ***\n```\n    const fs = require('fs');\n    const events = require('events');\n\n    var EventEmitter = new events.EventEmitter();\n\n    fs.readFile('input.txt', function (err, fd) {\n        if (err) {\n            return console.error(err)\n        }\n        EventEmitter.emit('to_parent', fd)\n    })\n\n    EventEmitter.on('to_parent', function (data) {\n        console.log(data.toString())\n    })\n```\n","source":"_posts/nodeJs回顾记录.md","raw":"---\ntitle: nodeJs回顾记录\ndate: 2019-11-25 14:11:50\ncategories: web\ntags:\n    - nodejs\ncopyright: true\nkeywords:\ndescription:\n---\n{% cq %} Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行时 {% endcq %}\n<img style=\"height: 176px;width: 50%;\" src=\"/img/libuv.png\">\n<!--more-->\n\n1. **在node_modules下的文件直接使用 require('nav') 使用** \n```\n    node_modules下创建nav文件夹再创建nav.js\n    //nav.js *** 主要使用nmp init -y 初始化 package.json文件中 \"main\": \"nav.js\" ***\n\n        const str = 'hello world come from nav.js'\n        module.exports = str\n\n    //其他js文件\n        const nav = require('nav')\n        console.log(nav)  //hello world come from nav.js\n```\n\n2. ***常用的fs模块API使用***\n```\n    const fs = require('fs')\n\n    // 1. 异步读取文件\n    fs.readFile('./demo.txt',function(err,fd){\n        if(err){\n            return console.error(err)\n        }\n        console.log(fd.toString())\n    })\n\n    // 2. 打开文件夹\n    fs.open('./demo.txt',function(err,fd){\n        if(err){\n            return console.error(err)\n        }\n        console.log(fd)\n    })\n\n    // 3. 获取文件信息\n    fs.stat('./demo.txt',function(err,fd){\n        if(err){\n            return console.error(err)\n        }\n        console.log(fd.isFile())\n    })\n\n    // 4. 写入文件\n    fs.writeFile('log.js', '写入日志3', function (err) {\n        if (err) {\n            return console.error(err)\n        }\n    })\n\n    // 5. 写入内容\n    fs.appendFile('./log.js','使用appendFile写入内容\\n',function(err){\n        if (err) {\n            return console.error(err)\n        }\n        console.log('写入成功')\n    })\n\n    // 6. 读取目录 把目录下面的文件和文件夹都获取到\n    fs.readdir('./src',function(err,fl){\n        if (err) {\n            return console.error(err)\n        }\n        console.log(fl)\n    })\n\n    // 7. fs.rename 1.重命名 2.剪切\n    fs.rename('./src/rename.js','./src/rename1.js',function(err,res){\n        if (err) {\n            return console.error(err)\n        }\n        console.log('重命名成功')\n    })\n    fs.rename('./src/index.html','./static/index.js',function(err,re){\n        if (err) {\n            return console.error(err)\n        }\n        console.log('剪切成功')\n    })\n\n    // 8. fs.rmdir 删除目录\n    fs.rmdir('index.html', function (err, re) {\n        if (err) {\n            return console.error(err)\n        }\n        console.log('删除目录成功')\n    })\n\n    //9. fs.unlink 删除文件\n    fs.unlink('index.html', function (err, re) {\n        if (err) {\n            return console.error(err)\n        }\n        console.log('删除文件成功')\n    })\n```\n\n2.1 *** 练习（打印src下是目录的文件)***\n```\n    //因为是异步操作，所以使用递归加匿名函数自调解决\n    fs.readdir('src',function(err,files){\n    var allFile = []\n    if(err){\n        return console.error(err)\n    }else{\n        (function a(i){\n            if(files.length == i){\n                console.log(allFile)\n                return false\n            }\n            fs.stat('src/'+files[i],function(err,fd){\n                if(fd.isDirectory()){\n                    allFile.push(files[i])\n                }\n                a(i+1)\n            })\n        })(0)\n    }\n})\n```\n\n3. *** 读入流、写入流和管道读取 ***\n```\n    const fs = require('fs');\n\n    //文件读取流（就是一段段读取）\n    var readStream = fs.createReadStream('demo.txt');\n    var str = '';\n    var count = 0;\n    readStream.on('data',function(chunk){\n        str += chunk;\n        count++;\n    })\n    readStream.on('end',function(chunk){\n        console.log(count)\n        console.log(str)\n    })\n\n    //文件写入流\n    var writeStream = fs.createWriteStream('input.txt');\n    var data = '使用createWriteStream流写入文件\\n'\n    //也可以使用for写入\n    for(var i=0;i<90;i++){\n        writeStream.write(data,'utf-8');\n    }\n    writeStream.end(); //标记写入完成 能触发以下方法\n    // 成功\n    writeStream.on('finish',function(){\n        console.log('写入完成')\n    })\n    //失败\n    writeStream.on('error',function(){\n        console.log('写入完成')\n    })\n\n    //读取一个文件内容写入到另一个文件中\n    var readerStream = fs.createReadStream('demo.txt'); //读取文件\n    var writeStream = fs.createWriteStream('input.txt'); //创建一个可写入流\n    readerStream.pipe(writeStream)\n    console.log('程序执行完毕')\n\n```\n\n4. *** 写一个简单的web服务器，可以根据输入同url返回相应的文件内容 ***\n```\n    const http = require('http');\n    const fs = require('fs');\n    const path = require('path');\n    const mime = require('./static/model/mime');\n\n    http.createServer(function (req, res) {\n        var pathname = req.url;\n        pathname == '/' ? pathname = './index.html' : \"\";\n        //获取文件的后缀名\n        let exname = path.extname(pathname)\n        if (pathname != '/favicon.ico') {\n            fs.readFile('static/' + pathname, function (err, fd) {\n                if (err) {\n                    return console.error(err)\n                } else {\n                    var mimeName = mime.getMime(exname) //使用自己写的方法返回text-html,text-css等\n                    res.writeHead(200, {\n                        \"Content-Type\": \"mimeName;chart=utf-8\"\n                    })\n                    res.end(fd)\n                }\n            })\n        }\n    }).listen(8888)\n```\n4.1 *** 使用回调函数解决异步问题 ***\n```\n    const fs = require('fs');\n    console.log(1)\n    function getMime(callback){\n        fs.readFile('input.txt',function(err,fd){\n            if(err){\n                return console.error(err)\n            }\n            callback(fd)\n        })\n    }\n    getMime(function(data){\n        console.log(data.toString())\n    })\n```\n4.2 *** 使用nodejs自带的events方法解决异步问题 ***\n```\n    const fs = require('fs');\n    const events = require('events');\n\n    var EventEmitter = new events.EventEmitter();\n\n    fs.readFile('input.txt', function (err, fd) {\n        if (err) {\n            return console.error(err)\n        }\n        EventEmitter.emit('to_parent', fd)\n    })\n\n    EventEmitter.on('to_parent', function (data) {\n        console.log(data.toString())\n    })\n```\n","slug":"nodeJs回顾记录","published":1,"updated":"2026-01-02T00:43:17.573Z","comments":1,"layout":"post","photos":[],"_id":"cmjwbsw65000rrotgfnad3u8e","content":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行时 </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n<img style=\"height: 176px;width: 50%;\" src=\"/img/libuv.png\">\n<span id=\"more\"></span>\n\n<ol>\n<li><p><strong>在node_modules下的文件直接使用 require(‘nav’) 使用</strong> </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">node_modules下创建nav文件夹再创建nav.js</span><br><span class=\"line\">//nav.js *** 主要使用nmp init -y 初始化 package.json文件中 &quot;main&quot;: &quot;nav.js&quot; ***</span><br><span class=\"line\"></span><br><span class=\"line\">    const str = &#x27;hello world come from nav.js&#x27;</span><br><span class=\"line\">    module.exports = str</span><br><span class=\"line\"></span><br><span class=\"line\">//其他js文件</span><br><span class=\"line\">    const nav = require(&#x27;nav&#x27;)</span><br><span class=\"line\">    console.log(nav)  //hello world come from nav.js</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><em><strong>常用的fs模块API使用</strong></em></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const fs = require(&#x27;fs&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\">// 1. 异步读取文件</span><br><span class=\"line\">fs.readFile(&#x27;./demo.txt&#x27;,function(err,fd)&#123;</span><br><span class=\"line\">    if(err)&#123;</span><br><span class=\"line\">        return console.error(err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    console.log(fd.toString())</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">// 2. 打开文件夹</span><br><span class=\"line\">fs.open(&#x27;./demo.txt&#x27;,function(err,fd)&#123;</span><br><span class=\"line\">    if(err)&#123;</span><br><span class=\"line\">        return console.error(err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    console.log(fd)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">// 3. 获取文件信息</span><br><span class=\"line\">fs.stat(&#x27;./demo.txt&#x27;,function(err,fd)&#123;</span><br><span class=\"line\">    if(err)&#123;</span><br><span class=\"line\">        return console.error(err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    console.log(fd.isFile())</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">// 4. 写入文件</span><br><span class=\"line\">fs.writeFile(&#x27;log.js&#x27;, &#x27;写入日志3&#x27;, function (err) &#123;</span><br><span class=\"line\">    if (err) &#123;</span><br><span class=\"line\">        return console.error(err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">// 5. 写入内容</span><br><span class=\"line\">fs.appendFile(&#x27;./log.js&#x27;,&#x27;使用appendFile写入内容\\n&#x27;,function(err)&#123;</span><br><span class=\"line\">    if (err) &#123;</span><br><span class=\"line\">        return console.error(err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    console.log(&#x27;写入成功&#x27;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">// 6. 读取目录 把目录下面的文件和文件夹都获取到</span><br><span class=\"line\">fs.readdir(&#x27;./src&#x27;,function(err,fl)&#123;</span><br><span class=\"line\">    if (err) &#123;</span><br><span class=\"line\">        return console.error(err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    console.log(fl)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">// 7. fs.rename 1.重命名 2.剪切</span><br><span class=\"line\">fs.rename(&#x27;./src/rename.js&#x27;,&#x27;./src/rename1.js&#x27;,function(err,res)&#123;</span><br><span class=\"line\">    if (err) &#123;</span><br><span class=\"line\">        return console.error(err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    console.log(&#x27;重命名成功&#x27;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">fs.rename(&#x27;./src/index.html&#x27;,&#x27;./static/index.js&#x27;,function(err,re)&#123;</span><br><span class=\"line\">    if (err) &#123;</span><br><span class=\"line\">        return console.error(err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    console.log(&#x27;剪切成功&#x27;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">// 8. fs.rmdir 删除目录</span><br><span class=\"line\">fs.rmdir(&#x27;index.html&#x27;, function (err, re) &#123;</span><br><span class=\"line\">    if (err) &#123;</span><br><span class=\"line\">        return console.error(err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    console.log(&#x27;删除目录成功&#x27;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">//9. fs.unlink 删除文件</span><br><span class=\"line\">fs.unlink(&#x27;index.html&#x27;, function (err, re) &#123;</span><br><span class=\"line\">    if (err) &#123;</span><br><span class=\"line\">        return console.error(err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    console.log(&#x27;删除文件成功&#x27;)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure></li>\n</ol>\n<p>2.1 *** 练习（打印src下是目录的文件)***</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    //因为是异步操作，所以使用递归加匿名函数自调解决</span><br><span class=\"line\">    fs.readdir(&#x27;src&#x27;,function(err,files)&#123;</span><br><span class=\"line\">    var allFile = []</span><br><span class=\"line\">    if(err)&#123;</span><br><span class=\"line\">        return console.error(err)</span><br><span class=\"line\">    &#125;else&#123;</span><br><span class=\"line\">        (function a(i)&#123;</span><br><span class=\"line\">            if(files.length == i)&#123;</span><br><span class=\"line\">                console.log(allFile)</span><br><span class=\"line\">                return false</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            fs.stat(&#x27;src/&#x27;+files[i],function(err,fd)&#123;</span><br><span class=\"line\">                if(fd.isDirectory())&#123;</span><br><span class=\"line\">                    allFile.push(files[i])</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                a(i+1)</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        &#125;)(0)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li><p>*** 读入流、写入流和管道读取 ***</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const fs = require(&#x27;fs&#x27;);</span><br><span class=\"line\"></span><br><span class=\"line\">//文件读取流（就是一段段读取）</span><br><span class=\"line\">var readStream = fs.createReadStream(&#x27;demo.txt&#x27;);</span><br><span class=\"line\">var str = &#x27;&#x27;;</span><br><span class=\"line\">var count = 0;</span><br><span class=\"line\">readStream.on(&#x27;data&#x27;,function(chunk)&#123;</span><br><span class=\"line\">    str += chunk;</span><br><span class=\"line\">    count++;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">readStream.on(&#x27;end&#x27;,function(chunk)&#123;</span><br><span class=\"line\">    console.log(count)</span><br><span class=\"line\">    console.log(str)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">//文件写入流</span><br><span class=\"line\">var writeStream = fs.createWriteStream(&#x27;input.txt&#x27;);</span><br><span class=\"line\">var data = &#x27;使用createWriteStream流写入文件\\n&#x27;</span><br><span class=\"line\">//也可以使用for写入</span><br><span class=\"line\">for(var i=0;i&lt;90;i++)&#123;</span><br><span class=\"line\">    writeStream.write(data,&#x27;utf-8&#x27;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">writeStream.end(); //标记写入完成 能触发以下方法</span><br><span class=\"line\">// 成功</span><br><span class=\"line\">writeStream.on(&#x27;finish&#x27;,function()&#123;</span><br><span class=\"line\">    console.log(&#x27;写入完成&#x27;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">//失败</span><br><span class=\"line\">writeStream.on(&#x27;error&#x27;,function()&#123;</span><br><span class=\"line\">    console.log(&#x27;写入完成&#x27;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">//读取一个文件内容写入到另一个文件中</span><br><span class=\"line\">var readerStream = fs.createReadStream(&#x27;demo.txt&#x27;); //读取文件</span><br><span class=\"line\">var writeStream = fs.createWriteStream(&#x27;input.txt&#x27;); //创建一个可写入流</span><br><span class=\"line\">readerStream.pipe(writeStream)</span><br><span class=\"line\">console.log(&#x27;程序执行完毕&#x27;)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>*** 写一个简单的web服务器，可以根据输入同url返回相应的文件内容 ***</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const http = require(&#x27;http&#x27;);</span><br><span class=\"line\">const fs = require(&#x27;fs&#x27;);</span><br><span class=\"line\">const path = require(&#x27;path&#x27;);</span><br><span class=\"line\">const mime = require(&#x27;./static/model/mime&#x27;);</span><br><span class=\"line\"></span><br><span class=\"line\">http.createServer(function (req, res) &#123;</span><br><span class=\"line\">    var pathname = req.url;</span><br><span class=\"line\">    pathname == &#x27;/&#x27; ? pathname = &#x27;./index.html&#x27; : &quot;&quot;;</span><br><span class=\"line\">    //获取文件的后缀名</span><br><span class=\"line\">    let exname = path.extname(pathname)</span><br><span class=\"line\">    if (pathname != &#x27;/favicon.ico&#x27;) &#123;</span><br><span class=\"line\">        fs.readFile(&#x27;static/&#x27; + pathname, function (err, fd) &#123;</span><br><span class=\"line\">            if (err) &#123;</span><br><span class=\"line\">                return console.error(err)</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                var mimeName = mime.getMime(exname) //使用自己写的方法返回text-html,text-css等</span><br><span class=\"line\">                res.writeHead(200, &#123;</span><br><span class=\"line\">                    &quot;Content-Type&quot;: &quot;mimeName;chart=utf-8&quot;</span><br><span class=\"line\">                &#125;)</span><br><span class=\"line\">                res.end(fd)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;).listen(8888)</span><br></pre></td></tr></table></figure>\n<p>4.1 *** 使用回调函数解决异步问题 ***</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const fs = require(&#x27;fs&#x27;);</span><br><span class=\"line\">console.log(1)</span><br><span class=\"line\">function getMime(callback)&#123;</span><br><span class=\"line\">    fs.readFile(&#x27;input.txt&#x27;,function(err,fd)&#123;</span><br><span class=\"line\">        if(err)&#123;</span><br><span class=\"line\">            return console.error(err)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        callback(fd)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">getMime(function(data)&#123;</span><br><span class=\"line\">    console.log(data.toString())</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>4.2 *** 使用nodejs自带的events方法解决异步问题 ***</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const fs = require(&#x27;fs&#x27;);</span><br><span class=\"line\">const events = require(&#x27;events&#x27;);</span><br><span class=\"line\"></span><br><span class=\"line\">var EventEmitter = new events.EventEmitter();</span><br><span class=\"line\"></span><br><span class=\"line\">fs.readFile(&#x27;input.txt&#x27;, function (err, fd) &#123;</span><br><span class=\"line\">    if (err) &#123;</span><br><span class=\"line\">        return console.error(err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    EventEmitter.emit(&#x27;to_parent&#x27;, fd)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">EventEmitter.on(&#x27;to_parent&#x27;, function (data) &#123;</span><br><span class=\"line\">    console.log(data.toString())</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure></li>\n</ol>\n","excerpt":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行时 </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n<img style=\"height: 176px;width: 50%;\" src=\"/img/libuv.png\">","more":"<ol>\n<li><p><strong>在node_modules下的文件直接使用 require(‘nav’) 使用</strong> </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">node_modules下创建nav文件夹再创建nav.js</span><br><span class=\"line\">//nav.js *** 主要使用nmp init -y 初始化 package.json文件中 &quot;main&quot;: &quot;nav.js&quot; ***</span><br><span class=\"line\"></span><br><span class=\"line\">    const str = &#x27;hello world come from nav.js&#x27;</span><br><span class=\"line\">    module.exports = str</span><br><span class=\"line\"></span><br><span class=\"line\">//其他js文件</span><br><span class=\"line\">    const nav = require(&#x27;nav&#x27;)</span><br><span class=\"line\">    console.log(nav)  //hello world come from nav.js</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><em><strong>常用的fs模块API使用</strong></em></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const fs = require(&#x27;fs&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\">// 1. 异步读取文件</span><br><span class=\"line\">fs.readFile(&#x27;./demo.txt&#x27;,function(err,fd)&#123;</span><br><span class=\"line\">    if(err)&#123;</span><br><span class=\"line\">        return console.error(err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    console.log(fd.toString())</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">// 2. 打开文件夹</span><br><span class=\"line\">fs.open(&#x27;./demo.txt&#x27;,function(err,fd)&#123;</span><br><span class=\"line\">    if(err)&#123;</span><br><span class=\"line\">        return console.error(err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    console.log(fd)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">// 3. 获取文件信息</span><br><span class=\"line\">fs.stat(&#x27;./demo.txt&#x27;,function(err,fd)&#123;</span><br><span class=\"line\">    if(err)&#123;</span><br><span class=\"line\">        return console.error(err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    console.log(fd.isFile())</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">// 4. 写入文件</span><br><span class=\"line\">fs.writeFile(&#x27;log.js&#x27;, &#x27;写入日志3&#x27;, function (err) &#123;</span><br><span class=\"line\">    if (err) &#123;</span><br><span class=\"line\">        return console.error(err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">// 5. 写入内容</span><br><span class=\"line\">fs.appendFile(&#x27;./log.js&#x27;,&#x27;使用appendFile写入内容\\n&#x27;,function(err)&#123;</span><br><span class=\"line\">    if (err) &#123;</span><br><span class=\"line\">        return console.error(err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    console.log(&#x27;写入成功&#x27;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">// 6. 读取目录 把目录下面的文件和文件夹都获取到</span><br><span class=\"line\">fs.readdir(&#x27;./src&#x27;,function(err,fl)&#123;</span><br><span class=\"line\">    if (err) &#123;</span><br><span class=\"line\">        return console.error(err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    console.log(fl)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">// 7. fs.rename 1.重命名 2.剪切</span><br><span class=\"line\">fs.rename(&#x27;./src/rename.js&#x27;,&#x27;./src/rename1.js&#x27;,function(err,res)&#123;</span><br><span class=\"line\">    if (err) &#123;</span><br><span class=\"line\">        return console.error(err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    console.log(&#x27;重命名成功&#x27;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">fs.rename(&#x27;./src/index.html&#x27;,&#x27;./static/index.js&#x27;,function(err,re)&#123;</span><br><span class=\"line\">    if (err) &#123;</span><br><span class=\"line\">        return console.error(err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    console.log(&#x27;剪切成功&#x27;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">// 8. fs.rmdir 删除目录</span><br><span class=\"line\">fs.rmdir(&#x27;index.html&#x27;, function (err, re) &#123;</span><br><span class=\"line\">    if (err) &#123;</span><br><span class=\"line\">        return console.error(err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    console.log(&#x27;删除目录成功&#x27;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">//9. fs.unlink 删除文件</span><br><span class=\"line\">fs.unlink(&#x27;index.html&#x27;, function (err, re) &#123;</span><br><span class=\"line\">    if (err) &#123;</span><br><span class=\"line\">        return console.error(err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    console.log(&#x27;删除文件成功&#x27;)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure></li>\n</ol>\n<p>2.1 *** 练习（打印src下是目录的文件)***</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    //因为是异步操作，所以使用递归加匿名函数自调解决</span><br><span class=\"line\">    fs.readdir(&#x27;src&#x27;,function(err,files)&#123;</span><br><span class=\"line\">    var allFile = []</span><br><span class=\"line\">    if(err)&#123;</span><br><span class=\"line\">        return console.error(err)</span><br><span class=\"line\">    &#125;else&#123;</span><br><span class=\"line\">        (function a(i)&#123;</span><br><span class=\"line\">            if(files.length == i)&#123;</span><br><span class=\"line\">                console.log(allFile)</span><br><span class=\"line\">                return false</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            fs.stat(&#x27;src/&#x27;+files[i],function(err,fd)&#123;</span><br><span class=\"line\">                if(fd.isDirectory())&#123;</span><br><span class=\"line\">                    allFile.push(files[i])</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                a(i+1)</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        &#125;)(0)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li><p>*** 读入流、写入流和管道读取 ***</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const fs = require(&#x27;fs&#x27;);</span><br><span class=\"line\"></span><br><span class=\"line\">//文件读取流（就是一段段读取）</span><br><span class=\"line\">var readStream = fs.createReadStream(&#x27;demo.txt&#x27;);</span><br><span class=\"line\">var str = &#x27;&#x27;;</span><br><span class=\"line\">var count = 0;</span><br><span class=\"line\">readStream.on(&#x27;data&#x27;,function(chunk)&#123;</span><br><span class=\"line\">    str += chunk;</span><br><span class=\"line\">    count++;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">readStream.on(&#x27;end&#x27;,function(chunk)&#123;</span><br><span class=\"line\">    console.log(count)</span><br><span class=\"line\">    console.log(str)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">//文件写入流</span><br><span class=\"line\">var writeStream = fs.createWriteStream(&#x27;input.txt&#x27;);</span><br><span class=\"line\">var data = &#x27;使用createWriteStream流写入文件\\n&#x27;</span><br><span class=\"line\">//也可以使用for写入</span><br><span class=\"line\">for(var i=0;i&lt;90;i++)&#123;</span><br><span class=\"line\">    writeStream.write(data,&#x27;utf-8&#x27;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">writeStream.end(); //标记写入完成 能触发以下方法</span><br><span class=\"line\">// 成功</span><br><span class=\"line\">writeStream.on(&#x27;finish&#x27;,function()&#123;</span><br><span class=\"line\">    console.log(&#x27;写入完成&#x27;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">//失败</span><br><span class=\"line\">writeStream.on(&#x27;error&#x27;,function()&#123;</span><br><span class=\"line\">    console.log(&#x27;写入完成&#x27;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">//读取一个文件内容写入到另一个文件中</span><br><span class=\"line\">var readerStream = fs.createReadStream(&#x27;demo.txt&#x27;); //读取文件</span><br><span class=\"line\">var writeStream = fs.createWriteStream(&#x27;input.txt&#x27;); //创建一个可写入流</span><br><span class=\"line\">readerStream.pipe(writeStream)</span><br><span class=\"line\">console.log(&#x27;程序执行完毕&#x27;)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>*** 写一个简单的web服务器，可以根据输入同url返回相应的文件内容 ***</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const http = require(&#x27;http&#x27;);</span><br><span class=\"line\">const fs = require(&#x27;fs&#x27;);</span><br><span class=\"line\">const path = require(&#x27;path&#x27;);</span><br><span class=\"line\">const mime = require(&#x27;./static/model/mime&#x27;);</span><br><span class=\"line\"></span><br><span class=\"line\">http.createServer(function (req, res) &#123;</span><br><span class=\"line\">    var pathname = req.url;</span><br><span class=\"line\">    pathname == &#x27;/&#x27; ? pathname = &#x27;./index.html&#x27; : &quot;&quot;;</span><br><span class=\"line\">    //获取文件的后缀名</span><br><span class=\"line\">    let exname = path.extname(pathname)</span><br><span class=\"line\">    if (pathname != &#x27;/favicon.ico&#x27;) &#123;</span><br><span class=\"line\">        fs.readFile(&#x27;static/&#x27; + pathname, function (err, fd) &#123;</span><br><span class=\"line\">            if (err) &#123;</span><br><span class=\"line\">                return console.error(err)</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                var mimeName = mime.getMime(exname) //使用自己写的方法返回text-html,text-css等</span><br><span class=\"line\">                res.writeHead(200, &#123;</span><br><span class=\"line\">                    &quot;Content-Type&quot;: &quot;mimeName;chart=utf-8&quot;</span><br><span class=\"line\">                &#125;)</span><br><span class=\"line\">                res.end(fd)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;).listen(8888)</span><br></pre></td></tr></table></figure>\n<p>4.1 *** 使用回调函数解决异步问题 ***</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const fs = require(&#x27;fs&#x27;);</span><br><span class=\"line\">console.log(1)</span><br><span class=\"line\">function getMime(callback)&#123;</span><br><span class=\"line\">    fs.readFile(&#x27;input.txt&#x27;,function(err,fd)&#123;</span><br><span class=\"line\">        if(err)&#123;</span><br><span class=\"line\">            return console.error(err)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        callback(fd)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">getMime(function(data)&#123;</span><br><span class=\"line\">    console.log(data.toString())</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>4.2 *** 使用nodejs自带的events方法解决异步问题 ***</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const fs = require(&#x27;fs&#x27;);</span><br><span class=\"line\">const events = require(&#x27;events&#x27;);</span><br><span class=\"line\"></span><br><span class=\"line\">var EventEmitter = new events.EventEmitter();</span><br><span class=\"line\"></span><br><span class=\"line\">fs.readFile(&#x27;input.txt&#x27;, function (err, fd) &#123;</span><br><span class=\"line\">    if (err) &#123;</span><br><span class=\"line\">        return console.error(err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    EventEmitter.emit(&#x27;to_parent&#x27;, fd)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">EventEmitter.on(&#x27;to_parent&#x27;, function (data) &#123;</span><br><span class=\"line\">    console.log(data.toString())</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure></li>\n</ol>"},{"title":"Vue中slot的使用（通俗易懂）","date":"2019-04-22T06:27:23.000Z","copyright":null,"keywords":null,"description":null,"_content":"{% cq %} slot {% endcq %}\n<img src=\"/img/slot.jpeg\" style=\"width:305px;heigth:277px\">\n好久没更新博客啦，今天我又回来啦！\n<!--more-->\n# 为什么会出现插槽\n我们经常需要向一个组件传递内容，像这样：\n    ```javascript\n        <alert-box>\n            Something bad happened\n        </alert-box>\n    ```\n但是现实却是很残酷，可能会给你来个Error!Something bad happened\n> 好啦，我们可以进入正题啦！😜\n    ```javascript\n    <div id=\"app\">\n       <childer-component :items=\"items\">\n           <h2>单个插槽</h2>\n           <span>只有在子组件使用单个插槽 slot 才能让我显示出来</span>\n\n           <h2>多个插槽也叫具名插槽</h2>\n           <div slot=\"one\">\n                <span>one</span>\n                <span>第一个</span>\n           </div>\n           <div slot=\"two\">\n                <span>two</span>\n                <span>第二个</span>\n           </div>\n           <h2>作用域插槽（将子组件的值传到父组件供使用）</h2>\n           <div slot-scope=\"props\">\n                <span>{{ props.addr }}</span>\n                <span>{{ props.cname }}</span>\n                <span>{{ props.age }}</span>\n           </div>\n       </childer-component>\n    </div>\n    <script>\n        var childerComponent = Vue.component('childer-component',{\n            props:['items'],\n            template:`\n                <div>\n                    <h1>我是子组件</h1>    \n                    <slot>默认</slot> \n\n                    <slot name=\"one\"></slot>\n                    <slot name=\"two\"></slot>  \n\n                    <slot :cname=\"items[2].cname\"></slot> \n                    <slot :addr=\"items[2].addr\"></slot> \n                    <slot age=\"18\"></slot> \n                </div>\n            `\n        })\n        var vm = new Vue({\n            el: '#app',\n            data: {\n                items:[\n                    { text:'文字1' , cname:'tom' , addr:'usa' },\n                    { text:'文字2' , cname:'wangwu' , addr:'uk' },\n                    { text:'文字3' , cname:'zhangsan' , addr:'un' }\n                ],\n                components:{\n                    'childerComponent':childerComponent,\n                }\n            }\n        })\n    </script>\n    ```\n","source":"_posts/slot的使用.md","raw":"---\ntitle: Vue中slot的使用（通俗易懂）\ndate: 2019-04-22 14:27:23\ncategories: web\ntags: [\"slot的使用\"]\ncopyright:\nkeywords:\ndescription:\n---\n{% cq %} slot {% endcq %}\n<img src=\"/img/slot.jpeg\" style=\"width:305px;heigth:277px\">\n好久没更新博客啦，今天我又回来啦！\n<!--more-->\n# 为什么会出现插槽\n我们经常需要向一个组件传递内容，像这样：\n    ```javascript\n        <alert-box>\n            Something bad happened\n        </alert-box>\n    ```\n但是现实却是很残酷，可能会给你来个Error!Something bad happened\n> 好啦，我们可以进入正题啦！😜\n    ```javascript\n    <div id=\"app\">\n       <childer-component :items=\"items\">\n           <h2>单个插槽</h2>\n           <span>只有在子组件使用单个插槽 slot 才能让我显示出来</span>\n\n           <h2>多个插槽也叫具名插槽</h2>\n           <div slot=\"one\">\n                <span>one</span>\n                <span>第一个</span>\n           </div>\n           <div slot=\"two\">\n                <span>two</span>\n                <span>第二个</span>\n           </div>\n           <h2>作用域插槽（将子组件的值传到父组件供使用）</h2>\n           <div slot-scope=\"props\">\n                <span>{{ props.addr }}</span>\n                <span>{{ props.cname }}</span>\n                <span>{{ props.age }}</span>\n           </div>\n       </childer-component>\n    </div>\n    <script>\n        var childerComponent = Vue.component('childer-component',{\n            props:['items'],\n            template:`\n                <div>\n                    <h1>我是子组件</h1>    \n                    <slot>默认</slot> \n\n                    <slot name=\"one\"></slot>\n                    <slot name=\"two\"></slot>  \n\n                    <slot :cname=\"items[2].cname\"></slot> \n                    <slot :addr=\"items[2].addr\"></slot> \n                    <slot age=\"18\"></slot> \n                </div>\n            `\n        })\n        var vm = new Vue({\n            el: '#app',\n            data: {\n                items:[\n                    { text:'文字1' , cname:'tom' , addr:'usa' },\n                    { text:'文字2' , cname:'wangwu' , addr:'uk' },\n                    { text:'文字3' , cname:'zhangsan' , addr:'un' }\n                ],\n                components:{\n                    'childerComponent':childerComponent,\n                }\n            }\n        })\n    </script>\n    ```\n","slug":"slot的使用","published":1,"updated":"2026-01-02T00:43:17.574Z","comments":1,"layout":"post","photos":[],"_id":"cmjwbsw66000urotg4d4d3xy7","content":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>slot </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n<img src=\"/img/slot.jpeg\" style=\"width:305px;heigth:277px\">\n好久没更新博客啦，今天我又回来啦！\n<span id=\"more\"></span>\n# 为什么会出现插槽\n我们经常需要向一个组件传递内容，像这样：\n    <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;alert-box&gt;</span><br><span class=\"line\">    <span class=\"title class_\">Something</span> bad happened</span><br><span class=\"line\">&lt;/alert-box&gt;</span><br></pre></td></tr></table></figure>\n但是现实却是很残酷，可能会给你来个Error!Something bad happened\n> 好啦，我们可以进入正题啦！😜\n    <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div id=<span class=\"string\">&quot;app&quot;</span>&gt;</span><br><span class=\"line\">   <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">childer-component</span> <span class=\"attr\">:items</span>=<span class=\"string\">&quot;items&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">       <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>单个插槽<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">       <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>只有在子组件使用单个插槽 slot 才能让我显示出来<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">       <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>多个插槽也叫具名插槽<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">       <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">slot</span>=<span class=\"string\">&quot;one&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>one<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>第一个<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">       <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">       <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">slot</span>=<span class=\"string\">&quot;two&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>two<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>第二个<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">       <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">       <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>作用域插槽（将子组件的值传到父组件供使用）<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">       <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">slot-scope</span>=<span class=\"string\">&quot;props&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>&#123;&#123; props.addr &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>&#123;&#123; props.cname &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>&#123;&#123; props.age &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">       <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">   <span class=\"tag\">&lt;/<span class=\"name\">childer-component</span>&gt;</span></span></span><br><span class=\"line\">&lt;/div&gt;</span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-handlebars\"><span class=\"language-xml\"></span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">    var childerComponent = Vue.component(&#x27;childer-component&#x27;,&#123;</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">        props:[&#x27;items&#x27;],</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">        template:`</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>我是子组件<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span>    </span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">slot</span>&gt;</span>默认<span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span> </span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\"></span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">slot</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;one&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span></span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">slot</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;two&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span>  </span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\"></span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">slot</span> <span class=\"attr\">:cname</span>=<span class=\"string\">&quot;items[2].cname&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span> </span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">slot</span> <span class=\"attr\">:addr</span>=<span class=\"string\">&quot;items[2].addr&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span> </span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">slot</span> <span class=\"attr\">age</span>=<span class=\"string\">&quot;18&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span> </span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">        `</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">    &#125;)</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">    var vm = new Vue(&#123;</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">        el: &#x27;#app&#x27;,</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">        data: &#123;</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">            items:[</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">                &#123; text:&#x27;文字1&#x27; , cname:&#x27;tom&#x27; , addr:&#x27;usa&#x27; &#125;,</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">                &#123; text:&#x27;文字2&#x27; , cname:&#x27;wangwu&#x27; , addr:&#x27;uk&#x27; &#125;,</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">                &#123; text:&#x27;文字3&#x27; , cname:&#x27;zhangsan&#x27; , addr:&#x27;un&#x27; &#125;</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">            ],</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">            components:&#123;</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">                &#x27;childerComponent&#x27;:childerComponent,</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">            &#125;</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">        &#125;</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">    &#125;)</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\"></span></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n","excerpt":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>slot </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n<img src=\"/img/slot.jpeg\" style=\"width:305px;heigth:277px\">\n好久没更新博客啦，今天我又回来啦！","more":"# 为什么会出现插槽\n我们经常需要向一个组件传递内容，像这样：\n    <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;alert-box&gt;</span><br><span class=\"line\">    <span class=\"title class_\">Something</span> bad happened</span><br><span class=\"line\">&lt;/alert-box&gt;</span><br></pre></td></tr></table></figure>\n但是现实却是很残酷，可能会给你来个Error!Something bad happened\n> 好啦，我们可以进入正题啦！😜\n    <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div id=<span class=\"string\">&quot;app&quot;</span>&gt;</span><br><span class=\"line\">   <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">childer-component</span> <span class=\"attr\">:items</span>=<span class=\"string\">&quot;items&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">       <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>单个插槽<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">       <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>只有在子组件使用单个插槽 slot 才能让我显示出来<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">       <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>多个插槽也叫具名插槽<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">       <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">slot</span>=<span class=\"string\">&quot;one&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>one<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>第一个<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">       <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">       <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">slot</span>=<span class=\"string\">&quot;two&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>two<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>第二个<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">       <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">       <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>作用域插槽（将子组件的值传到父组件供使用）<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">       <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">slot-scope</span>=<span class=\"string\">&quot;props&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>&#123;&#123; props.addr &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>&#123;&#123; props.cname &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>&#123;&#123; props.age &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">       <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">   <span class=\"tag\">&lt;/<span class=\"name\">childer-component</span>&gt;</span></span></span><br><span class=\"line\">&lt;/div&gt;</span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-handlebars\"><span class=\"language-xml\"></span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">    var childerComponent = Vue.component(&#x27;childer-component&#x27;,&#123;</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">        props:[&#x27;items&#x27;],</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">        template:`</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>我是子组件<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span>    </span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">slot</span>&gt;</span>默认<span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span> </span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\"></span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">slot</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;one&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span></span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">slot</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;two&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span>  </span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\"></span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">slot</span> <span class=\"attr\">:cname</span>=<span class=\"string\">&quot;items[2].cname&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span> </span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">slot</span> <span class=\"attr\">:addr</span>=<span class=\"string\">&quot;items[2].addr&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span> </span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">slot</span> <span class=\"attr\">age</span>=<span class=\"string\">&quot;18&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">slot</span>&gt;</span> </span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">        `</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">    &#125;)</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">    var vm = new Vue(&#123;</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">        el: &#x27;#app&#x27;,</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">        data: &#123;</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">            items:[</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">                &#123; text:&#x27;文字1&#x27; , cname:&#x27;tom&#x27; , addr:&#x27;usa&#x27; &#125;,</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">                &#123; text:&#x27;文字2&#x27; , cname:&#x27;wangwu&#x27; , addr:&#x27;uk&#x27; &#125;,</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">                &#123; text:&#x27;文字3&#x27; , cname:&#x27;zhangsan&#x27; , addr:&#x27;un&#x27; &#125;</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">            ],</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">            components:&#123;</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">                &#x27;childerComponent&#x27;:childerComponent,</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">            &#125;</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">        &#125;</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\">    &#125;)</span></span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"language-handlebars\"><span class=\"language-xml\"></span></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>"},{"title":"vue中diff算法详解","date":"2019-01-30T04:53:01.000Z","copyright":null,"keywords":null,"description":null,"_content":"{% cq %}[可以先看Vuejs运行机制](https://zhanghuaxiao.github.io/2019/01/30/vue-source-code/){% endcq %}\n<!--more-->\n#  当数据发生变化时，vue是怎么更新节点的？\n要知道渲染真实DOM的开销是很大的，比如有时候我们修改了某个数据，如果直接渲染到真实dom上会引起整个dom树的重绘和重排，有没有可能我们只更新我们修改的那一小块dom而不要更新整个dom呢？diff算法能够帮助我们。\n\n我们先根据真实DOM生成一颗virtual DOM，当virtual DOM某个节点的数据改变后会生成一个新的Vnode，然后Vnode和oldVnode作对比，发现有不一样的地方就直接修改在真实的DOM上，然后使oldVnode的值为Vnode。\n\ndiff的过程就是调用名为patch的函数，比较新旧节点，一边比较一边给真实的DOM打补丁。\n# virtual DOM和真实DOM的区别？\nvirtual DOM是将真实的DOM的数据抽取出来，以对象的形式模拟树形结构。比如dom是这样的：\n```javascript\n    <div>\n        <p>123</p>\n    </div>\n\n对应的virtual DOM（伪代码）：\n\n    var Vnode = {\n        tag: 'div',\n        children: [\n            { tag: 'p', text: '123' }\n        ]\n    };\n```\n（温馨提示：VNode和oldVNode都是对象，一定要记住）\n# diff的比较方式？\n在采取diff算法比较新旧节点的时候，比较只会在同层级进行, 不会跨层级比较。\n```javascript\n    <div>\n        <p>123</p>\n    </div>\n\n    <div>\n        <span>456</span>\n    </div>\n```\n上面的代码会分别比较同一层的两个div以及第二层的p和span，但是不会拿div和span作比较。在别处看到的一张很形象的图：\n<img src=\"/img/diff.png\">\n# diff流程图\n当数据发生改变时，set方法会让调用Dep.notify通知所有订阅者Watcher，订阅者就会调用patch给真实的DOM打补丁，更新相应的视图\n<img src=\"/img/diff-diagram.png\">\n# 具体分析\npatch\n来看看patch是怎么打补丁的（代码只保留核心部分）\n```javascript\n    function patch (oldVnode,vnode){\n        //some code\n        if(sameVnode(oldVnode,vnode)){\n            patchVnode(oldVnode,vnode)\n        }else{\n            const oEl = oldVnode.el   //当前oldVnode对应的真实元素节点\n            let parentEle = api.parentNode(oEl)   //父元素\n            createEle(vnode)   //根据Vnode生成新元素\n                if (parentEle !== null) {\n                // 将新元素添加进父元素    \n                api.insertBefore(parentEle, vnode.el, api.nextSibling(oEl)) \n                api.removeChild(parentEle, oldVnode.el)  // 移除以前的旧元素节点\n                oldVnode = null\n            }\n        }\n        // some code \n        return vnode\n    }\n```\npatch函数接收两个参数oldVnode和Vnode分别代表新的节点和之前的旧节点\n\n*判断两节点是否值得比较，值得比较则执行patchVnode*\n```javascript\n    function sameVnode (a, b) {\n        return (\n            a.key === b.key &&  // key值\n            a.tag === b.tag &&  // 标签名\n            a.isComment === b.isComment &&  // 是否为注释节点\n            // 是否都定义了data，data包含一些具体信息，例如onclick , style\n            isDef(a.data) === isDef(b.data) &&  \n            sameInputType(a, b) // 当标签是<input>的时候，type必须相同\n        )\n    }\n```\n*不值得比较则用Vnode替换oldVnode*\n如果两个节点都是一样的，那么就深入检查他们的子节点。如果两个节点不一样那就说明Vnode完全被改变了，就可以直接替换oldVnode。\n\n虽然这两个节点不一样但是他们的子节点一样怎么办？别忘了，diff可是逐层比较的，如果第一层不一样那么就不会继续深入比较第二层了。（我在想这算是一个缺点吗？相同子节点不能重复利用了...其实没这么简单，它利用闭包有个缓存机制）\n# patchVnode\n当我们确定两个节点值得比较之后我们会对两个节点指定patchVnode方法。那么这个方法做了什么呢？\n```javascript\n        patchVnode (oldVnode, vnode) {\n        const el = vnode.el = oldVnode.el\n        let i, oldCh = oldVnode.children, ch = vnode.children\n        if (oldVnode === vnode) return\n        if (oldVnode.text !== null && vnode.text !== null && oldVnode.text !== vnode.text) {\n            api.setTextContent(el, vnode.text)\n        }else {\n            updateEle(el, vnode, oldVnode)\n            if (oldCh && ch && oldCh !== ch) {\n                updateChildren(el, oldCh, ch)\n            }else if (ch){\n                createEle(vnode) //create el's children dom\n            }else if (oldCh){\n                api.removeChildren(el)\n            }\n        }\n    }\n```\n这个函数做了以下事情：\n\n找到对应的真实dom，称为el\n判断Vnode和oldVnode是否指向同一个对象，如果是，那么直接return\n如果他们都有文本节点并且不相等，那么将el的文本节点设置为Vnode的文本节点。\n如果oldVnode有子节点而Vnode没有，则删除el的子节点\n如果oldVnode没有子节点而Vnode有，则将Vnode的子节点真实化之后添加到el\n如果两者都有子节点，则执行updateChildren函数比较子节点，这一步很重要\n其他几个点都很好理解，我们详细来讲一下updateChildren\n# updateChildren\n```javascript\n        updateChildren (parentElm, oldCh, newCh) {\n        let oldStartIdx = 0, newStartIdx = 0\n        let oldEndIdx = oldCh.length - 1\n        let oldStartVnode = oldCh[0]\n        let oldEndVnode = oldCh[oldEndIdx]\n        let newEndIdx = newCh.length - 1\n        let newStartVnode = newCh[0]\n        let newEndVnode = newCh[newEndIdx]\n        let oldKeyToIdx\n        let idxInOld\n        let elmToMove\n        let before\n        while (oldStartIdx <= oldEndIdx && newStartIdx <= newEndIdx) {\n            if (oldStartVnode == null) {   // 对于vnode.key的比较，会把oldVnode = null\n                oldStartVnode = oldCh[++oldStartIdx] \n            }else if (oldEndVnode == null) {\n                oldEndVnode = oldCh[--oldEndIdx]\n            }else if (newStartVnode == null) {\n                newStartVnode = newCh[++newStartIdx]\n            }else if (newEndVnode == null) {\n                newEndVnode = newCh[--newEndIdx]\n            }else if (sameVnode(oldStartVnode, newStartVnode)) {\n                patchVnode(oldStartVnode, newStartVnode)\n                oldStartVnode = oldCh[++oldStartIdx]\n                newStartVnode = newCh[++newStartIdx]\n            }else if (sameVnode(oldEndVnode, newEndVnode)) {\n                patchVnode(oldEndVnode, newEndVnode)\n                oldEndVnode = oldCh[--oldEndIdx]\n                newEndVnode = newCh[--newEndIdx]\n            }else if (sameVnode(oldStartVnode, newEndVnode)) {\n                patchVnode(oldStartVnode, newEndVnode)\n                api.insertBefore(parentElm, oldStartVnode.el, api.nextSibling(oldEndVnode.el))\n                oldStartVnode = oldCh[++oldStartIdx]\n                newEndVnode = newCh[--newEndIdx]\n            }else if (sameVnode(oldEndVnode, newStartVnode)) {\n                patchVnode(oldEndVnode, newStartVnode)\n                api.insertBefore(parentElm, oldEndVnode.el, oldStartVnode.el)\n                oldEndVnode = oldCh[--oldEndIdx]\n                newStartVnode = newCh[++newStartIdx]\n            }else {\n            // 使用key时的比较\n                if (oldKeyToIdx === undefined) {\n                    oldKeyToIdx = createKeyToOldIdx(oldCh, oldStartIdx, oldEndIdx) // 有key生成index表\n                }\n                idxInOld = oldKeyToIdx[newStartVnode.key]\n                if (!idxInOld) {\n                    api.insertBefore(parentElm, createEle(newStartVnode).el, oldStartVnode.el)\n                    newStartVnode = newCh[++newStartIdx]\n                }\n                else {\n                    elmToMove = oldCh[idxInOld]\n                    if (elmToMove.sel !== newStartVnode.sel) {\n                        api.insertBefore(parentElm, createEle(newStartVnode).el, oldStartVnode.el)\n                    }else {\n                        patchVnode(elmToMove, newStartVnode)\n                        oldCh[idxInOld] = null\n                        api.insertBefore(parentElm, elmToMove.el, oldStartVnode.el)\n                    }\n                    newStartVnode = newCh[++newStartIdx]\n                }\n            }\n        }\n        if (oldStartIdx > oldEndIdx) {\n            before = newCh[newEndIdx + 1] == null ? null : newCh[newEndIdx + 1].el\n            addVnodes(parentElm, before, newCh, newStartIdx, newEndIdx)\n        }else if (newStartIdx > newEndIdx) {\n            removeVnodes(parentElm, oldCh, oldStartIdx, oldEndIdx)\n        }\n    }\n```\n先说一下这个函数做了什么\n\n* 将Vnode的子节点Vch和oldVnode的子节点oldCh提取出来\n* oldCh和vCh各有两个头尾的变量StartIdx和EndIdx，它们的2个变量相互比较，一共有4种比较方式。如果4种比较都没匹配，如果设置了key，就会用key进行比较，在比较的过程中，变量会往中间靠，一旦StartIdx>EndIdx表明oldCh和vCh至少有一个已经遍历完了，就会结束比较。\n\n# 图解updateChildren\n终于来到了这一部分，上面的总结相信很多人也看得一脸懵逼，下面我们好好说道说道。\n<img src=\"/img/updateChildren.png\" >\n现在分别对oldS、oldE、S、E两两做sameVnode比较，有四种比较方式，当其中两个能匹配上那么真实dom中的相应节点会移到Vnode相应的位置，这句话有点绕，打个比方\n\n* 如果是oldS和E匹配上了，那么真实dom中的第一个节点会移到最后\n* 如果是oldE和S匹配上了，那么真实dom中的最后一个节点会移到最前，匹配上的两个指针向中间移动\n* 如果四种匹配没有一对是成功的，那么遍历oldChild，S挨个和他们匹配，匹配成功就在真实dom中将成功的节点移到最前面，如果依旧没有成功的，那么将S对应的节点插入到dom中对应的oldS位置，oldS和S指针向中间移动。\n<img src=\"/img/sameVnode.png\">\n\n第一步\n\n    oldS = a, oldE = d；\n    S = a, E = b;\n\noldS和S匹配，则将dom中的a节点放到第一个，已经是第一个了就不管了，此时dom的位置为：a b d\n第二步\n\n    oldS = b, oldE = d；\n    S = c, E = b;\n\noldS和E匹配，就将原本的b节点移动到最后，因为E是最后一个节点，他们位置要一致，这就是上面说的：当其中两个能匹配上那么真实dom中的相应节点会移到Vnode相应的位置，此时dom的位置为：a d b\n第三步\n\n    oldS = d, oldE = d；\n    S = c, E = d;\n\noldE和E匹配，位置不变此时dom的位置为：a d b\n第四步\n\n    oldS++;\n    oldE--;\n    oldS > oldE;\n\n遍历结束，说明oldCh先遍历完。就将剩余的vCh节点根据自己的的index插入到真实dom中去，此时dom位置为：a c d b\n一次模拟完成。\n这个匹配过程的结束有两个条件：\n* oldS > oldE表示oldCh先遍历完，那么就将多余的vCh根据index添加到dom中去（如上图）\n* S > E表示vCh先遍历完，那么就在真实dom中将区间为[oldS, oldE]的多余节点删掉\n\n<img src=\"/img/dom.png\">\n\n下面再举一个例子，可以像上面那样自己试着模拟一下\n<img src=\"/img/dom1.png\">\n\n当这些节点sameVnode成功后就会紧接着执行patchVnode了，可以看一下上面的代码\n```javascript\n    if (sameVnode(oldStartVnode, newStartVnode)) {\n        patchVnode(oldStartVnode, newStartVnode)\n    }\n```\n就这样层层递归下去，直到将oldVnode和Vnode中的所有子节点比对完。也将dom的所有补丁都打好啦。那么现在再回过去看updateChildren的代码会不会容易很多呢？\n\n","source":"_posts/vue-diff算法.md","raw":"---\ntitle: vue中diff算法详解\ndate: 2019-01-30 12:53:01\ncategories: web\ntags:\n    - vue的diff算法\ncopyright:\nkeywords:\ndescription:\n---\n{% cq %}[可以先看Vuejs运行机制](https://zhanghuaxiao.github.io/2019/01/30/vue-source-code/){% endcq %}\n<!--more-->\n#  当数据发生变化时，vue是怎么更新节点的？\n要知道渲染真实DOM的开销是很大的，比如有时候我们修改了某个数据，如果直接渲染到真实dom上会引起整个dom树的重绘和重排，有没有可能我们只更新我们修改的那一小块dom而不要更新整个dom呢？diff算法能够帮助我们。\n\n我们先根据真实DOM生成一颗virtual DOM，当virtual DOM某个节点的数据改变后会生成一个新的Vnode，然后Vnode和oldVnode作对比，发现有不一样的地方就直接修改在真实的DOM上，然后使oldVnode的值为Vnode。\n\ndiff的过程就是调用名为patch的函数，比较新旧节点，一边比较一边给真实的DOM打补丁。\n# virtual DOM和真实DOM的区别？\nvirtual DOM是将真实的DOM的数据抽取出来，以对象的形式模拟树形结构。比如dom是这样的：\n```javascript\n    <div>\n        <p>123</p>\n    </div>\n\n对应的virtual DOM（伪代码）：\n\n    var Vnode = {\n        tag: 'div',\n        children: [\n            { tag: 'p', text: '123' }\n        ]\n    };\n```\n（温馨提示：VNode和oldVNode都是对象，一定要记住）\n# diff的比较方式？\n在采取diff算法比较新旧节点的时候，比较只会在同层级进行, 不会跨层级比较。\n```javascript\n    <div>\n        <p>123</p>\n    </div>\n\n    <div>\n        <span>456</span>\n    </div>\n```\n上面的代码会分别比较同一层的两个div以及第二层的p和span，但是不会拿div和span作比较。在别处看到的一张很形象的图：\n<img src=\"/img/diff.png\">\n# diff流程图\n当数据发生改变时，set方法会让调用Dep.notify通知所有订阅者Watcher，订阅者就会调用patch给真实的DOM打补丁，更新相应的视图\n<img src=\"/img/diff-diagram.png\">\n# 具体分析\npatch\n来看看patch是怎么打补丁的（代码只保留核心部分）\n```javascript\n    function patch (oldVnode,vnode){\n        //some code\n        if(sameVnode(oldVnode,vnode)){\n            patchVnode(oldVnode,vnode)\n        }else{\n            const oEl = oldVnode.el   //当前oldVnode对应的真实元素节点\n            let parentEle = api.parentNode(oEl)   //父元素\n            createEle(vnode)   //根据Vnode生成新元素\n                if (parentEle !== null) {\n                // 将新元素添加进父元素    \n                api.insertBefore(parentEle, vnode.el, api.nextSibling(oEl)) \n                api.removeChild(parentEle, oldVnode.el)  // 移除以前的旧元素节点\n                oldVnode = null\n            }\n        }\n        // some code \n        return vnode\n    }\n```\npatch函数接收两个参数oldVnode和Vnode分别代表新的节点和之前的旧节点\n\n*判断两节点是否值得比较，值得比较则执行patchVnode*\n```javascript\n    function sameVnode (a, b) {\n        return (\n            a.key === b.key &&  // key值\n            a.tag === b.tag &&  // 标签名\n            a.isComment === b.isComment &&  // 是否为注释节点\n            // 是否都定义了data，data包含一些具体信息，例如onclick , style\n            isDef(a.data) === isDef(b.data) &&  \n            sameInputType(a, b) // 当标签是<input>的时候，type必须相同\n        )\n    }\n```\n*不值得比较则用Vnode替换oldVnode*\n如果两个节点都是一样的，那么就深入检查他们的子节点。如果两个节点不一样那就说明Vnode完全被改变了，就可以直接替换oldVnode。\n\n虽然这两个节点不一样但是他们的子节点一样怎么办？别忘了，diff可是逐层比较的，如果第一层不一样那么就不会继续深入比较第二层了。（我在想这算是一个缺点吗？相同子节点不能重复利用了...其实没这么简单，它利用闭包有个缓存机制）\n# patchVnode\n当我们确定两个节点值得比较之后我们会对两个节点指定patchVnode方法。那么这个方法做了什么呢？\n```javascript\n        patchVnode (oldVnode, vnode) {\n        const el = vnode.el = oldVnode.el\n        let i, oldCh = oldVnode.children, ch = vnode.children\n        if (oldVnode === vnode) return\n        if (oldVnode.text !== null && vnode.text !== null && oldVnode.text !== vnode.text) {\n            api.setTextContent(el, vnode.text)\n        }else {\n            updateEle(el, vnode, oldVnode)\n            if (oldCh && ch && oldCh !== ch) {\n                updateChildren(el, oldCh, ch)\n            }else if (ch){\n                createEle(vnode) //create el's children dom\n            }else if (oldCh){\n                api.removeChildren(el)\n            }\n        }\n    }\n```\n这个函数做了以下事情：\n\n找到对应的真实dom，称为el\n判断Vnode和oldVnode是否指向同一个对象，如果是，那么直接return\n如果他们都有文本节点并且不相等，那么将el的文本节点设置为Vnode的文本节点。\n如果oldVnode有子节点而Vnode没有，则删除el的子节点\n如果oldVnode没有子节点而Vnode有，则将Vnode的子节点真实化之后添加到el\n如果两者都有子节点，则执行updateChildren函数比较子节点，这一步很重要\n其他几个点都很好理解，我们详细来讲一下updateChildren\n# updateChildren\n```javascript\n        updateChildren (parentElm, oldCh, newCh) {\n        let oldStartIdx = 0, newStartIdx = 0\n        let oldEndIdx = oldCh.length - 1\n        let oldStartVnode = oldCh[0]\n        let oldEndVnode = oldCh[oldEndIdx]\n        let newEndIdx = newCh.length - 1\n        let newStartVnode = newCh[0]\n        let newEndVnode = newCh[newEndIdx]\n        let oldKeyToIdx\n        let idxInOld\n        let elmToMove\n        let before\n        while (oldStartIdx <= oldEndIdx && newStartIdx <= newEndIdx) {\n            if (oldStartVnode == null) {   // 对于vnode.key的比较，会把oldVnode = null\n                oldStartVnode = oldCh[++oldStartIdx] \n            }else if (oldEndVnode == null) {\n                oldEndVnode = oldCh[--oldEndIdx]\n            }else if (newStartVnode == null) {\n                newStartVnode = newCh[++newStartIdx]\n            }else if (newEndVnode == null) {\n                newEndVnode = newCh[--newEndIdx]\n            }else if (sameVnode(oldStartVnode, newStartVnode)) {\n                patchVnode(oldStartVnode, newStartVnode)\n                oldStartVnode = oldCh[++oldStartIdx]\n                newStartVnode = newCh[++newStartIdx]\n            }else if (sameVnode(oldEndVnode, newEndVnode)) {\n                patchVnode(oldEndVnode, newEndVnode)\n                oldEndVnode = oldCh[--oldEndIdx]\n                newEndVnode = newCh[--newEndIdx]\n            }else if (sameVnode(oldStartVnode, newEndVnode)) {\n                patchVnode(oldStartVnode, newEndVnode)\n                api.insertBefore(parentElm, oldStartVnode.el, api.nextSibling(oldEndVnode.el))\n                oldStartVnode = oldCh[++oldStartIdx]\n                newEndVnode = newCh[--newEndIdx]\n            }else if (sameVnode(oldEndVnode, newStartVnode)) {\n                patchVnode(oldEndVnode, newStartVnode)\n                api.insertBefore(parentElm, oldEndVnode.el, oldStartVnode.el)\n                oldEndVnode = oldCh[--oldEndIdx]\n                newStartVnode = newCh[++newStartIdx]\n            }else {\n            // 使用key时的比较\n                if (oldKeyToIdx === undefined) {\n                    oldKeyToIdx = createKeyToOldIdx(oldCh, oldStartIdx, oldEndIdx) // 有key生成index表\n                }\n                idxInOld = oldKeyToIdx[newStartVnode.key]\n                if (!idxInOld) {\n                    api.insertBefore(parentElm, createEle(newStartVnode).el, oldStartVnode.el)\n                    newStartVnode = newCh[++newStartIdx]\n                }\n                else {\n                    elmToMove = oldCh[idxInOld]\n                    if (elmToMove.sel !== newStartVnode.sel) {\n                        api.insertBefore(parentElm, createEle(newStartVnode).el, oldStartVnode.el)\n                    }else {\n                        patchVnode(elmToMove, newStartVnode)\n                        oldCh[idxInOld] = null\n                        api.insertBefore(parentElm, elmToMove.el, oldStartVnode.el)\n                    }\n                    newStartVnode = newCh[++newStartIdx]\n                }\n            }\n        }\n        if (oldStartIdx > oldEndIdx) {\n            before = newCh[newEndIdx + 1] == null ? null : newCh[newEndIdx + 1].el\n            addVnodes(parentElm, before, newCh, newStartIdx, newEndIdx)\n        }else if (newStartIdx > newEndIdx) {\n            removeVnodes(parentElm, oldCh, oldStartIdx, oldEndIdx)\n        }\n    }\n```\n先说一下这个函数做了什么\n\n* 将Vnode的子节点Vch和oldVnode的子节点oldCh提取出来\n* oldCh和vCh各有两个头尾的变量StartIdx和EndIdx，它们的2个变量相互比较，一共有4种比较方式。如果4种比较都没匹配，如果设置了key，就会用key进行比较，在比较的过程中，变量会往中间靠，一旦StartIdx>EndIdx表明oldCh和vCh至少有一个已经遍历完了，就会结束比较。\n\n# 图解updateChildren\n终于来到了这一部分，上面的总结相信很多人也看得一脸懵逼，下面我们好好说道说道。\n<img src=\"/img/updateChildren.png\" >\n现在分别对oldS、oldE、S、E两两做sameVnode比较，有四种比较方式，当其中两个能匹配上那么真实dom中的相应节点会移到Vnode相应的位置，这句话有点绕，打个比方\n\n* 如果是oldS和E匹配上了，那么真实dom中的第一个节点会移到最后\n* 如果是oldE和S匹配上了，那么真实dom中的最后一个节点会移到最前，匹配上的两个指针向中间移动\n* 如果四种匹配没有一对是成功的，那么遍历oldChild，S挨个和他们匹配，匹配成功就在真实dom中将成功的节点移到最前面，如果依旧没有成功的，那么将S对应的节点插入到dom中对应的oldS位置，oldS和S指针向中间移动。\n<img src=\"/img/sameVnode.png\">\n\n第一步\n\n    oldS = a, oldE = d；\n    S = a, E = b;\n\noldS和S匹配，则将dom中的a节点放到第一个，已经是第一个了就不管了，此时dom的位置为：a b d\n第二步\n\n    oldS = b, oldE = d；\n    S = c, E = b;\n\noldS和E匹配，就将原本的b节点移动到最后，因为E是最后一个节点，他们位置要一致，这就是上面说的：当其中两个能匹配上那么真实dom中的相应节点会移到Vnode相应的位置，此时dom的位置为：a d b\n第三步\n\n    oldS = d, oldE = d；\n    S = c, E = d;\n\noldE和E匹配，位置不变此时dom的位置为：a d b\n第四步\n\n    oldS++;\n    oldE--;\n    oldS > oldE;\n\n遍历结束，说明oldCh先遍历完。就将剩余的vCh节点根据自己的的index插入到真实dom中去，此时dom位置为：a c d b\n一次模拟完成。\n这个匹配过程的结束有两个条件：\n* oldS > oldE表示oldCh先遍历完，那么就将多余的vCh根据index添加到dom中去（如上图）\n* S > E表示vCh先遍历完，那么就在真实dom中将区间为[oldS, oldE]的多余节点删掉\n\n<img src=\"/img/dom.png\">\n\n下面再举一个例子，可以像上面那样自己试着模拟一下\n<img src=\"/img/dom1.png\">\n\n当这些节点sameVnode成功后就会紧接着执行patchVnode了，可以看一下上面的代码\n```javascript\n    if (sameVnode(oldStartVnode, newStartVnode)) {\n        patchVnode(oldStartVnode, newStartVnode)\n    }\n```\n就这样层层递归下去，直到将oldVnode和Vnode中的所有子节点比对完。也将dom的所有补丁都打好啦。那么现在再回过去看updateChildren的代码会不会容易很多呢？\n\n","slug":"vue-diff算法","published":1,"updated":"2026-01-02T00:43:17.574Z","comments":1,"layout":"post","photos":[],"_id":"cmjwbsw66000xrotggpd77ywm","content":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p><a href=\"https://zhanghuaxiao.github.io/2019/01/30/vue-source-code/\">可以先看Vuejs运行机制</a></p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n<span id=\"more\"></span>\n<h1 id=\"当数据发生变化时，vue是怎么更新节点的？\"><a href=\"#当数据发生变化时，vue是怎么更新节点的？\" class=\"headerlink\" title=\"当数据发生变化时，vue是怎么更新节点的？\"></a>当数据发生变化时，vue是怎么更新节点的？</h1><p>要知道渲染真实DOM的开销是很大的，比如有时候我们修改了某个数据，如果直接渲染到真实dom上会引起整个dom树的重绘和重排，有没有可能我们只更新我们修改的那一小块dom而不要更新整个dom呢？diff算法能够帮助我们。</p>\n<p>我们先根据真实DOM生成一颗virtual DOM，当virtual DOM某个节点的数据改变后会生成一个新的Vnode，然后Vnode和oldVnode作对比，发现有不一样的地方就直接修改在真实的DOM上，然后使oldVnode的值为Vnode。</p>\n<p>diff的过程就是调用名为patch的函数，比较新旧节点，一边比较一边给真实的DOM打补丁。</p>\n<h1 id=\"virtual-DOM和真实DOM的区别？\"><a href=\"#virtual-DOM和真实DOM的区别？\" class=\"headerlink\" title=\"virtual DOM和真实DOM的区别？\"></a>virtual DOM和真实DOM的区别？</h1><p>virtual DOM是将真实的DOM的数据抽取出来，以对象的形式模拟树形结构。比如dom是这样的：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    &lt;div&gt;</span><br><span class=\"line\">        <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>123<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span></span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">对应的virtual <span class=\"variable constant_\">DOM</span>（伪代码）：</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> <span class=\"title class_\">Vnode</span> = &#123;</span><br><span class=\"line\">        <span class=\"attr\">tag</span>: <span class=\"string\">&#x27;div&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">children</span>: [</span><br><span class=\"line\">            &#123; <span class=\"attr\">tag</span>: <span class=\"string\">&#x27;p&#x27;</span>, <span class=\"attr\">text</span>: <span class=\"string\">&#x27;123&#x27;</span> &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">    &#125;;</span><br></pre></td></tr></table></figure>\n<p>（温馨提示：VNode和oldVNode都是对象，一定要记住）</p>\n<h1 id=\"diff的比较方式？\"><a href=\"#diff的比较方式？\" class=\"headerlink\" title=\"diff的比较方式？\"></a>diff的比较方式？</h1><p>在采取diff算法比较新旧节点的时候，比较只会在同层级进行, 不会跨层级比较。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div&gt;</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>123<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span></span><br><span class=\"line\">&lt;/div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>456<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n<p>上面的代码会分别比较同一层的两个div以及第二层的p和span，但是不会拿div和span作比较。在别处看到的一张很形象的图：<br><img src=\"/img/diff.png\"></p>\n<h1 id=\"diff流程图\"><a href=\"#diff流程图\" class=\"headerlink\" title=\"diff流程图\"></a>diff流程图</h1><p>当数据发生改变时，set方法会让调用Dep.notify通知所有订阅者Watcher，订阅者就会调用patch给真实的DOM打补丁，更新相应的视图<br><img src=\"/img/diff-diagram.png\"></p>\n<h1 id=\"具体分析\"><a href=\"#具体分析\" class=\"headerlink\" title=\"具体分析\"></a>具体分析</h1><p>patch<br>来看看patch是怎么打补丁的（代码只保留核心部分）</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">patch</span> (<span class=\"params\">oldVnode,vnode</span>)&#123;</span><br><span class=\"line\">    <span class=\"comment\">//some code</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"title function_\">sameVnode</span>(oldVnode,vnode))&#123;</span><br><span class=\"line\">        <span class=\"title function_\">patchVnode</span>(oldVnode,vnode)</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> oEl = oldVnode.<span class=\"property\">el</span>   <span class=\"comment\">//当前oldVnode对应的真实元素节点</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> parentEle = api.<span class=\"title function_\">parentNode</span>(oEl)   <span class=\"comment\">//父元素</span></span><br><span class=\"line\">        <span class=\"title function_\">createEle</span>(vnode)   <span class=\"comment\">//根据Vnode生成新元素</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (parentEle !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 将新元素添加进父元素    </span></span><br><span class=\"line\">            api.<span class=\"title function_\">insertBefore</span>(parentEle, vnode.<span class=\"property\">el</span>, api.<span class=\"title function_\">nextSibling</span>(oEl)) </span><br><span class=\"line\">            api.<span class=\"title function_\">removeChild</span>(parentEle, oldVnode.<span class=\"property\">el</span>)  <span class=\"comment\">// 移除以前的旧元素节点</span></span><br><span class=\"line\">            oldVnode = <span class=\"literal\">null</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// some code </span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> vnode</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>patch函数接收两个参数oldVnode和Vnode分别代表新的节点和之前的旧节点</p>\n<p><em>判断两节点是否值得比较，值得比较则执行patchVnode</em></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">sameVnode</span> (<span class=\"params\">a, b</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">        a.<span class=\"property\">key</span> === b.<span class=\"property\">key</span> &amp;&amp;  <span class=\"comment\">// key值</span></span><br><span class=\"line\">        a.<span class=\"property\">tag</span> === b.<span class=\"property\">tag</span> &amp;&amp;  <span class=\"comment\">// 标签名</span></span><br><span class=\"line\">        a.<span class=\"property\">isComment</span> === b.<span class=\"property\">isComment</span> &amp;&amp;  <span class=\"comment\">// 是否为注释节点</span></span><br><span class=\"line\">        <span class=\"comment\">// 是否都定义了data，data包含一些具体信息，例如onclick , style</span></span><br><span class=\"line\">        <span class=\"title function_\">isDef</span>(a.<span class=\"property\">data</span>) === <span class=\"title function_\">isDef</span>(b.<span class=\"property\">data</span>) &amp;&amp;  </span><br><span class=\"line\">        <span class=\"title function_\">sameInputType</span>(a, b) <span class=\"comment\">// 当标签是&lt;input&gt;的时候，type必须相同</span></span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><em>不值得比较则用Vnode替换oldVnode</em><br>如果两个节点都是一样的，那么就深入检查他们的子节点。如果两个节点不一样那就说明Vnode完全被改变了，就可以直接替换oldVnode。</p>\n<p>虽然这两个节点不一样但是他们的子节点一样怎么办？别忘了，diff可是逐层比较的，如果第一层不一样那么就不会继续深入比较第二层了。（我在想这算是一个缺点吗？相同子节点不能重复利用了…其实没这么简单，它利用闭包有个缓存机制）</p>\n<h1 id=\"patchVnode\"><a href=\"#patchVnode\" class=\"headerlink\" title=\"patchVnode\"></a>patchVnode</h1><p>当我们确定两个节点值得比较之后我们会对两个节点指定patchVnode方法。那么这个方法做了什么呢？</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    <span class=\"title function_\">patchVnode</span> (oldVnode, vnode) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> el = vnode.<span class=\"property\">el</span> = oldVnode.<span class=\"property\">el</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> i, oldCh = oldVnode.<span class=\"property\">children</span>, ch = vnode.<span class=\"property\">children</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (oldVnode === vnode) <span class=\"keyword\">return</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (oldVnode.<span class=\"property\">text</span> !== <span class=\"literal\">null</span> &amp;&amp; vnode.<span class=\"property\">text</span> !== <span class=\"literal\">null</span> &amp;&amp; oldVnode.<span class=\"property\">text</span> !== vnode.<span class=\"property\">text</span>) &#123;</span><br><span class=\"line\">        api.<span class=\"title function_\">setTextContent</span>(el, vnode.<span class=\"property\">text</span>)</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_\">updateEle</span>(el, vnode, oldVnode)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (oldCh &amp;&amp; ch &amp;&amp; oldCh !== ch) &#123;</span><br><span class=\"line\">            <span class=\"title function_\">updateChildren</span>(el, oldCh, ch)</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (ch)&#123;</span><br><span class=\"line\">            <span class=\"title function_\">createEle</span>(vnode) <span class=\"comment\">//create el&#x27;s children dom</span></span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (oldCh)&#123;</span><br><span class=\"line\">            api.<span class=\"title function_\">removeChildren</span>(el)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这个函数做了以下事情：</p>\n<p>找到对应的真实dom，称为el<br>判断Vnode和oldVnode是否指向同一个对象，如果是，那么直接return<br>如果他们都有文本节点并且不相等，那么将el的文本节点设置为Vnode的文本节点。<br>如果oldVnode有子节点而Vnode没有，则删除el的子节点<br>如果oldVnode没有子节点而Vnode有，则将Vnode的子节点真实化之后添加到el<br>如果两者都有子节点，则执行updateChildren函数比较子节点，这一步很重要<br>其他几个点都很好理解，我们详细来讲一下updateChildren</p>\n<h1 id=\"updateChildren\"><a href=\"#updateChildren\" class=\"headerlink\" title=\"updateChildren\"></a>updateChildren</h1><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    <span class=\"title function_\">updateChildren</span> (parentElm, oldCh, newCh) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> oldStartIdx = <span class=\"number\">0</span>, newStartIdx = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> oldEndIdx = oldCh.<span class=\"property\">length</span> - <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> oldStartVnode = oldCh[<span class=\"number\">0</span>]</span><br><span class=\"line\">    <span class=\"keyword\">let</span> oldEndVnode = oldCh[oldEndIdx]</span><br><span class=\"line\">    <span class=\"keyword\">let</span> newEndIdx = newCh.<span class=\"property\">length</span> - <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> newStartVnode = newCh[<span class=\"number\">0</span>]</span><br><span class=\"line\">    <span class=\"keyword\">let</span> newEndVnode = newCh[newEndIdx]</span><br><span class=\"line\">    <span class=\"keyword\">let</span> oldKeyToIdx</span><br><span class=\"line\">    <span class=\"keyword\">let</span> idxInOld</span><br><span class=\"line\">    <span class=\"keyword\">let</span> elmToMove</span><br><span class=\"line\">    <span class=\"keyword\">let</span> before</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (oldStartIdx &lt;= oldEndIdx &amp;&amp; newStartIdx &lt;= newEndIdx) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (oldStartVnode == <span class=\"literal\">null</span>) &#123;   <span class=\"comment\">// 对于vnode.key的比较，会把oldVnode = null</span></span><br><span class=\"line\">            oldStartVnode = oldCh[++oldStartIdx] </span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (oldEndVnode == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            oldEndVnode = oldCh[--oldEndIdx]</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (newStartVnode == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            newStartVnode = newCh[++newStartIdx]</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (newEndVnode == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            newEndVnode = newCh[--newEndIdx]</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"title function_\">sameVnode</span>(oldStartVnode, newStartVnode)) &#123;</span><br><span class=\"line\">            <span class=\"title function_\">patchVnode</span>(oldStartVnode, newStartVnode)</span><br><span class=\"line\">            oldStartVnode = oldCh[++oldStartIdx]</span><br><span class=\"line\">            newStartVnode = newCh[++newStartIdx]</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"title function_\">sameVnode</span>(oldEndVnode, newEndVnode)) &#123;</span><br><span class=\"line\">            <span class=\"title function_\">patchVnode</span>(oldEndVnode, newEndVnode)</span><br><span class=\"line\">            oldEndVnode = oldCh[--oldEndIdx]</span><br><span class=\"line\">            newEndVnode = newCh[--newEndIdx]</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"title function_\">sameVnode</span>(oldStartVnode, newEndVnode)) &#123;</span><br><span class=\"line\">            <span class=\"title function_\">patchVnode</span>(oldStartVnode, newEndVnode)</span><br><span class=\"line\">            api.<span class=\"title function_\">insertBefore</span>(parentElm, oldStartVnode.<span class=\"property\">el</span>, api.<span class=\"title function_\">nextSibling</span>(oldEndVnode.<span class=\"property\">el</span>))</span><br><span class=\"line\">            oldStartVnode = oldCh[++oldStartIdx]</span><br><span class=\"line\">            newEndVnode = newCh[--newEndIdx]</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"title function_\">sameVnode</span>(oldEndVnode, newStartVnode)) &#123;</span><br><span class=\"line\">            <span class=\"title function_\">patchVnode</span>(oldEndVnode, newStartVnode)</span><br><span class=\"line\">            api.<span class=\"title function_\">insertBefore</span>(parentElm, oldEndVnode.<span class=\"property\">el</span>, oldStartVnode.<span class=\"property\">el</span>)</span><br><span class=\"line\">            oldEndVnode = oldCh[--oldEndIdx]</span><br><span class=\"line\">            newStartVnode = newCh[++newStartIdx]</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 使用key时的比较</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (oldKeyToIdx === <span class=\"literal\">undefined</span>) &#123;</span><br><span class=\"line\">                oldKeyToIdx = <span class=\"title function_\">createKeyToOldIdx</span>(oldCh, oldStartIdx, oldEndIdx) <span class=\"comment\">// 有key生成index表</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            idxInOld = oldKeyToIdx[newStartVnode.<span class=\"property\">key</span>]</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!idxInOld) &#123;</span><br><span class=\"line\">                api.<span class=\"title function_\">insertBefore</span>(parentElm, <span class=\"title function_\">createEle</span>(newStartVnode).<span class=\"property\">el</span>, oldStartVnode.<span class=\"property\">el</span>)</span><br><span class=\"line\">                newStartVnode = newCh[++newStartIdx]</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                elmToMove = oldCh[idxInOld]</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (elmToMove.<span class=\"property\">sel</span> !== newStartVnode.<span class=\"property\">sel</span>) &#123;</span><br><span class=\"line\">                    api.<span class=\"title function_\">insertBefore</span>(parentElm, <span class=\"title function_\">createEle</span>(newStartVnode).<span class=\"property\">el</span>, oldStartVnode.<span class=\"property\">el</span>)</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"title function_\">patchVnode</span>(elmToMove, newStartVnode)</span><br><span class=\"line\">                    oldCh[idxInOld] = <span class=\"literal\">null</span></span><br><span class=\"line\">                    api.<span class=\"title function_\">insertBefore</span>(parentElm, elmToMove.<span class=\"property\">el</span>, oldStartVnode.<span class=\"property\">el</span>)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                newStartVnode = newCh[++newStartIdx]</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (oldStartIdx &gt; oldEndIdx) &#123;</span><br><span class=\"line\">        before = newCh[newEndIdx + <span class=\"number\">1</span>] == <span class=\"literal\">null</span> ? <span class=\"literal\">null</span> : newCh[newEndIdx + <span class=\"number\">1</span>].<span class=\"property\">el</span></span><br><span class=\"line\">        <span class=\"title function_\">addVnodes</span>(parentElm, before, newCh, newStartIdx, newEndIdx)</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (newStartIdx &gt; newEndIdx) &#123;</span><br><span class=\"line\">        <span class=\"title function_\">removeVnodes</span>(parentElm, oldCh, oldStartIdx, oldEndIdx)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>先说一下这个函数做了什么</p>\n<ul>\n<li>将Vnode的子节点Vch和oldVnode的子节点oldCh提取出来</li>\n<li>oldCh和vCh各有两个头尾的变量StartIdx和EndIdx，它们的2个变量相互比较，一共有4种比较方式。如果4种比较都没匹配，如果设置了key，就会用key进行比较，在比较的过程中，变量会往中间靠，一旦StartIdx&gt;EndIdx表明oldCh和vCh至少有一个已经遍历完了，就会结束比较。</li>\n</ul>\n<h1 id=\"图解updateChildren\"><a href=\"#图解updateChildren\" class=\"headerlink\" title=\"图解updateChildren\"></a>图解updateChildren</h1><p>终于来到了这一部分，上面的总结相信很多人也看得一脸懵逼，下面我们好好说道说道。<br><img src=\"/img/updateChildren.png\" ><br>现在分别对oldS、oldE、S、E两两做sameVnode比较，有四种比较方式，当其中两个能匹配上那么真实dom中的相应节点会移到Vnode相应的位置，这句话有点绕，打个比方</p>\n<ul>\n<li>如果是oldS和E匹配上了，那么真实dom中的第一个节点会移到最后</li>\n<li>如果是oldE和S匹配上了，那么真实dom中的最后一个节点会移到最前，匹配上的两个指针向中间移动</li>\n<li>如果四种匹配没有一对是成功的，那么遍历oldChild，S挨个和他们匹配，匹配成功就在真实dom中将成功的节点移到最前面，如果依旧没有成功的，那么将S对应的节点插入到dom中对应的oldS位置，oldS和S指针向中间移动。<img src=\"/img/sameVnode.png\"></li>\n</ul>\n<p>第一步</p>\n<pre><code>oldS = a, oldE = d；\nS = a, E = b;\n</code></pre>\n<p>oldS和S匹配，则将dom中的a节点放到第一个，已经是第一个了就不管了，此时dom的位置为：a b d<br>第二步</p>\n<pre><code>oldS = b, oldE = d；\nS = c, E = b;\n</code></pre>\n<p>oldS和E匹配，就将原本的b节点移动到最后，因为E是最后一个节点，他们位置要一致，这就是上面说的：当其中两个能匹配上那么真实dom中的相应节点会移到Vnode相应的位置，此时dom的位置为：a d b<br>第三步</p>\n<pre><code>oldS = d, oldE = d；\nS = c, E = d;\n</code></pre>\n<p>oldE和E匹配，位置不变此时dom的位置为：a d b<br>第四步</p>\n<pre><code>oldS++;\noldE--;\noldS &gt; oldE;\n</code></pre>\n<p>遍历结束，说明oldCh先遍历完。就将剩余的vCh节点根据自己的的index插入到真实dom中去，此时dom位置为：a c d b<br>一次模拟完成。<br>这个匹配过程的结束有两个条件：</p>\n<ul>\n<li>oldS &gt; oldE表示oldCh先遍历完，那么就将多余的vCh根据index添加到dom中去（如上图）</li>\n<li>S &gt; E表示vCh先遍历完，那么就在真实dom中将区间为[oldS, oldE]的多余节点删掉</li>\n</ul>\n<img src=\"/img/dom.png\">\n\n<p>下面再举一个例子，可以像上面那样自己试着模拟一下<br><img src=\"/img/dom1.png\"></p>\n<p>当这些节点sameVnode成功后就会紧接着执行patchVnode了，可以看一下上面的代码</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"title function_\">sameVnode</span>(oldStartVnode, newStartVnode)) &#123;</span><br><span class=\"line\">    <span class=\"title function_\">patchVnode</span>(oldStartVnode, newStartVnode)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>就这样层层递归下去，直到将oldVnode和Vnode中的所有子节点比对完。也将dom的所有补丁都打好啦。那么现在再回过去看updateChildren的代码会不会容易很多呢？</p>\n","excerpt":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p><a href=\"https://zhanghuaxiao.github.io/2019/01/30/vue-source-code/\">可以先看Vuejs运行机制</a></p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>","more":"<h1 id=\"当数据发生变化时，vue是怎么更新节点的？\"><a href=\"#当数据发生变化时，vue是怎么更新节点的？\" class=\"headerlink\" title=\"当数据发生变化时，vue是怎么更新节点的？\"></a>当数据发生变化时，vue是怎么更新节点的？</h1><p>要知道渲染真实DOM的开销是很大的，比如有时候我们修改了某个数据，如果直接渲染到真实dom上会引起整个dom树的重绘和重排，有没有可能我们只更新我们修改的那一小块dom而不要更新整个dom呢？diff算法能够帮助我们。</p>\n<p>我们先根据真实DOM生成一颗virtual DOM，当virtual DOM某个节点的数据改变后会生成一个新的Vnode，然后Vnode和oldVnode作对比，发现有不一样的地方就直接修改在真实的DOM上，然后使oldVnode的值为Vnode。</p>\n<p>diff的过程就是调用名为patch的函数，比较新旧节点，一边比较一边给真实的DOM打补丁。</p>\n<h1 id=\"virtual-DOM和真实DOM的区别？\"><a href=\"#virtual-DOM和真实DOM的区别？\" class=\"headerlink\" title=\"virtual DOM和真实DOM的区别？\"></a>virtual DOM和真实DOM的区别？</h1><p>virtual DOM是将真实的DOM的数据抽取出来，以对象的形式模拟树形结构。比如dom是这样的：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    &lt;div&gt;</span><br><span class=\"line\">        <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>123<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span></span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">对应的virtual <span class=\"variable constant_\">DOM</span>（伪代码）：</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> <span class=\"title class_\">Vnode</span> = &#123;</span><br><span class=\"line\">        <span class=\"attr\">tag</span>: <span class=\"string\">&#x27;div&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">children</span>: [</span><br><span class=\"line\">            &#123; <span class=\"attr\">tag</span>: <span class=\"string\">&#x27;p&#x27;</span>, <span class=\"attr\">text</span>: <span class=\"string\">&#x27;123&#x27;</span> &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">    &#125;;</span><br></pre></td></tr></table></figure>\n<p>（温馨提示：VNode和oldVNode都是对象，一定要记住）</p>\n<h1 id=\"diff的比较方式？\"><a href=\"#diff的比较方式？\" class=\"headerlink\" title=\"diff的比较方式？\"></a>diff的比较方式？</h1><p>在采取diff算法比较新旧节点的时候，比较只会在同层级进行, 不会跨层级比较。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div&gt;</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>123<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span></span><br><span class=\"line\">&lt;/div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>456<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n<p>上面的代码会分别比较同一层的两个div以及第二层的p和span，但是不会拿div和span作比较。在别处看到的一张很形象的图：<br><img src=\"/img/diff.png\"></p>\n<h1 id=\"diff流程图\"><a href=\"#diff流程图\" class=\"headerlink\" title=\"diff流程图\"></a>diff流程图</h1><p>当数据发生改变时，set方法会让调用Dep.notify通知所有订阅者Watcher，订阅者就会调用patch给真实的DOM打补丁，更新相应的视图<br><img src=\"/img/diff-diagram.png\"></p>\n<h1 id=\"具体分析\"><a href=\"#具体分析\" class=\"headerlink\" title=\"具体分析\"></a>具体分析</h1><p>patch<br>来看看patch是怎么打补丁的（代码只保留核心部分）</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">patch</span> (<span class=\"params\">oldVnode,vnode</span>)&#123;</span><br><span class=\"line\">    <span class=\"comment\">//some code</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"title function_\">sameVnode</span>(oldVnode,vnode))&#123;</span><br><span class=\"line\">        <span class=\"title function_\">patchVnode</span>(oldVnode,vnode)</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> oEl = oldVnode.<span class=\"property\">el</span>   <span class=\"comment\">//当前oldVnode对应的真实元素节点</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> parentEle = api.<span class=\"title function_\">parentNode</span>(oEl)   <span class=\"comment\">//父元素</span></span><br><span class=\"line\">        <span class=\"title function_\">createEle</span>(vnode)   <span class=\"comment\">//根据Vnode生成新元素</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (parentEle !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 将新元素添加进父元素    </span></span><br><span class=\"line\">            api.<span class=\"title function_\">insertBefore</span>(parentEle, vnode.<span class=\"property\">el</span>, api.<span class=\"title function_\">nextSibling</span>(oEl)) </span><br><span class=\"line\">            api.<span class=\"title function_\">removeChild</span>(parentEle, oldVnode.<span class=\"property\">el</span>)  <span class=\"comment\">// 移除以前的旧元素节点</span></span><br><span class=\"line\">            oldVnode = <span class=\"literal\">null</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// some code </span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> vnode</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>patch函数接收两个参数oldVnode和Vnode分别代表新的节点和之前的旧节点</p>\n<p><em>判断两节点是否值得比较，值得比较则执行patchVnode</em></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">sameVnode</span> (<span class=\"params\">a, b</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">        a.<span class=\"property\">key</span> === b.<span class=\"property\">key</span> &amp;&amp;  <span class=\"comment\">// key值</span></span><br><span class=\"line\">        a.<span class=\"property\">tag</span> === b.<span class=\"property\">tag</span> &amp;&amp;  <span class=\"comment\">// 标签名</span></span><br><span class=\"line\">        a.<span class=\"property\">isComment</span> === b.<span class=\"property\">isComment</span> &amp;&amp;  <span class=\"comment\">// 是否为注释节点</span></span><br><span class=\"line\">        <span class=\"comment\">// 是否都定义了data，data包含一些具体信息，例如onclick , style</span></span><br><span class=\"line\">        <span class=\"title function_\">isDef</span>(a.<span class=\"property\">data</span>) === <span class=\"title function_\">isDef</span>(b.<span class=\"property\">data</span>) &amp;&amp;  </span><br><span class=\"line\">        <span class=\"title function_\">sameInputType</span>(a, b) <span class=\"comment\">// 当标签是&lt;input&gt;的时候，type必须相同</span></span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><em>不值得比较则用Vnode替换oldVnode</em><br>如果两个节点都是一样的，那么就深入检查他们的子节点。如果两个节点不一样那就说明Vnode完全被改变了，就可以直接替换oldVnode。</p>\n<p>虽然这两个节点不一样但是他们的子节点一样怎么办？别忘了，diff可是逐层比较的，如果第一层不一样那么就不会继续深入比较第二层了。（我在想这算是一个缺点吗？相同子节点不能重复利用了…其实没这么简单，它利用闭包有个缓存机制）</p>\n<h1 id=\"patchVnode\"><a href=\"#patchVnode\" class=\"headerlink\" title=\"patchVnode\"></a>patchVnode</h1><p>当我们确定两个节点值得比较之后我们会对两个节点指定patchVnode方法。那么这个方法做了什么呢？</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    <span class=\"title function_\">patchVnode</span> (oldVnode, vnode) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> el = vnode.<span class=\"property\">el</span> = oldVnode.<span class=\"property\">el</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> i, oldCh = oldVnode.<span class=\"property\">children</span>, ch = vnode.<span class=\"property\">children</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (oldVnode === vnode) <span class=\"keyword\">return</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (oldVnode.<span class=\"property\">text</span> !== <span class=\"literal\">null</span> &amp;&amp; vnode.<span class=\"property\">text</span> !== <span class=\"literal\">null</span> &amp;&amp; oldVnode.<span class=\"property\">text</span> !== vnode.<span class=\"property\">text</span>) &#123;</span><br><span class=\"line\">        api.<span class=\"title function_\">setTextContent</span>(el, vnode.<span class=\"property\">text</span>)</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_\">updateEle</span>(el, vnode, oldVnode)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (oldCh &amp;&amp; ch &amp;&amp; oldCh !== ch) &#123;</span><br><span class=\"line\">            <span class=\"title function_\">updateChildren</span>(el, oldCh, ch)</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (ch)&#123;</span><br><span class=\"line\">            <span class=\"title function_\">createEle</span>(vnode) <span class=\"comment\">//create el&#x27;s children dom</span></span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (oldCh)&#123;</span><br><span class=\"line\">            api.<span class=\"title function_\">removeChildren</span>(el)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这个函数做了以下事情：</p>\n<p>找到对应的真实dom，称为el<br>判断Vnode和oldVnode是否指向同一个对象，如果是，那么直接return<br>如果他们都有文本节点并且不相等，那么将el的文本节点设置为Vnode的文本节点。<br>如果oldVnode有子节点而Vnode没有，则删除el的子节点<br>如果oldVnode没有子节点而Vnode有，则将Vnode的子节点真实化之后添加到el<br>如果两者都有子节点，则执行updateChildren函数比较子节点，这一步很重要<br>其他几个点都很好理解，我们详细来讲一下updateChildren</p>\n<h1 id=\"updateChildren\"><a href=\"#updateChildren\" class=\"headerlink\" title=\"updateChildren\"></a>updateChildren</h1><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    <span class=\"title function_\">updateChildren</span> (parentElm, oldCh, newCh) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> oldStartIdx = <span class=\"number\">0</span>, newStartIdx = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> oldEndIdx = oldCh.<span class=\"property\">length</span> - <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> oldStartVnode = oldCh[<span class=\"number\">0</span>]</span><br><span class=\"line\">    <span class=\"keyword\">let</span> oldEndVnode = oldCh[oldEndIdx]</span><br><span class=\"line\">    <span class=\"keyword\">let</span> newEndIdx = newCh.<span class=\"property\">length</span> - <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> newStartVnode = newCh[<span class=\"number\">0</span>]</span><br><span class=\"line\">    <span class=\"keyword\">let</span> newEndVnode = newCh[newEndIdx]</span><br><span class=\"line\">    <span class=\"keyword\">let</span> oldKeyToIdx</span><br><span class=\"line\">    <span class=\"keyword\">let</span> idxInOld</span><br><span class=\"line\">    <span class=\"keyword\">let</span> elmToMove</span><br><span class=\"line\">    <span class=\"keyword\">let</span> before</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (oldStartIdx &lt;= oldEndIdx &amp;&amp; newStartIdx &lt;= newEndIdx) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (oldStartVnode == <span class=\"literal\">null</span>) &#123;   <span class=\"comment\">// 对于vnode.key的比较，会把oldVnode = null</span></span><br><span class=\"line\">            oldStartVnode = oldCh[++oldStartIdx] </span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (oldEndVnode == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            oldEndVnode = oldCh[--oldEndIdx]</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (newStartVnode == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            newStartVnode = newCh[++newStartIdx]</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (newEndVnode == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            newEndVnode = newCh[--newEndIdx]</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"title function_\">sameVnode</span>(oldStartVnode, newStartVnode)) &#123;</span><br><span class=\"line\">            <span class=\"title function_\">patchVnode</span>(oldStartVnode, newStartVnode)</span><br><span class=\"line\">            oldStartVnode = oldCh[++oldStartIdx]</span><br><span class=\"line\">            newStartVnode = newCh[++newStartIdx]</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"title function_\">sameVnode</span>(oldEndVnode, newEndVnode)) &#123;</span><br><span class=\"line\">            <span class=\"title function_\">patchVnode</span>(oldEndVnode, newEndVnode)</span><br><span class=\"line\">            oldEndVnode = oldCh[--oldEndIdx]</span><br><span class=\"line\">            newEndVnode = newCh[--newEndIdx]</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"title function_\">sameVnode</span>(oldStartVnode, newEndVnode)) &#123;</span><br><span class=\"line\">            <span class=\"title function_\">patchVnode</span>(oldStartVnode, newEndVnode)</span><br><span class=\"line\">            api.<span class=\"title function_\">insertBefore</span>(parentElm, oldStartVnode.<span class=\"property\">el</span>, api.<span class=\"title function_\">nextSibling</span>(oldEndVnode.<span class=\"property\">el</span>))</span><br><span class=\"line\">            oldStartVnode = oldCh[++oldStartIdx]</span><br><span class=\"line\">            newEndVnode = newCh[--newEndIdx]</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"title function_\">sameVnode</span>(oldEndVnode, newStartVnode)) &#123;</span><br><span class=\"line\">            <span class=\"title function_\">patchVnode</span>(oldEndVnode, newStartVnode)</span><br><span class=\"line\">            api.<span class=\"title function_\">insertBefore</span>(parentElm, oldEndVnode.<span class=\"property\">el</span>, oldStartVnode.<span class=\"property\">el</span>)</span><br><span class=\"line\">            oldEndVnode = oldCh[--oldEndIdx]</span><br><span class=\"line\">            newStartVnode = newCh[++newStartIdx]</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 使用key时的比较</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (oldKeyToIdx === <span class=\"literal\">undefined</span>) &#123;</span><br><span class=\"line\">                oldKeyToIdx = <span class=\"title function_\">createKeyToOldIdx</span>(oldCh, oldStartIdx, oldEndIdx) <span class=\"comment\">// 有key生成index表</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            idxInOld = oldKeyToIdx[newStartVnode.<span class=\"property\">key</span>]</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!idxInOld) &#123;</span><br><span class=\"line\">                api.<span class=\"title function_\">insertBefore</span>(parentElm, <span class=\"title function_\">createEle</span>(newStartVnode).<span class=\"property\">el</span>, oldStartVnode.<span class=\"property\">el</span>)</span><br><span class=\"line\">                newStartVnode = newCh[++newStartIdx]</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                elmToMove = oldCh[idxInOld]</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (elmToMove.<span class=\"property\">sel</span> !== newStartVnode.<span class=\"property\">sel</span>) &#123;</span><br><span class=\"line\">                    api.<span class=\"title function_\">insertBefore</span>(parentElm, <span class=\"title function_\">createEle</span>(newStartVnode).<span class=\"property\">el</span>, oldStartVnode.<span class=\"property\">el</span>)</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"title function_\">patchVnode</span>(elmToMove, newStartVnode)</span><br><span class=\"line\">                    oldCh[idxInOld] = <span class=\"literal\">null</span></span><br><span class=\"line\">                    api.<span class=\"title function_\">insertBefore</span>(parentElm, elmToMove.<span class=\"property\">el</span>, oldStartVnode.<span class=\"property\">el</span>)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                newStartVnode = newCh[++newStartIdx]</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (oldStartIdx &gt; oldEndIdx) &#123;</span><br><span class=\"line\">        before = newCh[newEndIdx + <span class=\"number\">1</span>] == <span class=\"literal\">null</span> ? <span class=\"literal\">null</span> : newCh[newEndIdx + <span class=\"number\">1</span>].<span class=\"property\">el</span></span><br><span class=\"line\">        <span class=\"title function_\">addVnodes</span>(parentElm, before, newCh, newStartIdx, newEndIdx)</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (newStartIdx &gt; newEndIdx) &#123;</span><br><span class=\"line\">        <span class=\"title function_\">removeVnodes</span>(parentElm, oldCh, oldStartIdx, oldEndIdx)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>先说一下这个函数做了什么</p>\n<ul>\n<li>将Vnode的子节点Vch和oldVnode的子节点oldCh提取出来</li>\n<li>oldCh和vCh各有两个头尾的变量StartIdx和EndIdx，它们的2个变量相互比较，一共有4种比较方式。如果4种比较都没匹配，如果设置了key，就会用key进行比较，在比较的过程中，变量会往中间靠，一旦StartIdx&gt;EndIdx表明oldCh和vCh至少有一个已经遍历完了，就会结束比较。</li>\n</ul>\n<h1 id=\"图解updateChildren\"><a href=\"#图解updateChildren\" class=\"headerlink\" title=\"图解updateChildren\"></a>图解updateChildren</h1><p>终于来到了这一部分，上面的总结相信很多人也看得一脸懵逼，下面我们好好说道说道。<br><img src=\"/img/updateChildren.png\" ><br>现在分别对oldS、oldE、S、E两两做sameVnode比较，有四种比较方式，当其中两个能匹配上那么真实dom中的相应节点会移到Vnode相应的位置，这句话有点绕，打个比方</p>\n<ul>\n<li>如果是oldS和E匹配上了，那么真实dom中的第一个节点会移到最后</li>\n<li>如果是oldE和S匹配上了，那么真实dom中的最后一个节点会移到最前，匹配上的两个指针向中间移动</li>\n<li>如果四种匹配没有一对是成功的，那么遍历oldChild，S挨个和他们匹配，匹配成功就在真实dom中将成功的节点移到最前面，如果依旧没有成功的，那么将S对应的节点插入到dom中对应的oldS位置，oldS和S指针向中间移动。<img src=\"/img/sameVnode.png\"></li>\n</ul>\n<p>第一步</p>\n<pre><code>oldS = a, oldE = d；\nS = a, E = b;\n</code></pre>\n<p>oldS和S匹配，则将dom中的a节点放到第一个，已经是第一个了就不管了，此时dom的位置为：a b d<br>第二步</p>\n<pre><code>oldS = b, oldE = d；\nS = c, E = b;\n</code></pre>\n<p>oldS和E匹配，就将原本的b节点移动到最后，因为E是最后一个节点，他们位置要一致，这就是上面说的：当其中两个能匹配上那么真实dom中的相应节点会移到Vnode相应的位置，此时dom的位置为：a d b<br>第三步</p>\n<pre><code>oldS = d, oldE = d；\nS = c, E = d;\n</code></pre>\n<p>oldE和E匹配，位置不变此时dom的位置为：a d b<br>第四步</p>\n<pre><code>oldS++;\noldE--;\noldS &gt; oldE;\n</code></pre>\n<p>遍历结束，说明oldCh先遍历完。就将剩余的vCh节点根据自己的的index插入到真实dom中去，此时dom位置为：a c d b<br>一次模拟完成。<br>这个匹配过程的结束有两个条件：</p>\n<ul>\n<li>oldS &gt; oldE表示oldCh先遍历完，那么就将多余的vCh根据index添加到dom中去（如上图）</li>\n<li>S &gt; E表示vCh先遍历完，那么就在真实dom中将区间为[oldS, oldE]的多余节点删掉</li>\n</ul>\n<img src=\"/img/dom.png\">\n\n<p>下面再举一个例子，可以像上面那样自己试着模拟一下<br><img src=\"/img/dom1.png\"></p>\n<p>当这些节点sameVnode成功后就会紧接着执行patchVnode了，可以看一下上面的代码</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"title function_\">sameVnode</span>(oldStartVnode, newStartVnode)) &#123;</span><br><span class=\"line\">    <span class=\"title function_\">patchVnode</span>(oldStartVnode, newStartVnode)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>就这样层层递归下去，直到将oldVnode和Vnode中的所有子节点比对完。也将dom的所有补丁都打好啦。那么现在再回过去看updateChildren的代码会不会容易很多呢？</p>"},{"title":"Vue.js 内部运行机制","date":"2019-01-30T03:37:58.000Z","copyright":null,"keywords":null,"description":null,"_content":"{% cq %} 生活的全部意义在于无穷地探索尚未知道的东西，在于不断地增加更多的知识。————左拉 {% endcq %}\n<img src='/img/curious.jpg'>\n<!--more-->\n[原文地址](https://juejin.im/book/5a36661851882538e2259c0f/section/5a37bbb35188257d167a4d64)\n# 全局概览\n这一节笔者将为大家介绍一下 Vue.js 内部的整个流程，希望能让大家对全局有一个整体的印象，然后我们再来逐个模块进行讲解。从来没有了解过 Vue.js 实现的同学可能会对一些内容感到疑惑，这是很正常的，这一节的目的主要是为了让大家对整个流程有一个大概的认识，算是一个概览预备的过程，当把整本小册认真读完以后，再来阅读这一节，相信会有收获的。\n\n首先我们来看一下笔者画的内部流程图。\n<img src=\"/img/vuejsfrist.png\" class=\"full-image\">\n大家第一次看到这个图一定是一头雾水的，没有关系，我们来逐个讲一下这些模块的作用以及调用关系。相信讲完之后大家对Vue.js内部运行机制会有一个大概的认识。\n\n# 初始化及挂载\n<img src=\"/img/vuejs2.png\" class=\"full-image\">\n在 new Vue() 之后。 Vue 会调用 _init 函数进行初始化，也就是这里的 init 过程，它会初始化生命周期、事件、 props、 methods、 data、 computed 与 watch 等。其中最重要的是通过 Object.defineProperty 设置 setter 与 getter 函数，用来实现「响应式」以及「依赖收集」，后面会详细讲到，这里只要有一个印象即可。\n\n初始化之后调用 $mount 会挂载组件，如果是运行时编译，即不存在 render function 但是存在 template 的情况，需要进行「编译」步骤。\n\n# 编译\ncompile编译可以分成 parse、optimize 与 generate 三个阶段，最终需要得到 render function。\n<img src=\"/img/vuejs3.png\" class=\"full-image\">\n\n## parse\nparse 会用正则等方式解析 template 模板中的指令、class、style等数据，形成AST。\n\n## optimize\noptimize 的主要作用是标记 static 静态节点，这是 Vue 在编译过程中的一处优化，后面当 update 更新界面时，会有一个 patch 的过程， [diff](https://zhanghuaxiao.github.io/2019/01/30/vue-diff算法/#more) 算法会直接跳过静态节点，从而减少了比较的过程，优化了 patch 的性能。\n\n## generate\ngenerate 是将 AST 转化成 render function 字符串的过程，得到结果是 render 的字符串以及 staticRenderFns 字符串。\n\n在经历过 parse、optimize 与 generate 这三个阶段以后，组件中就会存在渲染 VNode 所需的 render function 了。\n\n# 响应式\n接下来也就是 Vue.js 响应式核心部分。\n<img src=\"/img/vuejs4.png\" class=\"full-image\">\n\n这里的 getter 跟 setter 已经在之前介绍过了，在 init 的时候通过 Object.defineProperty 进行了绑定，它使得当被设置的对象被读取的时候会执行 getter 函数，而在当被赋值的时候会执行 setter 函数。\n\n当 render function 被渲染的时候，因为会读取所需对象的值，所以会触发 getter 函数进行「依赖收集」，「依赖收集」的目的是将观察者 Watcher 对象存放到当前闭包中的订阅者 Dep 的 subs 中。形成如下所示的这样一个关系。\n<img src=\"/img/vuejs5.png\" class=\"full-image\">\n\n在修改对象的值的时候，会触发对应的 setter， setter 通知之前「依赖收集」得到的 Dep 中的每一个 Watcher，告诉它们自己的值改变了，需要重新渲染视图。这时候这些 Watcher 就会开始调用 update 来更新视图，当然这中间还有一个 patch 的过程以及使用队列来异步更新的策略，这个我们后面再讲。\n\n# Virtual DOM\n我们知道，render function 会被转化成 VNode 节点。Virtual DOM 其实就是一棵以 JavaScript 对象（ VNode 节点）作为基础的树，用对象属性来描述节点，实际上它只是一层对真实 DOM 的抽象。最终可以通过一系列操作使这棵树映射到真实环境上。由于 Virtual DOM 是以 JavaScript 对象为基础而不依赖真实平台环境，所以使它具有了跨平台的能力，比如说浏览器平台、Weex、Node 等。\n\n比如说下面这样一个例子：\n\n    {\n        tag: 'div',                 /*说明这是一个div标签*/\n        children: [                 /*存放该标签的子节点*/\n            {\n                tag: 'a',           /*说明这是一个a标签*/\n                text: 'click me'    /*标签的内容*/\n            }\n        ]\n    }\n\n渲染后可以得到\n\n    <div>\n        <a>click me</a>\n    </div>\n\n这只是一个简单的例子，实际上的节点有更多的属性来标志节点，比如 isStatic （代表是否为静态节点）、 isComment （代表是否为注释节点）等。\n\n# 更新视图\n<img src=\"/img/vuejs6.png\" class=\"full-image\">\n前面我们说到，在修改一个对象值的时候，会通过 setter -> Watcher -> update 的流程来修改对应的视图，那么最终是如何更新视图的呢？\n\n当数据变化后，执行 render function 就可以得到一个新的 VNode 节点，我们如果想要得到新的视图，最简单粗暴的方法就是直接解析这个新的 VNode 节点，然后用 innerHTML 直接全部渲染到真实 DOM 中。但是其实我们只对其中的一小块内容进行了修改，这样做似乎有些「浪费」。\n\n那么我们为什么不能只修改那些「改变了的地方」呢？这个时候就要介绍我们的「patch」了。我们会将新的 VNode 与旧的 VNode 一起传入 patch 进行比较，经过 diff 算法得出它们的「差异」。最后我们只需要将这些「差异」的对应 DOM 进行修改即可。\n\n# 再看全局\n<img src=\"/img/vuejs7.png\" class=\"full-image\">\n回过头再来看看这张图，是不是大脑中已经有一个大概的脉络了呢？","source":"_posts/vue-source-code.md","raw":"---\ntitle: Vue.js 内部运行机制\ndate: 2019-01-30 11:37:58\ncategories: web\ntags:\n    - Vue.js 内部运行机制\n    - patch\n    - render function \n    - diff\ncopyright:\nkeywords:\ndescription:\n---\n{% cq %} 生活的全部意义在于无穷地探索尚未知道的东西，在于不断地增加更多的知识。————左拉 {% endcq %}\n<img src='/img/curious.jpg'>\n<!--more-->\n[原文地址](https://juejin.im/book/5a36661851882538e2259c0f/section/5a37bbb35188257d167a4d64)\n# 全局概览\n这一节笔者将为大家介绍一下 Vue.js 内部的整个流程，希望能让大家对全局有一个整体的印象，然后我们再来逐个模块进行讲解。从来没有了解过 Vue.js 实现的同学可能会对一些内容感到疑惑，这是很正常的，这一节的目的主要是为了让大家对整个流程有一个大概的认识，算是一个概览预备的过程，当把整本小册认真读完以后，再来阅读这一节，相信会有收获的。\n\n首先我们来看一下笔者画的内部流程图。\n<img src=\"/img/vuejsfrist.png\" class=\"full-image\">\n大家第一次看到这个图一定是一头雾水的，没有关系，我们来逐个讲一下这些模块的作用以及调用关系。相信讲完之后大家对Vue.js内部运行机制会有一个大概的认识。\n\n# 初始化及挂载\n<img src=\"/img/vuejs2.png\" class=\"full-image\">\n在 new Vue() 之后。 Vue 会调用 _init 函数进行初始化，也就是这里的 init 过程，它会初始化生命周期、事件、 props、 methods、 data、 computed 与 watch 等。其中最重要的是通过 Object.defineProperty 设置 setter 与 getter 函数，用来实现「响应式」以及「依赖收集」，后面会详细讲到，这里只要有一个印象即可。\n\n初始化之后调用 $mount 会挂载组件，如果是运行时编译，即不存在 render function 但是存在 template 的情况，需要进行「编译」步骤。\n\n# 编译\ncompile编译可以分成 parse、optimize 与 generate 三个阶段，最终需要得到 render function。\n<img src=\"/img/vuejs3.png\" class=\"full-image\">\n\n## parse\nparse 会用正则等方式解析 template 模板中的指令、class、style等数据，形成AST。\n\n## optimize\noptimize 的主要作用是标记 static 静态节点，这是 Vue 在编译过程中的一处优化，后面当 update 更新界面时，会有一个 patch 的过程， [diff](https://zhanghuaxiao.github.io/2019/01/30/vue-diff算法/#more) 算法会直接跳过静态节点，从而减少了比较的过程，优化了 patch 的性能。\n\n## generate\ngenerate 是将 AST 转化成 render function 字符串的过程，得到结果是 render 的字符串以及 staticRenderFns 字符串。\n\n在经历过 parse、optimize 与 generate 这三个阶段以后，组件中就会存在渲染 VNode 所需的 render function 了。\n\n# 响应式\n接下来也就是 Vue.js 响应式核心部分。\n<img src=\"/img/vuejs4.png\" class=\"full-image\">\n\n这里的 getter 跟 setter 已经在之前介绍过了，在 init 的时候通过 Object.defineProperty 进行了绑定，它使得当被设置的对象被读取的时候会执行 getter 函数，而在当被赋值的时候会执行 setter 函数。\n\n当 render function 被渲染的时候，因为会读取所需对象的值，所以会触发 getter 函数进行「依赖收集」，「依赖收集」的目的是将观察者 Watcher 对象存放到当前闭包中的订阅者 Dep 的 subs 中。形成如下所示的这样一个关系。\n<img src=\"/img/vuejs5.png\" class=\"full-image\">\n\n在修改对象的值的时候，会触发对应的 setter， setter 通知之前「依赖收集」得到的 Dep 中的每一个 Watcher，告诉它们自己的值改变了，需要重新渲染视图。这时候这些 Watcher 就会开始调用 update 来更新视图，当然这中间还有一个 patch 的过程以及使用队列来异步更新的策略，这个我们后面再讲。\n\n# Virtual DOM\n我们知道，render function 会被转化成 VNode 节点。Virtual DOM 其实就是一棵以 JavaScript 对象（ VNode 节点）作为基础的树，用对象属性来描述节点，实际上它只是一层对真实 DOM 的抽象。最终可以通过一系列操作使这棵树映射到真实环境上。由于 Virtual DOM 是以 JavaScript 对象为基础而不依赖真实平台环境，所以使它具有了跨平台的能力，比如说浏览器平台、Weex、Node 等。\n\n比如说下面这样一个例子：\n\n    {\n        tag: 'div',                 /*说明这是一个div标签*/\n        children: [                 /*存放该标签的子节点*/\n            {\n                tag: 'a',           /*说明这是一个a标签*/\n                text: 'click me'    /*标签的内容*/\n            }\n        ]\n    }\n\n渲染后可以得到\n\n    <div>\n        <a>click me</a>\n    </div>\n\n这只是一个简单的例子，实际上的节点有更多的属性来标志节点，比如 isStatic （代表是否为静态节点）、 isComment （代表是否为注释节点）等。\n\n# 更新视图\n<img src=\"/img/vuejs6.png\" class=\"full-image\">\n前面我们说到，在修改一个对象值的时候，会通过 setter -> Watcher -> update 的流程来修改对应的视图，那么最终是如何更新视图的呢？\n\n当数据变化后，执行 render function 就可以得到一个新的 VNode 节点，我们如果想要得到新的视图，最简单粗暴的方法就是直接解析这个新的 VNode 节点，然后用 innerHTML 直接全部渲染到真实 DOM 中。但是其实我们只对其中的一小块内容进行了修改，这样做似乎有些「浪费」。\n\n那么我们为什么不能只修改那些「改变了的地方」呢？这个时候就要介绍我们的「patch」了。我们会将新的 VNode 与旧的 VNode 一起传入 patch 进行比较，经过 diff 算法得出它们的「差异」。最后我们只需要将这些「差异」的对应 DOM 进行修改即可。\n\n# 再看全局\n<img src=\"/img/vuejs7.png\" class=\"full-image\">\n回过头再来看看这张图，是不是大脑中已经有一个大概的脉络了呢？","slug":"vue-source-code","published":1,"updated":"2026-01-02T00:43:17.575Z","comments":1,"layout":"post","photos":[],"_id":"cmjwbsw66000zrotgf53kcj4o","content":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>生活的全部意义在于无穷地探索尚未知道的东西，在于不断地增加更多的知识。————左拉 </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n<img src='/img/curious.jpg'>\n<span id=\"more\"></span>\n[原文地址](https://juejin.im/book/5a36661851882538e2259c0f/section/5a37bbb35188257d167a4d64)\n# 全局概览\n这一节笔者将为大家介绍一下 Vue.js 内部的整个流程，希望能让大家对全局有一个整体的印象，然后我们再来逐个模块进行讲解。从来没有了解过 Vue.js 实现的同学可能会对一些内容感到疑惑，这是很正常的，这一节的目的主要是为了让大家对整个流程有一个大概的认识，算是一个概览预备的过程，当把整本小册认真读完以后，再来阅读这一节，相信会有收获的。\n\n<p>首先我们来看一下笔者画的内部流程图。<br><img src=\"/img/vuejsfrist.png\" class=\"full-image\"><br>大家第一次看到这个图一定是一头雾水的，没有关系，我们来逐个讲一下这些模块的作用以及调用关系。相信讲完之后大家对Vue.js内部运行机制会有一个大概的认识。</p>\n<h1 id=\"初始化及挂载\"><a href=\"#初始化及挂载\" class=\"headerlink\" title=\"初始化及挂载\"></a>初始化及挂载</h1><img src=\"/img/vuejs2.png\" class=\"full-image\">\n在 new Vue() 之后。 Vue 会调用 _init 函数进行初始化，也就是这里的 init 过程，它会初始化生命周期、事件、 props、 methods、 data、 computed 与 watch 等。其中最重要的是通过 Object.defineProperty 设置 setter 与 getter 函数，用来实现「响应式」以及「依赖收集」，后面会详细讲到，这里只要有一个印象即可。\n\n<p>初始化之后调用 $mount 会挂载组件，如果是运行时编译，即不存在 render function 但是存在 template 的情况，需要进行「编译」步骤。</p>\n<h1 id=\"编译\"><a href=\"#编译\" class=\"headerlink\" title=\"编译\"></a>编译</h1><p>compile编译可以分成 parse、optimize 与 generate 三个阶段，最终需要得到 render function。<br><img src=\"/img/vuejs3.png\" class=\"full-image\"></p>\n<h2 id=\"parse\"><a href=\"#parse\" class=\"headerlink\" title=\"parse\"></a>parse</h2><p>parse 会用正则等方式解析 template 模板中的指令、class、style等数据，形成AST。</p>\n<h2 id=\"optimize\"><a href=\"#optimize\" class=\"headerlink\" title=\"optimize\"></a>optimize</h2><p>optimize 的主要作用是标记 static 静态节点，这是 Vue 在编译过程中的一处优化，后面当 update 更新界面时，会有一个 patch 的过程， <a href=\"https://zhanghuaxiao.github.io/2019/01/30/vue-diff%E7%AE%97%E6%B3%95/#more\">diff</a> 算法会直接跳过静态节点，从而减少了比较的过程，优化了 patch 的性能。</p>\n<h2 id=\"generate\"><a href=\"#generate\" class=\"headerlink\" title=\"generate\"></a>generate</h2><p>generate 是将 AST 转化成 render function 字符串的过程，得到结果是 render 的字符串以及 staticRenderFns 字符串。</p>\n<p>在经历过 parse、optimize 与 generate 这三个阶段以后，组件中就会存在渲染 VNode 所需的 render function 了。</p>\n<h1 id=\"响应式\"><a href=\"#响应式\" class=\"headerlink\" title=\"响应式\"></a>响应式</h1><p>接下来也就是 Vue.js 响应式核心部分。<br><img src=\"/img/vuejs4.png\" class=\"full-image\"></p>\n<p>这里的 getter 跟 setter 已经在之前介绍过了，在 init 的时候通过 Object.defineProperty 进行了绑定，它使得当被设置的对象被读取的时候会执行 getter 函数，而在当被赋值的时候会执行 setter 函数。</p>\n<p>当 render function 被渲染的时候，因为会读取所需对象的值，所以会触发 getter 函数进行「依赖收集」，「依赖收集」的目的是将观察者 Watcher 对象存放到当前闭包中的订阅者 Dep 的 subs 中。形成如下所示的这样一个关系。<br><img src=\"/img/vuejs5.png\" class=\"full-image\"></p>\n<p>在修改对象的值的时候，会触发对应的 setter， setter 通知之前「依赖收集」得到的 Dep 中的每一个 Watcher，告诉它们自己的值改变了，需要重新渲染视图。这时候这些 Watcher 就会开始调用 update 来更新视图，当然这中间还有一个 patch 的过程以及使用队列来异步更新的策略，这个我们后面再讲。</p>\n<h1 id=\"Virtual-DOM\"><a href=\"#Virtual-DOM\" class=\"headerlink\" title=\"Virtual DOM\"></a>Virtual DOM</h1><p>我们知道，render function 会被转化成 VNode 节点。Virtual DOM 其实就是一棵以 JavaScript 对象（ VNode 节点）作为基础的树，用对象属性来描述节点，实际上它只是一层对真实 DOM 的抽象。最终可以通过一系列操作使这棵树映射到真实环境上。由于 Virtual DOM 是以 JavaScript 对象为基础而不依赖真实平台环境，所以使它具有了跨平台的能力，比如说浏览器平台、Weex、Node 等。</p>\n<p>比如说下面这样一个例子：</p>\n<pre><code>&#123;\n    tag: &#39;div&#39;,                 /*说明这是一个div标签*/\n    children: [                 /*存放该标签的子节点*/\n        &#123;\n            tag: &#39;a&#39;,           /*说明这是一个a标签*/\n            text: &#39;click me&#39;    /*标签的内容*/\n        &#125;\n    ]\n&#125;\n</code></pre>\n<p>渲染后可以得到</p>\n<pre><code>&lt;div&gt;\n    &lt;a&gt;click me&lt;/a&gt;\n&lt;/div&gt;\n</code></pre>\n<p>这只是一个简单的例子，实际上的节点有更多的属性来标志节点，比如 isStatic （代表是否为静态节点）、 isComment （代表是否为注释节点）等。</p>\n<h1 id=\"更新视图\"><a href=\"#更新视图\" class=\"headerlink\" title=\"更新视图\"></a>更新视图</h1><img src=\"/img/vuejs6.png\" class=\"full-image\">\n前面我们说到，在修改一个对象值的时候，会通过 setter -> Watcher -> update 的流程来修改对应的视图，那么最终是如何更新视图的呢？\n\n<p>当数据变化后，执行 render function 就可以得到一个新的 VNode 节点，我们如果想要得到新的视图，最简单粗暴的方法就是直接解析这个新的 VNode 节点，然后用 innerHTML 直接全部渲染到真实 DOM 中。但是其实我们只对其中的一小块内容进行了修改，这样做似乎有些「浪费」。</p>\n<p>那么我们为什么不能只修改那些「改变了的地方」呢？这个时候就要介绍我们的「patch」了。我们会将新的 VNode 与旧的 VNode 一起传入 patch 进行比较，经过 diff 算法得出它们的「差异」。最后我们只需要将这些「差异」的对应 DOM 进行修改即可。</p>\n<h1 id=\"再看全局\"><a href=\"#再看全局\" class=\"headerlink\" title=\"再看全局\"></a>再看全局</h1><img src=\"/img/vuejs7.png\" class=\"full-image\">\n回过头再来看看这张图，是不是大脑中已经有一个大概的脉络了呢？","excerpt":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>生活的全部意义在于无穷地探索尚未知道的东西，在于不断地增加更多的知识。————左拉 </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n<img src='/img/curious.jpg'>","more":"[原文地址](https://juejin.im/book/5a36661851882538e2259c0f/section/5a37bbb35188257d167a4d64)\n# 全局概览\n这一节笔者将为大家介绍一下 Vue.js 内部的整个流程，希望能让大家对全局有一个整体的印象，然后我们再来逐个模块进行讲解。从来没有了解过 Vue.js 实现的同学可能会对一些内容感到疑惑，这是很正常的，这一节的目的主要是为了让大家对整个流程有一个大概的认识，算是一个概览预备的过程，当把整本小册认真读完以后，再来阅读这一节，相信会有收获的。\n\n<p>首先我们来看一下笔者画的内部流程图。<br><img src=\"/img/vuejsfrist.png\" class=\"full-image\"><br>大家第一次看到这个图一定是一头雾水的，没有关系，我们来逐个讲一下这些模块的作用以及调用关系。相信讲完之后大家对Vue.js内部运行机制会有一个大概的认识。</p>\n<h1 id=\"初始化及挂载\"><a href=\"#初始化及挂载\" class=\"headerlink\" title=\"初始化及挂载\"></a>初始化及挂载</h1><img src=\"/img/vuejs2.png\" class=\"full-image\">\n在 new Vue() 之后。 Vue 会调用 _init 函数进行初始化，也就是这里的 init 过程，它会初始化生命周期、事件、 props、 methods、 data、 computed 与 watch 等。其中最重要的是通过 Object.defineProperty 设置 setter 与 getter 函数，用来实现「响应式」以及「依赖收集」，后面会详细讲到，这里只要有一个印象即可。\n\n<p>初始化之后调用 $mount 会挂载组件，如果是运行时编译，即不存在 render function 但是存在 template 的情况，需要进行「编译」步骤。</p>\n<h1 id=\"编译\"><a href=\"#编译\" class=\"headerlink\" title=\"编译\"></a>编译</h1><p>compile编译可以分成 parse、optimize 与 generate 三个阶段，最终需要得到 render function。<br><img src=\"/img/vuejs3.png\" class=\"full-image\"></p>\n<h2 id=\"parse\"><a href=\"#parse\" class=\"headerlink\" title=\"parse\"></a>parse</h2><p>parse 会用正则等方式解析 template 模板中的指令、class、style等数据，形成AST。</p>\n<h2 id=\"optimize\"><a href=\"#optimize\" class=\"headerlink\" title=\"optimize\"></a>optimize</h2><p>optimize 的主要作用是标记 static 静态节点，这是 Vue 在编译过程中的一处优化，后面当 update 更新界面时，会有一个 patch 的过程， <a href=\"https://zhanghuaxiao.github.io/2019/01/30/vue-diff%E7%AE%97%E6%B3%95/#more\">diff</a> 算法会直接跳过静态节点，从而减少了比较的过程，优化了 patch 的性能。</p>\n<h2 id=\"generate\"><a href=\"#generate\" class=\"headerlink\" title=\"generate\"></a>generate</h2><p>generate 是将 AST 转化成 render function 字符串的过程，得到结果是 render 的字符串以及 staticRenderFns 字符串。</p>\n<p>在经历过 parse、optimize 与 generate 这三个阶段以后，组件中就会存在渲染 VNode 所需的 render function 了。</p>\n<h1 id=\"响应式\"><a href=\"#响应式\" class=\"headerlink\" title=\"响应式\"></a>响应式</h1><p>接下来也就是 Vue.js 响应式核心部分。<br><img src=\"/img/vuejs4.png\" class=\"full-image\"></p>\n<p>这里的 getter 跟 setter 已经在之前介绍过了，在 init 的时候通过 Object.defineProperty 进行了绑定，它使得当被设置的对象被读取的时候会执行 getter 函数，而在当被赋值的时候会执行 setter 函数。</p>\n<p>当 render function 被渲染的时候，因为会读取所需对象的值，所以会触发 getter 函数进行「依赖收集」，「依赖收集」的目的是将观察者 Watcher 对象存放到当前闭包中的订阅者 Dep 的 subs 中。形成如下所示的这样一个关系。<br><img src=\"/img/vuejs5.png\" class=\"full-image\"></p>\n<p>在修改对象的值的时候，会触发对应的 setter， setter 通知之前「依赖收集」得到的 Dep 中的每一个 Watcher，告诉它们自己的值改变了，需要重新渲染视图。这时候这些 Watcher 就会开始调用 update 来更新视图，当然这中间还有一个 patch 的过程以及使用队列来异步更新的策略，这个我们后面再讲。</p>\n<h1 id=\"Virtual-DOM\"><a href=\"#Virtual-DOM\" class=\"headerlink\" title=\"Virtual DOM\"></a>Virtual DOM</h1><p>我们知道，render function 会被转化成 VNode 节点。Virtual DOM 其实就是一棵以 JavaScript 对象（ VNode 节点）作为基础的树，用对象属性来描述节点，实际上它只是一层对真实 DOM 的抽象。最终可以通过一系列操作使这棵树映射到真实环境上。由于 Virtual DOM 是以 JavaScript 对象为基础而不依赖真实平台环境，所以使它具有了跨平台的能力，比如说浏览器平台、Weex、Node 等。</p>\n<p>比如说下面这样一个例子：</p>\n<pre><code>&#123;\n    tag: &#39;div&#39;,                 /*说明这是一个div标签*/\n    children: [                 /*存放该标签的子节点*/\n        &#123;\n            tag: &#39;a&#39;,           /*说明这是一个a标签*/\n            text: &#39;click me&#39;    /*标签的内容*/\n        &#125;\n    ]\n&#125;\n</code></pre>\n<p>渲染后可以得到</p>\n<pre><code>&lt;div&gt;\n    &lt;a&gt;click me&lt;/a&gt;\n&lt;/div&gt;\n</code></pre>\n<p>这只是一个简单的例子，实际上的节点有更多的属性来标志节点，比如 isStatic （代表是否为静态节点）、 isComment （代表是否为注释节点）等。</p>\n<h1 id=\"更新视图\"><a href=\"#更新视图\" class=\"headerlink\" title=\"更新视图\"></a>更新视图</h1><img src=\"/img/vuejs6.png\" class=\"full-image\">\n前面我们说到，在修改一个对象值的时候，会通过 setter -> Watcher -> update 的流程来修改对应的视图，那么最终是如何更新视图的呢？\n\n<p>当数据变化后，执行 render function 就可以得到一个新的 VNode 节点，我们如果想要得到新的视图，最简单粗暴的方法就是直接解析这个新的 VNode 节点，然后用 innerHTML 直接全部渲染到真实 DOM 中。但是其实我们只对其中的一小块内容进行了修改，这样做似乎有些「浪费」。</p>\n<p>那么我们为什么不能只修改那些「改变了的地方」呢？这个时候就要介绍我们的「patch」了。我们会将新的 VNode 与旧的 VNode 一起传入 patch 进行比较，经过 diff 算法得出它们的「差异」。最后我们只需要将这些「差异」的对应 DOM 进行修改即可。</p>\n<h1 id=\"再看全局\"><a href=\"#再看全局\" class=\"headerlink\" title=\"再看全局\"></a>再看全局</h1><img src=\"/img/vuejs7.png\" class=\"full-image\">\n回过头再来看看这张图，是不是大脑中已经有一个大概的脉络了呢？"},{"title":"Vue双向绑定实现原理","date":"2019-07-09T07:22:16.000Z","copyright":null,"keywords":null,"description":null,"_content":"{% cq %} 留下源码以便以后调试回忆 {% endcq %}\n<!--more-->\n    ```javascript\n        <body>\n            <div id=\"app\">\n                <input type=\"text\" v-model=\"text\"> {{ text }}\n            </div>\n            <script>\n                function observe(obj, vm) {\n                Object.keys(obj).forEach(function (key) {\n                    defineReactive(vm, key, obj[key]);\n                })\n                }\n                function defineReactive(obj, key, val) {\n                var dep = new Dep();\n                Object.defineProperty(obj, key, {\n                    get: function () {\n                    // 添加订阅者 watcher 到主题对象 Dep\n                    if (Dep.target) dep.addSub(Dep.target);\n                    return val\n                    },\n                    set: function (newVal) {\n                    if (newVal === val) return\n                    val = newVal;\n                    // 作为发布者发出通知\n                    dep.notify();\n                    }\n                });\n                }\n                function nodeToFragment(node, vm) {\n                var flag = document.createDocumentFragment();\n                var child;\n                // 理解了上面这一点，就能理解 while (child = node.firstChild) 这种用法\n                // 其次，appendChild 方法有个隐蔽的地方，就是调用以后 child 会从原来 DOM 中移除\n                // 所以，第二次循环时，node.firstChild 已经不再是之前的第一个子元素了\n                while (child = node.firstChild) {\n                    compile(child, vm);\n                    flag.appendChild(child); // 将子节点劫持到文档片段中\n                }\n                return flag\n                }\n                function compile(node, vm) {\n                var reg = /\\{\\{(.*)\\}\\}/;\n                // 节点类型为元素\n                if (node.nodeType === 1) {\n                    var attr = node.attributes;\n                    // 解析属性\n                    for (var i = 0; i < attr.length; i++) {\n                    if (attr[i].nodeName == 'v-model') {\n                        var name = attr[i].nodeValue; // 获取 v-model 绑定的属性名\n                        node.addEventListener('input', function (e) {\n                        // 给相应的 data 属性赋值，进而触发该属性的 set 方法\n                        vm[name] = e.target.value;\n                        });\n                        node.value = vm[name]; // 将 data 的值赋给该 node\n                        node.removeAttribute('v-model');\n                    }\n                    };\n                    new Watcher(vm, node, name, 'input');\n                }\n                // 节点类型为 text\n                if (node.nodeType === 3) {\n                    if (reg.test(node.nodeValue)) {\n                    var name = RegExp.$1; // 获取匹配到的字符串\n                    name = name.trim();\n                    new Watcher(vm, node, name, 'text');\n                    }\n                }\n                }\n                function Watcher(vm, node, name, nodeType) {\n                Dep.target = this;\n                this.name = name;\n                this.node = node;\n                this.vm = vm;\n                this.nodeType = nodeType;\n                this.update();\n                Dep.target = null;\n                }\n                Watcher.prototype = {\n                update: function () {\n                    this.get();\n                    if (this.nodeType == 'text') {\n                    this.node.nodeValue = this.value;\n                    }\n                    if (this.nodeType == 'input') {\n                    this.node.value = this.value;\n                    }\n                },\n                // 获取 data 中的属性值\n                get: function () {\n                    this.value = this.vm[this.name]; // 触发相应属性的 get\n                }\n                }\n                function Dep() {\n                this.subs = []\n                }\n                Dep.prototype = {\n                addSub: function (sub) {\n                    this.subs.push(sub);\n                },\n                notify: function () {\n                    this.subs.forEach(function (sub) {\n                    sub.update();\n                    });\n                }\n                }\n                function Vue(options) {\n                this.data = options.data;\n                var data = this.data;\n                observe(data, this);\n                var id = options.el;\n                var dom = nodeToFragment(document.getElementById(id), this);\n                // 编译完成后，将 dom 返回到 app 中\n                document.getElementById(id).appendChild(dom);\n                }\n                var vm = new Vue({\n                el: 'app',\n                data: {\n                    text: 'hello world',\n                }\n                })\n            </script>\n        </body>\n    ```","source":"_posts/Vue双向绑定实现原理.md","raw":"---\ntitle: Vue双向绑定实现原理\ndate: 2019-07-09 15:22:16\ncategories:\ntags:\n    - Vue双向绑定实现原理\ncopyright:\nkeywords:\ndescription:\n---\n{% cq %} 留下源码以便以后调试回忆 {% endcq %}\n<!--more-->\n    ```javascript\n        <body>\n            <div id=\"app\">\n                <input type=\"text\" v-model=\"text\"> {{ text }}\n            </div>\n            <script>\n                function observe(obj, vm) {\n                Object.keys(obj).forEach(function (key) {\n                    defineReactive(vm, key, obj[key]);\n                })\n                }\n                function defineReactive(obj, key, val) {\n                var dep = new Dep();\n                Object.defineProperty(obj, key, {\n                    get: function () {\n                    // 添加订阅者 watcher 到主题对象 Dep\n                    if (Dep.target) dep.addSub(Dep.target);\n                    return val\n                    },\n                    set: function (newVal) {\n                    if (newVal === val) return\n                    val = newVal;\n                    // 作为发布者发出通知\n                    dep.notify();\n                    }\n                });\n                }\n                function nodeToFragment(node, vm) {\n                var flag = document.createDocumentFragment();\n                var child;\n                // 理解了上面这一点，就能理解 while (child = node.firstChild) 这种用法\n                // 其次，appendChild 方法有个隐蔽的地方，就是调用以后 child 会从原来 DOM 中移除\n                // 所以，第二次循环时，node.firstChild 已经不再是之前的第一个子元素了\n                while (child = node.firstChild) {\n                    compile(child, vm);\n                    flag.appendChild(child); // 将子节点劫持到文档片段中\n                }\n                return flag\n                }\n                function compile(node, vm) {\n                var reg = /\\{\\{(.*)\\}\\}/;\n                // 节点类型为元素\n                if (node.nodeType === 1) {\n                    var attr = node.attributes;\n                    // 解析属性\n                    for (var i = 0; i < attr.length; i++) {\n                    if (attr[i].nodeName == 'v-model') {\n                        var name = attr[i].nodeValue; // 获取 v-model 绑定的属性名\n                        node.addEventListener('input', function (e) {\n                        // 给相应的 data 属性赋值，进而触发该属性的 set 方法\n                        vm[name] = e.target.value;\n                        });\n                        node.value = vm[name]; // 将 data 的值赋给该 node\n                        node.removeAttribute('v-model');\n                    }\n                    };\n                    new Watcher(vm, node, name, 'input');\n                }\n                // 节点类型为 text\n                if (node.nodeType === 3) {\n                    if (reg.test(node.nodeValue)) {\n                    var name = RegExp.$1; // 获取匹配到的字符串\n                    name = name.trim();\n                    new Watcher(vm, node, name, 'text');\n                    }\n                }\n                }\n                function Watcher(vm, node, name, nodeType) {\n                Dep.target = this;\n                this.name = name;\n                this.node = node;\n                this.vm = vm;\n                this.nodeType = nodeType;\n                this.update();\n                Dep.target = null;\n                }\n                Watcher.prototype = {\n                update: function () {\n                    this.get();\n                    if (this.nodeType == 'text') {\n                    this.node.nodeValue = this.value;\n                    }\n                    if (this.nodeType == 'input') {\n                    this.node.value = this.value;\n                    }\n                },\n                // 获取 data 中的属性值\n                get: function () {\n                    this.value = this.vm[this.name]; // 触发相应属性的 get\n                }\n                }\n                function Dep() {\n                this.subs = []\n                }\n                Dep.prototype = {\n                addSub: function (sub) {\n                    this.subs.push(sub);\n                },\n                notify: function () {\n                    this.subs.forEach(function (sub) {\n                    sub.update();\n                    });\n                }\n                }\n                function Vue(options) {\n                this.data = options.data;\n                var data = this.data;\n                observe(data, this);\n                var id = options.el;\n                var dom = nodeToFragment(document.getElementById(id), this);\n                // 编译完成后，将 dom 返回到 app 中\n                document.getElementById(id).appendChild(dom);\n                }\n                var vm = new Vue({\n                el: 'app',\n                data: {\n                    text: 'hello world',\n                }\n                })\n            </script>\n        </body>\n    ```","slug":"Vue双向绑定实现原理","published":1,"updated":"2026-01-02T00:43:17.572Z","comments":1,"layout":"post","photos":[],"_id":"cmjwbsw670013rotg0yzlb9b0","content":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>留下源码以便以后调试回忆 </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n<span id=\"more\"></span>\n<pre><code><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;text&quot;</span>&gt;</span> &#123;&#123; text &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">function</span> <span class=\"title function_\">observe</span>(<span class=\"params\">obj, vm</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"title class_\">Object</span>.<span class=\"title function_\">keys</span>(obj).<span class=\"title function_\">forEach</span>(<span class=\"keyword\">function</span> (<span class=\"params\">key</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"title function_\">defineReactive</span>(vm, key, obj[key]);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;)</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">function</span> <span class=\"title function_\">defineReactive</span>(<span class=\"params\">obj, key, val</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> dep = <span class=\"keyword\">new</span> <span class=\"title class_\">Dep</span>();</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"title class_\">Object</span>.<span class=\"title function_\">defineProperty</span>(obj, key, &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">get</span>: <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"comment\">// 添加订阅者 watcher 到主题对象 Dep</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"keyword\">if</span> (<span class=\"title class_\">Dep</span>.<span class=\"property\">target</span>) dep.<span class=\"title function_\">addSub</span>(<span class=\"title class_\">Dep</span>.<span class=\"property\">target</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"keyword\">return</span> val</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">set</span>: <span class=\"keyword\">function</span> (<span class=\"params\">newVal</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"keyword\">if</span> (newVal === val) <span class=\"keyword\">return</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            val = newVal;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"comment\">// 作为发布者发出通知</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            dep.<span class=\"title function_\">notify</span>();</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">function</span> <span class=\"title function_\">nodeToFragment</span>(<span class=\"params\">node, vm</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> flag = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createDocumentFragment</span>();</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> child;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"comment\">// 理解了上面这一点，就能理解 while (child = node.firstChild) 这种用法</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"comment\">// 其次，appendChild 方法有个隐蔽的地方，就是调用以后 child 会从原来 DOM 中移除</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"comment\">// 所以，第二次循环时，node.firstChild 已经不再是之前的第一个子元素了</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">while</span> (child = node.<span class=\"property\">firstChild</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"title function_\">compile</span>(child, vm);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            flag.<span class=\"title function_\">appendChild</span>(child); <span class=\"comment\">// 将子节点劫持到文档片段中</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">return</span> flag</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">function</span> <span class=\"title function_\">compile</span>(<span class=\"params\">node, vm</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> reg = <span class=\"regexp\">/\\&#123;\\&#123;(.*)\\&#125;\\&#125;/</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"comment\">// 节点类型为元素</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">if</span> (node.<span class=\"property\">nodeType</span> === <span class=\"number\">1</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"keyword\">var</span> attr = node.<span class=\"property\">attributes</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"comment\">// 解析属性</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; attr.<span class=\"property\">length</span>; i++) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"keyword\">if</span> (attr[i].<span class=\"property\">nodeName</span> == <span class=\"string\">&#x27;v-model&#x27;</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                <span class=\"keyword\">var</span> name = attr[i].<span class=\"property\">nodeValue</span>; <span class=\"comment\">// 获取 v-model 绑定的属性名</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                node.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;input&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">e</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                <span class=\"comment\">// 给相应的 data 属性赋值，进而触发该属性的 set 方法</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                vm[name] = e.<span class=\"property\">target</span>.<span class=\"property\">value</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                &#125;);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                node.<span class=\"property\">value</span> = vm[name]; <span class=\"comment\">// 将 data 的值赋给该 node</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                node.<span class=\"title function_\">removeAttribute</span>(<span class=\"string\">&#x27;v-model&#x27;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"keyword\">new</span> <span class=\"title class_\">Watcher</span>(vm, node, name, <span class=\"string\">&#x27;input&#x27;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"comment\">// 节点类型为 text</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">if</span> (node.<span class=\"property\">nodeType</span> === <span class=\"number\">3</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"keyword\">if</span> (reg.<span class=\"title function_\">test</span>(node.<span class=\"property\">nodeValue</span>)) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"keyword\">var</span> name = <span class=\"title class_\">RegExp</span>.<span class=\"property\">$1</span>; <span class=\"comment\">// 获取匹配到的字符串</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            name = name.<span class=\"title function_\">trim</span>();</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"keyword\">new</span> <span class=\"title class_\">Watcher</span>(vm, node, name, <span class=\"string\">&#x27;text&#x27;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">function</span> <span class=\"title function_\">Watcher</span>(<span class=\"params\">vm, node, name, nodeType</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"title class_\">Dep</span>.<span class=\"property\">target</span> = <span class=\"variable language_\">this</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"variable language_\">this</span>.<span class=\"property\">name</span> = name;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"variable language_\">this</span>.<span class=\"property\">node</span> = node;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"variable language_\">this</span>.<span class=\"property\">vm</span> = vm;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"variable language_\">this</span>.<span class=\"property\">nodeType</span> = nodeType;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"variable language_\">this</span>.<span class=\"title function_\">update</span>();</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"title class_\">Dep</span>.<span class=\"property\">target</span> = <span class=\"literal\">null</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"title class_\">Watcher</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span> = &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"attr\">update</span>: <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"variable language_\">this</span>.<span class=\"title function_\">get</span>();</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">nodeType</span> == <span class=\"string\">&#x27;text&#x27;</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"variable language_\">this</span>.<span class=\"property\">node</span>.<span class=\"property\">nodeValue</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">value</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">nodeType</span> == <span class=\"string\">&#x27;input&#x27;</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"variable language_\">this</span>.<span class=\"property\">node</span>.<span class=\"property\">value</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">value</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"comment\">// 获取 data 中的属性值</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"attr\">get</span>: <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"variable language_\">this</span>.<span class=\"property\">value</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">vm</span>[<span class=\"variable language_\">this</span>.<span class=\"property\">name</span>]; <span class=\"comment\">// 触发相应属性的 get</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">function</span> <span class=\"title function_\">Dep</span>(<span class=\"params\"></span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"variable language_\">this</span>.<span class=\"property\">subs</span> = []</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"title class_\">Dep</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span> = &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"attr\">addSub</span>: <span class=\"keyword\">function</span> (<span class=\"params\">sub</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"variable language_\">this</span>.<span class=\"property\">subs</span>.<span class=\"title function_\">push</span>(sub);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"attr\">notify</span>: <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"variable language_\">this</span>.<span class=\"property\">subs</span>.<span class=\"title function_\">forEach</span>(<span class=\"keyword\">function</span> (<span class=\"params\">sub</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            sub.<span class=\"title function_\">update</span>();</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">function</span> <span class=\"title function_\">Vue</span>(<span class=\"params\">options</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"variable language_\">this</span>.<span class=\"property\">data</span> = options.<span class=\"property\">data</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> data = <span class=\"variable language_\">this</span>.<span class=\"property\">data</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"title function_\">observe</span>(data, <span class=\"variable language_\">this</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> id = options.<span class=\"property\">el</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> dom = <span class=\"title function_\">nodeToFragment</span>(<span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(id), <span class=\"variable language_\">this</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"comment\">// 编译完成后，将 dom 返回到 app 中</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(id).<span class=\"title function_\">appendChild</span>(dom);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> vm = <span class=\"keyword\">new</span> <span class=\"title class_\">Vue</span>(&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"attr\">el</span>: <span class=\"string\">&#x27;app&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"attr\">data</span>: &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">text</span>: <span class=\"string\">&#x27;hello world&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;)</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n</code></pre>\n","excerpt":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>留下源码以便以后调试回忆 </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>","more":"<pre><code><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">v-model</span>=<span class=\"string\">&quot;text&quot;</span>&gt;</span> &#123;&#123; text &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">function</span> <span class=\"title function_\">observe</span>(<span class=\"params\">obj, vm</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"title class_\">Object</span>.<span class=\"title function_\">keys</span>(obj).<span class=\"title function_\">forEach</span>(<span class=\"keyword\">function</span> (<span class=\"params\">key</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"title function_\">defineReactive</span>(vm, key, obj[key]);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;)</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">function</span> <span class=\"title function_\">defineReactive</span>(<span class=\"params\">obj, key, val</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> dep = <span class=\"keyword\">new</span> <span class=\"title class_\">Dep</span>();</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"title class_\">Object</span>.<span class=\"title function_\">defineProperty</span>(obj, key, &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">get</span>: <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"comment\">// 添加订阅者 watcher 到主题对象 Dep</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"keyword\">if</span> (<span class=\"title class_\">Dep</span>.<span class=\"property\">target</span>) dep.<span class=\"title function_\">addSub</span>(<span class=\"title class_\">Dep</span>.<span class=\"property\">target</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"keyword\">return</span> val</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">set</span>: <span class=\"keyword\">function</span> (<span class=\"params\">newVal</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"keyword\">if</span> (newVal === val) <span class=\"keyword\">return</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            val = newVal;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"comment\">// 作为发布者发出通知</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            dep.<span class=\"title function_\">notify</span>();</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">function</span> <span class=\"title function_\">nodeToFragment</span>(<span class=\"params\">node, vm</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> flag = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createDocumentFragment</span>();</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> child;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"comment\">// 理解了上面这一点，就能理解 while (child = node.firstChild) 这种用法</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"comment\">// 其次，appendChild 方法有个隐蔽的地方，就是调用以后 child 会从原来 DOM 中移除</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"comment\">// 所以，第二次循环时，node.firstChild 已经不再是之前的第一个子元素了</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">while</span> (child = node.<span class=\"property\">firstChild</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"title function_\">compile</span>(child, vm);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            flag.<span class=\"title function_\">appendChild</span>(child); <span class=\"comment\">// 将子节点劫持到文档片段中</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">return</span> flag</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">function</span> <span class=\"title function_\">compile</span>(<span class=\"params\">node, vm</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> reg = <span class=\"regexp\">/\\&#123;\\&#123;(.*)\\&#125;\\&#125;/</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"comment\">// 节点类型为元素</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">if</span> (node.<span class=\"property\">nodeType</span> === <span class=\"number\">1</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"keyword\">var</span> attr = node.<span class=\"property\">attributes</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"comment\">// 解析属性</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; attr.<span class=\"property\">length</span>; i++) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"keyword\">if</span> (attr[i].<span class=\"property\">nodeName</span> == <span class=\"string\">&#x27;v-model&#x27;</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                <span class=\"keyword\">var</span> name = attr[i].<span class=\"property\">nodeValue</span>; <span class=\"comment\">// 获取 v-model 绑定的属性名</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                node.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;input&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">e</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                <span class=\"comment\">// 给相应的 data 属性赋值，进而触发该属性的 set 方法</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                vm[name] = e.<span class=\"property\">target</span>.<span class=\"property\">value</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                &#125;);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                node.<span class=\"property\">value</span> = vm[name]; <span class=\"comment\">// 将 data 的值赋给该 node</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                node.<span class=\"title function_\">removeAttribute</span>(<span class=\"string\">&#x27;v-model&#x27;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"keyword\">new</span> <span class=\"title class_\">Watcher</span>(vm, node, name, <span class=\"string\">&#x27;input&#x27;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"comment\">// 节点类型为 text</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">if</span> (node.<span class=\"property\">nodeType</span> === <span class=\"number\">3</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"keyword\">if</span> (reg.<span class=\"title function_\">test</span>(node.<span class=\"property\">nodeValue</span>)) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"keyword\">var</span> name = <span class=\"title class_\">RegExp</span>.<span class=\"property\">$1</span>; <span class=\"comment\">// 获取匹配到的字符串</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            name = name.<span class=\"title function_\">trim</span>();</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"keyword\">new</span> <span class=\"title class_\">Watcher</span>(vm, node, name, <span class=\"string\">&#x27;text&#x27;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">function</span> <span class=\"title function_\">Watcher</span>(<span class=\"params\">vm, node, name, nodeType</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"title class_\">Dep</span>.<span class=\"property\">target</span> = <span class=\"variable language_\">this</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"variable language_\">this</span>.<span class=\"property\">name</span> = name;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"variable language_\">this</span>.<span class=\"property\">node</span> = node;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"variable language_\">this</span>.<span class=\"property\">vm</span> = vm;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"variable language_\">this</span>.<span class=\"property\">nodeType</span> = nodeType;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"variable language_\">this</span>.<span class=\"title function_\">update</span>();</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"title class_\">Dep</span>.<span class=\"property\">target</span> = <span class=\"literal\">null</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"title class_\">Watcher</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span> = &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"attr\">update</span>: <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"variable language_\">this</span>.<span class=\"title function_\">get</span>();</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">nodeType</span> == <span class=\"string\">&#x27;text&#x27;</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"variable language_\">this</span>.<span class=\"property\">node</span>.<span class=\"property\">nodeValue</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">value</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">nodeType</span> == <span class=\"string\">&#x27;input&#x27;</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"variable language_\">this</span>.<span class=\"property\">node</span>.<span class=\"property\">value</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">value</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"comment\">// 获取 data 中的属性值</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"attr\">get</span>: <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"variable language_\">this</span>.<span class=\"property\">value</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">vm</span>[<span class=\"variable language_\">this</span>.<span class=\"property\">name</span>]; <span class=\"comment\">// 触发相应属性的 get</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">function</span> <span class=\"title function_\">Dep</span>(<span class=\"params\"></span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"variable language_\">this</span>.<span class=\"property\">subs</span> = []</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"title class_\">Dep</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span> = &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"attr\">addSub</span>: <span class=\"keyword\">function</span> (<span class=\"params\">sub</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"variable language_\">this</span>.<span class=\"property\">subs</span>.<span class=\"title function_\">push</span>(sub);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"attr\">notify</span>: <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"variable language_\">this</span>.<span class=\"property\">subs</span>.<span class=\"title function_\">forEach</span>(<span class=\"keyword\">function</span> (<span class=\"params\">sub</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            sub.<span class=\"title function_\">update</span>();</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">function</span> <span class=\"title function_\">Vue</span>(<span class=\"params\">options</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"variable language_\">this</span>.<span class=\"property\">data</span> = options.<span class=\"property\">data</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> data = <span class=\"variable language_\">this</span>.<span class=\"property\">data</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"title function_\">observe</span>(data, <span class=\"variable language_\">this</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> id = options.<span class=\"property\">el</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> dom = <span class=\"title function_\">nodeToFragment</span>(<span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(id), <span class=\"variable language_\">this</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"comment\">// 编译完成后，将 dom 返回到 app 中</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(id).<span class=\"title function_\">appendChild</span>(dom);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> vm = <span class=\"keyword\">new</span> <span class=\"title class_\">Vue</span>(&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"attr\">el</span>: <span class=\"string\">&#x27;app&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"attr\">data</span>: &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">text</span>: <span class=\"string\">&#x27;hello world&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;)</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n</code></pre>"},{"title":"Vue中的$emit $on $once $off的使用","date":"2019-08-23T03:12:11.000Z","copyright":null,"keywords":null,"description":null,"_content":"{% cq %} 最近的大事就是香港暴乱,做好自己就是对祖国的最好支持！ {% endcq %}\n<!--more-->\n1.如果对以上方法还不了解的可以点击[传送门](https://cn.vuejs.org/v2/api/#vm-on)大致了解一下😯\n2.都说实践出真知，复制以下代码，动动小手点击下就全懂啦！\n```javascript\n<body>\n    <div id=\"app\">\n        <p>{{msg}}{{count}}</p>\n        <children-component @aa=\"aa\"></children-component> <br/>\n        <button @click=\"removeClick\">父组件按钮使用$off移除$on监听</button>\n    </div>\n    <script src=\"https://cdn.jsdelivr.net/npm/vue/dist/vue.js\"></script>\n    <script>\n        var bus = new Vue()\n        var children = {\n                data(){\n                    return{\n                        data:\"\"\n                    }\n                },\n                methods: {\n                    childrenClick(){\n                        bus.$emit('aa','子组件通过emit发送过来的数据')\n                    },\n                    hanldClick(){\n                        bus.$emit('bb','子组件用来探索$once')\n                    }\n                },\n            template:`<div>\n                <button @click=\"childrenClick\">子组件使用$emit发送数据，父组件使用$on监听</button><br/><br/> \n                <button @click=\"hanldClick\">子组件使用$emit发送数据，父组件使用$once监听只能触发一次</button>\n            </div>`\n        }\n        var vm = new Vue({\n            el:\"#app\",\n            data:{\n                msg:'',\n                count:0\n            },\n            components:{\n                'children-component':children\n            },\n            methods:{\n                aa(s){\n                    console.log(s)  \n                },\n                removeClick(){\n                    bus.$off('aa')\n                }\n            },\n            mounted(){\n                bus.$on('aa',(val)=>{\n                    this.msg = val\n                    this.count++\n                })\n                bus.$once('bb',(val)=>{\n                    console.log(val)\n                })\n            }\n        })\n    </script>\n</body>\n```\n\n","source":"_posts/vue的-emit-on-once-off的使用.md","raw":"---\ntitle: Vue中的$emit $on $once $off的使用\ndate: 2019-08-23 11:12:11\ncategories: web\ntags: ['vue中$emit/$on/$once/$off的使用']\ncopyright:\nkeywords:\ndescription:\n---\n{% cq %} 最近的大事就是香港暴乱,做好自己就是对祖国的最好支持！ {% endcq %}\n<!--more-->\n1.如果对以上方法还不了解的可以点击[传送门](https://cn.vuejs.org/v2/api/#vm-on)大致了解一下😯\n2.都说实践出真知，复制以下代码，动动小手点击下就全懂啦！\n```javascript\n<body>\n    <div id=\"app\">\n        <p>{{msg}}{{count}}</p>\n        <children-component @aa=\"aa\"></children-component> <br/>\n        <button @click=\"removeClick\">父组件按钮使用$off移除$on监听</button>\n    </div>\n    <script src=\"https://cdn.jsdelivr.net/npm/vue/dist/vue.js\"></script>\n    <script>\n        var bus = new Vue()\n        var children = {\n                data(){\n                    return{\n                        data:\"\"\n                    }\n                },\n                methods: {\n                    childrenClick(){\n                        bus.$emit('aa','子组件通过emit发送过来的数据')\n                    },\n                    hanldClick(){\n                        bus.$emit('bb','子组件用来探索$once')\n                    }\n                },\n            template:`<div>\n                <button @click=\"childrenClick\">子组件使用$emit发送数据，父组件使用$on监听</button><br/><br/> \n                <button @click=\"hanldClick\">子组件使用$emit发送数据，父组件使用$once监听只能触发一次</button>\n            </div>`\n        }\n        var vm = new Vue({\n            el:\"#app\",\n            data:{\n                msg:'',\n                count:0\n            },\n            components:{\n                'children-component':children\n            },\n            methods:{\n                aa(s){\n                    console.log(s)  \n                },\n                removeClick(){\n                    bus.$off('aa')\n                }\n            },\n            mounted(){\n                bus.$on('aa',(val)=>{\n                    this.msg = val\n                    this.count++\n                })\n                bus.$once('bb',(val)=>{\n                    console.log(val)\n                })\n            }\n        })\n    </script>\n</body>\n```\n\n","slug":"vue的-emit-on-once-off的使用","published":1,"updated":"2026-01-02T00:43:17.576Z","comments":1,"layout":"post","photos":[],"_id":"cmjwbsw670015rotg312yaiuk","content":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>最近的大事就是香港暴乱,做好自己就是对祖国的最好支持！ </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n<span id=\"more\"></span>\n<p>1.如果对以上方法还不了解的可以点击<a href=\"https://cn.vuejs.org/v2/api/#vm-on\">传送门</a>大致了解一下😯<br>2.都说实践出真知，复制以下代码，动动小手点击下就全懂啦！</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>&#123;&#123;msg&#125;&#125;&#123;&#123;count&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">children-component</span> @<span class=\"attr\">aa</span>=<span class=\"string\">&quot;aa&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">children-component</span>&gt;</span> <span class=\"tag\">&lt;<span class=\"name\">br</span>/&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;removeClick&quot;</span>&gt;</span>父组件按钮使用$off移除$on监听<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> bus = <span class=\"keyword\">new</span> <span class=\"title class_\">Vue</span>()</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> children = &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                <span class=\"title function_\">data</span>(<span class=\"params\"></span>)&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    <span class=\"keyword\">return</span>&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                        <span class=\"attr\">data</span>:<span class=\"string\">&quot;&quot;</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                <span class=\"attr\">methods</span>: &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    <span class=\"title function_\">childrenClick</span>(<span class=\"params\"></span>)&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                        bus.$emit(<span class=\"string\">&#x27;aa&#x27;</span>,<span class=\"string\">&#x27;子组件通过emit发送过来的数据&#x27;</span>)</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    <span class=\"title function_\">hanldClick</span>(<span class=\"params\"></span>)&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                        bus.$emit(<span class=\"string\">&#x27;bb&#x27;</span>,<span class=\"string\">&#x27;子组件用来探索$once&#x27;</span>)</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">template</span>:<span class=\"string\">`&lt;div&gt;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-javascript\"><span class=\"language-xml\">                &lt;button @click=&quot;childrenClick&quot;&gt;子组件使用$emit发送数据，父组件使用$on监听&lt;/button&gt;&lt;br/&gt;&lt;br/&gt; </span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-javascript\"><span class=\"language-xml\">                &lt;button @click=&quot;hanldClick&quot;&gt;子组件使用$emit发送数据，父组件使用$once监听只能触发一次&lt;/button&gt;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-javascript\"><span class=\"language-xml\">            &lt;/div&gt;`</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> vm = <span class=\"keyword\">new</span> <span class=\"title class_\">Vue</span>(&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">el</span>:<span class=\"string\">&quot;#app&quot;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">data</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                <span class=\"attr\">msg</span>:<span class=\"string\">&#x27;&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                <span class=\"attr\">count</span>:<span class=\"number\">0</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">components</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                <span class=\"string\">&#x27;children-component&#x27;</span>:children</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">methods</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                <span class=\"title function_\">aa</span>(<span class=\"params\">s</span>)&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(s)  </span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                <span class=\"title function_\">removeClick</span>(<span class=\"params\"></span>)&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    bus.$off(<span class=\"string\">&#x27;aa&#x27;</span>)</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"title function_\">mounted</span>(<span class=\"params\"></span>)&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                bus.$on(<span class=\"string\">&#x27;aa&#x27;</span>,<span class=\"function\">(<span class=\"params\">val</span>)=&gt;</span>&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    <span class=\"variable language_\">this</span>.<span class=\"property\">msg</span> = val</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    <span class=\"variable language_\">this</span>.<span class=\"property\">count</span>++</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                &#125;)</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                bus.$once(<span class=\"string\">&#x27;bb&#x27;</span>,<span class=\"function\">(<span class=\"params\">val</span>)=&gt;</span>&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(val)</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                &#125;)</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;)</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\">&lt;/body&gt;</span><br></pre></td></tr></table></figure>\n\n","excerpt":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>最近的大事就是香港暴乱,做好自己就是对祖国的最好支持！ </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>","more":"<p>1.如果对以上方法还不了解的可以点击<a href=\"https://cn.vuejs.org/v2/api/#vm-on\">传送门</a>大致了解一下😯<br>2.都说实践出真知，复制以下代码，动动小手点击下就全懂啦！</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>&#123;&#123;msg&#125;&#125;&#123;&#123;count&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">children-component</span> @<span class=\"attr\">aa</span>=<span class=\"string\">&quot;aa&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">children-component</span>&gt;</span> <span class=\"tag\">&lt;<span class=\"name\">br</span>/&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;removeClick&quot;</span>&gt;</span>父组件按钮使用$off移除$on监听<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> bus = <span class=\"keyword\">new</span> <span class=\"title class_\">Vue</span>()</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> children = &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                <span class=\"title function_\">data</span>(<span class=\"params\"></span>)&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    <span class=\"keyword\">return</span>&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                        <span class=\"attr\">data</span>:<span class=\"string\">&quot;&quot;</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                <span class=\"attr\">methods</span>: &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    <span class=\"title function_\">childrenClick</span>(<span class=\"params\"></span>)&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                        bus.$emit(<span class=\"string\">&#x27;aa&#x27;</span>,<span class=\"string\">&#x27;子组件通过emit发送过来的数据&#x27;</span>)</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    <span class=\"title function_\">hanldClick</span>(<span class=\"params\"></span>)&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                        bus.$emit(<span class=\"string\">&#x27;bb&#x27;</span>,<span class=\"string\">&#x27;子组件用来探索$once&#x27;</span>)</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">template</span>:<span class=\"string\">`&lt;div&gt;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-javascript\"><span class=\"language-xml\">                &lt;button @click=&quot;childrenClick&quot;&gt;子组件使用$emit发送数据，父组件使用$on监听&lt;/button&gt;&lt;br/&gt;&lt;br/&gt; </span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-javascript\"><span class=\"language-xml\">                &lt;button @click=&quot;hanldClick&quot;&gt;子组件使用$emit发送数据，父组件使用$once监听只能触发一次&lt;/button&gt;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-javascript\"><span class=\"language-xml\">            &lt;/div&gt;`</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> vm = <span class=\"keyword\">new</span> <span class=\"title class_\">Vue</span>(&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">el</span>:<span class=\"string\">&quot;#app&quot;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">data</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                <span class=\"attr\">msg</span>:<span class=\"string\">&#x27;&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                <span class=\"attr\">count</span>:<span class=\"number\">0</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">components</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                <span class=\"string\">&#x27;children-component&#x27;</span>:children</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">methods</span>:&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                <span class=\"title function_\">aa</span>(<span class=\"params\">s</span>)&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(s)  </span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                <span class=\"title function_\">removeClick</span>(<span class=\"params\"></span>)&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    bus.$off(<span class=\"string\">&#x27;aa&#x27;</span>)</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"title function_\">mounted</span>(<span class=\"params\"></span>)&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                bus.$on(<span class=\"string\">&#x27;aa&#x27;</span>,<span class=\"function\">(<span class=\"params\">val</span>)=&gt;</span>&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    <span class=\"variable language_\">this</span>.<span class=\"property\">msg</span> = val</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    <span class=\"variable language_\">this</span>.<span class=\"property\">count</span>++</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                &#125;)</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                bus.$once(<span class=\"string\">&#x27;bb&#x27;</span>,<span class=\"function\">(<span class=\"params\">val</span>)=&gt;</span>&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(val)</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">                &#125;)</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;)</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\">&lt;/body&gt;</span><br></pre></td></tr></table></figure>"},{"title":"vue的functionnal使用","date":"2020-05-25T07:19:48.000Z","copyright":null,"keywords":null,"description":null,"_content":"{% cq %} vue的functionnal使用 {% endcq %}\n<img src=\"../img/functionnal.gif\" style=\"width:305px;heigth:277px\">\n<!--more-->\n Vue.js 组件提供了一个 functional 开关，设置为 true 后，就可以让组件变为无状态、无实例的函数化组件。因为只是函数，所以渲染的开销相对来说，较小。\n\n函数化的组件中的 Render 函数，提供了第二个参数 context 作为上下文，data、props、slots、children 以及 parent 都可以通过 context 来访问。\n\n1.新建一个functionnal.js（名字随意，只要是js文件）文件\n  ```javascript\n    //图片组件设置\n      // eslint-disable-next-line no-unused-vars\n      var imgOptions = {\n      props: [\"data\"],\n      render: function(createElement) {\n        return createElement(\"div\", [\n          createElement(\"p\", \"图片组件\"),\n          createElement(\"img\", {\n            attrs: {\n              src: this.data.url,\n              height: 300,\n              weight: 400\n            }\n          })\n        ]);\n      }\n    };\n    //文字组件设置\n    // eslint-disable-next-line no-unused-vars\n    var textOptions = {\n      props: [\"data\"],\n      render: function(createElement) {\n        return createElement(\"div\", [\n          createElement(\"p\", \"文本组件\"),\n          createElement(\"span\", {\n            attrs: {\n              height: 300,\n              weight: 400\n            }\n          }),\n          this.data.content\n        ]);\n      }\n    };\n\n    // eslint-disable-next-line no-unused-vars\n    var renderData = {};\n\n    export default {\n      functional: true,\n      render(createElement, { data }) {\n        console.log(data);\n        if (data.attrs.data.type === \"text\") {\n          renderData = textOptions;\n        } else if (data.attrs.data.type === \"img\") {\n          renderData = imgOptions;\n        }\n        return createElement(renderData, data);\n      }\n    };\n```\n2.例如在About.vue文件中使用\n  ```javascript\n    <template>\n      <div class=\"about\">\n        <h1>functionnal的使用</h1>\n        <button @click=\"log('img')\">图片</button>\n        <button @click=\"log('text')\">文字</button>\n        <functionalVue :data=\"data\"></functionalVue>\n      </div>\n    </template>\n\n    <script>\n    import functionalVue from \"./functionnal\";\n    export default {\n      data() {\n        return {\n          data: {}\n        };\n      },\n      components: {\n        functionalVue\n      },\n      methods: {\n        log(type) {\n          if (type === \"img\") {\n            this.data = {\n              type: type,\n              url:\n                \"http://pic-bucket.ws.126.net/photo/0001/2019-02-07/E7D8PON900AO0001NOS.jpg\"\n            };\n          } else {\n            this.data = {\n              type: type,\n              content:\n                \"《流浪地球》中的科学：太阳何时吞并地球？科学家已经给出时间表\"\n            };\n          }\n        }\n      },\n      created() {\n        this.data = {\n          type: \"text\",\n          content: \"《流浪地球》中的科学：太阳何时吞并地球？科学家已经给出时间表\"\n        };\n      }\n    };\n    </script>\n\n  ```\n","source":"_posts/vue的functionnal使用.md","raw":"---\ntitle: vue的functionnal使用\ndate: 2020-05-25 15:19:48\ncategories: web\ntags:\n    - vue的functionnal使用\ncopyright:\nkeywords:\ndescription:\n---\n{% cq %} vue的functionnal使用 {% endcq %}\n<img src=\"../img/functionnal.gif\" style=\"width:305px;heigth:277px\">\n<!--more-->\n Vue.js 组件提供了一个 functional 开关，设置为 true 后，就可以让组件变为无状态、无实例的函数化组件。因为只是函数，所以渲染的开销相对来说，较小。\n\n函数化的组件中的 Render 函数，提供了第二个参数 context 作为上下文，data、props、slots、children 以及 parent 都可以通过 context 来访问。\n\n1.新建一个functionnal.js（名字随意，只要是js文件）文件\n  ```javascript\n    //图片组件设置\n      // eslint-disable-next-line no-unused-vars\n      var imgOptions = {\n      props: [\"data\"],\n      render: function(createElement) {\n        return createElement(\"div\", [\n          createElement(\"p\", \"图片组件\"),\n          createElement(\"img\", {\n            attrs: {\n              src: this.data.url,\n              height: 300,\n              weight: 400\n            }\n          })\n        ]);\n      }\n    };\n    //文字组件设置\n    // eslint-disable-next-line no-unused-vars\n    var textOptions = {\n      props: [\"data\"],\n      render: function(createElement) {\n        return createElement(\"div\", [\n          createElement(\"p\", \"文本组件\"),\n          createElement(\"span\", {\n            attrs: {\n              height: 300,\n              weight: 400\n            }\n          }),\n          this.data.content\n        ]);\n      }\n    };\n\n    // eslint-disable-next-line no-unused-vars\n    var renderData = {};\n\n    export default {\n      functional: true,\n      render(createElement, { data }) {\n        console.log(data);\n        if (data.attrs.data.type === \"text\") {\n          renderData = textOptions;\n        } else if (data.attrs.data.type === \"img\") {\n          renderData = imgOptions;\n        }\n        return createElement(renderData, data);\n      }\n    };\n```\n2.例如在About.vue文件中使用\n  ```javascript\n    <template>\n      <div class=\"about\">\n        <h1>functionnal的使用</h1>\n        <button @click=\"log('img')\">图片</button>\n        <button @click=\"log('text')\">文字</button>\n        <functionalVue :data=\"data\"></functionalVue>\n      </div>\n    </template>\n\n    <script>\n    import functionalVue from \"./functionnal\";\n    export default {\n      data() {\n        return {\n          data: {}\n        };\n      },\n      components: {\n        functionalVue\n      },\n      methods: {\n        log(type) {\n          if (type === \"img\") {\n            this.data = {\n              type: type,\n              url:\n                \"http://pic-bucket.ws.126.net/photo/0001/2019-02-07/E7D8PON900AO0001NOS.jpg\"\n            };\n          } else {\n            this.data = {\n              type: type,\n              content:\n                \"《流浪地球》中的科学：太阳何时吞并地球？科学家已经给出时间表\"\n            };\n          }\n        }\n      },\n      created() {\n        this.data = {\n          type: \"text\",\n          content: \"《流浪地球》中的科学：太阳何时吞并地球？科学家已经给出时间表\"\n        };\n      }\n    };\n    </script>\n\n  ```\n","slug":"vue的functionnal使用","published":1,"updated":"2026-01-02T00:46:24.227Z","comments":1,"layout":"post","photos":[],"_id":"cmjwbsw670018rotgdyc079c9","content":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>vue的functionnal使用 </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n<img src=\"../img/functionnal.gif\" style=\"width:305px;heigth:277px\">\n<span id=\"more\"></span>\n Vue.js 组件提供了一个 functional 开关，设置为 true 后，就可以让组件变为无状态、无实例的函数化组件。因为只是函数，所以渲染的开销相对来说，较小。\n\n<p>函数化的组件中的 Render 函数，提供了第二个参数 context 作为上下文，data、props、slots、children 以及 parent 都可以通过 context 来访问。</p>\n<p>1.新建一个functionnal.js（名字随意，只要是js文件）文件<br>  <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//图片组件设置</span></span><br><span class=\"line\">  <span class=\"comment\">// eslint-disable-next-line no-unused-vars</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> imgOptions = &#123;</span><br><span class=\"line\">  <span class=\"attr\">props</span>: [<span class=\"string\">&quot;data&quot;</span>],</span><br><span class=\"line\">  <span class=\"attr\">render</span>: <span class=\"keyword\">function</span>(<span class=\"params\">createElement</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>, [</span><br><span class=\"line\">      <span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;p&quot;</span>, <span class=\"string\">&quot;图片组件&quot;</span>),</span><br><span class=\"line\">      <span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;img&quot;</span>, &#123;</span><br><span class=\"line\">        <span class=\"attr\">attrs</span>: &#123;</span><br><span class=\"line\">          <span class=\"attr\">src</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">data</span>.<span class=\"property\">url</span>,</span><br><span class=\"line\">          <span class=\"attr\">height</span>: <span class=\"number\">300</span>,</span><br><span class=\"line\">          <span class=\"attr\">weight</span>: <span class=\"number\">400</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    ]);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"comment\">//文字组件设置</span></span><br><span class=\"line\"><span class=\"comment\">// eslint-disable-next-line no-unused-vars</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> textOptions = &#123;</span><br><span class=\"line\">  <span class=\"attr\">props</span>: [<span class=\"string\">&quot;data&quot;</span>],</span><br><span class=\"line\">  <span class=\"attr\">render</span>: <span class=\"keyword\">function</span>(<span class=\"params\">createElement</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>, [</span><br><span class=\"line\">      <span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;p&quot;</span>, <span class=\"string\">&quot;文本组件&quot;</span>),</span><br><span class=\"line\">      <span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;span&quot;</span>, &#123;</span><br><span class=\"line\">        <span class=\"attr\">attrs</span>: &#123;</span><br><span class=\"line\">          <span class=\"attr\">height</span>: <span class=\"number\">300</span>,</span><br><span class=\"line\">          <span class=\"attr\">weight</span>: <span class=\"number\">400</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;),</span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"property\">data</span>.<span class=\"property\">content</span></span><br><span class=\"line\">    ]);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// eslint-disable-next-line no-unused-vars</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> renderData = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">functional</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  <span class=\"title function_\">render</span>(<span class=\"params\">createElement, &#123; data &#125;</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(data);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (data.<span class=\"property\">attrs</span>.<span class=\"property\">data</span>.<span class=\"property\">type</span> === <span class=\"string\">&quot;text&quot;</span>) &#123;</span><br><span class=\"line\">      renderData = textOptions;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (data.<span class=\"property\">attrs</span>.<span class=\"property\">data</span>.<span class=\"property\">type</span> === <span class=\"string\">&quot;img&quot;</span>) &#123;</span><br><span class=\"line\">      renderData = imgOptions;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"title function_\">createElement</span>(renderData, data);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure><br>2.例如在About.vue文件中使用<br>  <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;about&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>functionnal的使用<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;log(&#x27;img&#x27;)&quot;</span>&gt;</span>图片<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;log(&#x27;text&#x27;)&quot;</span>&gt;</span>文字<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">functionalVue</span> <span class=\"attr\">:data</span>=<span class=\"string\">&quot;data&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">functionalVue</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"keyword\">import</span> functionalVue <span class=\"keyword\">from</span> <span class=\"string\">&quot;./functionnal&quot;</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"title function_\">data</span>(<span class=\"params\"></span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">return</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">      <span class=\"attr\">data</span>: &#123;&#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"attr\">components</span>: &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    functionalVue</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"attr\">methods</span>: &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"title function_\">log</span>(<span class=\"params\">type</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">      <span class=\"keyword\">if</span> (type === <span class=\"string\">&quot;img&quot;</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"variable language_\">this</span>.<span class=\"property\">data</span> = &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">          <span class=\"attr\">type</span>: type,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">          <span class=\"attr\">url</span>:</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&quot;http://pic-bucket.ws.126.net/photo/0001/2019-02-07/E7D8PON900AO0001NOS.jpg&quot;</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">      &#125; <span class=\"keyword\">else</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"variable language_\">this</span>.<span class=\"property\">data</span> = &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">          <span class=\"attr\">type</span>: type,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">          <span class=\"attr\">content</span>:</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&quot;《流浪地球》中的科学：太阳何时吞并地球？科学家已经给出时间表&quot;</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">      &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"title function_\">created</span>(<span class=\"params\"></span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"variable language_\">this</span>.<span class=\"property\">data</span> = &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">      <span class=\"attr\">type</span>: <span class=\"string\">&quot;text&quot;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">      <span class=\"attr\">content</span>: <span class=\"string\">&quot;《流浪地球》中的科学：太阳何时吞并地球？科学家已经给出时间表&quot;</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">&#125;;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n","excerpt":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>vue的functionnal使用 </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n<img src=\"../img/functionnal.gif\" style=\"width:305px;heigth:277px\">","more":"Vue.js 组件提供了一个 functional 开关，设置为 true 后，就可以让组件变为无状态、无实例的函数化组件。因为只是函数，所以渲染的开销相对来说，较小。\n\n<p>函数化的组件中的 Render 函数，提供了第二个参数 context 作为上下文，data、props、slots、children 以及 parent 都可以通过 context 来访问。</p>\n<p>1.新建一个functionnal.js（名字随意，只要是js文件）文件<br>  <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//图片组件设置</span></span><br><span class=\"line\">  <span class=\"comment\">// eslint-disable-next-line no-unused-vars</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> imgOptions = &#123;</span><br><span class=\"line\">  <span class=\"attr\">props</span>: [<span class=\"string\">&quot;data&quot;</span>],</span><br><span class=\"line\">  <span class=\"attr\">render</span>: <span class=\"keyword\">function</span>(<span class=\"params\">createElement</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>, [</span><br><span class=\"line\">      <span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;p&quot;</span>, <span class=\"string\">&quot;图片组件&quot;</span>),</span><br><span class=\"line\">      <span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;img&quot;</span>, &#123;</span><br><span class=\"line\">        <span class=\"attr\">attrs</span>: &#123;</span><br><span class=\"line\">          <span class=\"attr\">src</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">data</span>.<span class=\"property\">url</span>,</span><br><span class=\"line\">          <span class=\"attr\">height</span>: <span class=\"number\">300</span>,</span><br><span class=\"line\">          <span class=\"attr\">weight</span>: <span class=\"number\">400</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    ]);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"comment\">//文字组件设置</span></span><br><span class=\"line\"><span class=\"comment\">// eslint-disable-next-line no-unused-vars</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> textOptions = &#123;</span><br><span class=\"line\">  <span class=\"attr\">props</span>: [<span class=\"string\">&quot;data&quot;</span>],</span><br><span class=\"line\">  <span class=\"attr\">render</span>: <span class=\"keyword\">function</span>(<span class=\"params\">createElement</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;div&quot;</span>, [</span><br><span class=\"line\">      <span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;p&quot;</span>, <span class=\"string\">&quot;文本组件&quot;</span>),</span><br><span class=\"line\">      <span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;span&quot;</span>, &#123;</span><br><span class=\"line\">        <span class=\"attr\">attrs</span>: &#123;</span><br><span class=\"line\">          <span class=\"attr\">height</span>: <span class=\"number\">300</span>,</span><br><span class=\"line\">          <span class=\"attr\">weight</span>: <span class=\"number\">400</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;),</span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"property\">data</span>.<span class=\"property\">content</span></span><br><span class=\"line\">    ]);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// eslint-disable-next-line no-unused-vars</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> renderData = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">functional</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  <span class=\"title function_\">render</span>(<span class=\"params\">createElement, &#123; data &#125;</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(data);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (data.<span class=\"property\">attrs</span>.<span class=\"property\">data</span>.<span class=\"property\">type</span> === <span class=\"string\">&quot;text&quot;</span>) &#123;</span><br><span class=\"line\">      renderData = textOptions;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (data.<span class=\"property\">attrs</span>.<span class=\"property\">data</span>.<span class=\"property\">type</span> === <span class=\"string\">&quot;img&quot;</span>) &#123;</span><br><span class=\"line\">      renderData = imgOptions;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"title function_\">createElement</span>(renderData, data);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure><br>2.例如在About.vue文件中使用<br>  <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;about&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>functionnal的使用<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;log(&#x27;img&#x27;)&quot;</span>&gt;</span>图片<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">&quot;log(&#x27;text&#x27;)&quot;</span>&gt;</span>文字<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">functionalVue</span> <span class=\"attr\">:data</span>=<span class=\"string\">&quot;data&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">functionalVue</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"keyword\">import</span> functionalVue <span class=\"keyword\">from</span> <span class=\"string\">&quot;./functionnal&quot;</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"title function_\">data</span>(<span class=\"params\"></span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">return</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">      <span class=\"attr\">data</span>: &#123;&#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"attr\">components</span>: &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    functionalVue</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"attr\">methods</span>: &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"title function_\">log</span>(<span class=\"params\">type</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">      <span class=\"keyword\">if</span> (type === <span class=\"string\">&quot;img&quot;</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"variable language_\">this</span>.<span class=\"property\">data</span> = &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">          <span class=\"attr\">type</span>: type,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">          <span class=\"attr\">url</span>:</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&quot;http://pic-bucket.ws.126.net/photo/0001/2019-02-07/E7D8PON900AO0001NOS.jpg&quot;</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">      &#125; <span class=\"keyword\">else</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"variable language_\">this</span>.<span class=\"property\">data</span> = &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">          <span class=\"attr\">type</span>: type,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">          <span class=\"attr\">content</span>:</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"string\">&quot;《流浪地球》中的科学：太阳何时吞并地球？科学家已经给出时间表&quot;</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">      &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"title function_\">created</span>(<span class=\"params\"></span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"variable language_\">this</span>.<span class=\"property\">data</span> = &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">      <span class=\"attr\">type</span>: <span class=\"string\">&quot;text&quot;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">      <span class=\"attr\">content</span>: <span class=\"string\">&quot;《流浪地球》中的科学：太阳何时吞并地球？科学家已经给出时间表&quot;</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">&#125;;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>"},{"title":"webpack4.29.0基本用法","date":"2019-01-25T09:11:32.000Z","copyright":true,"keywords":null,"description":null,"_content":"\n{% cq %} 不积跬步无以至千里，不积小流无以成江海 {% endcq %}\n<img src=\"/img/jy.png\">\n<!--more-->\n# 准备工作\n+ 全局安装webpack和webpack-cli\n    >sudo npm install webpack -g\n    >sudo npm install webpack-cli -g\n\n+ 文件夹下局部安装\n    >npm init -y\n    >sudo npm install webpack --save-dev\n    >sudo npm install webpack-cli --save-dev\n\n## 实现对一个js文件打包\n``` \n    //webpack.config.js\n    const path = require('path')\n    module.exports = {\n        mode:'development',\n        entry:'./app.js',\n        output:{\n            filename:'[name].bundle.js',\n            path:path.join(__dirname,'./dist'),\n      }\n    }\n    这样就能在dist目录下出现一个app.bundle.js文件啦！\n```\n## 实现多个js文件打包\n```\n    //webpack.config.js\n    const path = require('path')\n    const CleanWebpackPlugin = require('clean-webpack-plugin')\n    module.exports = {\n        mode: 'development',\n        entry: {\n            index: './src/index.js',\n            test: './src/test.js',\n            test1: './src/test1.js',\n        },\n        output: {\n            path: path.join(__dirname,'./dist/js'),\n            filename:'[name]-[hash].js',\n            pubicPath: 'http://cdn.con' //请求时会自己加协议（location.protocol='http'）和端口号(host='cdn.con')\n        }，\n        plugins: [\n            new CleanWebpackPlugin (['./dist/js']) //清除之前打包的文件\n        ]\n    }\n```\n## 使用模版实现每个js对应自己的html\n```\n    //webpack.config.js\n    const path = require('path')\n    const HtmlWebpackPlugin = require('html-webpack-plugin') //模版loader\n    const CleanWebpackPlugin = require('clean-webpack-plugin')\n    module.exports = {\n        entry:{\n            index:'./src/index.js',\n            test:'./src/test.js',\n            test1:'./src/test1.js',\n        },\n        output:{\n            path:path.join(__dirname,'./dist/js'),\n            filename:'[name]-[hash].js',\n            publicPath:\"http://cdn.com\"\n        },\n        plugins:[\n            new HtmlWebpackPlugin({\n                title: 'this a index.html', //每个html 的title\n                template:'hello.html',\n                filename:'index.html',\n                excludeChunks:['test','test1'] //排除名为test.js,test1.js打包的js文件\n            }),\n            new HtmlWebpackPlugin({\n                title:'this a test.js',\n                template:'hello.html',\n                filename:'test.html',\n                excludeChunks:['index','test1']\n            }),\n            new HtmlWebpackPlugin({\n                title:'this a test1.js',\n                template:'hello.html',\n                filename:'test1.html',\n                excludeChunks:['test','index']       \n            }),\n            new CleanWebpackPlugin(['./dist/js'])\n        ]\n    }\n\n    //hello.html 模版内容\n    <head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title><%= htmlWebpackPlugin.options.title%></title>\n    <script type=\"text/javascript\">\n        <%=\n        compilation.assets[htmlWebpackPlugin.files.chunks.test1.entry.substr\n        (htmlWebpackPlugin.files.publicPath.length)].source() %>\n    </script>\n    </head>\n    <body>\n        <% for(let k in htmlWebpackPlugin.files.chunks) {%>\n            <% if(k != 'index') {%>\n                <script src=\"<%=htmlWebpackPlugin.files.chunks[k].entry %>\"></script>\n            <% }%>\n        <% } %>\n    </body>\n```\n## 使用file-loader|css-loader|style-loader|postcss-loader\n```\n    //webpack.config.js\n    module.exports = {\n    mode: 'development',\n    entry: './app.js',\n    output: {\n        filename: '[name].bundle.js',\n        path: path.join(__dirname, './dist/js1'),\n    },\n    plugins: [\n        new CleanWebpackPlugin(['./dist/js1']),\n        require('autoprefixer')\n    ],\n    module: {\n        rules: [\n        {\n            test: /\\.(le|c)ss$/,\n            test: /\\.(png|jpg|gif)$/,\n            use: [\n            { loader: \"style-loader\" },\n            { loader: \"css-loader\" },\n            { loader: 'file-loader'},\n            {\n                loader: \"postcss-loader\",\n                options: {\n                plugins: [\n                    require(\"autoprefixer\") /*在这里添加*/,\n                ],\n                }\n            }\n            ]\n\n        }\n        ]\n     },\n    }\n```\n### 简单打包一个库的演示\n\n```\n    //webapck.config.js\n    const path = require('path');\n\n    module.exports = {\n        mode:'development',\n        entry: './src/index.js',\n        // 不打包进自己写的库的代码中，在业务代码中加载\n        externals:['lodash'],\n        output: {\n            path: path.resolve(__dirname, 'dist'),\n            // 文件打包后的文件名字\n            filename: 'library.js',\n            //可以使用src引入变为全局变量\n            library:'library',   \n            //以上library挂载的地方（比如this window等）\n            libraryTarget: \"umd\"\n        }\n    };\n```","source":"_posts/webpack4-29-0.md","raw":"---\ntitle: 'webpack4.29.0基本用法'\ndate: 2019-01-25 17:11:32\ncategories: web\ntags:\n    - webpack4+\ncopyright: true\nkeywords:\ndescription:\n---\n\n{% cq %} 不积跬步无以至千里，不积小流无以成江海 {% endcq %}\n<img src=\"/img/jy.png\">\n<!--more-->\n# 准备工作\n+ 全局安装webpack和webpack-cli\n    >sudo npm install webpack -g\n    >sudo npm install webpack-cli -g\n\n+ 文件夹下局部安装\n    >npm init -y\n    >sudo npm install webpack --save-dev\n    >sudo npm install webpack-cli --save-dev\n\n## 实现对一个js文件打包\n``` \n    //webpack.config.js\n    const path = require('path')\n    module.exports = {\n        mode:'development',\n        entry:'./app.js',\n        output:{\n            filename:'[name].bundle.js',\n            path:path.join(__dirname,'./dist'),\n      }\n    }\n    这样就能在dist目录下出现一个app.bundle.js文件啦！\n```\n## 实现多个js文件打包\n```\n    //webpack.config.js\n    const path = require('path')\n    const CleanWebpackPlugin = require('clean-webpack-plugin')\n    module.exports = {\n        mode: 'development',\n        entry: {\n            index: './src/index.js',\n            test: './src/test.js',\n            test1: './src/test1.js',\n        },\n        output: {\n            path: path.join(__dirname,'./dist/js'),\n            filename:'[name]-[hash].js',\n            pubicPath: 'http://cdn.con' //请求时会自己加协议（location.protocol='http'）和端口号(host='cdn.con')\n        }，\n        plugins: [\n            new CleanWebpackPlugin (['./dist/js']) //清除之前打包的文件\n        ]\n    }\n```\n## 使用模版实现每个js对应自己的html\n```\n    //webpack.config.js\n    const path = require('path')\n    const HtmlWebpackPlugin = require('html-webpack-plugin') //模版loader\n    const CleanWebpackPlugin = require('clean-webpack-plugin')\n    module.exports = {\n        entry:{\n            index:'./src/index.js',\n            test:'./src/test.js',\n            test1:'./src/test1.js',\n        },\n        output:{\n            path:path.join(__dirname,'./dist/js'),\n            filename:'[name]-[hash].js',\n            publicPath:\"http://cdn.com\"\n        },\n        plugins:[\n            new HtmlWebpackPlugin({\n                title: 'this a index.html', //每个html 的title\n                template:'hello.html',\n                filename:'index.html',\n                excludeChunks:['test','test1'] //排除名为test.js,test1.js打包的js文件\n            }),\n            new HtmlWebpackPlugin({\n                title:'this a test.js',\n                template:'hello.html',\n                filename:'test.html',\n                excludeChunks:['index','test1']\n            }),\n            new HtmlWebpackPlugin({\n                title:'this a test1.js',\n                template:'hello.html',\n                filename:'test1.html',\n                excludeChunks:['test','index']       \n            }),\n            new CleanWebpackPlugin(['./dist/js'])\n        ]\n    }\n\n    //hello.html 模版内容\n    <head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title><%= htmlWebpackPlugin.options.title%></title>\n    <script type=\"text/javascript\">\n        <%=\n        compilation.assets[htmlWebpackPlugin.files.chunks.test1.entry.substr\n        (htmlWebpackPlugin.files.publicPath.length)].source() %>\n    </script>\n    </head>\n    <body>\n        <% for(let k in htmlWebpackPlugin.files.chunks) {%>\n            <% if(k != 'index') {%>\n                <script src=\"<%=htmlWebpackPlugin.files.chunks[k].entry %>\"></script>\n            <% }%>\n        <% } %>\n    </body>\n```\n## 使用file-loader|css-loader|style-loader|postcss-loader\n```\n    //webpack.config.js\n    module.exports = {\n    mode: 'development',\n    entry: './app.js',\n    output: {\n        filename: '[name].bundle.js',\n        path: path.join(__dirname, './dist/js1'),\n    },\n    plugins: [\n        new CleanWebpackPlugin(['./dist/js1']),\n        require('autoprefixer')\n    ],\n    module: {\n        rules: [\n        {\n            test: /\\.(le|c)ss$/,\n            test: /\\.(png|jpg|gif)$/,\n            use: [\n            { loader: \"style-loader\" },\n            { loader: \"css-loader\" },\n            { loader: 'file-loader'},\n            {\n                loader: \"postcss-loader\",\n                options: {\n                plugins: [\n                    require(\"autoprefixer\") /*在这里添加*/,\n                ],\n                }\n            }\n            ]\n\n        }\n        ]\n     },\n    }\n```\n### 简单打包一个库的演示\n\n```\n    //webapck.config.js\n    const path = require('path');\n\n    module.exports = {\n        mode:'development',\n        entry: './src/index.js',\n        // 不打包进自己写的库的代码中，在业务代码中加载\n        externals:['lodash'],\n        output: {\n            path: path.resolve(__dirname, 'dist'),\n            // 文件打包后的文件名字\n            filename: 'library.js',\n            //可以使用src引入变为全局变量\n            library:'library',   \n            //以上library挂载的地方（比如this window等）\n            libraryTarget: \"umd\"\n        }\n    };\n```","slug":"webpack4-29-0","published":1,"updated":"2026-01-02T00:43:17.576Z","comments":1,"layout":"post","photos":[],"_id":"cmjwbsw68001brotgek1ka0r3","content":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>不积跬步无以至千里，不积小流无以成江海 </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n<img src=\"/img/jy.png\">\n<span id=\"more\"></span>\n# 准备工作\n+ 全局安装webpack和webpack-cli\n    >sudo npm install webpack -g\n    >sudo npm install webpack-cli -g\n\n<ul>\n<li>文件夹下局部安装<blockquote>\n<p>npm init -y<br>sudo npm install webpack –save-dev<br>sudo npm install webpack-cli –save-dev</p>\n</blockquote>\n</li>\n</ul>\n<h2 id=\"实现对一个js文件打包\"><a href=\"#实现对一个js文件打包\" class=\"headerlink\" title=\"实现对一个js文件打包\"></a>实现对一个js文件打包</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//webpack.config.js</span><br><span class=\"line\">const path = require(&#x27;path&#x27;)</span><br><span class=\"line\">module.exports = &#123;</span><br><span class=\"line\">    mode:&#x27;development&#x27;,</span><br><span class=\"line\">    entry:&#x27;./app.js&#x27;,</span><br><span class=\"line\">    output:&#123;</span><br><span class=\"line\">        filename:&#x27;[name].bundle.js&#x27;,</span><br><span class=\"line\">        path:path.join(__dirname,&#x27;./dist&#x27;),</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">这样就能在dist目录下出现一个app.bundle.js文件啦！</span><br></pre></td></tr></table></figure>\n<h2 id=\"实现多个js文件打包\"><a href=\"#实现多个js文件打包\" class=\"headerlink\" title=\"实现多个js文件打包\"></a>实现多个js文件打包</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//webpack.config.js</span><br><span class=\"line\">const path = require(&#x27;path&#x27;)</span><br><span class=\"line\">const CleanWebpackPlugin = require(&#x27;clean-webpack-plugin&#x27;)</span><br><span class=\"line\">module.exports = &#123;</span><br><span class=\"line\">    mode: &#x27;development&#x27;,</span><br><span class=\"line\">    entry: &#123;</span><br><span class=\"line\">        index: &#x27;./src/index.js&#x27;,</span><br><span class=\"line\">        test: &#x27;./src/test.js&#x27;,</span><br><span class=\"line\">        test1: &#x27;./src/test1.js&#x27;,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    output: &#123;</span><br><span class=\"line\">        path: path.join(__dirname,&#x27;./dist/js&#x27;),</span><br><span class=\"line\">        filename:&#x27;[name]-[hash].js&#x27;,</span><br><span class=\"line\">        pubicPath: &#x27;http://cdn.con&#x27; //请求时会自己加协议（location.protocol=&#x27;http&#x27;）和端口号(host=&#x27;cdn.con&#x27;)</span><br><span class=\"line\">    &#125;，</span><br><span class=\"line\">    plugins: [</span><br><span class=\"line\">        new CleanWebpackPlugin ([&#x27;./dist/js&#x27;]) //清除之前打包的文件</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"使用模版实现每个js对应自己的html\"><a href=\"#使用模版实现每个js对应自己的html\" class=\"headerlink\" title=\"使用模版实现每个js对应自己的html\"></a>使用模版实现每个js对应自己的html</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//webpack.config.js</span><br><span class=\"line\">const path = require(&#x27;path&#x27;)</span><br><span class=\"line\">const HtmlWebpackPlugin = require(&#x27;html-webpack-plugin&#x27;) //模版loader</span><br><span class=\"line\">const CleanWebpackPlugin = require(&#x27;clean-webpack-plugin&#x27;)</span><br><span class=\"line\">module.exports = &#123;</span><br><span class=\"line\">    entry:&#123;</span><br><span class=\"line\">        index:&#x27;./src/index.js&#x27;,</span><br><span class=\"line\">        test:&#x27;./src/test.js&#x27;,</span><br><span class=\"line\">        test1:&#x27;./src/test1.js&#x27;,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    output:&#123;</span><br><span class=\"line\">        path:path.join(__dirname,&#x27;./dist/js&#x27;),</span><br><span class=\"line\">        filename:&#x27;[name]-[hash].js&#x27;,</span><br><span class=\"line\">        publicPath:&quot;http://cdn.com&quot;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    plugins:[</span><br><span class=\"line\">        new HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">            title: &#x27;this a index.html&#x27;, //每个html 的title</span><br><span class=\"line\">            template:&#x27;hello.html&#x27;,</span><br><span class=\"line\">            filename:&#x27;index.html&#x27;,</span><br><span class=\"line\">            excludeChunks:[&#x27;test&#x27;,&#x27;test1&#x27;] //排除名为test.js,test1.js打包的js文件</span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">        new HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">            title:&#x27;this a test.js&#x27;,</span><br><span class=\"line\">            template:&#x27;hello.html&#x27;,</span><br><span class=\"line\">            filename:&#x27;test.html&#x27;,</span><br><span class=\"line\">            excludeChunks:[&#x27;index&#x27;,&#x27;test1&#x27;]</span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">        new HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">            title:&#x27;this a test1.js&#x27;,</span><br><span class=\"line\">            template:&#x27;hello.html&#x27;,</span><br><span class=\"line\">            filename:&#x27;test1.html&#x27;,</span><br><span class=\"line\">            excludeChunks:[&#x27;test&#x27;,&#x27;index&#x27;]       </span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">        new CleanWebpackPlugin([&#x27;./dist/js&#x27;])</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">//hello.html 模版内容</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class=\"line\">&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class=\"line\">&lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class=\"line\">&lt;title&gt;&lt;%= htmlWebpackPlugin.options.title%&gt;&lt;/title&gt;</span><br><span class=\"line\">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class=\"line\">    &lt;%=</span><br><span class=\"line\">    compilation.assets[htmlWebpackPlugin.files.chunks.test1.entry.substr</span><br><span class=\"line\">    (htmlWebpackPlugin.files.publicPath.length)].source() %&gt;</span><br><span class=\"line\">&lt;/script&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">    &lt;% for(let k in htmlWebpackPlugin.files.chunks) &#123;%&gt;</span><br><span class=\"line\">        &lt;% if(k != &#x27;index&#x27;) &#123;%&gt;</span><br><span class=\"line\">            &lt;script src=&quot;&lt;%=htmlWebpackPlugin.files.chunks[k].entry %&gt;&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">        &lt;% &#125;%&gt;</span><br><span class=\"line\">    &lt;% &#125; %&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"使用file-loader-css-loader-style-loader-postcss-loader\"><a href=\"#使用file-loader-css-loader-style-loader-postcss-loader\" class=\"headerlink\" title=\"使用file-loader|css-loader|style-loader|postcss-loader\"></a>使用file-loader|css-loader|style-loader|postcss-loader</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//webpack.config.js</span><br><span class=\"line\">module.exports = &#123;</span><br><span class=\"line\">mode: &#x27;development&#x27;,</span><br><span class=\"line\">entry: &#x27;./app.js&#x27;,</span><br><span class=\"line\">output: &#123;</span><br><span class=\"line\">    filename: &#x27;[name].bundle.js&#x27;,</span><br><span class=\"line\">    path: path.join(__dirname, &#x27;./dist/js1&#x27;),</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">plugins: [</span><br><span class=\"line\">    new CleanWebpackPlugin([&#x27;./dist/js1&#x27;]),</span><br><span class=\"line\">    require(&#x27;autoprefixer&#x27;)</span><br><span class=\"line\">],</span><br><span class=\"line\">module: &#123;</span><br><span class=\"line\">    rules: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        test: /\\.(le|c)ss$/,</span><br><span class=\"line\">        test: /\\.(png|jpg|gif)$/,</span><br><span class=\"line\">        use: [</span><br><span class=\"line\">        &#123; loader: &quot;style-loader&quot; &#125;,</span><br><span class=\"line\">        &#123; loader: &quot;css-loader&quot; &#125;,</span><br><span class=\"line\">        &#123; loader: &#x27;file-loader&#x27;&#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            loader: &quot;postcss-loader&quot;,</span><br><span class=\"line\">            options: &#123;</span><br><span class=\"line\">            plugins: [</span><br><span class=\"line\">                require(&quot;autoprefixer&quot;) /*在这里添加*/,</span><br><span class=\"line\">            ],</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\"> &#125;,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"简单打包一个库的演示\"><a href=\"#简单打包一个库的演示\" class=\"headerlink\" title=\"简单打包一个库的演示\"></a>简单打包一个库的演示</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//webapck.config.js</span><br><span class=\"line\">const path = require(&#x27;path&#x27;);</span><br><span class=\"line\"></span><br><span class=\"line\">module.exports = &#123;</span><br><span class=\"line\">    mode:&#x27;development&#x27;,</span><br><span class=\"line\">    entry: &#x27;./src/index.js&#x27;,</span><br><span class=\"line\">    // 不打包进自己写的库的代码中，在业务代码中加载</span><br><span class=\"line\">    externals:[&#x27;lodash&#x27;],</span><br><span class=\"line\">    output: &#123;</span><br><span class=\"line\">        path: path.resolve(__dirname, &#x27;dist&#x27;),</span><br><span class=\"line\">        // 文件打包后的文件名字</span><br><span class=\"line\">        filename: &#x27;library.js&#x27;,</span><br><span class=\"line\">        //可以使用src引入变为全局变量</span><br><span class=\"line\">        library:&#x27;library&#x27;,   </span><br><span class=\"line\">        //以上library挂载的地方（比如this window等）</span><br><span class=\"line\">        libraryTarget: &quot;umd&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>","excerpt":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>不积跬步无以至千里，不积小流无以成江海 </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n<img src=\"/img/jy.png\">","more":"# 准备工作\n+ 全局安装webpack和webpack-cli\n    >sudo npm install webpack -g\n    >sudo npm install webpack-cli -g\n\n<ul>\n<li>文件夹下局部安装<blockquote>\n<p>npm init -y<br>sudo npm install webpack –save-dev<br>sudo npm install webpack-cli –save-dev</p>\n</blockquote>\n</li>\n</ul>\n<h2 id=\"实现对一个js文件打包\"><a href=\"#实现对一个js文件打包\" class=\"headerlink\" title=\"实现对一个js文件打包\"></a>实现对一个js文件打包</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//webpack.config.js</span><br><span class=\"line\">const path = require(&#x27;path&#x27;)</span><br><span class=\"line\">module.exports = &#123;</span><br><span class=\"line\">    mode:&#x27;development&#x27;,</span><br><span class=\"line\">    entry:&#x27;./app.js&#x27;,</span><br><span class=\"line\">    output:&#123;</span><br><span class=\"line\">        filename:&#x27;[name].bundle.js&#x27;,</span><br><span class=\"line\">        path:path.join(__dirname,&#x27;./dist&#x27;),</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">这样就能在dist目录下出现一个app.bundle.js文件啦！</span><br></pre></td></tr></table></figure>\n<h2 id=\"实现多个js文件打包\"><a href=\"#实现多个js文件打包\" class=\"headerlink\" title=\"实现多个js文件打包\"></a>实现多个js文件打包</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//webpack.config.js</span><br><span class=\"line\">const path = require(&#x27;path&#x27;)</span><br><span class=\"line\">const CleanWebpackPlugin = require(&#x27;clean-webpack-plugin&#x27;)</span><br><span class=\"line\">module.exports = &#123;</span><br><span class=\"line\">    mode: &#x27;development&#x27;,</span><br><span class=\"line\">    entry: &#123;</span><br><span class=\"line\">        index: &#x27;./src/index.js&#x27;,</span><br><span class=\"line\">        test: &#x27;./src/test.js&#x27;,</span><br><span class=\"line\">        test1: &#x27;./src/test1.js&#x27;,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    output: &#123;</span><br><span class=\"line\">        path: path.join(__dirname,&#x27;./dist/js&#x27;),</span><br><span class=\"line\">        filename:&#x27;[name]-[hash].js&#x27;,</span><br><span class=\"line\">        pubicPath: &#x27;http://cdn.con&#x27; //请求时会自己加协议（location.protocol=&#x27;http&#x27;）和端口号(host=&#x27;cdn.con&#x27;)</span><br><span class=\"line\">    &#125;，</span><br><span class=\"line\">    plugins: [</span><br><span class=\"line\">        new CleanWebpackPlugin ([&#x27;./dist/js&#x27;]) //清除之前打包的文件</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"使用模版实现每个js对应自己的html\"><a href=\"#使用模版实现每个js对应自己的html\" class=\"headerlink\" title=\"使用模版实现每个js对应自己的html\"></a>使用模版实现每个js对应自己的html</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//webpack.config.js</span><br><span class=\"line\">const path = require(&#x27;path&#x27;)</span><br><span class=\"line\">const HtmlWebpackPlugin = require(&#x27;html-webpack-plugin&#x27;) //模版loader</span><br><span class=\"line\">const CleanWebpackPlugin = require(&#x27;clean-webpack-plugin&#x27;)</span><br><span class=\"line\">module.exports = &#123;</span><br><span class=\"line\">    entry:&#123;</span><br><span class=\"line\">        index:&#x27;./src/index.js&#x27;,</span><br><span class=\"line\">        test:&#x27;./src/test.js&#x27;,</span><br><span class=\"line\">        test1:&#x27;./src/test1.js&#x27;,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    output:&#123;</span><br><span class=\"line\">        path:path.join(__dirname,&#x27;./dist/js&#x27;),</span><br><span class=\"line\">        filename:&#x27;[name]-[hash].js&#x27;,</span><br><span class=\"line\">        publicPath:&quot;http://cdn.com&quot;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    plugins:[</span><br><span class=\"line\">        new HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">            title: &#x27;this a index.html&#x27;, //每个html 的title</span><br><span class=\"line\">            template:&#x27;hello.html&#x27;,</span><br><span class=\"line\">            filename:&#x27;index.html&#x27;,</span><br><span class=\"line\">            excludeChunks:[&#x27;test&#x27;,&#x27;test1&#x27;] //排除名为test.js,test1.js打包的js文件</span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">        new HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">            title:&#x27;this a test.js&#x27;,</span><br><span class=\"line\">            template:&#x27;hello.html&#x27;,</span><br><span class=\"line\">            filename:&#x27;test.html&#x27;,</span><br><span class=\"line\">            excludeChunks:[&#x27;index&#x27;,&#x27;test1&#x27;]</span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">        new HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">            title:&#x27;this a test1.js&#x27;,</span><br><span class=\"line\">            template:&#x27;hello.html&#x27;,</span><br><span class=\"line\">            filename:&#x27;test1.html&#x27;,</span><br><span class=\"line\">            excludeChunks:[&#x27;test&#x27;,&#x27;index&#x27;]       </span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">        new CleanWebpackPlugin([&#x27;./dist/js&#x27;])</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">//hello.html 模版内容</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class=\"line\">&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class=\"line\">&lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class=\"line\">&lt;title&gt;&lt;%= htmlWebpackPlugin.options.title%&gt;&lt;/title&gt;</span><br><span class=\"line\">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class=\"line\">    &lt;%=</span><br><span class=\"line\">    compilation.assets[htmlWebpackPlugin.files.chunks.test1.entry.substr</span><br><span class=\"line\">    (htmlWebpackPlugin.files.publicPath.length)].source() %&gt;</span><br><span class=\"line\">&lt;/script&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">    &lt;% for(let k in htmlWebpackPlugin.files.chunks) &#123;%&gt;</span><br><span class=\"line\">        &lt;% if(k != &#x27;index&#x27;) &#123;%&gt;</span><br><span class=\"line\">            &lt;script src=&quot;&lt;%=htmlWebpackPlugin.files.chunks[k].entry %&gt;&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">        &lt;% &#125;%&gt;</span><br><span class=\"line\">    &lt;% &#125; %&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"使用file-loader-css-loader-style-loader-postcss-loader\"><a href=\"#使用file-loader-css-loader-style-loader-postcss-loader\" class=\"headerlink\" title=\"使用file-loader|css-loader|style-loader|postcss-loader\"></a>使用file-loader|css-loader|style-loader|postcss-loader</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//webpack.config.js</span><br><span class=\"line\">module.exports = &#123;</span><br><span class=\"line\">mode: &#x27;development&#x27;,</span><br><span class=\"line\">entry: &#x27;./app.js&#x27;,</span><br><span class=\"line\">output: &#123;</span><br><span class=\"line\">    filename: &#x27;[name].bundle.js&#x27;,</span><br><span class=\"line\">    path: path.join(__dirname, &#x27;./dist/js1&#x27;),</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">plugins: [</span><br><span class=\"line\">    new CleanWebpackPlugin([&#x27;./dist/js1&#x27;]),</span><br><span class=\"line\">    require(&#x27;autoprefixer&#x27;)</span><br><span class=\"line\">],</span><br><span class=\"line\">module: &#123;</span><br><span class=\"line\">    rules: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        test: /\\.(le|c)ss$/,</span><br><span class=\"line\">        test: /\\.(png|jpg|gif)$/,</span><br><span class=\"line\">        use: [</span><br><span class=\"line\">        &#123; loader: &quot;style-loader&quot; &#125;,</span><br><span class=\"line\">        &#123; loader: &quot;css-loader&quot; &#125;,</span><br><span class=\"line\">        &#123; loader: &#x27;file-loader&#x27;&#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            loader: &quot;postcss-loader&quot;,</span><br><span class=\"line\">            options: &#123;</span><br><span class=\"line\">            plugins: [</span><br><span class=\"line\">                require(&quot;autoprefixer&quot;) /*在这里添加*/,</span><br><span class=\"line\">            ],</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\"> &#125;,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"简单打包一个库的演示\"><a href=\"#简单打包一个库的演示\" class=\"headerlink\" title=\"简单打包一个库的演示\"></a>简单打包一个库的演示</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//webapck.config.js</span><br><span class=\"line\">const path = require(&#x27;path&#x27;);</span><br><span class=\"line\"></span><br><span class=\"line\">module.exports = &#123;</span><br><span class=\"line\">    mode:&#x27;development&#x27;,</span><br><span class=\"line\">    entry: &#x27;./src/index.js&#x27;,</span><br><span class=\"line\">    // 不打包进自己写的库的代码中，在业务代码中加载</span><br><span class=\"line\">    externals:[&#x27;lodash&#x27;],</span><br><span class=\"line\">    output: &#123;</span><br><span class=\"line\">        path: path.resolve(__dirname, &#x27;dist&#x27;),</span><br><span class=\"line\">        // 文件打包后的文件名字</span><br><span class=\"line\">        filename: &#x27;library.js&#x27;,</span><br><span class=\"line\">        //可以使用src引入变为全局变量</span><br><span class=\"line\">        library:&#x27;library&#x27;,   </span><br><span class=\"line\">        //以上library挂载的地方（比如this window等）</span><br><span class=\"line\">        libraryTarget: &quot;umd&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>"},{"title":"在mac appstor下载软件提示内存不足问题","date":"2019-08-15T02:04:03.000Z","copyright":null,"keywords":null,"description":null,"_content":"{% cq %} 日积月累 {% endcq %}\n<!--more-->\ntime machine搞的鬼。你原来空间不足时，但time machine存储的是你的“过去”你只禁用掉time machine，再删除time machine时间点就可以了，另外可以运行电脑一两天，也有可能就好了。你在关于存储空间中显示的不是真实值，用df -h查看才是真实的。只要运行sudo tmutil listlocalsnapshots /查看有还存储了那些time machine，再用下面的命令删除掉就可以了。","source":"_posts/在mac app store下载软件提示内存不足问题.md","raw":"---\ntitle: 在mac appstor下载软件提示内存不足问题\ndate: 2019-08-15 10:04:03\ncategories: 用机小技巧\ntags:\ncopyright:\nkeywords:\ndescription:\n---\n{% cq %} 日积月累 {% endcq %}\n<!--more-->\ntime machine搞的鬼。你原来空间不足时，但time machine存储的是你的“过去”你只禁用掉time machine，再删除time machine时间点就可以了，另外可以运行电脑一两天，也有可能就好了。你在关于存储空间中显示的不是真实值，用df -h查看才是真实的。只要运行sudo tmutil listlocalsnapshots /查看有还存储了那些time machine，再用下面的命令删除掉就可以了。","slug":"在mac app store下载软件提示内存不足问题","published":1,"updated":"2026-01-02T00:43:17.577Z","comments":1,"layout":"post","photos":[],"_id":"cmjwbsw68001erotgfqr8dh3y","content":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>日积月累 </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n<span id=\"more\"></span>\n<p>time machine搞的鬼。你原来空间不足时，但time machine存储的是你的“过去”你只禁用掉time machine，再删除time machine时间点就可以了，另外可以运行电脑一两天，也有可能就好了。你在关于存储空间中显示的不是真实值，用df -h查看才是真实的。只要运行sudo tmutil listlocalsnapshots &#x2F;查看有还存储了那些time machine，再用下面的命令删除掉就可以了。</p>\n","excerpt":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>日积月累 </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>","more":"<p>time machine搞的鬼。你原来空间不足时，但time machine存储的是你的“过去”你只禁用掉time machine，再删除time machine时间点就可以了，另外可以运行电脑一两天，也有可能就好了。你在关于存储空间中显示的不是真实值，用df -h查看才是真实的。只要运行sudo tmutil listlocalsnapshots &#x2F;查看有还存储了那些time machine，再用下面的命令删除掉就可以了。</p>"},{"title":"区块链理论和代码演示","date":"2019-02-03T13:28:21.000Z","copyright":null,"keywords":null,"description":null,"_content":"{%cq%}一场没有诗和远方，全是苟且的演讲{%endcq%}\n无意间看晓说，他说5G对以后的影响，其中有个数据分发使用了比特币技术，对此查阅资料及视频进行学习，以下为个人总结\n<!--more-->\n参考资料如何\n* [晓说视频](https://v.youku.com/v_show/id_XMzk5Mzk3MjI4OA==.html?spm=a2h0j.11185381.listitem_page1.5!6~A&&s=6e782defbfbd0d4e11ef)\n\n* [讲解区块链原理视频](https://www.imooc.com/video/17059)\n\n* [区块链代码实现视频](https://www.imooc.com/video/17549)\n\n* [以太坊开源代码](https://github.com/ethereum/go-ethereum) 以太坊（英文Ethereum）是一个开源的有智能合约功能的公共区块链平台，通过其专用加密货币以太币（Ether）提供去中心化的以太虚拟机（Ethereum Virtual Machine）来处理点对点合约。\n\n\n## 区块链基本原型\n\n* 区块链本质就是 **分布式数据库**\n* 区块链是 **公开的数据库**，不是私人的数据库\n* 区块链是加密货币和智能合约的基础\n\n## 解决去中心问题\n问：如何快速验证哪个数据才是正确的？\n答：每次交易都记录 序号/时间戳/hash值，形成一个区块链，和其他区块进行对比\n\n## 如何确定使用权。\n问：账户所有权问题\n    <img src=\"/img/ownership.png\">\n    <img src=\"/img/ownership1.png\">\n答：地址是用公钥通过hash值生成的，值再进行Base58进行编码的值,谁用这个地址支付，谁就拥有这个地址的所有权,谁有这个私钥，谁就能用这个地址支付，丢失私钥就是丢失使用权不能补办\n\n## 使用go语言模拟区块链技术基本原理\n<img src=\"/img/blockchain-basic-core.png\">\n\n# 挖矿的本质\n使用计算机计算，前面连续都是零的一串，记录交易信息的特殊的hash值生产的编码","source":"_posts/区块链技术.md","raw":"---\ntitle: 区块链理论和代码演示\ndate: 2019-02-03 21:28:21\ncategories: 区块链\ntags:\n    - 区块链理论和代码演示\ncopyright:\nkeywords:\ndescription:\n---\n{%cq%}一场没有诗和远方，全是苟且的演讲{%endcq%}\n无意间看晓说，他说5G对以后的影响，其中有个数据分发使用了比特币技术，对此查阅资料及视频进行学习，以下为个人总结\n<!--more-->\n参考资料如何\n* [晓说视频](https://v.youku.com/v_show/id_XMzk5Mzk3MjI4OA==.html?spm=a2h0j.11185381.listitem_page1.5!6~A&&s=6e782defbfbd0d4e11ef)\n\n* [讲解区块链原理视频](https://www.imooc.com/video/17059)\n\n* [区块链代码实现视频](https://www.imooc.com/video/17549)\n\n* [以太坊开源代码](https://github.com/ethereum/go-ethereum) 以太坊（英文Ethereum）是一个开源的有智能合约功能的公共区块链平台，通过其专用加密货币以太币（Ether）提供去中心化的以太虚拟机（Ethereum Virtual Machine）来处理点对点合约。\n\n\n## 区块链基本原型\n\n* 区块链本质就是 **分布式数据库**\n* 区块链是 **公开的数据库**，不是私人的数据库\n* 区块链是加密货币和智能合约的基础\n\n## 解决去中心问题\n问：如何快速验证哪个数据才是正确的？\n答：每次交易都记录 序号/时间戳/hash值，形成一个区块链，和其他区块进行对比\n\n## 如何确定使用权。\n问：账户所有权问题\n    <img src=\"/img/ownership.png\">\n    <img src=\"/img/ownership1.png\">\n答：地址是用公钥通过hash值生成的，值再进行Base58进行编码的值,谁用这个地址支付，谁就拥有这个地址的所有权,谁有这个私钥，谁就能用这个地址支付，丢失私钥就是丢失使用权不能补办\n\n## 使用go语言模拟区块链技术基本原理\n<img src=\"/img/blockchain-basic-core.png\">\n\n# 挖矿的本质\n使用计算机计算，前面连续都是零的一串，记录交易信息的特殊的hash值生产的编码","slug":"区块链技术","published":1,"updated":"2026-01-02T00:43:17.576Z","comments":1,"layout":"post","photos":[],"_id":"cmjwbsw68001hrotghjeqdslp","content":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>一场没有诗和远方，全是苟且的演讲</p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n<p>无意间看晓说，他说5G对以后的影响，其中有个数据分发使用了比特币技术，对此查阅资料及视频进行学习，以下为个人总结</p>\n<span id=\"more\"></span>\n<p>参考资料如何</p>\n<ul>\n<li><p><a href=\"https://v.youku.com/v_show/id_XMzk5Mzk3MjI4OA==.html?spm=a2h0j.11185381.listitem_page1.5!6~A&&s=6e782defbfbd0d4e11ef\">晓说视频</a></p>\n</li>\n<li><p><a href=\"https://www.imooc.com/video/17059\">讲解区块链原理视频</a></p>\n</li>\n<li><p><a href=\"https://www.imooc.com/video/17549\">区块链代码实现视频</a></p>\n</li>\n<li><p><a href=\"https://github.com/ethereum/go-ethereum\">以太坊开源代码</a> 以太坊（英文Ethereum）是一个开源的有智能合约功能的公共区块链平台，通过其专用加密货币以太币（Ether）提供去中心化的以太虚拟机（Ethereum Virtual Machine）来处理点对点合约。</p>\n</li>\n</ul>\n<h2 id=\"区块链基本原型\"><a href=\"#区块链基本原型\" class=\"headerlink\" title=\"区块链基本原型\"></a>区块链基本原型</h2><ul>\n<li>区块链本质就是 <strong>分布式数据库</strong></li>\n<li>区块链是 <strong>公开的数据库</strong>，不是私人的数据库</li>\n<li>区块链是加密货币和智能合约的基础</li>\n</ul>\n<h2 id=\"解决去中心问题\"><a href=\"#解决去中心问题\" class=\"headerlink\" title=\"解决去中心问题\"></a>解决去中心问题</h2><p>问：如何快速验证哪个数据才是正确的？<br>答：每次交易都记录 序号&#x2F;时间戳&#x2F;hash值，形成一个区块链，和其他区块进行对比</p>\n<h2 id=\"如何确定使用权。\"><a href=\"#如何确定使用权。\" class=\"headerlink\" title=\"如何确定使用权。\"></a>如何确定使用权。</h2><p>问：账户所有权问题<br>    <img src=\"/img/ownership.png\"><br>    <img src=\"/img/ownership1.png\"><br>答：地址是用公钥通过hash值生成的，值再进行Base58进行编码的值,谁用这个地址支付，谁就拥有这个地址的所有权,谁有这个私钥，谁就能用这个地址支付，丢失私钥就是丢失使用权不能补办</p>\n<h2 id=\"使用go语言模拟区块链技术基本原理\"><a href=\"#使用go语言模拟区块链技术基本原理\" class=\"headerlink\" title=\"使用go语言模拟区块链技术基本原理\"></a>使用go语言模拟区块链技术基本原理</h2><img src=\"/img/blockchain-basic-core.png\">\n\n<h1 id=\"挖矿的本质\"><a href=\"#挖矿的本质\" class=\"headerlink\" title=\"挖矿的本质\"></a>挖矿的本质</h1><p>使用计算机计算，前面连续都是零的一串，记录交易信息的特殊的hash值生产的编码</p>\n","excerpt":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>一场没有诗和远方，全是苟且的演讲</p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n<p>无意间看晓说，他说5G对以后的影响，其中有个数据分发使用了比特币技术，对此查阅资料及视频进行学习，以下为个人总结</p>","more":"<p>参考资料如何</p>\n<ul>\n<li><p><a href=\"https://v.youku.com/v_show/id_XMzk5Mzk3MjI4OA==.html?spm=a2h0j.11185381.listitem_page1.5!6~A&&s=6e782defbfbd0d4e11ef\">晓说视频</a></p>\n</li>\n<li><p><a href=\"https://www.imooc.com/video/17059\">讲解区块链原理视频</a></p>\n</li>\n<li><p><a href=\"https://www.imooc.com/video/17549\">区块链代码实现视频</a></p>\n</li>\n<li><p><a href=\"https://github.com/ethereum/go-ethereum\">以太坊开源代码</a> 以太坊（英文Ethereum）是一个开源的有智能合约功能的公共区块链平台，通过其专用加密货币以太币（Ether）提供去中心化的以太虚拟机（Ethereum Virtual Machine）来处理点对点合约。</p>\n</li>\n</ul>\n<h2 id=\"区块链基本原型\"><a href=\"#区块链基本原型\" class=\"headerlink\" title=\"区块链基本原型\"></a>区块链基本原型</h2><ul>\n<li>区块链本质就是 <strong>分布式数据库</strong></li>\n<li>区块链是 <strong>公开的数据库</strong>，不是私人的数据库</li>\n<li>区块链是加密货币和智能合约的基础</li>\n</ul>\n<h2 id=\"解决去中心问题\"><a href=\"#解决去中心问题\" class=\"headerlink\" title=\"解决去中心问题\"></a>解决去中心问题</h2><p>问：如何快速验证哪个数据才是正确的？<br>答：每次交易都记录 序号&#x2F;时间戳&#x2F;hash值，形成一个区块链，和其他区块进行对比</p>\n<h2 id=\"如何确定使用权。\"><a href=\"#如何确定使用权。\" class=\"headerlink\" title=\"如何确定使用权。\"></a>如何确定使用权。</h2><p>问：账户所有权问题<br>    <img src=\"/img/ownership.png\"><br>    <img src=\"/img/ownership1.png\"><br>答：地址是用公钥通过hash值生成的，值再进行Base58进行编码的值,谁用这个地址支付，谁就拥有这个地址的所有权,谁有这个私钥，谁就能用这个地址支付，丢失私钥就是丢失使用权不能补办</p>\n<h2 id=\"使用go语言模拟区块链技术基本原理\"><a href=\"#使用go语言模拟区块链技术基本原理\" class=\"headerlink\" title=\"使用go语言模拟区块链技术基本原理\"></a>使用go语言模拟区块链技术基本原理</h2><img src=\"/img/blockchain-basic-core.png\">\n\n<h1 id=\"挖矿的本质\"><a href=\"#挖矿的本质\" class=\"headerlink\" title=\"挖矿的本质\"></a>挖矿的本质</h1><p>使用计算机计算，前面连续都是零的一串，记录交易信息的特殊的hash值生产的编码</p>"},{"title":"图片懒加载","date":"2019-02-14T11:22:21.000Z","copyright":null,"keywords":null,"description":null,"_content":"{% cq %} LazyLoad {% endcq %}\n<img src=\"/img/lazyload.gif\">\n<!--more-->\n# 懒加载的意义\n这里‘懒’的意思可以理解为延迟，如淘宝、京东这些电商平台有大量的图片，如果上来就加载服务器表示压力山大，所以就想出了懒加载这种克敌之法，用户滚动到的区域才发送请求加载内容\n# 原理\n将页面中的img标签src指向一张小照片或者为空都可以，然后写一个自定义属性比如（data-src）指向正确的图片，其实就是用正确的照片替换src里面的照片\n# 代码\n在写代码前，需要了解各种高度。先看这篇文章[js坐标位置](https://zhanghuaxiao.github.io/2019/02/14/js获取事件坐标位置/)\n```javascript\n    <head>\n    <meta charset=\"UTF-8\">\n    <title>Document</title>\n    <style>\n        img {\n            display: block;\n            margin-bottom: 50px;\n            width: 400px;\n            height: 400px;\n        }\n    </style>\n</head>\n<body>\n    <img src=\"\" data-src=\"http://ww4.sinaimg.cn/large/006y8mN6gw1fa5obmqrmvj305k05k3yh.jpg\" alt=\"\">\n        <img src=\"\" data-src=\"http://ww1.sinaimg.cn/large/006y8mN6gw1fa7kaed2hpj30sg0l9q54.jpg\" alt=\"\">\n        <img src=\"\" data-src=\"http://imgsrc.baidu.com/imgad/pic/item/3c6d55fbb2fb43161361e1432ba4462309f7d389.jpg\" alt=\"\">\n        <img src=\"\" data-src=\"http://pic.58pic.com/58pic/15/68/59/71X58PICNjx_1024.jpg\" alt=\"\">\n        <img src=\"\" data-src=\"http://qimg.hxnews.com/2019/0128/1548663985785.jpg\" alt=\"\">\n        <img src=\"\" data-src=\"http://imgsrc.baidu.com/imgad/pic/item/242dd42a2834349bf8d014a3c3ea15ce37d3bec6.jpg\" alt=\"\">\n        <img src=\"\" data-src=\"http://imgsrc.baidu.com/imgad/pic/item/d439b6003af33a87089f4704cc5c10385343b53a.jpg\" alt=\"\">\n        <img src=\"\" data-src=\"http://imgsrc.baidu.com/imgad/pic/item/38dbb6fd5266d01607666e0b9d2bd40735fa3591.jpg\" alt=\"\">\n        <img src=\"\" data-src=\"http://imgsrc.baidu.com/imgad/pic/item/d043ad4bd11373f02f236d8cae0f4bfbfbed0480.jpg\" alt=\"\">\n</body>\n```\n## javascript\n```javascript\n    var num = document.getElementsByTagName('img').length;\n    var img = document.getElementsByTagName(\"img\");\n    var n = 0; //存储图片加载到的位置，避免每次都从第一张图片开始遍历\n    lazyload(); //页面载入完毕加载可是区域内的图片\n    window.onscroll = lazyload;\n    function lazyload() { //监听页面滚动事件\n        var seeHeight = document.documentElement.clientHeight; //可见区域高度\n        var scrollTop = document.documentElement.scrollTop || document.body.scrollTop; //滚动条距离顶部高度\n        for (var i = n; i < num; i++) {\n            if (img[i].offsetTop < seeHeight + scrollTop) {\n                if (img[i].getAttribute(\"src\") == \"\") {\n                    img[i].src = img[i].getAttribute(\"data-src\");\n                }\n                n = i + 1;\n            }\n        }\n    }\n```\n## 使用节流函数进行性能优化\n如果直接将函数绑定在scroll事件上，当页面滚动时，函数会被高频触发，这非常影响浏览器的性能。\n我想实现限制触发频率，来优化性能。\n\n节流函数：只允许一个函数在N秒内执行一次。下面是一个通俗易通的节流函数：\n{%codeblock lang:javascript%}\n    var num = document.getElementsByTagName('img').length;\n    var img = document.getElementsByTagName(\"img\");\n    var n = 0; //存储图片加载到的位置，避免每次都从第一张图片开始遍历\n    resizehandler(); //页面载入完毕加载可是区域内的图片\n    n=0;\n    function resizehandler(){\n        var seeHeight = document.documentElement.clientHeight; //可见区域高度\n        var scrollTop = document.documentElement.scrollTop || document.body.scrollTop; //滚动条距离顶部高度\n        for (var i = n; i < num; i++) {\n            if (img[i].offsetTop < seeHeight + scrollTop) {\n                if (img[i].getAttribute(\"src\") == \"\") {\n                    img[i].src = img[i].getAttribute(\"data-src\");\n                }\n                n = i + 1;\n            }\n        }\n    }\n    function throttle(method,context){\n        clearTimeout(method.tId);\n        method.tId=setTimeout(function(){\n            method.call(context);\n        },500);\n    }\n    window.onscroll=function(){\n        throttle(resizehandler,window);\n    }\n{% endcodeblock %}    \n# 函数节流方案以下三种\n## 时间戳方案\n{% codeblock lang:javascript%}\n    var num = document.getElementsByTagName('img').length;\n    var img = document.getElementsByTagName(\"img\");\n    var n = 0; //存储图片加载到的位置，避免每次都从第一张图片开始遍历\n    lazyload(); //页面载入完毕加载可是区域内的图片\n    function lazyload() { //监听页面滚动事件\n        var seeHeight = document.documentElement.clientHeight; //可见区域高度\n        var scrollTop = document.documentElement.scrollTop || document.body.scrollTop; //滚动条距离顶部高度\n        for (var i = n; i < num; i++) {\n            if (img[i].offsetTop < seeHeight + scrollTop) {\n                if (img[i].getAttribute(\"src\") == \"\") {\n                    img[i].src = img[i].getAttribute(\"data-src\");\n                }\n                n = i + 1;\n            }\n        }\n    }\n---------------------------------  以上代码不在重复  --------------------------------\n    var throttle = function(fun,delay){\n        var perv = Date.now();\n        return function(){\n            var context = this;\n            var now = Date.now();\n            if (now-perv >= delay){\n                fun.apply(context,arguments)\n                prev = Date.now();\n            }\n        }\n    }\n    window.addEventListener('scroll',throttle(lazyload,1000))\n{% endcodeblock %}\n## 定时器方案\n{% codeblock lang:javascript %}\n    var throttle = function(fun,delay){\n        var timer = null;\n        return function(){\n            var context = this;\n            if(!timer){\n                timer = setTimeout(function(){\n                    fun.apply(context,arguments)\n                    timer = null\n                },delay)\n            }\n        }\n    }\n    window.addEventListener('scroll',throttle(lazyload,1000))\n{% endcodeblock %}\n## 时间戳+定时器方案\n{% codeblock lang:javascript %}\n    var throttle = function(fun,delay){\n        var timer = null;\n        var startTime = Date.now();\n        return function() {\n                var curTime = Date.now();\n                var remaining = delay - (curTime - startTime);\n                var context = this;\n                var args = arguments;\n                clearTimeout(timer);\n                if (remaining <= 0) {\n                        fun.apply(context, args);\n                        startTime = Date.now();\n                } else {\n                        timer = setTimeout(fun, remaining);\n                }\n        }\n    }\n    window.addEventListener('scroll',throttle(lazyload,1000))\n{% endcodeblock %}","source":"_posts/图片懒加载.md","raw":"---\ntitle: 图片懒加载\ndate: 2019-02-14 19:22:21\ncategories: web\ntags: [\"图片懒加载\",\"函数节流3种方式\"]\ncopyright:\nkeywords:\ndescription:\n---\n{% cq %} LazyLoad {% endcq %}\n<img src=\"/img/lazyload.gif\">\n<!--more-->\n# 懒加载的意义\n这里‘懒’的意思可以理解为延迟，如淘宝、京东这些电商平台有大量的图片，如果上来就加载服务器表示压力山大，所以就想出了懒加载这种克敌之法，用户滚动到的区域才发送请求加载内容\n# 原理\n将页面中的img标签src指向一张小照片或者为空都可以，然后写一个自定义属性比如（data-src）指向正确的图片，其实就是用正确的照片替换src里面的照片\n# 代码\n在写代码前，需要了解各种高度。先看这篇文章[js坐标位置](https://zhanghuaxiao.github.io/2019/02/14/js获取事件坐标位置/)\n```javascript\n    <head>\n    <meta charset=\"UTF-8\">\n    <title>Document</title>\n    <style>\n        img {\n            display: block;\n            margin-bottom: 50px;\n            width: 400px;\n            height: 400px;\n        }\n    </style>\n</head>\n<body>\n    <img src=\"\" data-src=\"http://ww4.sinaimg.cn/large/006y8mN6gw1fa5obmqrmvj305k05k3yh.jpg\" alt=\"\">\n        <img src=\"\" data-src=\"http://ww1.sinaimg.cn/large/006y8mN6gw1fa7kaed2hpj30sg0l9q54.jpg\" alt=\"\">\n        <img src=\"\" data-src=\"http://imgsrc.baidu.com/imgad/pic/item/3c6d55fbb2fb43161361e1432ba4462309f7d389.jpg\" alt=\"\">\n        <img src=\"\" data-src=\"http://pic.58pic.com/58pic/15/68/59/71X58PICNjx_1024.jpg\" alt=\"\">\n        <img src=\"\" data-src=\"http://qimg.hxnews.com/2019/0128/1548663985785.jpg\" alt=\"\">\n        <img src=\"\" data-src=\"http://imgsrc.baidu.com/imgad/pic/item/242dd42a2834349bf8d014a3c3ea15ce37d3bec6.jpg\" alt=\"\">\n        <img src=\"\" data-src=\"http://imgsrc.baidu.com/imgad/pic/item/d439b6003af33a87089f4704cc5c10385343b53a.jpg\" alt=\"\">\n        <img src=\"\" data-src=\"http://imgsrc.baidu.com/imgad/pic/item/38dbb6fd5266d01607666e0b9d2bd40735fa3591.jpg\" alt=\"\">\n        <img src=\"\" data-src=\"http://imgsrc.baidu.com/imgad/pic/item/d043ad4bd11373f02f236d8cae0f4bfbfbed0480.jpg\" alt=\"\">\n</body>\n```\n## javascript\n```javascript\n    var num = document.getElementsByTagName('img').length;\n    var img = document.getElementsByTagName(\"img\");\n    var n = 0; //存储图片加载到的位置，避免每次都从第一张图片开始遍历\n    lazyload(); //页面载入完毕加载可是区域内的图片\n    window.onscroll = lazyload;\n    function lazyload() { //监听页面滚动事件\n        var seeHeight = document.documentElement.clientHeight; //可见区域高度\n        var scrollTop = document.documentElement.scrollTop || document.body.scrollTop; //滚动条距离顶部高度\n        for (var i = n; i < num; i++) {\n            if (img[i].offsetTop < seeHeight + scrollTop) {\n                if (img[i].getAttribute(\"src\") == \"\") {\n                    img[i].src = img[i].getAttribute(\"data-src\");\n                }\n                n = i + 1;\n            }\n        }\n    }\n```\n## 使用节流函数进行性能优化\n如果直接将函数绑定在scroll事件上，当页面滚动时，函数会被高频触发，这非常影响浏览器的性能。\n我想实现限制触发频率，来优化性能。\n\n节流函数：只允许一个函数在N秒内执行一次。下面是一个通俗易通的节流函数：\n{%codeblock lang:javascript%}\n    var num = document.getElementsByTagName('img').length;\n    var img = document.getElementsByTagName(\"img\");\n    var n = 0; //存储图片加载到的位置，避免每次都从第一张图片开始遍历\n    resizehandler(); //页面载入完毕加载可是区域内的图片\n    n=0;\n    function resizehandler(){\n        var seeHeight = document.documentElement.clientHeight; //可见区域高度\n        var scrollTop = document.documentElement.scrollTop || document.body.scrollTop; //滚动条距离顶部高度\n        for (var i = n; i < num; i++) {\n            if (img[i].offsetTop < seeHeight + scrollTop) {\n                if (img[i].getAttribute(\"src\") == \"\") {\n                    img[i].src = img[i].getAttribute(\"data-src\");\n                }\n                n = i + 1;\n            }\n        }\n    }\n    function throttle(method,context){\n        clearTimeout(method.tId);\n        method.tId=setTimeout(function(){\n            method.call(context);\n        },500);\n    }\n    window.onscroll=function(){\n        throttle(resizehandler,window);\n    }\n{% endcodeblock %}    \n# 函数节流方案以下三种\n## 时间戳方案\n{% codeblock lang:javascript%}\n    var num = document.getElementsByTagName('img').length;\n    var img = document.getElementsByTagName(\"img\");\n    var n = 0; //存储图片加载到的位置，避免每次都从第一张图片开始遍历\n    lazyload(); //页面载入完毕加载可是区域内的图片\n    function lazyload() { //监听页面滚动事件\n        var seeHeight = document.documentElement.clientHeight; //可见区域高度\n        var scrollTop = document.documentElement.scrollTop || document.body.scrollTop; //滚动条距离顶部高度\n        for (var i = n; i < num; i++) {\n            if (img[i].offsetTop < seeHeight + scrollTop) {\n                if (img[i].getAttribute(\"src\") == \"\") {\n                    img[i].src = img[i].getAttribute(\"data-src\");\n                }\n                n = i + 1;\n            }\n        }\n    }\n---------------------------------  以上代码不在重复  --------------------------------\n    var throttle = function(fun,delay){\n        var perv = Date.now();\n        return function(){\n            var context = this;\n            var now = Date.now();\n            if (now-perv >= delay){\n                fun.apply(context,arguments)\n                prev = Date.now();\n            }\n        }\n    }\n    window.addEventListener('scroll',throttle(lazyload,1000))\n{% endcodeblock %}\n## 定时器方案\n{% codeblock lang:javascript %}\n    var throttle = function(fun,delay){\n        var timer = null;\n        return function(){\n            var context = this;\n            if(!timer){\n                timer = setTimeout(function(){\n                    fun.apply(context,arguments)\n                    timer = null\n                },delay)\n            }\n        }\n    }\n    window.addEventListener('scroll',throttle(lazyload,1000))\n{% endcodeblock %}\n## 时间戳+定时器方案\n{% codeblock lang:javascript %}\n    var throttle = function(fun,delay){\n        var timer = null;\n        var startTime = Date.now();\n        return function() {\n                var curTime = Date.now();\n                var remaining = delay - (curTime - startTime);\n                var context = this;\n                var args = arguments;\n                clearTimeout(timer);\n                if (remaining <= 0) {\n                        fun.apply(context, args);\n                        startTime = Date.now();\n                } else {\n                        timer = setTimeout(fun, remaining);\n                }\n        }\n    }\n    window.addEventListener('scroll',throttle(lazyload,1000))\n{% endcodeblock %}","slug":"图片懒加载","published":1,"updated":"2026-01-02T00:43:17.576Z","comments":1,"layout":"post","photos":[],"_id":"cmjwbsw69001lrotgey8meop9","content":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>LazyLoad </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n<img src=\"/img/lazyload.gif\">\n<span id=\"more\"></span>\n# 懒加载的意义\n这里‘懒’的意思可以理解为延迟，如淘宝、京东这些电商平台有大量的图片，如果上来就加载服务器表示压力山大，所以就想出了懒加载这种克敌之法，用户滚动到的区域才发送请求加载内容\n# 原理\n将页面中的img标签src指向一张小照片或者为空都可以，然后写一个自定义属性比如（data-src）指向正确的图片，其实就是用正确的照片替换src里面的照片\n# 代码\n在写代码前，需要了解各种高度。先看这篇文章[js坐标位置](https://zhanghuaxiao.github.io/2019/02/14/js获取事件坐标位置/)\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    &lt;head&gt;</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Document<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"language-css\"></span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"selector-tag\">img</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">            <span class=\"attribute\">display</span>: block;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">            <span class=\"attribute\">margin-bottom</span>: <span class=\"number\">50px</span>;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">            <span class=\"attribute\">width</span>: <span class=\"number\">400px</span>;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">            <span class=\"attribute\">height</span>: <span class=\"number\">400px</span>;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span></span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">    &lt;img src=&quot;&quot; data-src=&quot;http://ww4.sinaimg.cn/large/006y8mN6gw1fa5obmqrmvj305k05k3yh.jpg&quot; alt=&quot;&quot;&gt;</span><br><span class=\"line\">        &lt;img src=&quot;&quot; data-src=&quot;http://ww1.sinaimg.cn/large/006y8mN6gw1fa7kaed2hpj30sg0l9q54.jpg&quot; alt=&quot;&quot;&gt;</span><br><span class=\"line\">        &lt;img src=&quot;&quot; data-src=&quot;http://imgsrc.baidu.com/imgad/pic/item/3c6d55fbb2fb43161361e1432ba4462309f7d389.jpg&quot; alt=&quot;&quot;&gt;</span><br><span class=\"line\">        &lt;img src=&quot;&quot; data-src=&quot;http://pic.58pic.com/58pic/15/68/59/71X58PICNjx_1024.jpg&quot; alt=&quot;&quot;&gt;</span><br><span class=\"line\">        &lt;img src=&quot;&quot; data-src=&quot;http://qimg.hxnews.com/2019/0128/1548663985785.jpg&quot; alt=&quot;&quot;&gt;</span><br><span class=\"line\">        &lt;img src=&quot;&quot; data-src=&quot;http://imgsrc.baidu.com/imgad/pic/item/242dd42a2834349bf8d014a3c3ea15ce37d3bec6.jpg&quot; alt=&quot;&quot;&gt;</span><br><span class=\"line\">        &lt;img src=&quot;&quot; data-src=&quot;http://imgsrc.baidu.com/imgad/pic/item/d439b6003af33a87089f4704cc5c10385343b53a.jpg&quot; alt=&quot;&quot;&gt;</span><br><span class=\"line\">        &lt;img src=&quot;&quot; data-src=&quot;http://imgsrc.baidu.com/imgad/pic/item/38dbb6fd5266d01607666e0b9d2bd40735fa3591.jpg&quot; alt=&quot;&quot;&gt;</span><br><span class=\"line\">        &lt;img src=&quot;&quot; data-src=&quot;http://imgsrc.baidu.com/imgad/pic/item/d043ad4bd11373f02f236d8cae0f4bfbfbed0480.jpg&quot; alt=&quot;&quot;&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br></pre></td></tr></table></figure>\n## javascript\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> num = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementsByTagName</span>(<span class=\"string\">&#x27;img&#x27;</span>).<span class=\"property\">length</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> img = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementsByTagName</span>(<span class=\"string\">&quot;img&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> n = <span class=\"number\">0</span>; <span class=\"comment\">//存储图片加载到的位置，避免每次都从第一张图片开始遍历</span></span><br><span class=\"line\"><span class=\"title function_\">lazyload</span>(); <span class=\"comment\">//页面载入完毕加载可是区域内的图片</span></span><br><span class=\"line\"><span class=\"variable language_\">window</span>.<span class=\"property\">onscroll</span> = lazyload;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">lazyload</span>(<span class=\"params\"></span>) &#123; <span class=\"comment\">//监听页面滚动事件</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> seeHeight = <span class=\"variable language_\">document</span>.<span class=\"property\">documentElement</span>.<span class=\"property\">clientHeight</span>; <span class=\"comment\">//可见区域高度</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> scrollTop = <span class=\"variable language_\">document</span>.<span class=\"property\">documentElement</span>.<span class=\"property\">scrollTop</span> || <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"property\">scrollTop</span>; <span class=\"comment\">//滚动条距离顶部高度</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = n; i &lt; num; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (img[i].<span class=\"property\">offsetTop</span> &lt; seeHeight + scrollTop) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (img[i].<span class=\"title function_\">getAttribute</span>(<span class=\"string\">&quot;src&quot;</span>) == <span class=\"string\">&quot;&quot;</span>) &#123;</span><br><span class=\"line\">                img[i].<span class=\"property\">src</span> = img[i].<span class=\"title function_\">getAttribute</span>(<span class=\"string\">&quot;data-src&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            n = i + <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n## 使用节流函数进行性能优化\n如果直接将函数绑定在scroll事件上，当页面滚动时，函数会被高频触发，这非常影响浏览器的性能。\n我想实现限制触发频率，来优化性能。\n\n<p>节流函数：只允许一个函数在N秒内执行一次。下面是一个通俗易通的节流函数：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> num = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementsByTagName</span>(<span class=\"string\">&#x27;img&#x27;</span>).<span class=\"property\">length</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> img = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementsByTagName</span>(<span class=\"string\">&quot;img&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> n = <span class=\"number\">0</span>; <span class=\"comment\">//存储图片加载到的位置，避免每次都从第一张图片开始遍历</span></span><br><span class=\"line\"><span class=\"title function_\">resizehandler</span>(); <span class=\"comment\">//页面载入完毕加载可是区域内的图片</span></span><br><span class=\"line\">n=<span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">resizehandler</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> seeHeight = <span class=\"variable language_\">document</span>.<span class=\"property\">documentElement</span>.<span class=\"property\">clientHeight</span>; <span class=\"comment\">//可见区域高度</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> scrollTop = <span class=\"variable language_\">document</span>.<span class=\"property\">documentElement</span>.<span class=\"property\">scrollTop</span> || <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"property\">scrollTop</span>; <span class=\"comment\">//滚动条距离顶部高度</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = n; i &lt; num; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (img[i].<span class=\"property\">offsetTop</span> &lt; seeHeight + scrollTop) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (img[i].<span class=\"title function_\">getAttribute</span>(<span class=\"string\">&quot;src&quot;</span>) == <span class=\"string\">&quot;&quot;</span>) &#123;</span><br><span class=\"line\">                img[i].<span class=\"property\">src</span> = img[i].<span class=\"title function_\">getAttribute</span>(<span class=\"string\">&quot;data-src&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            n = i + <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">throttle</span>(<span class=\"params\">method,context</span>)&#123;</span><br><span class=\"line\">    <span class=\"built_in\">clearTimeout</span>(method.<span class=\"property\">tId</span>);</span><br><span class=\"line\">    method.<span class=\"property\">tId</span>=<span class=\"built_in\">setTimeout</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">        method.<span class=\"title function_\">call</span>(context);</span><br><span class=\"line\">    &#125;,<span class=\"number\">500</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"variable language_\">window</span>.<span class=\"property\">onscroll</span>=<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"title function_\">throttle</span>(resizehandler,<span class=\"variable language_\">window</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>    \n<h1 id=\"函数节流方案以下三种\"><a href=\"#函数节流方案以下三种\" class=\"headerlink\" title=\"函数节流方案以下三种\"></a>函数节流方案以下三种</h1><h2 id=\"时间戳方案\"><a href=\"#时间戳方案\" class=\"headerlink\" title=\"时间戳方案\"></a>时间戳方案</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    <span class=\"keyword\">var</span> num = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementsByTagName</span>(<span class=\"string\">&#x27;img&#x27;</span>).<span class=\"property\">length</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> img = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementsByTagName</span>(<span class=\"string\">&quot;img&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> n = <span class=\"number\">0</span>; <span class=\"comment\">//存储图片加载到的位置，避免每次都从第一张图片开始遍历</span></span><br><span class=\"line\">    <span class=\"title function_\">lazyload</span>(); <span class=\"comment\">//页面载入完毕加载可是区域内的图片</span></span><br><span class=\"line\">    <span class=\"keyword\">function</span> <span class=\"title function_\">lazyload</span>(<span class=\"params\"></span>) &#123; <span class=\"comment\">//监听页面滚动事件</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> seeHeight = <span class=\"variable language_\">document</span>.<span class=\"property\">documentElement</span>.<span class=\"property\">clientHeight</span>; <span class=\"comment\">//可见区域高度</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> scrollTop = <span class=\"variable language_\">document</span>.<span class=\"property\">documentElement</span>.<span class=\"property\">scrollTop</span> || <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"property\">scrollTop</span>; <span class=\"comment\">//滚动条距离顶部高度</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = n; i &lt; num; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (img[i].<span class=\"property\">offsetTop</span> &lt; seeHeight + scrollTop) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (img[i].<span class=\"title function_\">getAttribute</span>(<span class=\"string\">&quot;src&quot;</span>) == <span class=\"string\">&quot;&quot;</span>) &#123;</span><br><span class=\"line\">                    img[i].<span class=\"property\">src</span> = img[i].<span class=\"title function_\">getAttribute</span>(<span class=\"string\">&quot;data-src&quot;</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                n = i + <span class=\"number\">1</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">---------------------------------  以上代码不在重复  --------------------------------</span><br><span class=\"line\">    <span class=\"keyword\">var</span> throttle = <span class=\"keyword\">function</span>(<span class=\"params\">fun,delay</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> perv = <span class=\"title class_\">Date</span>.<span class=\"title function_\">now</span>();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> context = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> now = <span class=\"title class_\">Date</span>.<span class=\"title function_\">now</span>();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (now-perv &gt;= delay)&#123;</span><br><span class=\"line\">                fun.<span class=\"title function_\">apply</span>(context,<span class=\"variable language_\">arguments</span>)</span><br><span class=\"line\">                prev = <span class=\"title class_\">Date</span>.<span class=\"title function_\">now</span>();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"variable language_\">window</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;scroll&#x27;</span>,<span class=\"title function_\">throttle</span>(lazyload,<span class=\"number\">1000</span>))</span><br></pre></td></tr></table></figure>\n<h2 id=\"定时器方案\"><a href=\"#定时器方案\" class=\"headerlink\" title=\"定时器方案\"></a>定时器方案</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> throttle = <span class=\"keyword\">function</span>(<span class=\"params\">fun,delay</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> timer = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> context = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!timer)&#123;</span><br><span class=\"line\">            timer = <span class=\"built_in\">setTimeout</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">                fun.<span class=\"title function_\">apply</span>(context,<span class=\"variable language_\">arguments</span>)</span><br><span class=\"line\">                timer = <span class=\"literal\">null</span></span><br><span class=\"line\">            &#125;,delay)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"variable language_\">window</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;scroll&#x27;</span>,<span class=\"title function_\">throttle</span>(lazyload,<span class=\"number\">1000</span>))</span><br></pre></td></tr></table></figure>\n<h2 id=\"时间戳-定时器方案\"><a href=\"#时间戳-定时器方案\" class=\"headerlink\" title=\"时间戳+定时器方案\"></a>时间戳+定时器方案</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> throttle = <span class=\"keyword\">function</span>(<span class=\"params\">fun,delay</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> timer = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> startTime = <span class=\"title class_\">Date</span>.<span class=\"title function_\">now</span>();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> curTime = <span class=\"title class_\">Date</span>.<span class=\"title function_\">now</span>();</span><br><span class=\"line\">            <span class=\"keyword\">var</span> remaining = delay - (curTime - startTime);</span><br><span class=\"line\">            <span class=\"keyword\">var</span> context = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> args = <span class=\"variable language_\">arguments</span>;</span><br><span class=\"line\">            <span class=\"built_in\">clearTimeout</span>(timer);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (remaining &lt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                    fun.<span class=\"title function_\">apply</span>(context, args);</span><br><span class=\"line\">                    startTime = <span class=\"title class_\">Date</span>.<span class=\"title function_\">now</span>();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    timer = <span class=\"built_in\">setTimeout</span>(fun, remaining);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"variable language_\">window</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;scroll&#x27;</span>,<span class=\"title function_\">throttle</span>(lazyload,<span class=\"number\">1000</span>))</span><br></pre></td></tr></table></figure>","excerpt":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>LazyLoad </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n<img src=\"/img/lazyload.gif\">","more":"# 懒加载的意义\n这里‘懒’的意思可以理解为延迟，如淘宝、京东这些电商平台有大量的图片，如果上来就加载服务器表示压力山大，所以就想出了懒加载这种克敌之法，用户滚动到的区域才发送请求加载内容\n# 原理\n将页面中的img标签src指向一张小照片或者为空都可以，然后写一个自定义属性比如（data-src）指向正确的图片，其实就是用正确的照片替换src里面的照片\n# 代码\n在写代码前，需要了解各种高度。先看这篇文章[js坐标位置](https://zhanghuaxiao.github.io/2019/02/14/js获取事件坐标位置/)\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    &lt;head&gt;</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Document<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"language-css\"></span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"selector-tag\">img</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">            <span class=\"attribute\">display</span>: block;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">            <span class=\"attribute\">margin-bottom</span>: <span class=\"number\">50px</span>;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">            <span class=\"attribute\">width</span>: <span class=\"number\">400px</span>;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">            <span class=\"attribute\">height</span>: <span class=\"number\">400px</span>;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span></span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">    &lt;img src=&quot;&quot; data-src=&quot;http://ww4.sinaimg.cn/large/006y8mN6gw1fa5obmqrmvj305k05k3yh.jpg&quot; alt=&quot;&quot;&gt;</span><br><span class=\"line\">        &lt;img src=&quot;&quot; data-src=&quot;http://ww1.sinaimg.cn/large/006y8mN6gw1fa7kaed2hpj30sg0l9q54.jpg&quot; alt=&quot;&quot;&gt;</span><br><span class=\"line\">        &lt;img src=&quot;&quot; data-src=&quot;http://imgsrc.baidu.com/imgad/pic/item/3c6d55fbb2fb43161361e1432ba4462309f7d389.jpg&quot; alt=&quot;&quot;&gt;</span><br><span class=\"line\">        &lt;img src=&quot;&quot; data-src=&quot;http://pic.58pic.com/58pic/15/68/59/71X58PICNjx_1024.jpg&quot; alt=&quot;&quot;&gt;</span><br><span class=\"line\">        &lt;img src=&quot;&quot; data-src=&quot;http://qimg.hxnews.com/2019/0128/1548663985785.jpg&quot; alt=&quot;&quot;&gt;</span><br><span class=\"line\">        &lt;img src=&quot;&quot; data-src=&quot;http://imgsrc.baidu.com/imgad/pic/item/242dd42a2834349bf8d014a3c3ea15ce37d3bec6.jpg&quot; alt=&quot;&quot;&gt;</span><br><span class=\"line\">        &lt;img src=&quot;&quot; data-src=&quot;http://imgsrc.baidu.com/imgad/pic/item/d439b6003af33a87089f4704cc5c10385343b53a.jpg&quot; alt=&quot;&quot;&gt;</span><br><span class=\"line\">        &lt;img src=&quot;&quot; data-src=&quot;http://imgsrc.baidu.com/imgad/pic/item/38dbb6fd5266d01607666e0b9d2bd40735fa3591.jpg&quot; alt=&quot;&quot;&gt;</span><br><span class=\"line\">        &lt;img src=&quot;&quot; data-src=&quot;http://imgsrc.baidu.com/imgad/pic/item/d043ad4bd11373f02f236d8cae0f4bfbfbed0480.jpg&quot; alt=&quot;&quot;&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br></pre></td></tr></table></figure>\n## javascript\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> num = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementsByTagName</span>(<span class=\"string\">&#x27;img&#x27;</span>).<span class=\"property\">length</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> img = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementsByTagName</span>(<span class=\"string\">&quot;img&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> n = <span class=\"number\">0</span>; <span class=\"comment\">//存储图片加载到的位置，避免每次都从第一张图片开始遍历</span></span><br><span class=\"line\"><span class=\"title function_\">lazyload</span>(); <span class=\"comment\">//页面载入完毕加载可是区域内的图片</span></span><br><span class=\"line\"><span class=\"variable language_\">window</span>.<span class=\"property\">onscroll</span> = lazyload;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">lazyload</span>(<span class=\"params\"></span>) &#123; <span class=\"comment\">//监听页面滚动事件</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> seeHeight = <span class=\"variable language_\">document</span>.<span class=\"property\">documentElement</span>.<span class=\"property\">clientHeight</span>; <span class=\"comment\">//可见区域高度</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> scrollTop = <span class=\"variable language_\">document</span>.<span class=\"property\">documentElement</span>.<span class=\"property\">scrollTop</span> || <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"property\">scrollTop</span>; <span class=\"comment\">//滚动条距离顶部高度</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = n; i &lt; num; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (img[i].<span class=\"property\">offsetTop</span> &lt; seeHeight + scrollTop) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (img[i].<span class=\"title function_\">getAttribute</span>(<span class=\"string\">&quot;src&quot;</span>) == <span class=\"string\">&quot;&quot;</span>) &#123;</span><br><span class=\"line\">                img[i].<span class=\"property\">src</span> = img[i].<span class=\"title function_\">getAttribute</span>(<span class=\"string\">&quot;data-src&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            n = i + <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n## 使用节流函数进行性能优化\n如果直接将函数绑定在scroll事件上，当页面滚动时，函数会被高频触发，这非常影响浏览器的性能。\n我想实现限制触发频率，来优化性能。\n\n<p>节流函数：只允许一个函数在N秒内执行一次。下面是一个通俗易通的节流函数：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> num = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementsByTagName</span>(<span class=\"string\">&#x27;img&#x27;</span>).<span class=\"property\">length</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> img = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementsByTagName</span>(<span class=\"string\">&quot;img&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> n = <span class=\"number\">0</span>; <span class=\"comment\">//存储图片加载到的位置，避免每次都从第一张图片开始遍历</span></span><br><span class=\"line\"><span class=\"title function_\">resizehandler</span>(); <span class=\"comment\">//页面载入完毕加载可是区域内的图片</span></span><br><span class=\"line\">n=<span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">resizehandler</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> seeHeight = <span class=\"variable language_\">document</span>.<span class=\"property\">documentElement</span>.<span class=\"property\">clientHeight</span>; <span class=\"comment\">//可见区域高度</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> scrollTop = <span class=\"variable language_\">document</span>.<span class=\"property\">documentElement</span>.<span class=\"property\">scrollTop</span> || <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"property\">scrollTop</span>; <span class=\"comment\">//滚动条距离顶部高度</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = n; i &lt; num; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (img[i].<span class=\"property\">offsetTop</span> &lt; seeHeight + scrollTop) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (img[i].<span class=\"title function_\">getAttribute</span>(<span class=\"string\">&quot;src&quot;</span>) == <span class=\"string\">&quot;&quot;</span>) &#123;</span><br><span class=\"line\">                img[i].<span class=\"property\">src</span> = img[i].<span class=\"title function_\">getAttribute</span>(<span class=\"string\">&quot;data-src&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            n = i + <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">throttle</span>(<span class=\"params\">method,context</span>)&#123;</span><br><span class=\"line\">    <span class=\"built_in\">clearTimeout</span>(method.<span class=\"property\">tId</span>);</span><br><span class=\"line\">    method.<span class=\"property\">tId</span>=<span class=\"built_in\">setTimeout</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">        method.<span class=\"title function_\">call</span>(context);</span><br><span class=\"line\">    &#125;,<span class=\"number\">500</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"variable language_\">window</span>.<span class=\"property\">onscroll</span>=<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"title function_\">throttle</span>(resizehandler,<span class=\"variable language_\">window</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>    \n<h1 id=\"函数节流方案以下三种\"><a href=\"#函数节流方案以下三种\" class=\"headerlink\" title=\"函数节流方案以下三种\"></a>函数节流方案以下三种</h1><h2 id=\"时间戳方案\"><a href=\"#时间戳方案\" class=\"headerlink\" title=\"时间戳方案\"></a>时间戳方案</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    <span class=\"keyword\">var</span> num = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementsByTagName</span>(<span class=\"string\">&#x27;img&#x27;</span>).<span class=\"property\">length</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> img = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementsByTagName</span>(<span class=\"string\">&quot;img&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> n = <span class=\"number\">0</span>; <span class=\"comment\">//存储图片加载到的位置，避免每次都从第一张图片开始遍历</span></span><br><span class=\"line\">    <span class=\"title function_\">lazyload</span>(); <span class=\"comment\">//页面载入完毕加载可是区域内的图片</span></span><br><span class=\"line\">    <span class=\"keyword\">function</span> <span class=\"title function_\">lazyload</span>(<span class=\"params\"></span>) &#123; <span class=\"comment\">//监听页面滚动事件</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> seeHeight = <span class=\"variable language_\">document</span>.<span class=\"property\">documentElement</span>.<span class=\"property\">clientHeight</span>; <span class=\"comment\">//可见区域高度</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> scrollTop = <span class=\"variable language_\">document</span>.<span class=\"property\">documentElement</span>.<span class=\"property\">scrollTop</span> || <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"property\">scrollTop</span>; <span class=\"comment\">//滚动条距离顶部高度</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = n; i &lt; num; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (img[i].<span class=\"property\">offsetTop</span> &lt; seeHeight + scrollTop) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (img[i].<span class=\"title function_\">getAttribute</span>(<span class=\"string\">&quot;src&quot;</span>) == <span class=\"string\">&quot;&quot;</span>) &#123;</span><br><span class=\"line\">                    img[i].<span class=\"property\">src</span> = img[i].<span class=\"title function_\">getAttribute</span>(<span class=\"string\">&quot;data-src&quot;</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                n = i + <span class=\"number\">1</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">---------------------------------  以上代码不在重复  --------------------------------</span><br><span class=\"line\">    <span class=\"keyword\">var</span> throttle = <span class=\"keyword\">function</span>(<span class=\"params\">fun,delay</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> perv = <span class=\"title class_\">Date</span>.<span class=\"title function_\">now</span>();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> context = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> now = <span class=\"title class_\">Date</span>.<span class=\"title function_\">now</span>();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (now-perv &gt;= delay)&#123;</span><br><span class=\"line\">                fun.<span class=\"title function_\">apply</span>(context,<span class=\"variable language_\">arguments</span>)</span><br><span class=\"line\">                prev = <span class=\"title class_\">Date</span>.<span class=\"title function_\">now</span>();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"variable language_\">window</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;scroll&#x27;</span>,<span class=\"title function_\">throttle</span>(lazyload,<span class=\"number\">1000</span>))</span><br></pre></td></tr></table></figure>\n<h2 id=\"定时器方案\"><a href=\"#定时器方案\" class=\"headerlink\" title=\"定时器方案\"></a>定时器方案</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> throttle = <span class=\"keyword\">function</span>(<span class=\"params\">fun,delay</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> timer = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> context = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!timer)&#123;</span><br><span class=\"line\">            timer = <span class=\"built_in\">setTimeout</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">                fun.<span class=\"title function_\">apply</span>(context,<span class=\"variable language_\">arguments</span>)</span><br><span class=\"line\">                timer = <span class=\"literal\">null</span></span><br><span class=\"line\">            &#125;,delay)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"variable language_\">window</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;scroll&#x27;</span>,<span class=\"title function_\">throttle</span>(lazyload,<span class=\"number\">1000</span>))</span><br></pre></td></tr></table></figure>\n<h2 id=\"时间戳-定时器方案\"><a href=\"#时间戳-定时器方案\" class=\"headerlink\" title=\"时间戳+定时器方案\"></a>时间戳+定时器方案</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> throttle = <span class=\"keyword\">function</span>(<span class=\"params\">fun,delay</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> timer = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> startTime = <span class=\"title class_\">Date</span>.<span class=\"title function_\">now</span>();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> curTime = <span class=\"title class_\">Date</span>.<span class=\"title function_\">now</span>();</span><br><span class=\"line\">            <span class=\"keyword\">var</span> remaining = delay - (curTime - startTime);</span><br><span class=\"line\">            <span class=\"keyword\">var</span> context = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> args = <span class=\"variable language_\">arguments</span>;</span><br><span class=\"line\">            <span class=\"built_in\">clearTimeout</span>(timer);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (remaining &lt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                    fun.<span class=\"title function_\">apply</span>(context, args);</span><br><span class=\"line\">                    startTime = <span class=\"title class_\">Date</span>.<span class=\"title function_\">now</span>();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    timer = <span class=\"built_in\">setTimeout</span>(fun, remaining);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"variable language_\">window</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;scroll&#x27;</span>,<span class=\"title function_\">throttle</span>(lazyload,<span class=\"number\">1000</span>))</span><br></pre></td></tr></table></figure>"},{"title":"如何清除已设置的npm淘宝镜像","date":"2020-05-19T08:03:49.000Z","copyright":true,"keywords":null,"description":null,"_content":"1.设置淘宝的是：\nnpm config set registry https://registry.npm.taobao.org\n\n2.不想用他们的，再设置回原来的就可以了：\nnpm config set registry https://registry.npmjs.org","source":"_posts/如何清除已设置的npm淘宝镜像.md","raw":"---\ntitle: 如何清除已设置的npm淘宝镜像\ndate: 2020-05-19 16:03:49\ncategories: web\ntags:\n    - 如何清除已设置的npm淘宝镜像\ncopyright: true\nkeywords: \ndescription:\n---\n1.设置淘宝的是：\nnpm config set registry https://registry.npm.taobao.org\n\n2.不想用他们的，再设置回原来的就可以了：\nnpm config set registry https://registry.npmjs.org","slug":"如何清除已设置的npm淘宝镜像","published":1,"updated":"2026-01-02T00:43:17.577Z","comments":1,"layout":"post","photos":[],"_id":"cmjwbsw69001nrotgbmwc3pav","content":"<p>1.设置淘宝的是：<br>npm config set registry <a href=\"https://registry.npm.taobao.org/\">https://registry.npm.taobao.org</a></p>\n<p>2.不想用他们的，再设置回原来的就可以了：<br>npm config set registry <a href=\"https://registry.npmjs.org/\">https://registry.npmjs.org</a></p>\n","excerpt":"","more":"<p>1.设置淘宝的是：<br>npm config set registry <a href=\"https://registry.npm.taobao.org/\">https://registry.npm.taobao.org</a></p>\n<p>2.不想用他们的，再设置回原来的就可以了：<br>npm config set registry <a href=\"https://registry.npmjs.org/\">https://registry.npmjs.org</a></p>\n"},{"title":"探究call 和 apply 的原理","date":"2019-02-18T06:40:01.000Z","copyright":null,"keywords":null,"description":null,"_content":"{%cq%}音乐🎵搭配学习更美味哦！{%endcq%}\n<img src=\"/img/callAndapply.jpg\">\n建议看这片文章时可以点击[音乐🎵](https://music.163.com/#/song?id=1293886117)，来个单曲循，美滋滋\n<!--more-->\n# 先拿call开刀\n> 作用：call和apply都是替换函数内错误的this\n\n```javascript\n    var a = {\n        value:1\n    }\n    var b = function(){\n        console.log(this.value) // 如果不对this进行绑定执行bar() 会返回undefined\n    }\n    b.call(a) //1\n```\n去除繁琐的讲解，一步到位自己模拟call的用法写一个函数，达到相同目的\n\n```javascript\n    Function.prototype.myCall = function(context){\n        var context = context || window; //当没传入值时候，就是指全局window\n        context.fn = this; //把调用myCall前的方法缓存下来\n        var args = [...arguments].slice(1);//使用...打散传入值，并去除第一方法，得到一个数组\n        var result = context.fn(...args);//把数组打散，把dinging 18传入b方法中\n        delete context.fn; //删除\n        return result\n    }\n    var a = {\n        value:1\n    }\n    var b = function(name,age){\n        console.log(this.value)\n        console.log(name)\n        console.log(age)\n    }\n    b.myCall(a,\"dingding\",18)\n```\n## apply\n> apply的方法和 call 方法的实现类似，只不过是如果有参数，以数组形式进行传递\n\napply这个API平时使用的场景，代码如下:\n```javascript\n    var a = {\n        value:1\n    }\n    var b = function(name,age){\n        console.log(this.value)\n        console.log(name)\n        console.log(age)\n    }\n    b.apply(a,[\"dingding\",18])\n```\n直接上模拟apply功能代码\n```javascript\n    Function.prototype.myApply = function(context){\n        var context = context || window;\n        context.fn = this;\n        var result;\n        if(arguments[1]){\n            result = context.fn(...arguments[1]) \n        }else{\n            result = context.fn()\n        }\n        delete context.fn\n        return result\n    }\n    var a = {\n        value:1\n    }\n    var b = function(name,age){\n        console.log(this.value)\n        console.log(name)\n        console.log(age)\n    }\n    b.myApply(a,[\"dingding\",18])\n```\n[参考资料](https://www.jianshu.com/p/92b48caee4b2)","source":"_posts/探究call-和-apply-的原理.md","raw":"---\ntitle: 探究call 和 apply 的原理\ndate: 2019-02-18 14:40:01\ncategories: web\ntags: [\"探究call 和 apply 的原理\"]\ncopyright:\nkeywords:\ndescription:\n---\n{%cq%}音乐🎵搭配学习更美味哦！{%endcq%}\n<img src=\"/img/callAndapply.jpg\">\n建议看这片文章时可以点击[音乐🎵](https://music.163.com/#/song?id=1293886117)，来个单曲循，美滋滋\n<!--more-->\n# 先拿call开刀\n> 作用：call和apply都是替换函数内错误的this\n\n```javascript\n    var a = {\n        value:1\n    }\n    var b = function(){\n        console.log(this.value) // 如果不对this进行绑定执行bar() 会返回undefined\n    }\n    b.call(a) //1\n```\n去除繁琐的讲解，一步到位自己模拟call的用法写一个函数，达到相同目的\n\n```javascript\n    Function.prototype.myCall = function(context){\n        var context = context || window; //当没传入值时候，就是指全局window\n        context.fn = this; //把调用myCall前的方法缓存下来\n        var args = [...arguments].slice(1);//使用...打散传入值，并去除第一方法，得到一个数组\n        var result = context.fn(...args);//把数组打散，把dinging 18传入b方法中\n        delete context.fn; //删除\n        return result\n    }\n    var a = {\n        value:1\n    }\n    var b = function(name,age){\n        console.log(this.value)\n        console.log(name)\n        console.log(age)\n    }\n    b.myCall(a,\"dingding\",18)\n```\n## apply\n> apply的方法和 call 方法的实现类似，只不过是如果有参数，以数组形式进行传递\n\napply这个API平时使用的场景，代码如下:\n```javascript\n    var a = {\n        value:1\n    }\n    var b = function(name,age){\n        console.log(this.value)\n        console.log(name)\n        console.log(age)\n    }\n    b.apply(a,[\"dingding\",18])\n```\n直接上模拟apply功能代码\n```javascript\n    Function.prototype.myApply = function(context){\n        var context = context || window;\n        context.fn = this;\n        var result;\n        if(arguments[1]){\n            result = context.fn(...arguments[1]) \n        }else{\n            result = context.fn()\n        }\n        delete context.fn\n        return result\n    }\n    var a = {\n        value:1\n    }\n    var b = function(name,age){\n        console.log(this.value)\n        console.log(name)\n        console.log(age)\n    }\n    b.myApply(a,[\"dingding\",18])\n```\n[参考资料](https://www.jianshu.com/p/92b48caee4b2)","slug":"探究call-和-apply-的原理","published":1,"updated":"2026-01-02T00:43:17.577Z","comments":1,"layout":"post","photos":[],"_id":"cmjwbsw69001protgawlv48eh","content":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>音乐🎵搭配学习更美味哦！</p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n<img src=\"/img/callAndapply.jpg\">\n建议看这片文章时可以点击[音乐🎵](https://music.163.com/#/song?id=1293886117)，来个单曲循，美滋滋\n<span id=\"more\"></span>\n# 先拿call开刀\n> 作用：call和apply都是替换函数内错误的this\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">    <span class=\"attr\">value</span>:<span class=\"number\">1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">value</span>) <span class=\"comment\">// 如果不对this进行绑定执行bar() 会返回undefined</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">b.<span class=\"title function_\">call</span>(a) <span class=\"comment\">//1</span></span><br></pre></td></tr></table></figure>\n<p>去除繁琐的讲解，一步到位自己模拟call的用法写一个函数，达到相同目的</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Function</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">myCall</span> = <span class=\"keyword\">function</span>(<span class=\"params\">context</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> context = context || <span class=\"variable language_\">window</span>; <span class=\"comment\">//当没传入值时候，就是指全局window</span></span><br><span class=\"line\">    context.<span class=\"property\">fn</span> = <span class=\"variable language_\">this</span>; <span class=\"comment\">//把调用myCall前的方法缓存下来</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> args = [...<span class=\"variable language_\">arguments</span>].<span class=\"title function_\">slice</span>(<span class=\"number\">1</span>);<span class=\"comment\">//使用...打散传入值，并去除第一方法，得到一个数组</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> result = context.<span class=\"title function_\">fn</span>(...args);<span class=\"comment\">//把数组打散，把dinging 18传入b方法中</span></span><br><span class=\"line\">    <span class=\"keyword\">delete</span> context.<span class=\"property\">fn</span>; <span class=\"comment\">//删除</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">    <span class=\"attr\">value</span>:<span class=\"number\">1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"keyword\">function</span>(<span class=\"params\">name,age</span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">value</span>)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(name)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(age)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">b.<span class=\"title function_\">myCall</span>(a,<span class=\"string\">&quot;dingding&quot;</span>,<span class=\"number\">18</span>)</span><br></pre></td></tr></table></figure>\n<h2 id=\"apply\"><a href=\"#apply\" class=\"headerlink\" title=\"apply\"></a>apply</h2><blockquote>\n<p>apply的方法和 call 方法的实现类似，只不过是如果有参数，以数组形式进行传递</p>\n</blockquote>\n<p>apply这个API平时使用的场景，代码如下:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">    <span class=\"attr\">value</span>:<span class=\"number\">1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"keyword\">function</span>(<span class=\"params\">name,age</span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">value</span>)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(name)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(age)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">b.<span class=\"title function_\">apply</span>(a,[<span class=\"string\">&quot;dingding&quot;</span>,<span class=\"number\">18</span>])</span><br></pre></td></tr></table></figure>\n<p>直接上模拟apply功能代码</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Function</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">myApply</span> = <span class=\"keyword\">function</span>(<span class=\"params\">context</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> context = context || <span class=\"variable language_\">window</span>;</span><br><span class=\"line\">    context.<span class=\"property\">fn</span> = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> result;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"variable language_\">arguments</span>[<span class=\"number\">1</span>])&#123;</span><br><span class=\"line\">        result = context.<span class=\"title function_\">fn</span>(...<span class=\"variable language_\">arguments</span>[<span class=\"number\">1</span>]) </span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        result = context.<span class=\"title function_\">fn</span>()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> context.<span class=\"property\">fn</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">    <span class=\"attr\">value</span>:<span class=\"number\">1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"keyword\">function</span>(<span class=\"params\">name,age</span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">value</span>)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(name)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(age)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">b.<span class=\"title function_\">myApply</span>(a,[<span class=\"string\">&quot;dingding&quot;</span>,<span class=\"number\">18</span>])</span><br></pre></td></tr></table></figure>\n<p><a href=\"https://www.jianshu.com/p/92b48caee4b2\">参考资料</a></p>\n","excerpt":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>音乐🎵搭配学习更美味哦！</p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n<img src=\"/img/callAndapply.jpg\">\n建议看这片文章时可以点击[音乐🎵](https://music.163.com/#/song?id=1293886117)，来个单曲循，美滋滋","more":"# 先拿call开刀\n> 作用：call和apply都是替换函数内错误的this\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">    <span class=\"attr\">value</span>:<span class=\"number\">1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">value</span>) <span class=\"comment\">// 如果不对this进行绑定执行bar() 会返回undefined</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">b.<span class=\"title function_\">call</span>(a) <span class=\"comment\">//1</span></span><br></pre></td></tr></table></figure>\n<p>去除繁琐的讲解，一步到位自己模拟call的用法写一个函数，达到相同目的</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Function</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">myCall</span> = <span class=\"keyword\">function</span>(<span class=\"params\">context</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> context = context || <span class=\"variable language_\">window</span>; <span class=\"comment\">//当没传入值时候，就是指全局window</span></span><br><span class=\"line\">    context.<span class=\"property\">fn</span> = <span class=\"variable language_\">this</span>; <span class=\"comment\">//把调用myCall前的方法缓存下来</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> args = [...<span class=\"variable language_\">arguments</span>].<span class=\"title function_\">slice</span>(<span class=\"number\">1</span>);<span class=\"comment\">//使用...打散传入值，并去除第一方法，得到一个数组</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> result = context.<span class=\"title function_\">fn</span>(...args);<span class=\"comment\">//把数组打散，把dinging 18传入b方法中</span></span><br><span class=\"line\">    <span class=\"keyword\">delete</span> context.<span class=\"property\">fn</span>; <span class=\"comment\">//删除</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">    <span class=\"attr\">value</span>:<span class=\"number\">1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"keyword\">function</span>(<span class=\"params\">name,age</span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">value</span>)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(name)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(age)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">b.<span class=\"title function_\">myCall</span>(a,<span class=\"string\">&quot;dingding&quot;</span>,<span class=\"number\">18</span>)</span><br></pre></td></tr></table></figure>\n<h2 id=\"apply\"><a href=\"#apply\" class=\"headerlink\" title=\"apply\"></a>apply</h2><blockquote>\n<p>apply的方法和 call 方法的实现类似，只不过是如果有参数，以数组形式进行传递</p>\n</blockquote>\n<p>apply这个API平时使用的场景，代码如下:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">    <span class=\"attr\">value</span>:<span class=\"number\">1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"keyword\">function</span>(<span class=\"params\">name,age</span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">value</span>)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(name)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(age)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">b.<span class=\"title function_\">apply</span>(a,[<span class=\"string\">&quot;dingding&quot;</span>,<span class=\"number\">18</span>])</span><br></pre></td></tr></table></figure>\n<p>直接上模拟apply功能代码</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Function</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">myApply</span> = <span class=\"keyword\">function</span>(<span class=\"params\">context</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> context = context || <span class=\"variable language_\">window</span>;</span><br><span class=\"line\">    context.<span class=\"property\">fn</span> = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> result;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"variable language_\">arguments</span>[<span class=\"number\">1</span>])&#123;</span><br><span class=\"line\">        result = context.<span class=\"title function_\">fn</span>(...<span class=\"variable language_\">arguments</span>[<span class=\"number\">1</span>]) </span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        result = context.<span class=\"title function_\">fn</span>()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> context.<span class=\"property\">fn</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">    <span class=\"attr\">value</span>:<span class=\"number\">1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"keyword\">function</span>(<span class=\"params\">name,age</span>)&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">value</span>)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(name)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(age)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">b.<span class=\"title function_\">myApply</span>(a,[<span class=\"string\">&quot;dingding&quot;</span>,<span class=\"number\">18</span>])</span><br></pre></td></tr></table></figure>\n<p><a href=\"https://www.jianshu.com/p/92b48caee4b2\">参考资料</a></p>"},{"title":"深度学习之神经网络","date":"2019-02-04T09:50:33.000Z","copyright":null,"keywords":null,"description":null,"_content":"{%cq%}今天是19年除夕夜{%endcq%}\n<!--more-->\n# 神经网络\n\n[参考视频](https://www.imooc.com/video/18099)\n\n## 神经元————最小的神经网络\n<img src=\"/img/nerve.png\">\n<img src=\"/img/nerve1.png\">\n\n# 总结\n太枯燥看不下去了 😂","source":"_posts/深度学习之之神经网络.md","raw":"---\ntitle: 深度学习之神经网络\ndate: 2019-02-04 17:50:33\ncategories: 深度学习\ntags:\n    - 神经网络\ncopyright:\nkeywords:\ndescription:\n---\n{%cq%}今天是19年除夕夜{%endcq%}\n<!--more-->\n# 神经网络\n\n[参考视频](https://www.imooc.com/video/18099)\n\n## 神经元————最小的神经网络\n<img src=\"/img/nerve.png\">\n<img src=\"/img/nerve1.png\">\n\n# 总结\n太枯燥看不下去了 😂","slug":"深度学习之之神经网络","published":1,"updated":"2026-01-02T00:43:17.578Z","comments":1,"layout":"post","photos":[],"_id":"cmjwbsw69001srotg07gwawu9","content":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>今天是19年除夕夜</p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n<span id=\"more\"></span>\n<h1 id=\"神经网络\"><a href=\"#神经网络\" class=\"headerlink\" title=\"神经网络\"></a>神经网络</h1><p><a href=\"https://www.imooc.com/video/18099\">参考视频</a></p>\n<h2 id=\"神经元————最小的神经网络\"><a href=\"#神经元————最小的神经网络\" class=\"headerlink\" title=\"神经元————最小的神经网络\"></a>神经元————最小的神经网络</h2><img src=\"/img/nerve.png\">\n<img src=\"/img/nerve1.png\">\n\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>太枯燥看不下去了 😂</p>\n","excerpt":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>今天是19年除夕夜</p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>","more":"<h1 id=\"神经网络\"><a href=\"#神经网络\" class=\"headerlink\" title=\"神经网络\"></a>神经网络</h1><p><a href=\"https://www.imooc.com/video/18099\">参考视频</a></p>\n<h2 id=\"神经元————最小的神经网络\"><a href=\"#神经元————最小的神经网络\" class=\"headerlink\" title=\"神经元————最小的神经网络\"></a>神经元————最小的神经网络</h2><img src=\"/img/nerve.png\">\n<img src=\"/img/nerve1.png\">\n\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>太枯燥看不下去了 😂</p>"},{"title":"跨浏览器窗口,7种方式","date":"2021-09-01T00:26:58.000Z","copyright":null,"keywords":null,"description":null,"_content":"{% cq %} 跨浏览器窗口,7种方式 {% endcq %}\n\n<!--more-->\n#### WebSocket\n    模拟聊天室\n服务端代码\n    ```javascript\n        const WebSocket = require('ws');\n\n        const server = new WebSocket.Server({\n        port: 8080\n        });\n\n        server.on('open', function open() {\n        console.log('connected');\n        });\n\n        server.on('close', function close() {\n        console.log('disconnected');\n        });\n\n        server.on('connection', function connection(ws, req) {\n        const ip = req.connection.remoteAddress;\n        const port = req.connection.remotePort;\n        const clientName = ip + port;\n\n        console.log('%s is connected', clientName)\n\n        // 发送欢迎信息给客户端\n        ws.send(\"Welcome \" + clientName);\n\n        ws.on('message', function incoming(message) {\n            console.log('received: %s from %s', message, clientName);\n\n            // 广播消息给所有客户端\n            server.clients.forEach(function each(client) {\n            if (client.readyState === WebSocket.OPEN) {\n                client.send(clientName + \" -> \" + message);\n            }\n            });\n\n        });\n\n        });\n    ```\n客户端的实现\n    ```javascript\n        <!DOCTYPE html>\n        <html>\n        <head>\n            <meta charset=\"UTF-8\">\n            <title>WebSocket Chat</title>\n        </head>\n        <body>\n            <script type=\"text/javascript\">\n                var socket;\n                if (!window.WebSocket) {\n                    window.WebSocket = window.MozWebSocket;\n                }\n                if (window.WebSocket) {\n                    socket = new WebSocket(\"ws://localhost:8080/ws\");\n                    socket.onmessage = function (event) {\n                        var ta = document.getElementById('responseText');\n                        ta.value = ta.value + '\\n' + event.data\n                    };\n                    socket.onopen = function (event) {\n                        var ta = document.getElementById('responseText');\n                        ta.value = \"连接开启!\";\n                    };\n                    socket.onclose = function (event) {\n                        var ta = document.getElementById('responseText');\n                        ta.value = ta.value + \"连接被关闭\";\n                    };\n                } else {\n                    alert(\"你的浏览器不支持 WebSocket！\");\n                }\n\n                function send(message) {\n                    if (!window.WebSocket) {\n                        return;\n                    }\n                    if (socket.readyState == WebSocket.OPEN) {\n                        socket.send(message);\n                    } else {\n                        alert(\"连接没有开启.\");\n                    }\n                }\n            </script>\n            <form onsubmit=\"return false;\">\n                <h3>WebSocket 聊天室：</h3>\n                <textarea id=\"responseText\" style=\"width: 500px; height: 300px;\"></textarea>\n                <br>\n                <input type=\"text\" name=\"message\" style=\"width: 300px\" value=\"您好\">\n                <input type=\"button\" value=\"发送消息\" onclick=\"send(this.form.message.value)\">\n                <input type=\"button\" onclick=\"javascript:document.getElementById('responseText').value=''\" value=\"清空聊天记录\">\n            </form>\n        </body>\n        </html>\n    ```\n#### 定时器 + 客户端存储\n\n#### postMessage\n\n#### StorageEvent\n    page1\n    ```javascript\n        localStorage.setItem('message',JSON.stringify({\n            message: '消息'，\n            from: 'Page 1',\n            date: Date.now()\n        }))\n\n    ```\n    page2\n    ```javascript\n        localStorage.setItem('message',JSON.stringify({\n            message: '消息'，\n            from: 'Page 1',\n            date: Date.now()\n        }))\n    ```\n#### BroadcastChannel\n    page1\n    ```javascript\n        var channel = new BroadcastChannel(\"channel-BroadcastChannel\");\n        channel.postMessage('Hello, BroadcastChannel!')\n    ```\n    page2\n    ```javascript\n        var channel = new BroadcastChannel(\"channel-BroadcastChannel\");\n        channel.addEventListener(\"message\", function(ev) {\n            console.log(ev.data)\n        });\n    ```\n#### SharedWorker\n> 我们可以在浏览器地址栏里面输入 `chrome://inspect，然后在侧边栏选中shared workers了，就可以看到浏览器，目前在运行的所有worker。点击inspect会打开一个开发者工具，然后就可以看到输出的log了\n> 注意：如果要使 SharedWorker 连接到多个不同的页面，这些页面必须是同源的（相同的协议、host 以及端口）。\n    worker.js\n    ```javascript\n        var portList = [];\n\n        onconnect = function(e) {\n            console.log('e', e)\n            var port = e.ports[0];\n            ensurePorts(port);\n            port.onmessage = function(e) {\n                var data = e.data;\n                disptach(port, data);\n            };\n            port.start();\n        };\n        // 创建所有workder\n        function ensurePorts(port) {\n            if (portList.indexOf(port) < 0) {\n                portList.push(port);\n            }\n        }\n        // 发送其他页面\n        function disptach(selfPort, data) {\n            console.log('portList', portList)\n            console.log('selfPort', selfPort)\n            console.log('data', data)\n            portList\n                .filter(port => selfPort !== port)\n                .forEach(port => port.postMessage(data));\n        }\n    ```\n    page1\n    ```javascript\n        <!DOCTYPE html>\n        <html lang=\"en\">\n        <head>\n            <meta charset=\"UTF-8\" />\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n            <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\" />\n            <title>BroadcastChannel Page 1</title>\n        </head>\n        <body>\n            <h3>Page 1</h3>\n            <section style=\"margin-top:50px; text-align: center\">\n            <input id=\"inputMessage\" value=\"page 1的测试消息\" />\n            <input type=\"button\" value=\"发送消息\" id=\"btnSend\" />\n            <section id=\"messages\">\n                <p>收到的消息：</p>\n            </section>\n            </section>\n\n            <script src=\"./worker.js\"></script>\n            <script>\n            var messagesEle = document.getElementById(\"messages\");\n            var messageEl = document.getElementById(\"inputMessage\");\n            var btnSend = document.getElementById(\"btnSend\");\n            //\n\n            if (!window.SharedWorker) {\n                alert(\"浏览器不支持SharedWorkder!\");\n            } else {\n                var myWorker = new SharedWorker(\"./worker.js\");\n                // 监听数据\n                myWorker.port.onmessage = function(e) {\n                console.log('page1', e)\n                var msgEl = document.createElement(\"p\");\n                var data = e.data;\n                msgEl.innerText = data.date + \" \" + data.from + \":\" + data.message;\n                messagesEle.appendChild(msgEl);\n                };\n\n                btnSend.addEventListener(\"click\", function() {\n                var message = messageEl.value;\n                // 发送数据\n                myWorker.port.postMessage({\n                    date: new Date().toLocaleString(),\n                    message,\n                    from: \"page 1\"\n                });\n                });\n\n                myWorker.port.start();\n            }\n            </script>\n        </body>\n        </html>\n    ```\n    page2\n    ```javascript\n        <!DOCTYPE html>\n        <html lang=\"en\">\n        <head>\n            <meta charset=\"UTF-8\" />\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n            <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\" />\n            <title>BroadcastChannel Page 1</title>\n        </head>\n        <body>\n            <h3>Page 2</h3>\n            <section style=\"margin-top:50px; text-align: center\">\n            <input id=\"inputMessage\" value=\"page 1的测试消息\" />\n            <input type=\"button\" value=\"发送消息\" id=\"btnSend\" />\n            <section id=\"messages\">\n                <p>收到的消息：</p>\n            </section>\n            </section>\n\n            <script src=\"./worker.js\"></script>\n            <script>\n            var messagesEle = document.getElementById(\"messages\");\n            var messageEl = document.getElementById(\"inputMessage\");\n            var btnSend = document.getElementById(\"btnSend\");\n            //\n\n            if (!window.SharedWorker) {\n                alert(\"浏览器不支持SharedWorkder!\");\n            } else {\n                var myWorker = new SharedWorker(\"./worker.js\");\n\n                myWorker.port.onmessage = function(e) {\n                console.log('page2', e)\n                var msgEl = document.createElement(\"p\");\n                var data = e.data;\n                msgEl.innerText = data.date + \" \" + data.from + \":\" + data.message;\n                messagesEle.appendChild(msgEl);\n                };\n\n                btnSend.addEventListener(\"click\", function() {\n                var message = messageEl.value;\n\n                var message = messageEl.value;\n\n                myWorker.port.postMessage({\n                    date: new Date().toLocaleString(),\n                    message,\n                    from: \"page 2\"\n                });\n                });\n\n                myWorker.port.start();\n            }\n            </script>\n        </body>\n        </html>\n    ```\n#### MessageChannel","source":"_posts/跨浏览器窗口-7种方式 copy.md","raw":"---\ntitle: '跨浏览器窗口,7种方式'\ndate: 2021-09-01 08:26:58\ncategories: web\ntags: ['跨浏览器窗口,7种方式']\ncopyright:\nkeywords:\ndescription:\n---\n{% cq %} 跨浏览器窗口,7种方式 {% endcq %}\n\n<!--more-->\n#### WebSocket\n    模拟聊天室\n服务端代码\n    ```javascript\n        const WebSocket = require('ws');\n\n        const server = new WebSocket.Server({\n        port: 8080\n        });\n\n        server.on('open', function open() {\n        console.log('connected');\n        });\n\n        server.on('close', function close() {\n        console.log('disconnected');\n        });\n\n        server.on('connection', function connection(ws, req) {\n        const ip = req.connection.remoteAddress;\n        const port = req.connection.remotePort;\n        const clientName = ip + port;\n\n        console.log('%s is connected', clientName)\n\n        // 发送欢迎信息给客户端\n        ws.send(\"Welcome \" + clientName);\n\n        ws.on('message', function incoming(message) {\n            console.log('received: %s from %s', message, clientName);\n\n            // 广播消息给所有客户端\n            server.clients.forEach(function each(client) {\n            if (client.readyState === WebSocket.OPEN) {\n                client.send(clientName + \" -> \" + message);\n            }\n            });\n\n        });\n\n        });\n    ```\n客户端的实现\n    ```javascript\n        <!DOCTYPE html>\n        <html>\n        <head>\n            <meta charset=\"UTF-8\">\n            <title>WebSocket Chat</title>\n        </head>\n        <body>\n            <script type=\"text/javascript\">\n                var socket;\n                if (!window.WebSocket) {\n                    window.WebSocket = window.MozWebSocket;\n                }\n                if (window.WebSocket) {\n                    socket = new WebSocket(\"ws://localhost:8080/ws\");\n                    socket.onmessage = function (event) {\n                        var ta = document.getElementById('responseText');\n                        ta.value = ta.value + '\\n' + event.data\n                    };\n                    socket.onopen = function (event) {\n                        var ta = document.getElementById('responseText');\n                        ta.value = \"连接开启!\";\n                    };\n                    socket.onclose = function (event) {\n                        var ta = document.getElementById('responseText');\n                        ta.value = ta.value + \"连接被关闭\";\n                    };\n                } else {\n                    alert(\"你的浏览器不支持 WebSocket！\");\n                }\n\n                function send(message) {\n                    if (!window.WebSocket) {\n                        return;\n                    }\n                    if (socket.readyState == WebSocket.OPEN) {\n                        socket.send(message);\n                    } else {\n                        alert(\"连接没有开启.\");\n                    }\n                }\n            </script>\n            <form onsubmit=\"return false;\">\n                <h3>WebSocket 聊天室：</h3>\n                <textarea id=\"responseText\" style=\"width: 500px; height: 300px;\"></textarea>\n                <br>\n                <input type=\"text\" name=\"message\" style=\"width: 300px\" value=\"您好\">\n                <input type=\"button\" value=\"发送消息\" onclick=\"send(this.form.message.value)\">\n                <input type=\"button\" onclick=\"javascript:document.getElementById('responseText').value=''\" value=\"清空聊天记录\">\n            </form>\n        </body>\n        </html>\n    ```\n#### 定时器 + 客户端存储\n\n#### postMessage\n\n#### StorageEvent\n    page1\n    ```javascript\n        localStorage.setItem('message',JSON.stringify({\n            message: '消息'，\n            from: 'Page 1',\n            date: Date.now()\n        }))\n\n    ```\n    page2\n    ```javascript\n        localStorage.setItem('message',JSON.stringify({\n            message: '消息'，\n            from: 'Page 1',\n            date: Date.now()\n        }))\n    ```\n#### BroadcastChannel\n    page1\n    ```javascript\n        var channel = new BroadcastChannel(\"channel-BroadcastChannel\");\n        channel.postMessage('Hello, BroadcastChannel!')\n    ```\n    page2\n    ```javascript\n        var channel = new BroadcastChannel(\"channel-BroadcastChannel\");\n        channel.addEventListener(\"message\", function(ev) {\n            console.log(ev.data)\n        });\n    ```\n#### SharedWorker\n> 我们可以在浏览器地址栏里面输入 `chrome://inspect，然后在侧边栏选中shared workers了，就可以看到浏览器，目前在运行的所有worker。点击inspect会打开一个开发者工具，然后就可以看到输出的log了\n> 注意：如果要使 SharedWorker 连接到多个不同的页面，这些页面必须是同源的（相同的协议、host 以及端口）。\n    worker.js\n    ```javascript\n        var portList = [];\n\n        onconnect = function(e) {\n            console.log('e', e)\n            var port = e.ports[0];\n            ensurePorts(port);\n            port.onmessage = function(e) {\n                var data = e.data;\n                disptach(port, data);\n            };\n            port.start();\n        };\n        // 创建所有workder\n        function ensurePorts(port) {\n            if (portList.indexOf(port) < 0) {\n                portList.push(port);\n            }\n        }\n        // 发送其他页面\n        function disptach(selfPort, data) {\n            console.log('portList', portList)\n            console.log('selfPort', selfPort)\n            console.log('data', data)\n            portList\n                .filter(port => selfPort !== port)\n                .forEach(port => port.postMessage(data));\n        }\n    ```\n    page1\n    ```javascript\n        <!DOCTYPE html>\n        <html lang=\"en\">\n        <head>\n            <meta charset=\"UTF-8\" />\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n            <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\" />\n            <title>BroadcastChannel Page 1</title>\n        </head>\n        <body>\n            <h3>Page 1</h3>\n            <section style=\"margin-top:50px; text-align: center\">\n            <input id=\"inputMessage\" value=\"page 1的测试消息\" />\n            <input type=\"button\" value=\"发送消息\" id=\"btnSend\" />\n            <section id=\"messages\">\n                <p>收到的消息：</p>\n            </section>\n            </section>\n\n            <script src=\"./worker.js\"></script>\n            <script>\n            var messagesEle = document.getElementById(\"messages\");\n            var messageEl = document.getElementById(\"inputMessage\");\n            var btnSend = document.getElementById(\"btnSend\");\n            //\n\n            if (!window.SharedWorker) {\n                alert(\"浏览器不支持SharedWorkder!\");\n            } else {\n                var myWorker = new SharedWorker(\"./worker.js\");\n                // 监听数据\n                myWorker.port.onmessage = function(e) {\n                console.log('page1', e)\n                var msgEl = document.createElement(\"p\");\n                var data = e.data;\n                msgEl.innerText = data.date + \" \" + data.from + \":\" + data.message;\n                messagesEle.appendChild(msgEl);\n                };\n\n                btnSend.addEventListener(\"click\", function() {\n                var message = messageEl.value;\n                // 发送数据\n                myWorker.port.postMessage({\n                    date: new Date().toLocaleString(),\n                    message,\n                    from: \"page 1\"\n                });\n                });\n\n                myWorker.port.start();\n            }\n            </script>\n        </body>\n        </html>\n    ```\n    page2\n    ```javascript\n        <!DOCTYPE html>\n        <html lang=\"en\">\n        <head>\n            <meta charset=\"UTF-8\" />\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n            <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\" />\n            <title>BroadcastChannel Page 1</title>\n        </head>\n        <body>\n            <h3>Page 2</h3>\n            <section style=\"margin-top:50px; text-align: center\">\n            <input id=\"inputMessage\" value=\"page 1的测试消息\" />\n            <input type=\"button\" value=\"发送消息\" id=\"btnSend\" />\n            <section id=\"messages\">\n                <p>收到的消息：</p>\n            </section>\n            </section>\n\n            <script src=\"./worker.js\"></script>\n            <script>\n            var messagesEle = document.getElementById(\"messages\");\n            var messageEl = document.getElementById(\"inputMessage\");\n            var btnSend = document.getElementById(\"btnSend\");\n            //\n\n            if (!window.SharedWorker) {\n                alert(\"浏览器不支持SharedWorkder!\");\n            } else {\n                var myWorker = new SharedWorker(\"./worker.js\");\n\n                myWorker.port.onmessage = function(e) {\n                console.log('page2', e)\n                var msgEl = document.createElement(\"p\");\n                var data = e.data;\n                msgEl.innerText = data.date + \" \" + data.from + \":\" + data.message;\n                messagesEle.appendChild(msgEl);\n                };\n\n                btnSend.addEventListener(\"click\", function() {\n                var message = messageEl.value;\n\n                var message = messageEl.value;\n\n                myWorker.port.postMessage({\n                    date: new Date().toLocaleString(),\n                    message,\n                    from: \"page 2\"\n                });\n                });\n\n                myWorker.port.start();\n            }\n            </script>\n        </body>\n        </html>\n    ```\n#### MessageChannel","slug":"跨浏览器窗口-7种方式 copy","published":1,"updated":"2026-01-02T00:43:17.578Z","comments":1,"layout":"post","photos":[],"_id":"cmjwbsw6a001urotg74p40kio","content":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>跨浏览器窗口,7种方式 </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n\n<span id=\"more\"></span>\n<h4 id=\"WebSocket\"><a href=\"#WebSocket\" class=\"headerlink\" title=\"WebSocket\"></a>WebSocket</h4><pre><code>模拟聊天室\n</code></pre>\n<p>服务端代码<br>    <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">WebSocket</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;ws&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> server = <span class=\"keyword\">new</span> <span class=\"title class_\">WebSocket</span>.<span class=\"title class_\">Server</span>(&#123;</span><br><span class=\"line\"><span class=\"attr\">port</span>: <span class=\"number\">8080</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;open&#x27;</span>, <span class=\"keyword\">function</span> <span class=\"title function_\">open</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;connected&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;close&#x27;</span>, <span class=\"keyword\">function</span> <span class=\"title function_\">close</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;disconnected&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;connection&#x27;</span>, <span class=\"keyword\">function</span> <span class=\"title function_\">connection</span>(<span class=\"params\">ws, req</span>) &#123;</span><br><span class=\"line\"><span class=\"keyword\">const</span> ip = req.<span class=\"property\">connection</span>.<span class=\"property\">remoteAddress</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> port = req.<span class=\"property\">connection</span>.<span class=\"property\">remotePort</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> clientName = ip + port;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;%s is connected&#x27;</span>, clientName)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 发送欢迎信息给客户端</span></span><br><span class=\"line\">ws.<span class=\"title function_\">send</span>(<span class=\"string\">&quot;Welcome &quot;</span> + clientName);</span><br><span class=\"line\"></span><br><span class=\"line\">ws.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;message&#x27;</span>, <span class=\"keyword\">function</span> <span class=\"title function_\">incoming</span>(<span class=\"params\">message</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;received: %s from %s&#x27;</span>, message, clientName);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 广播消息给所有客户端</span></span><br><span class=\"line\">    server.<span class=\"property\">clients</span>.<span class=\"title function_\">forEach</span>(<span class=\"keyword\">function</span> <span class=\"title function_\">each</span>(<span class=\"params\">client</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (client.<span class=\"property\">readyState</span> === <span class=\"title class_\">WebSocket</span>.<span class=\"property\">OPEN</span>) &#123;</span><br><span class=\"line\">        client.<span class=\"title function_\">send</span>(clientName + <span class=\"string\">&quot; -&gt; &quot;</span> + message);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure><br>客户端的实现<br>    <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!<span class=\"variable constant_\">DOCTYPE</span> html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class=\"line\">    &lt;title&gt;WebSocket Chat&lt;/title&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">    &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class=\"line\">        var socket;</span><br><span class=\"line\">        if (!window.WebSocket) &#123;</span><br><span class=\"line\">            window.WebSocket = window.MozWebSocket;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        if (window.WebSocket) &#123;</span><br><span class=\"line\">            socket = new WebSocket(&quot;ws://localhost:8080/ws&quot;);</span><br><span class=\"line\">            socket.onmessage = function (event) &#123;</span><br><span class=\"line\">                var ta = document.getElementById(&#x27;responseText&#x27;);</span><br><span class=\"line\">                ta.value = ta.value + &#x27;\\n&#x27; + event.data</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            socket.onopen = function (event) &#123;</span><br><span class=\"line\">                var ta = document.getElementById(&#x27;responseText&#x27;);</span><br><span class=\"line\">                ta.value = &quot;连接开启!&quot;;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            socket.onclose = function (event) &#123;</span><br><span class=\"line\">                var ta = document.getElementById(&#x27;responseText&#x27;);</span><br><span class=\"line\">                ta.value = ta.value + &quot;连接被关闭&quot;;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            alert(&quot;你的浏览器不支持 WebSocket！&quot;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        function send(message) &#123;</span><br><span class=\"line\">            if (!window.WebSocket) &#123;</span><br><span class=\"line\">                return;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            if (socket.readyState == WebSocket.OPEN) &#123;</span><br><span class=\"line\">                socket.send(message);</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                alert(&quot;连接没有开启.&quot;);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &lt;/script&gt;</span><br><span class=\"line\">    &lt;form onsubmit=&quot;return false;&quot;&gt;</span><br><span class=\"line\">        &lt;h3&gt;WebSocket 聊天室：&lt;/h3&gt;</span><br><span class=\"line\">        &lt;textarea id=&quot;responseText&quot; style=&quot;width: 500px; height: 300px;&quot;&gt;&lt;/textarea&gt;</span><br><span class=\"line\">        &lt;br&gt;</span><br><span class=\"line\">        &lt;input type=&quot;text&quot; name=&quot;message&quot; style=&quot;width: 300px&quot; value=&quot;您好&quot;&gt;</span><br><span class=\"line\">        &lt;input type=&quot;button&quot; value=&quot;发送消息&quot; onclick=&quot;send(this.form.message.value)&quot;&gt;</span><br><span class=\"line\">        &lt;input type=&quot;button&quot; onclick=&quot;javascript:document.getElementById(&#x27;responseText&#x27;).value=&#x27;&#x27;&quot; value=&quot;清空聊天记录&quot;&gt;</span><br><span class=\"line\">    &lt;/form&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"定时器-客户端存储\"><a href=\"#定时器-客户端存储\" class=\"headerlink\" title=\"定时器 + 客户端存储\"></a>定时器 + 客户端存储</h4><h4 id=\"postMessage\"><a href=\"#postMessage\" class=\"headerlink\" title=\"postMessage\"></a>postMessage</h4><h4 id=\"StorageEvent\"><a href=\"#StorageEvent\" class=\"headerlink\" title=\"StorageEvent\"></a>StorageEvent</h4><pre><code>page1\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">setItem</span>(<span class=\"string\">&#x27;message&#x27;</span>,<span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">message</span>: <span class=\"string\">&#x27;消息&#x27;</span>，</span><br><span class=\"line\">    <span class=\"attr\">from</span>: <span class=\"string\">&#x27;Page 1&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">date</span>: <span class=\"title class_\">Date</span>.<span class=\"title function_\">now</span>()</span><br><span class=\"line\">&#125;))</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\npage2\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">setItem</span>(<span class=\"string\">&#x27;message&#x27;</span>,<span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">message</span>: <span class=\"string\">&#x27;消息&#x27;</span>，</span><br><span class=\"line\">    <span class=\"attr\">from</span>: <span class=\"string\">&#x27;Page 1&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">date</span>: <span class=\"title class_\">Date</span>.<span class=\"title function_\">now</span>()</span><br><span class=\"line\">&#125;))</span><br></pre></td></tr></table></figure>\n</code></pre>\n<h4 id=\"BroadcastChannel\"><a href=\"#BroadcastChannel\" class=\"headerlink\" title=\"BroadcastChannel\"></a>BroadcastChannel</h4><pre><code>page1\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> channel = <span class=\"keyword\">new</span> <span class=\"title class_\">BroadcastChannel</span>(<span class=\"string\">&quot;channel-BroadcastChannel&quot;</span>);</span><br><span class=\"line\">channel.<span class=\"title function_\">postMessage</span>(<span class=\"string\">&#x27;Hello, BroadcastChannel!&#x27;</span>)</span><br></pre></td></tr></table></figure>\npage2\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> channel = <span class=\"keyword\">new</span> <span class=\"title class_\">BroadcastChannel</span>(<span class=\"string\">&quot;channel-BroadcastChannel&quot;</span>);</span><br><span class=\"line\">channel.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;message&quot;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">ev</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(ev.<span class=\"property\">data</span>)</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n</code></pre>\n<h4 id=\"SharedWorker\"><a href=\"#SharedWorker\" class=\"headerlink\" title=\"SharedWorker\"></a>SharedWorker</h4><blockquote>\n<p>我们可以在浏览器地址栏里面输入 &#96;chrome:&#x2F;&#x2F;inspect，然后在侧边栏选中shared workers了，就可以看到浏览器，目前在运行的所有worker。点击inspect会打开一个开发者工具，然后就可以看到输出的log了<br>注意：如果要使 SharedWorker 连接到多个不同的页面，这些页面必须是同源的（相同的协议、host 以及端口）。<br>    worker.js<br>    <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> portList = [];</span><br><span class=\"line\"></span><br><span class=\"line\">onconnect = <span class=\"keyword\">function</span>(<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;e&#x27;</span>, e)</span><br><span class=\"line\">    <span class=\"keyword\">var</span> port = e.<span class=\"property\">ports</span>[<span class=\"number\">0</span>];</span><br><span class=\"line\">    <span class=\"title function_\">ensurePorts</span>(port);</span><br><span class=\"line\">    port.<span class=\"property\">onmessage</span> = <span class=\"keyword\">function</span>(<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> data = e.<span class=\"property\">data</span>;</span><br><span class=\"line\">        <span class=\"title function_\">disptach</span>(port, data);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    port.<span class=\"title function_\">start</span>();</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"comment\">// 创建所有workder</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">ensurePorts</span>(<span class=\"params\">port</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (portList.<span class=\"title function_\">indexOf</span>(port) &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        portList.<span class=\"title function_\">push</span>(port);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 发送其他页面</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">disptach</span>(<span class=\"params\">selfPort, data</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;portList&#x27;</span>, portList)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;selfPort&#x27;</span>, selfPort)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;data&#x27;</span>, data)</span><br><span class=\"line\">    portList</span><br><span class=\"line\">        .<span class=\"title function_\">filter</span>(<span class=\"function\"><span class=\"params\">port</span> =&gt;</span> selfPort !== port)</span><br><span class=\"line\">        .<span class=\"title function_\">forEach</span>(<span class=\"function\"><span class=\"params\">port</span> =&gt;</span> port.<span class=\"title function_\">postMessage</span>(data));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br>    page1<br>    <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!<span class=\"variable constant_\">DOCTYPE</span> html&gt;</span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;X-UA-Compatible&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;ie=edge&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>BroadcastChannel Page 1<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">h3</span>&gt;</span>Page 1<span class=\"tag\">&lt;/<span class=\"name\">h3</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">section</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;margin-top:50px; text-align: center&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;inputMessage&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;page 1的测试消息&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;button&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;发送消息&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;btnSend&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">section</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;messages&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>收到的消息：<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">section</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">section</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;./worker.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">var</span> messagesEle = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;messages&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">var</span> messageEl = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;inputMessage&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">var</span> btnSend = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;btnSend&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"comment\">//</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">if</span> (!<span class=\"variable language_\">window</span>.<span class=\"property\">SharedWorker</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"title function_\">alert</span>(<span class=\"string\">&quot;浏览器不支持SharedWorkder!&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125; <span class=\"keyword\">else</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> myWorker = <span class=\"keyword\">new</span> <span class=\"title class_\">SharedWorker</span>(<span class=\"string\">&quot;./worker.js&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"comment\">// 监听数据</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        myWorker.<span class=\"property\">port</span>.<span class=\"property\">onmessage</span> = <span class=\"keyword\">function</span>(<span class=\"params\">e</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;page1&#x27;</span>, e)</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> msgEl = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;p&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> data = e.<span class=\"property\">data</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        msgEl.<span class=\"property\">innerText</span> = data.<span class=\"property\">date</span> + <span class=\"string\">&quot; &quot;</span> + data.<span class=\"property\">from</span> + <span class=\"string\">&quot;:&quot;</span> + data.<span class=\"property\">message</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        messagesEle.<span class=\"title function_\">appendChild</span>(msgEl);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        btnSend.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;click&quot;</span>, <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> message = messageEl.<span class=\"property\">value</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"comment\">// 发送数据</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        myWorker.<span class=\"property\">port</span>.<span class=\"title function_\">postMessage</span>(&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">date</span>: <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>().<span class=\"title function_\">toLocaleString</span>(),</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            message,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">from</span>: <span class=\"string\">&quot;page 1&quot;</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        myWorker.<span class=\"property\">port</span>.<span class=\"title function_\">start</span>();</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure><br>    page2<br>    <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!<span class=\"variable constant_\">DOCTYPE</span> html&gt;</span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;X-UA-Compatible&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;ie=edge&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>BroadcastChannel Page 1<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">h3</span>&gt;</span>Page 2<span class=\"tag\">&lt;/<span class=\"name\">h3</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">section</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;margin-top:50px; text-align: center&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;inputMessage&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;page 1的测试消息&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;button&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;发送消息&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;btnSend&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">section</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;messages&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>收到的消息：<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">section</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">section</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;./worker.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">var</span> messagesEle = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;messages&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">var</span> messageEl = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;inputMessage&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">var</span> btnSend = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;btnSend&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"comment\">//</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">if</span> (!<span class=\"variable language_\">window</span>.<span class=\"property\">SharedWorker</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"title function_\">alert</span>(<span class=\"string\">&quot;浏览器不支持SharedWorkder!&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125; <span class=\"keyword\">else</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> myWorker = <span class=\"keyword\">new</span> <span class=\"title class_\">SharedWorker</span>(<span class=\"string\">&quot;./worker.js&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        myWorker.<span class=\"property\">port</span>.<span class=\"property\">onmessage</span> = <span class=\"keyword\">function</span>(<span class=\"params\">e</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;page2&#x27;</span>, e)</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> msgEl = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;p&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> data = e.<span class=\"property\">data</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        msgEl.<span class=\"property\">innerText</span> = data.<span class=\"property\">date</span> + <span class=\"string\">&quot; &quot;</span> + data.<span class=\"property\">from</span> + <span class=\"string\">&quot;:&quot;</span> + data.<span class=\"property\">message</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        messagesEle.<span class=\"title function_\">appendChild</span>(msgEl);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        btnSend.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;click&quot;</span>, <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> message = messageEl.<span class=\"property\">value</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> message = messageEl.<span class=\"property\">value</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        myWorker.<span class=\"property\">port</span>.<span class=\"title function_\">postMessage</span>(&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">date</span>: <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>().<span class=\"title function_\">toLocaleString</span>(),</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            message,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">from</span>: <span class=\"string\">&quot;page 2&quot;</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        myWorker.<span class=\"property\">port</span>.<span class=\"title function_\">start</span>();</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p>\n</blockquote>\n<h4 id=\"MessageChannel\"><a href=\"#MessageChannel\" class=\"headerlink\" title=\"MessageChannel\"></a>MessageChannel</h4>","excerpt":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>跨浏览器窗口,7种方式 </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>","more":"<h4 id=\"WebSocket\"><a href=\"#WebSocket\" class=\"headerlink\" title=\"WebSocket\"></a>WebSocket</h4><pre><code>模拟聊天室\n</code></pre>\n<p>服务端代码<br>    <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">WebSocket</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;ws&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> server = <span class=\"keyword\">new</span> <span class=\"title class_\">WebSocket</span>.<span class=\"title class_\">Server</span>(&#123;</span><br><span class=\"line\"><span class=\"attr\">port</span>: <span class=\"number\">8080</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;open&#x27;</span>, <span class=\"keyword\">function</span> <span class=\"title function_\">open</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;connected&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;close&#x27;</span>, <span class=\"keyword\">function</span> <span class=\"title function_\">close</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;disconnected&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;connection&#x27;</span>, <span class=\"keyword\">function</span> <span class=\"title function_\">connection</span>(<span class=\"params\">ws, req</span>) &#123;</span><br><span class=\"line\"><span class=\"keyword\">const</span> ip = req.<span class=\"property\">connection</span>.<span class=\"property\">remoteAddress</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> port = req.<span class=\"property\">connection</span>.<span class=\"property\">remotePort</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> clientName = ip + port;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;%s is connected&#x27;</span>, clientName)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 发送欢迎信息给客户端</span></span><br><span class=\"line\">ws.<span class=\"title function_\">send</span>(<span class=\"string\">&quot;Welcome &quot;</span> + clientName);</span><br><span class=\"line\"></span><br><span class=\"line\">ws.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;message&#x27;</span>, <span class=\"keyword\">function</span> <span class=\"title function_\">incoming</span>(<span class=\"params\">message</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;received: %s from %s&#x27;</span>, message, clientName);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 广播消息给所有客户端</span></span><br><span class=\"line\">    server.<span class=\"property\">clients</span>.<span class=\"title function_\">forEach</span>(<span class=\"keyword\">function</span> <span class=\"title function_\">each</span>(<span class=\"params\">client</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (client.<span class=\"property\">readyState</span> === <span class=\"title class_\">WebSocket</span>.<span class=\"property\">OPEN</span>) &#123;</span><br><span class=\"line\">        client.<span class=\"title function_\">send</span>(clientName + <span class=\"string\">&quot; -&gt; &quot;</span> + message);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure><br>客户端的实现<br>    <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!<span class=\"variable constant_\">DOCTYPE</span> html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class=\"line\">    &lt;title&gt;WebSocket Chat&lt;/title&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">    &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class=\"line\">        var socket;</span><br><span class=\"line\">        if (!window.WebSocket) &#123;</span><br><span class=\"line\">            window.WebSocket = window.MozWebSocket;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        if (window.WebSocket) &#123;</span><br><span class=\"line\">            socket = new WebSocket(&quot;ws://localhost:8080/ws&quot;);</span><br><span class=\"line\">            socket.onmessage = function (event) &#123;</span><br><span class=\"line\">                var ta = document.getElementById(&#x27;responseText&#x27;);</span><br><span class=\"line\">                ta.value = ta.value + &#x27;\\n&#x27; + event.data</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            socket.onopen = function (event) &#123;</span><br><span class=\"line\">                var ta = document.getElementById(&#x27;responseText&#x27;);</span><br><span class=\"line\">                ta.value = &quot;连接开启!&quot;;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            socket.onclose = function (event) &#123;</span><br><span class=\"line\">                var ta = document.getElementById(&#x27;responseText&#x27;);</span><br><span class=\"line\">                ta.value = ta.value + &quot;连接被关闭&quot;;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            alert(&quot;你的浏览器不支持 WebSocket！&quot;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        function send(message) &#123;</span><br><span class=\"line\">            if (!window.WebSocket) &#123;</span><br><span class=\"line\">                return;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            if (socket.readyState == WebSocket.OPEN) &#123;</span><br><span class=\"line\">                socket.send(message);</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                alert(&quot;连接没有开启.&quot;);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &lt;/script&gt;</span><br><span class=\"line\">    &lt;form onsubmit=&quot;return false;&quot;&gt;</span><br><span class=\"line\">        &lt;h3&gt;WebSocket 聊天室：&lt;/h3&gt;</span><br><span class=\"line\">        &lt;textarea id=&quot;responseText&quot; style=&quot;width: 500px; height: 300px;&quot;&gt;&lt;/textarea&gt;</span><br><span class=\"line\">        &lt;br&gt;</span><br><span class=\"line\">        &lt;input type=&quot;text&quot; name=&quot;message&quot; style=&quot;width: 300px&quot; value=&quot;您好&quot;&gt;</span><br><span class=\"line\">        &lt;input type=&quot;button&quot; value=&quot;发送消息&quot; onclick=&quot;send(this.form.message.value)&quot;&gt;</span><br><span class=\"line\">        &lt;input type=&quot;button&quot; onclick=&quot;javascript:document.getElementById(&#x27;responseText&#x27;).value=&#x27;&#x27;&quot; value=&quot;清空聊天记录&quot;&gt;</span><br><span class=\"line\">    &lt;/form&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"定时器-客户端存储\"><a href=\"#定时器-客户端存储\" class=\"headerlink\" title=\"定时器 + 客户端存储\"></a>定时器 + 客户端存储</h4><h4 id=\"postMessage\"><a href=\"#postMessage\" class=\"headerlink\" title=\"postMessage\"></a>postMessage</h4><h4 id=\"StorageEvent\"><a href=\"#StorageEvent\" class=\"headerlink\" title=\"StorageEvent\"></a>StorageEvent</h4><pre><code>page1\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">setItem</span>(<span class=\"string\">&#x27;message&#x27;</span>,<span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">message</span>: <span class=\"string\">&#x27;消息&#x27;</span>，</span><br><span class=\"line\">    <span class=\"attr\">from</span>: <span class=\"string\">&#x27;Page 1&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">date</span>: <span class=\"title class_\">Date</span>.<span class=\"title function_\">now</span>()</span><br><span class=\"line\">&#125;))</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\npage2\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">setItem</span>(<span class=\"string\">&#x27;message&#x27;</span>,<span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">message</span>: <span class=\"string\">&#x27;消息&#x27;</span>，</span><br><span class=\"line\">    <span class=\"attr\">from</span>: <span class=\"string\">&#x27;Page 1&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">date</span>: <span class=\"title class_\">Date</span>.<span class=\"title function_\">now</span>()</span><br><span class=\"line\">&#125;))</span><br></pre></td></tr></table></figure>\n</code></pre>\n<h4 id=\"BroadcastChannel\"><a href=\"#BroadcastChannel\" class=\"headerlink\" title=\"BroadcastChannel\"></a>BroadcastChannel</h4><pre><code>page1\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> channel = <span class=\"keyword\">new</span> <span class=\"title class_\">BroadcastChannel</span>(<span class=\"string\">&quot;channel-BroadcastChannel&quot;</span>);</span><br><span class=\"line\">channel.<span class=\"title function_\">postMessage</span>(<span class=\"string\">&#x27;Hello, BroadcastChannel!&#x27;</span>)</span><br></pre></td></tr></table></figure>\npage2\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> channel = <span class=\"keyword\">new</span> <span class=\"title class_\">BroadcastChannel</span>(<span class=\"string\">&quot;channel-BroadcastChannel&quot;</span>);</span><br><span class=\"line\">channel.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;message&quot;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">ev</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(ev.<span class=\"property\">data</span>)</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n</code></pre>\n<h4 id=\"SharedWorker\"><a href=\"#SharedWorker\" class=\"headerlink\" title=\"SharedWorker\"></a>SharedWorker</h4><blockquote>\n<p>我们可以在浏览器地址栏里面输入 &#96;chrome:&#x2F;&#x2F;inspect，然后在侧边栏选中shared workers了，就可以看到浏览器，目前在运行的所有worker。点击inspect会打开一个开发者工具，然后就可以看到输出的log了<br>注意：如果要使 SharedWorker 连接到多个不同的页面，这些页面必须是同源的（相同的协议、host 以及端口）。<br>    worker.js<br>    <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> portList = [];</span><br><span class=\"line\"></span><br><span class=\"line\">onconnect = <span class=\"keyword\">function</span>(<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;e&#x27;</span>, e)</span><br><span class=\"line\">    <span class=\"keyword\">var</span> port = e.<span class=\"property\">ports</span>[<span class=\"number\">0</span>];</span><br><span class=\"line\">    <span class=\"title function_\">ensurePorts</span>(port);</span><br><span class=\"line\">    port.<span class=\"property\">onmessage</span> = <span class=\"keyword\">function</span>(<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> data = e.<span class=\"property\">data</span>;</span><br><span class=\"line\">        <span class=\"title function_\">disptach</span>(port, data);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    port.<span class=\"title function_\">start</span>();</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"comment\">// 创建所有workder</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">ensurePorts</span>(<span class=\"params\">port</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (portList.<span class=\"title function_\">indexOf</span>(port) &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        portList.<span class=\"title function_\">push</span>(port);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 发送其他页面</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">disptach</span>(<span class=\"params\">selfPort, data</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;portList&#x27;</span>, portList)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;selfPort&#x27;</span>, selfPort)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;data&#x27;</span>, data)</span><br><span class=\"line\">    portList</span><br><span class=\"line\">        .<span class=\"title function_\">filter</span>(<span class=\"function\"><span class=\"params\">port</span> =&gt;</span> selfPort !== port)</span><br><span class=\"line\">        .<span class=\"title function_\">forEach</span>(<span class=\"function\"><span class=\"params\">port</span> =&gt;</span> port.<span class=\"title function_\">postMessage</span>(data));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br>    page1<br>    <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!<span class=\"variable constant_\">DOCTYPE</span> html&gt;</span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;X-UA-Compatible&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;ie=edge&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>BroadcastChannel Page 1<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">h3</span>&gt;</span>Page 1<span class=\"tag\">&lt;/<span class=\"name\">h3</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">section</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;margin-top:50px; text-align: center&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;inputMessage&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;page 1的测试消息&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;button&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;发送消息&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;btnSend&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">section</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;messages&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>收到的消息：<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">section</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">section</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;./worker.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">var</span> messagesEle = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;messages&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">var</span> messageEl = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;inputMessage&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">var</span> btnSend = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;btnSend&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"comment\">//</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">if</span> (!<span class=\"variable language_\">window</span>.<span class=\"property\">SharedWorker</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"title function_\">alert</span>(<span class=\"string\">&quot;浏览器不支持SharedWorkder!&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125; <span class=\"keyword\">else</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> myWorker = <span class=\"keyword\">new</span> <span class=\"title class_\">SharedWorker</span>(<span class=\"string\">&quot;./worker.js&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"comment\">// 监听数据</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        myWorker.<span class=\"property\">port</span>.<span class=\"property\">onmessage</span> = <span class=\"keyword\">function</span>(<span class=\"params\">e</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;page1&#x27;</span>, e)</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> msgEl = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;p&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> data = e.<span class=\"property\">data</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        msgEl.<span class=\"property\">innerText</span> = data.<span class=\"property\">date</span> + <span class=\"string\">&quot; &quot;</span> + data.<span class=\"property\">from</span> + <span class=\"string\">&quot;:&quot;</span> + data.<span class=\"property\">message</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        messagesEle.<span class=\"title function_\">appendChild</span>(msgEl);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        btnSend.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;click&quot;</span>, <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> message = messageEl.<span class=\"property\">value</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"comment\">// 发送数据</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        myWorker.<span class=\"property\">port</span>.<span class=\"title function_\">postMessage</span>(&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">date</span>: <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>().<span class=\"title function_\">toLocaleString</span>(),</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            message,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">from</span>: <span class=\"string\">&quot;page 1&quot;</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        myWorker.<span class=\"property\">port</span>.<span class=\"title function_\">start</span>();</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure><br>    page2<br>    <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!<span class=\"variable constant_\">DOCTYPE</span> html&gt;</span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;X-UA-Compatible&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;ie=edge&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>BroadcastChannel Page 1<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">h3</span>&gt;</span>Page 2<span class=\"tag\">&lt;/<span class=\"name\">h3</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">section</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;margin-top:50px; text-align: center&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;inputMessage&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;page 1的测试消息&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;button&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;发送消息&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;btnSend&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">section</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;messages&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>收到的消息：<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">section</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">section</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;./worker.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">var</span> messagesEle = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;messages&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">var</span> messageEl = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;inputMessage&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">var</span> btnSend = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;btnSend&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"comment\">//</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">if</span> (!<span class=\"variable language_\">window</span>.<span class=\"property\">SharedWorker</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"title function_\">alert</span>(<span class=\"string\">&quot;浏览器不支持SharedWorkder!&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125; <span class=\"keyword\">else</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> myWorker = <span class=\"keyword\">new</span> <span class=\"title class_\">SharedWorker</span>(<span class=\"string\">&quot;./worker.js&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        myWorker.<span class=\"property\">port</span>.<span class=\"property\">onmessage</span> = <span class=\"keyword\">function</span>(<span class=\"params\">e</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;page2&#x27;</span>, e)</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> msgEl = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;p&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> data = e.<span class=\"property\">data</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        msgEl.<span class=\"property\">innerText</span> = data.<span class=\"property\">date</span> + <span class=\"string\">&quot; &quot;</span> + data.<span class=\"property\">from</span> + <span class=\"string\">&quot;:&quot;</span> + data.<span class=\"property\">message</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        messagesEle.<span class=\"title function_\">appendChild</span>(msgEl);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        btnSend.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;click&quot;</span>, <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> message = messageEl.<span class=\"property\">value</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> message = messageEl.<span class=\"property\">value</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        myWorker.<span class=\"property\">port</span>.<span class=\"title function_\">postMessage</span>(&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">date</span>: <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>().<span class=\"title function_\">toLocaleString</span>(),</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            message,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">from</span>: <span class=\"string\">&quot;page 2&quot;</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        myWorker.<span class=\"property\">port</span>.<span class=\"title function_\">start</span>();</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p>\n</blockquote>\n<h4 id=\"MessageChannel\"><a href=\"#MessageChannel\" class=\"headerlink\" title=\"MessageChannel\"></a>MessageChannel</h4>"},{"title":"跨浏览器窗口,7种方式","date":"2021-09-01T00:26:58.000Z","copyright":null,"keywords":null,"description":null,"_content":"{% cq %} 跨浏览器窗口,7种方式 {% endcq %}\n\n<!--more-->\n#### WebSocket\n    模拟聊天室\n服务端代码\n    ```javascript\n        const WebSocket = require('ws');\n\n        const server = new WebSocket.Server({\n        port: 8080\n        });\n\n        server.on('open', function open() {\n        console.log('connected');\n        });\n\n        server.on('close', function close() {\n        console.log('disconnected');\n        });\n\n        server.on('connection', function connection(ws, req) {\n        const ip = req.connection.remoteAddress;\n        const port = req.connection.remotePort;\n        const clientName = ip + port;\n\n        console.log('%s is connected', clientName)\n\n        // 发送欢迎信息给客户端\n        ws.send(\"Welcome \" + clientName);\n\n        ws.on('message', function incoming(message) {\n            console.log('received: %s from %s', message, clientName);\n\n            // 广播消息给所有客户端\n            server.clients.forEach(function each(client) {\n            if (client.readyState === WebSocket.OPEN) {\n                client.send(clientName + \" -> \" + message);\n            }\n            });\n\n        });\n\n        });\n    ```\n客户端的实现\n    ```javascript\n        <!DOCTYPE html>\n        <html>\n        <head>\n            <meta charset=\"UTF-8\">\n            <title>WebSocket Chat</title>\n        </head>\n        <body>\n            <script type=\"text/javascript\">\n                var socket;\n                if (!window.WebSocket) {\n                    window.WebSocket = window.MozWebSocket;\n                }\n                if (window.WebSocket) {\n                    socket = new WebSocket(\"ws://localhost:8080/ws\");\n                    socket.onmessage = function (event) {\n                        var ta = document.getElementById('responseText');\n                        ta.value = ta.value + '\\n' + event.data\n                    };\n                    socket.onopen = function (event) {\n                        var ta = document.getElementById('responseText');\n                        ta.value = \"连接开启!\";\n                    };\n                    socket.onclose = function (event) {\n                        var ta = document.getElementById('responseText');\n                        ta.value = ta.value + \"连接被关闭\";\n                    };\n                } else {\n                    alert(\"你的浏览器不支持 WebSocket！\");\n                }\n\n                function send(message) {\n                    if (!window.WebSocket) {\n                        return;\n                    }\n                    if (socket.readyState == WebSocket.OPEN) {\n                        socket.send(message);\n                    } else {\n                        alert(\"连接没有开启.\");\n                    }\n                }\n            </script>\n            <form onsubmit=\"return false;\">\n                <h3>WebSocket 聊天室：</h3>\n                <textarea id=\"responseText\" style=\"width: 500px; height: 300px;\"></textarea>\n                <br>\n                <input type=\"text\" name=\"message\" style=\"width: 300px\" value=\"您好\">\n                <input type=\"button\" value=\"发送消息\" onclick=\"send(this.form.message.value)\">\n                <input type=\"button\" onclick=\"javascript:document.getElementById('responseText').value=''\" value=\"清空聊天记录\">\n            </form>\n        </body>\n        </html>\n    ```\n#### 定时器 + 客户端存储\n\n#### postMessage\n\n#### StorageEvent\n    page1\n    ```javascript\n        localStorage.setItem('message',JSON.stringify({\n            message: '消息'，\n            from: 'Page 1',\n            date: Date.now()\n        }))\n\n    ```\n    page2\n    ```javascript\n        localStorage.setItem('message',JSON.stringify({\n            message: '消息'，\n            from: 'Page 1',\n            date: Date.now()\n        }))\n    ```\n#### BroadcastChannel\n    page1\n    ```javascript\n        var channel = new BroadcastChannel(\"channel-BroadcastChannel\");\n        channel.postMessage('Hello, BroadcastChannel!')\n    ```\n    page2\n    ```javascript\n        var channel = new BroadcastChannel(\"channel-BroadcastChannel\");\n        channel.addEventListener(\"message\", function(ev) {\n            console.log(ev.data)\n        });\n    ```\n#### SharedWorker\n> 我们可以在浏览器地址栏里面输入 `chrome://inspect，然后在侧边栏选中shared workers了，就可以看到浏览器，目前在运行的所有worker。点击inspect会打开一个开发者工具，然后就可以看到输出的log了\n> 注意：如果要使 SharedWorker 连接到多个不同的页面，这些页面必须是同源的（相同的协议、host 以及端口）。\n    worker.js\n    ```javascript\n        var portList = [];\n\n        onconnect = function(e) {\n            console.log('e', e)\n            var port = e.ports[0];\n            ensurePorts(port);\n            port.onmessage = function(e) {\n                var data = e.data;\n                disptach(port, data);\n            };\n            port.start();\n        };\n        // 创建所有workder\n        function ensurePorts(port) {\n            if (portList.indexOf(port) < 0) {\n                portList.push(port);\n            }\n        }\n        // 发送其他页面\n        function disptach(selfPort, data) {\n            console.log('portList', portList)\n            console.log('selfPort', selfPort)\n            console.log('data', data)\n            portList\n                .filter(port => selfPort !== port)\n                .forEach(port => port.postMessage(data));\n        }\n    ```\n    page1\n    ```javascript\n        <!DOCTYPE html>\n        <html lang=\"en\">\n        <head>\n            <meta charset=\"UTF-8\" />\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n            <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\" />\n            <title>BroadcastChannel Page 1</title>\n        </head>\n        <body>\n            <h3>Page 1</h3>\n            <section style=\"margin-top:50px; text-align: center\">\n            <input id=\"inputMessage\" value=\"page 1的测试消息\" />\n            <input type=\"button\" value=\"发送消息\" id=\"btnSend\" />\n            <section id=\"messages\">\n                <p>收到的消息：</p>\n            </section>\n            </section>\n\n            <script src=\"./worker.js\"></script>\n            <script>\n            var messagesEle = document.getElementById(\"messages\");\n            var messageEl = document.getElementById(\"inputMessage\");\n            var btnSend = document.getElementById(\"btnSend\");\n            //\n\n            if (!window.SharedWorker) {\n                alert(\"浏览器不支持SharedWorkder!\");\n            } else {\n                var myWorker = new SharedWorker(\"./worker.js\");\n                // 监听数据\n                myWorker.port.onmessage = function(e) {\n                console.log('page1', e)\n                var msgEl = document.createElement(\"p\");\n                var data = e.data;\n                msgEl.innerText = data.date + \" \" + data.from + \":\" + data.message;\n                messagesEle.appendChild(msgEl);\n                };\n\n                btnSend.addEventListener(\"click\", function() {\n                var message = messageEl.value;\n                // 发送数据\n                myWorker.port.postMessage({\n                    date: new Date().toLocaleString(),\n                    message,\n                    from: \"page 1\"\n                });\n                });\n\n                myWorker.port.start();\n            }\n            </script>\n        </body>\n        </html>\n    ```\n    page2\n    ```javascript\n        <!DOCTYPE html>\n        <html lang=\"en\">\n        <head>\n            <meta charset=\"UTF-8\" />\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n            <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\" />\n            <title>BroadcastChannel Page 1</title>\n        </head>\n        <body>\n            <h3>Page 2</h3>\n            <section style=\"margin-top:50px; text-align: center\">\n            <input id=\"inputMessage\" value=\"page 1的测试消息\" />\n            <input type=\"button\" value=\"发送消息\" id=\"btnSend\" />\n            <section id=\"messages\">\n                <p>收到的消息：</p>\n            </section>\n            </section>\n\n            <script src=\"./worker.js\"></script>\n            <script>\n            var messagesEle = document.getElementById(\"messages\");\n            var messageEl = document.getElementById(\"inputMessage\");\n            var btnSend = document.getElementById(\"btnSend\");\n            //\n\n            if (!window.SharedWorker) {\n                alert(\"浏览器不支持SharedWorkder!\");\n            } else {\n                var myWorker = new SharedWorker(\"./worker.js\");\n\n                myWorker.port.onmessage = function(e) {\n                console.log('page2', e)\n                var msgEl = document.createElement(\"p\");\n                var data = e.data;\n                msgEl.innerText = data.date + \" \" + data.from + \":\" + data.message;\n                messagesEle.appendChild(msgEl);\n                };\n\n                btnSend.addEventListener(\"click\", function() {\n                var message = messageEl.value;\n\n                var message = messageEl.value;\n\n                myWorker.port.postMessage({\n                    date: new Date().toLocaleString(),\n                    message,\n                    from: \"page 2\"\n                });\n                });\n\n                myWorker.port.start();\n            }\n            </script>\n        </body>\n        </html>\n    ```\n#### MessageChannel","source":"_posts/跨浏览器窗口-7种方式.md","raw":"---\ntitle: '跨浏览器窗口,7种方式'\ndate: 2021-09-01 08:26:58\ncategories: web\ntags: ['跨浏览器窗口,7种方式']\ncopyright:\nkeywords:\ndescription:\n---\n{% cq %} 跨浏览器窗口,7种方式 {% endcq %}\n\n<!--more-->\n#### WebSocket\n    模拟聊天室\n服务端代码\n    ```javascript\n        const WebSocket = require('ws');\n\n        const server = new WebSocket.Server({\n        port: 8080\n        });\n\n        server.on('open', function open() {\n        console.log('connected');\n        });\n\n        server.on('close', function close() {\n        console.log('disconnected');\n        });\n\n        server.on('connection', function connection(ws, req) {\n        const ip = req.connection.remoteAddress;\n        const port = req.connection.remotePort;\n        const clientName = ip + port;\n\n        console.log('%s is connected', clientName)\n\n        // 发送欢迎信息给客户端\n        ws.send(\"Welcome \" + clientName);\n\n        ws.on('message', function incoming(message) {\n            console.log('received: %s from %s', message, clientName);\n\n            // 广播消息给所有客户端\n            server.clients.forEach(function each(client) {\n            if (client.readyState === WebSocket.OPEN) {\n                client.send(clientName + \" -> \" + message);\n            }\n            });\n\n        });\n\n        });\n    ```\n客户端的实现\n    ```javascript\n        <!DOCTYPE html>\n        <html>\n        <head>\n            <meta charset=\"UTF-8\">\n            <title>WebSocket Chat</title>\n        </head>\n        <body>\n            <script type=\"text/javascript\">\n                var socket;\n                if (!window.WebSocket) {\n                    window.WebSocket = window.MozWebSocket;\n                }\n                if (window.WebSocket) {\n                    socket = new WebSocket(\"ws://localhost:8080/ws\");\n                    socket.onmessage = function (event) {\n                        var ta = document.getElementById('responseText');\n                        ta.value = ta.value + '\\n' + event.data\n                    };\n                    socket.onopen = function (event) {\n                        var ta = document.getElementById('responseText');\n                        ta.value = \"连接开启!\";\n                    };\n                    socket.onclose = function (event) {\n                        var ta = document.getElementById('responseText');\n                        ta.value = ta.value + \"连接被关闭\";\n                    };\n                } else {\n                    alert(\"你的浏览器不支持 WebSocket！\");\n                }\n\n                function send(message) {\n                    if (!window.WebSocket) {\n                        return;\n                    }\n                    if (socket.readyState == WebSocket.OPEN) {\n                        socket.send(message);\n                    } else {\n                        alert(\"连接没有开启.\");\n                    }\n                }\n            </script>\n            <form onsubmit=\"return false;\">\n                <h3>WebSocket 聊天室：</h3>\n                <textarea id=\"responseText\" style=\"width: 500px; height: 300px;\"></textarea>\n                <br>\n                <input type=\"text\" name=\"message\" style=\"width: 300px\" value=\"您好\">\n                <input type=\"button\" value=\"发送消息\" onclick=\"send(this.form.message.value)\">\n                <input type=\"button\" onclick=\"javascript:document.getElementById('responseText').value=''\" value=\"清空聊天记录\">\n            </form>\n        </body>\n        </html>\n    ```\n#### 定时器 + 客户端存储\n\n#### postMessage\n\n#### StorageEvent\n    page1\n    ```javascript\n        localStorage.setItem('message',JSON.stringify({\n            message: '消息'，\n            from: 'Page 1',\n            date: Date.now()\n        }))\n\n    ```\n    page2\n    ```javascript\n        localStorage.setItem('message',JSON.stringify({\n            message: '消息'，\n            from: 'Page 1',\n            date: Date.now()\n        }))\n    ```\n#### BroadcastChannel\n    page1\n    ```javascript\n        var channel = new BroadcastChannel(\"channel-BroadcastChannel\");\n        channel.postMessage('Hello, BroadcastChannel!')\n    ```\n    page2\n    ```javascript\n        var channel = new BroadcastChannel(\"channel-BroadcastChannel\");\n        channel.addEventListener(\"message\", function(ev) {\n            console.log(ev.data)\n        });\n    ```\n#### SharedWorker\n> 我们可以在浏览器地址栏里面输入 `chrome://inspect，然后在侧边栏选中shared workers了，就可以看到浏览器，目前在运行的所有worker。点击inspect会打开一个开发者工具，然后就可以看到输出的log了\n> 注意：如果要使 SharedWorker 连接到多个不同的页面，这些页面必须是同源的（相同的协议、host 以及端口）。\n    worker.js\n    ```javascript\n        var portList = [];\n\n        onconnect = function(e) {\n            console.log('e', e)\n            var port = e.ports[0];\n            ensurePorts(port);\n            port.onmessage = function(e) {\n                var data = e.data;\n                disptach(port, data);\n            };\n            port.start();\n        };\n        // 创建所有workder\n        function ensurePorts(port) {\n            if (portList.indexOf(port) < 0) {\n                portList.push(port);\n            }\n        }\n        // 发送其他页面\n        function disptach(selfPort, data) {\n            console.log('portList', portList)\n            console.log('selfPort', selfPort)\n            console.log('data', data)\n            portList\n                .filter(port => selfPort !== port)\n                .forEach(port => port.postMessage(data));\n        }\n    ```\n    page1\n    ```javascript\n        <!DOCTYPE html>\n        <html lang=\"en\">\n        <head>\n            <meta charset=\"UTF-8\" />\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n            <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\" />\n            <title>BroadcastChannel Page 1</title>\n        </head>\n        <body>\n            <h3>Page 1</h3>\n            <section style=\"margin-top:50px; text-align: center\">\n            <input id=\"inputMessage\" value=\"page 1的测试消息\" />\n            <input type=\"button\" value=\"发送消息\" id=\"btnSend\" />\n            <section id=\"messages\">\n                <p>收到的消息：</p>\n            </section>\n            </section>\n\n            <script src=\"./worker.js\"></script>\n            <script>\n            var messagesEle = document.getElementById(\"messages\");\n            var messageEl = document.getElementById(\"inputMessage\");\n            var btnSend = document.getElementById(\"btnSend\");\n            //\n\n            if (!window.SharedWorker) {\n                alert(\"浏览器不支持SharedWorkder!\");\n            } else {\n                var myWorker = new SharedWorker(\"./worker.js\");\n                // 监听数据\n                myWorker.port.onmessage = function(e) {\n                console.log('page1', e)\n                var msgEl = document.createElement(\"p\");\n                var data = e.data;\n                msgEl.innerText = data.date + \" \" + data.from + \":\" + data.message;\n                messagesEle.appendChild(msgEl);\n                };\n\n                btnSend.addEventListener(\"click\", function() {\n                var message = messageEl.value;\n                // 发送数据\n                myWorker.port.postMessage({\n                    date: new Date().toLocaleString(),\n                    message,\n                    from: \"page 1\"\n                });\n                });\n\n                myWorker.port.start();\n            }\n            </script>\n        </body>\n        </html>\n    ```\n    page2\n    ```javascript\n        <!DOCTYPE html>\n        <html lang=\"en\">\n        <head>\n            <meta charset=\"UTF-8\" />\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n            <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\" />\n            <title>BroadcastChannel Page 1</title>\n        </head>\n        <body>\n            <h3>Page 2</h3>\n            <section style=\"margin-top:50px; text-align: center\">\n            <input id=\"inputMessage\" value=\"page 1的测试消息\" />\n            <input type=\"button\" value=\"发送消息\" id=\"btnSend\" />\n            <section id=\"messages\">\n                <p>收到的消息：</p>\n            </section>\n            </section>\n\n            <script src=\"./worker.js\"></script>\n            <script>\n            var messagesEle = document.getElementById(\"messages\");\n            var messageEl = document.getElementById(\"inputMessage\");\n            var btnSend = document.getElementById(\"btnSend\");\n            //\n\n            if (!window.SharedWorker) {\n                alert(\"浏览器不支持SharedWorkder!\");\n            } else {\n                var myWorker = new SharedWorker(\"./worker.js\");\n\n                myWorker.port.onmessage = function(e) {\n                console.log('page2', e)\n                var msgEl = document.createElement(\"p\");\n                var data = e.data;\n                msgEl.innerText = data.date + \" \" + data.from + \":\" + data.message;\n                messagesEle.appendChild(msgEl);\n                };\n\n                btnSend.addEventListener(\"click\", function() {\n                var message = messageEl.value;\n\n                var message = messageEl.value;\n\n                myWorker.port.postMessage({\n                    date: new Date().toLocaleString(),\n                    message,\n                    from: \"page 2\"\n                });\n                });\n\n                myWorker.port.start();\n            }\n            </script>\n        </body>\n        </html>\n    ```\n#### MessageChannel","slug":"跨浏览器窗口-7种方式","published":1,"updated":"2026-01-02T00:43:17.578Z","comments":1,"layout":"post","photos":[],"_id":"cmjwbsw6a001yrotg1oji1asq","content":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>跨浏览器窗口,7种方式 </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>\n\n<span id=\"more\"></span>\n<h4 id=\"WebSocket\"><a href=\"#WebSocket\" class=\"headerlink\" title=\"WebSocket\"></a>WebSocket</h4><pre><code>模拟聊天室\n</code></pre>\n<p>服务端代码<br>    <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">WebSocket</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;ws&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> server = <span class=\"keyword\">new</span> <span class=\"title class_\">WebSocket</span>.<span class=\"title class_\">Server</span>(&#123;</span><br><span class=\"line\"><span class=\"attr\">port</span>: <span class=\"number\">8080</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;open&#x27;</span>, <span class=\"keyword\">function</span> <span class=\"title function_\">open</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;connected&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;close&#x27;</span>, <span class=\"keyword\">function</span> <span class=\"title function_\">close</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;disconnected&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;connection&#x27;</span>, <span class=\"keyword\">function</span> <span class=\"title function_\">connection</span>(<span class=\"params\">ws, req</span>) &#123;</span><br><span class=\"line\"><span class=\"keyword\">const</span> ip = req.<span class=\"property\">connection</span>.<span class=\"property\">remoteAddress</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> port = req.<span class=\"property\">connection</span>.<span class=\"property\">remotePort</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> clientName = ip + port;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;%s is connected&#x27;</span>, clientName)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 发送欢迎信息给客户端</span></span><br><span class=\"line\">ws.<span class=\"title function_\">send</span>(<span class=\"string\">&quot;Welcome &quot;</span> + clientName);</span><br><span class=\"line\"></span><br><span class=\"line\">ws.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;message&#x27;</span>, <span class=\"keyword\">function</span> <span class=\"title function_\">incoming</span>(<span class=\"params\">message</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;received: %s from %s&#x27;</span>, message, clientName);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 广播消息给所有客户端</span></span><br><span class=\"line\">    server.<span class=\"property\">clients</span>.<span class=\"title function_\">forEach</span>(<span class=\"keyword\">function</span> <span class=\"title function_\">each</span>(<span class=\"params\">client</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (client.<span class=\"property\">readyState</span> === <span class=\"title class_\">WebSocket</span>.<span class=\"property\">OPEN</span>) &#123;</span><br><span class=\"line\">        client.<span class=\"title function_\">send</span>(clientName + <span class=\"string\">&quot; -&gt; &quot;</span> + message);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure><br>客户端的实现<br>    <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!<span class=\"variable constant_\">DOCTYPE</span> html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class=\"line\">    &lt;title&gt;WebSocket Chat&lt;/title&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">    &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class=\"line\">        var socket;</span><br><span class=\"line\">        if (!window.WebSocket) &#123;</span><br><span class=\"line\">            window.WebSocket = window.MozWebSocket;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        if (window.WebSocket) &#123;</span><br><span class=\"line\">            socket = new WebSocket(&quot;ws://localhost:8080/ws&quot;);</span><br><span class=\"line\">            socket.onmessage = function (event) &#123;</span><br><span class=\"line\">                var ta = document.getElementById(&#x27;responseText&#x27;);</span><br><span class=\"line\">                ta.value = ta.value + &#x27;\\n&#x27; + event.data</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            socket.onopen = function (event) &#123;</span><br><span class=\"line\">                var ta = document.getElementById(&#x27;responseText&#x27;);</span><br><span class=\"line\">                ta.value = &quot;连接开启!&quot;;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            socket.onclose = function (event) &#123;</span><br><span class=\"line\">                var ta = document.getElementById(&#x27;responseText&#x27;);</span><br><span class=\"line\">                ta.value = ta.value + &quot;连接被关闭&quot;;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            alert(&quot;你的浏览器不支持 WebSocket！&quot;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        function send(message) &#123;</span><br><span class=\"line\">            if (!window.WebSocket) &#123;</span><br><span class=\"line\">                return;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            if (socket.readyState == WebSocket.OPEN) &#123;</span><br><span class=\"line\">                socket.send(message);</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                alert(&quot;连接没有开启.&quot;);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &lt;/script&gt;</span><br><span class=\"line\">    &lt;form onsubmit=&quot;return false;&quot;&gt;</span><br><span class=\"line\">        &lt;h3&gt;WebSocket 聊天室：&lt;/h3&gt;</span><br><span class=\"line\">        &lt;textarea id=&quot;responseText&quot; style=&quot;width: 500px; height: 300px;&quot;&gt;&lt;/textarea&gt;</span><br><span class=\"line\">        &lt;br&gt;</span><br><span class=\"line\">        &lt;input type=&quot;text&quot; name=&quot;message&quot; style=&quot;width: 300px&quot; value=&quot;您好&quot;&gt;</span><br><span class=\"line\">        &lt;input type=&quot;button&quot; value=&quot;发送消息&quot; onclick=&quot;send(this.form.message.value)&quot;&gt;</span><br><span class=\"line\">        &lt;input type=&quot;button&quot; onclick=&quot;javascript:document.getElementById(&#x27;responseText&#x27;).value=&#x27;&#x27;&quot; value=&quot;清空聊天记录&quot;&gt;</span><br><span class=\"line\">    &lt;/form&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"定时器-客户端存储\"><a href=\"#定时器-客户端存储\" class=\"headerlink\" title=\"定时器 + 客户端存储\"></a>定时器 + 客户端存储</h4><h4 id=\"postMessage\"><a href=\"#postMessage\" class=\"headerlink\" title=\"postMessage\"></a>postMessage</h4><h4 id=\"StorageEvent\"><a href=\"#StorageEvent\" class=\"headerlink\" title=\"StorageEvent\"></a>StorageEvent</h4><pre><code>page1\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">setItem</span>(<span class=\"string\">&#x27;message&#x27;</span>,<span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">message</span>: <span class=\"string\">&#x27;消息&#x27;</span>，</span><br><span class=\"line\">    <span class=\"attr\">from</span>: <span class=\"string\">&#x27;Page 1&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">date</span>: <span class=\"title class_\">Date</span>.<span class=\"title function_\">now</span>()</span><br><span class=\"line\">&#125;))</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\npage2\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">setItem</span>(<span class=\"string\">&#x27;message&#x27;</span>,<span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">message</span>: <span class=\"string\">&#x27;消息&#x27;</span>，</span><br><span class=\"line\">    <span class=\"attr\">from</span>: <span class=\"string\">&#x27;Page 1&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">date</span>: <span class=\"title class_\">Date</span>.<span class=\"title function_\">now</span>()</span><br><span class=\"line\">&#125;))</span><br></pre></td></tr></table></figure>\n</code></pre>\n<h4 id=\"BroadcastChannel\"><a href=\"#BroadcastChannel\" class=\"headerlink\" title=\"BroadcastChannel\"></a>BroadcastChannel</h4><pre><code>page1\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> channel = <span class=\"keyword\">new</span> <span class=\"title class_\">BroadcastChannel</span>(<span class=\"string\">&quot;channel-BroadcastChannel&quot;</span>);</span><br><span class=\"line\">channel.<span class=\"title function_\">postMessage</span>(<span class=\"string\">&#x27;Hello, BroadcastChannel!&#x27;</span>)</span><br></pre></td></tr></table></figure>\npage2\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> channel = <span class=\"keyword\">new</span> <span class=\"title class_\">BroadcastChannel</span>(<span class=\"string\">&quot;channel-BroadcastChannel&quot;</span>);</span><br><span class=\"line\">channel.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;message&quot;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">ev</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(ev.<span class=\"property\">data</span>)</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n</code></pre>\n<h4 id=\"SharedWorker\"><a href=\"#SharedWorker\" class=\"headerlink\" title=\"SharedWorker\"></a>SharedWorker</h4><blockquote>\n<p>我们可以在浏览器地址栏里面输入 &#96;chrome:&#x2F;&#x2F;inspect，然后在侧边栏选中shared workers了，就可以看到浏览器，目前在运行的所有worker。点击inspect会打开一个开发者工具，然后就可以看到输出的log了<br>注意：如果要使 SharedWorker 连接到多个不同的页面，这些页面必须是同源的（相同的协议、host 以及端口）。<br>    worker.js<br>    <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> portList = [];</span><br><span class=\"line\"></span><br><span class=\"line\">onconnect = <span class=\"keyword\">function</span>(<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;e&#x27;</span>, e)</span><br><span class=\"line\">    <span class=\"keyword\">var</span> port = e.<span class=\"property\">ports</span>[<span class=\"number\">0</span>];</span><br><span class=\"line\">    <span class=\"title function_\">ensurePorts</span>(port);</span><br><span class=\"line\">    port.<span class=\"property\">onmessage</span> = <span class=\"keyword\">function</span>(<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> data = e.<span class=\"property\">data</span>;</span><br><span class=\"line\">        <span class=\"title function_\">disptach</span>(port, data);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    port.<span class=\"title function_\">start</span>();</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"comment\">// 创建所有workder</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">ensurePorts</span>(<span class=\"params\">port</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (portList.<span class=\"title function_\">indexOf</span>(port) &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        portList.<span class=\"title function_\">push</span>(port);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 发送其他页面</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">disptach</span>(<span class=\"params\">selfPort, data</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;portList&#x27;</span>, portList)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;selfPort&#x27;</span>, selfPort)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;data&#x27;</span>, data)</span><br><span class=\"line\">    portList</span><br><span class=\"line\">        .<span class=\"title function_\">filter</span>(<span class=\"function\"><span class=\"params\">port</span> =&gt;</span> selfPort !== port)</span><br><span class=\"line\">        .<span class=\"title function_\">forEach</span>(<span class=\"function\"><span class=\"params\">port</span> =&gt;</span> port.<span class=\"title function_\">postMessage</span>(data));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br>    page1<br>    <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!<span class=\"variable constant_\">DOCTYPE</span> html&gt;</span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;X-UA-Compatible&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;ie=edge&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>BroadcastChannel Page 1<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">h3</span>&gt;</span>Page 1<span class=\"tag\">&lt;/<span class=\"name\">h3</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">section</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;margin-top:50px; text-align: center&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;inputMessage&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;page 1的测试消息&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;button&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;发送消息&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;btnSend&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">section</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;messages&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>收到的消息：<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">section</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">section</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;./worker.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">var</span> messagesEle = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;messages&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">var</span> messageEl = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;inputMessage&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">var</span> btnSend = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;btnSend&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"comment\">//</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">if</span> (!<span class=\"variable language_\">window</span>.<span class=\"property\">SharedWorker</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"title function_\">alert</span>(<span class=\"string\">&quot;浏览器不支持SharedWorkder!&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125; <span class=\"keyword\">else</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> myWorker = <span class=\"keyword\">new</span> <span class=\"title class_\">SharedWorker</span>(<span class=\"string\">&quot;./worker.js&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"comment\">// 监听数据</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        myWorker.<span class=\"property\">port</span>.<span class=\"property\">onmessage</span> = <span class=\"keyword\">function</span>(<span class=\"params\">e</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;page1&#x27;</span>, e)</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> msgEl = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;p&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> data = e.<span class=\"property\">data</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        msgEl.<span class=\"property\">innerText</span> = data.<span class=\"property\">date</span> + <span class=\"string\">&quot; &quot;</span> + data.<span class=\"property\">from</span> + <span class=\"string\">&quot;:&quot;</span> + data.<span class=\"property\">message</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        messagesEle.<span class=\"title function_\">appendChild</span>(msgEl);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        btnSend.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;click&quot;</span>, <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> message = messageEl.<span class=\"property\">value</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"comment\">// 发送数据</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        myWorker.<span class=\"property\">port</span>.<span class=\"title function_\">postMessage</span>(&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">date</span>: <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>().<span class=\"title function_\">toLocaleString</span>(),</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            message,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">from</span>: <span class=\"string\">&quot;page 1&quot;</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        myWorker.<span class=\"property\">port</span>.<span class=\"title function_\">start</span>();</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure><br>    page2<br>    <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!<span class=\"variable constant_\">DOCTYPE</span> html&gt;</span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;X-UA-Compatible&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;ie=edge&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>BroadcastChannel Page 1<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">h3</span>&gt;</span>Page 2<span class=\"tag\">&lt;/<span class=\"name\">h3</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">section</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;margin-top:50px; text-align: center&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;inputMessage&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;page 1的测试消息&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;button&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;发送消息&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;btnSend&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">section</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;messages&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>收到的消息：<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">section</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">section</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;./worker.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">var</span> messagesEle = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;messages&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">var</span> messageEl = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;inputMessage&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">var</span> btnSend = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;btnSend&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"comment\">//</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">if</span> (!<span class=\"variable language_\">window</span>.<span class=\"property\">SharedWorker</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"title function_\">alert</span>(<span class=\"string\">&quot;浏览器不支持SharedWorkder!&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125; <span class=\"keyword\">else</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> myWorker = <span class=\"keyword\">new</span> <span class=\"title class_\">SharedWorker</span>(<span class=\"string\">&quot;./worker.js&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        myWorker.<span class=\"property\">port</span>.<span class=\"property\">onmessage</span> = <span class=\"keyword\">function</span>(<span class=\"params\">e</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;page2&#x27;</span>, e)</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> msgEl = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;p&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> data = e.<span class=\"property\">data</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        msgEl.<span class=\"property\">innerText</span> = data.<span class=\"property\">date</span> + <span class=\"string\">&quot; &quot;</span> + data.<span class=\"property\">from</span> + <span class=\"string\">&quot;:&quot;</span> + data.<span class=\"property\">message</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        messagesEle.<span class=\"title function_\">appendChild</span>(msgEl);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        btnSend.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;click&quot;</span>, <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> message = messageEl.<span class=\"property\">value</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> message = messageEl.<span class=\"property\">value</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        myWorker.<span class=\"property\">port</span>.<span class=\"title function_\">postMessage</span>(&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">date</span>: <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>().<span class=\"title function_\">toLocaleString</span>(),</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            message,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">from</span>: <span class=\"string\">&quot;page 2&quot;</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        myWorker.<span class=\"property\">port</span>.<span class=\"title function_\">start</span>();</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p>\n</blockquote>\n<h4 id=\"MessageChannel\"><a href=\"#MessageChannel\" class=\"headerlink\" title=\"MessageChannel\"></a>MessageChannel</h4>","excerpt":"<blockquote class=\"blockquote-center\">\n            <i class=\"fa fa-quote-left\"></i>\n            <p>跨浏览器窗口,7种方式 </p>\n\n            <i class=\"fa fa-quote-right\"></i>\n          </blockquote>","more":"<h4 id=\"WebSocket\"><a href=\"#WebSocket\" class=\"headerlink\" title=\"WebSocket\"></a>WebSocket</h4><pre><code>模拟聊天室\n</code></pre>\n<p>服务端代码<br>    <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">WebSocket</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;ws&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> server = <span class=\"keyword\">new</span> <span class=\"title class_\">WebSocket</span>.<span class=\"title class_\">Server</span>(&#123;</span><br><span class=\"line\"><span class=\"attr\">port</span>: <span class=\"number\">8080</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;open&#x27;</span>, <span class=\"keyword\">function</span> <span class=\"title function_\">open</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;connected&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;close&#x27;</span>, <span class=\"keyword\">function</span> <span class=\"title function_\">close</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;disconnected&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;connection&#x27;</span>, <span class=\"keyword\">function</span> <span class=\"title function_\">connection</span>(<span class=\"params\">ws, req</span>) &#123;</span><br><span class=\"line\"><span class=\"keyword\">const</span> ip = req.<span class=\"property\">connection</span>.<span class=\"property\">remoteAddress</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> port = req.<span class=\"property\">connection</span>.<span class=\"property\">remotePort</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> clientName = ip + port;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;%s is connected&#x27;</span>, clientName)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 发送欢迎信息给客户端</span></span><br><span class=\"line\">ws.<span class=\"title function_\">send</span>(<span class=\"string\">&quot;Welcome &quot;</span> + clientName);</span><br><span class=\"line\"></span><br><span class=\"line\">ws.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;message&#x27;</span>, <span class=\"keyword\">function</span> <span class=\"title function_\">incoming</span>(<span class=\"params\">message</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;received: %s from %s&#x27;</span>, message, clientName);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 广播消息给所有客户端</span></span><br><span class=\"line\">    server.<span class=\"property\">clients</span>.<span class=\"title function_\">forEach</span>(<span class=\"keyword\">function</span> <span class=\"title function_\">each</span>(<span class=\"params\">client</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (client.<span class=\"property\">readyState</span> === <span class=\"title class_\">WebSocket</span>.<span class=\"property\">OPEN</span>) &#123;</span><br><span class=\"line\">        client.<span class=\"title function_\">send</span>(clientName + <span class=\"string\">&quot; -&gt; &quot;</span> + message);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure><br>客户端的实现<br>    <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!<span class=\"variable constant_\">DOCTYPE</span> html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class=\"line\">    &lt;title&gt;WebSocket Chat&lt;/title&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">    &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class=\"line\">        var socket;</span><br><span class=\"line\">        if (!window.WebSocket) &#123;</span><br><span class=\"line\">            window.WebSocket = window.MozWebSocket;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        if (window.WebSocket) &#123;</span><br><span class=\"line\">            socket = new WebSocket(&quot;ws://localhost:8080/ws&quot;);</span><br><span class=\"line\">            socket.onmessage = function (event) &#123;</span><br><span class=\"line\">                var ta = document.getElementById(&#x27;responseText&#x27;);</span><br><span class=\"line\">                ta.value = ta.value + &#x27;\\n&#x27; + event.data</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            socket.onopen = function (event) &#123;</span><br><span class=\"line\">                var ta = document.getElementById(&#x27;responseText&#x27;);</span><br><span class=\"line\">                ta.value = &quot;连接开启!&quot;;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            socket.onclose = function (event) &#123;</span><br><span class=\"line\">                var ta = document.getElementById(&#x27;responseText&#x27;);</span><br><span class=\"line\">                ta.value = ta.value + &quot;连接被关闭&quot;;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            alert(&quot;你的浏览器不支持 WebSocket！&quot;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        function send(message) &#123;</span><br><span class=\"line\">            if (!window.WebSocket) &#123;</span><br><span class=\"line\">                return;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            if (socket.readyState == WebSocket.OPEN) &#123;</span><br><span class=\"line\">                socket.send(message);</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                alert(&quot;连接没有开启.&quot;);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &lt;/script&gt;</span><br><span class=\"line\">    &lt;form onsubmit=&quot;return false;&quot;&gt;</span><br><span class=\"line\">        &lt;h3&gt;WebSocket 聊天室：&lt;/h3&gt;</span><br><span class=\"line\">        &lt;textarea id=&quot;responseText&quot; style=&quot;width: 500px; height: 300px;&quot;&gt;&lt;/textarea&gt;</span><br><span class=\"line\">        &lt;br&gt;</span><br><span class=\"line\">        &lt;input type=&quot;text&quot; name=&quot;message&quot; style=&quot;width: 300px&quot; value=&quot;您好&quot;&gt;</span><br><span class=\"line\">        &lt;input type=&quot;button&quot; value=&quot;发送消息&quot; onclick=&quot;send(this.form.message.value)&quot;&gt;</span><br><span class=\"line\">        &lt;input type=&quot;button&quot; onclick=&quot;javascript:document.getElementById(&#x27;responseText&#x27;).value=&#x27;&#x27;&quot; value=&quot;清空聊天记录&quot;&gt;</span><br><span class=\"line\">    &lt;/form&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"定时器-客户端存储\"><a href=\"#定时器-客户端存储\" class=\"headerlink\" title=\"定时器 + 客户端存储\"></a>定时器 + 客户端存储</h4><h4 id=\"postMessage\"><a href=\"#postMessage\" class=\"headerlink\" title=\"postMessage\"></a>postMessage</h4><h4 id=\"StorageEvent\"><a href=\"#StorageEvent\" class=\"headerlink\" title=\"StorageEvent\"></a>StorageEvent</h4><pre><code>page1\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">setItem</span>(<span class=\"string\">&#x27;message&#x27;</span>,<span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">message</span>: <span class=\"string\">&#x27;消息&#x27;</span>，</span><br><span class=\"line\">    <span class=\"attr\">from</span>: <span class=\"string\">&#x27;Page 1&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">date</span>: <span class=\"title class_\">Date</span>.<span class=\"title function_\">now</span>()</span><br><span class=\"line\">&#125;))</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\npage2\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">setItem</span>(<span class=\"string\">&#x27;message&#x27;</span>,<span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">message</span>: <span class=\"string\">&#x27;消息&#x27;</span>，</span><br><span class=\"line\">    <span class=\"attr\">from</span>: <span class=\"string\">&#x27;Page 1&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">date</span>: <span class=\"title class_\">Date</span>.<span class=\"title function_\">now</span>()</span><br><span class=\"line\">&#125;))</span><br></pre></td></tr></table></figure>\n</code></pre>\n<h4 id=\"BroadcastChannel\"><a href=\"#BroadcastChannel\" class=\"headerlink\" title=\"BroadcastChannel\"></a>BroadcastChannel</h4><pre><code>page1\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> channel = <span class=\"keyword\">new</span> <span class=\"title class_\">BroadcastChannel</span>(<span class=\"string\">&quot;channel-BroadcastChannel&quot;</span>);</span><br><span class=\"line\">channel.<span class=\"title function_\">postMessage</span>(<span class=\"string\">&#x27;Hello, BroadcastChannel!&#x27;</span>)</span><br></pre></td></tr></table></figure>\npage2\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> channel = <span class=\"keyword\">new</span> <span class=\"title class_\">BroadcastChannel</span>(<span class=\"string\">&quot;channel-BroadcastChannel&quot;</span>);</span><br><span class=\"line\">channel.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;message&quot;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">ev</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(ev.<span class=\"property\">data</span>)</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n</code></pre>\n<h4 id=\"SharedWorker\"><a href=\"#SharedWorker\" class=\"headerlink\" title=\"SharedWorker\"></a>SharedWorker</h4><blockquote>\n<p>我们可以在浏览器地址栏里面输入 &#96;chrome:&#x2F;&#x2F;inspect，然后在侧边栏选中shared workers了，就可以看到浏览器，目前在运行的所有worker。点击inspect会打开一个开发者工具，然后就可以看到输出的log了<br>注意：如果要使 SharedWorker 连接到多个不同的页面，这些页面必须是同源的（相同的协议、host 以及端口）。<br>    worker.js<br>    <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> portList = [];</span><br><span class=\"line\"></span><br><span class=\"line\">onconnect = <span class=\"keyword\">function</span>(<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;e&#x27;</span>, e)</span><br><span class=\"line\">    <span class=\"keyword\">var</span> port = e.<span class=\"property\">ports</span>[<span class=\"number\">0</span>];</span><br><span class=\"line\">    <span class=\"title function_\">ensurePorts</span>(port);</span><br><span class=\"line\">    port.<span class=\"property\">onmessage</span> = <span class=\"keyword\">function</span>(<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> data = e.<span class=\"property\">data</span>;</span><br><span class=\"line\">        <span class=\"title function_\">disptach</span>(port, data);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    port.<span class=\"title function_\">start</span>();</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"comment\">// 创建所有workder</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">ensurePorts</span>(<span class=\"params\">port</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (portList.<span class=\"title function_\">indexOf</span>(port) &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        portList.<span class=\"title function_\">push</span>(port);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 发送其他页面</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">disptach</span>(<span class=\"params\">selfPort, data</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;portList&#x27;</span>, portList)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;selfPort&#x27;</span>, selfPort)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;data&#x27;</span>, data)</span><br><span class=\"line\">    portList</span><br><span class=\"line\">        .<span class=\"title function_\">filter</span>(<span class=\"function\"><span class=\"params\">port</span> =&gt;</span> selfPort !== port)</span><br><span class=\"line\">        .<span class=\"title function_\">forEach</span>(<span class=\"function\"><span class=\"params\">port</span> =&gt;</span> port.<span class=\"title function_\">postMessage</span>(data));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br>    page1<br>    <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!<span class=\"variable constant_\">DOCTYPE</span> html&gt;</span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;X-UA-Compatible&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;ie=edge&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>BroadcastChannel Page 1<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">h3</span>&gt;</span>Page 1<span class=\"tag\">&lt;/<span class=\"name\">h3</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">section</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;margin-top:50px; text-align: center&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;inputMessage&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;page 1的测试消息&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;button&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;发送消息&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;btnSend&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">section</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;messages&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>收到的消息：<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">section</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">section</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;./worker.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">var</span> messagesEle = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;messages&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">var</span> messageEl = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;inputMessage&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">var</span> btnSend = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;btnSend&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"comment\">//</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">if</span> (!<span class=\"variable language_\">window</span>.<span class=\"property\">SharedWorker</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"title function_\">alert</span>(<span class=\"string\">&quot;浏览器不支持SharedWorkder!&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125; <span class=\"keyword\">else</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> myWorker = <span class=\"keyword\">new</span> <span class=\"title class_\">SharedWorker</span>(<span class=\"string\">&quot;./worker.js&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"comment\">// 监听数据</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        myWorker.<span class=\"property\">port</span>.<span class=\"property\">onmessage</span> = <span class=\"keyword\">function</span>(<span class=\"params\">e</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;page1&#x27;</span>, e)</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> msgEl = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;p&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> data = e.<span class=\"property\">data</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        msgEl.<span class=\"property\">innerText</span> = data.<span class=\"property\">date</span> + <span class=\"string\">&quot; &quot;</span> + data.<span class=\"property\">from</span> + <span class=\"string\">&quot;:&quot;</span> + data.<span class=\"property\">message</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        messagesEle.<span class=\"title function_\">appendChild</span>(msgEl);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        btnSend.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;click&quot;</span>, <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> message = messageEl.<span class=\"property\">value</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"comment\">// 发送数据</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        myWorker.<span class=\"property\">port</span>.<span class=\"title function_\">postMessage</span>(&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">date</span>: <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>().<span class=\"title function_\">toLocaleString</span>(),</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            message,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">from</span>: <span class=\"string\">&quot;page 1&quot;</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        myWorker.<span class=\"property\">port</span>.<span class=\"title function_\">start</span>();</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure><br>    page2<br>    <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!<span class=\"variable constant_\">DOCTYPE</span> html&gt;</span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">&quot;X-UA-Compatible&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;ie=edge&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>BroadcastChannel Page 1<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">h3</span>&gt;</span>Page 2<span class=\"tag\">&lt;/<span class=\"name\">h3</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">section</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;margin-top:50px; text-align: center&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;inputMessage&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;page 1的测试消息&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;button&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;发送消息&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;btnSend&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">section</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;messages&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>收到的消息：<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">section</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">section</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;./worker.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">var</span> messagesEle = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;messages&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">var</span> messageEl = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;inputMessage&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">var</span> btnSend = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;btnSend&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"comment\">//</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">if</span> (!<span class=\"variable language_\">window</span>.<span class=\"property\">SharedWorker</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"title function_\">alert</span>(<span class=\"string\">&quot;浏览器不支持SharedWorkder!&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125; <span class=\"keyword\">else</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> myWorker = <span class=\"keyword\">new</span> <span class=\"title class_\">SharedWorker</span>(<span class=\"string\">&quot;./worker.js&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        myWorker.<span class=\"property\">port</span>.<span class=\"property\">onmessage</span> = <span class=\"keyword\">function</span>(<span class=\"params\">e</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;page2&#x27;</span>, e)</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> msgEl = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;p&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> data = e.<span class=\"property\">data</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        msgEl.<span class=\"property\">innerText</span> = data.<span class=\"property\">date</span> + <span class=\"string\">&quot; &quot;</span> + data.<span class=\"property\">from</span> + <span class=\"string\">&quot;:&quot;</span> + data.<span class=\"property\">message</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        messagesEle.<span class=\"title function_\">appendChild</span>(msgEl);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        btnSend.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;click&quot;</span>, <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> message = messageEl.<span class=\"property\">value</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"keyword\">var</span> message = messageEl.<span class=\"property\">value</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        myWorker.<span class=\"property\">port</span>.<span class=\"title function_\">postMessage</span>(&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">date</span>: <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>().<span class=\"title function_\">toLocaleString</span>(),</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            message,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">            <span class=\"attr\">from</span>: <span class=\"string\">&quot;page 2&quot;</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        &#125;);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        myWorker.<span class=\"property\">port</span>.<span class=\"title function_\">start</span>();</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p>\n</blockquote>\n<h4 id=\"MessageChannel\"><a href=\"#MessageChannel\" class=\"headerlink\" title=\"MessageChannel\"></a>MessageChannel</h4>"}],"PostAsset":[],"PostCategory":[{"post_id":"cmjwbsw620007rotg3v63gzbw","category_id":"cmjwbsw600004rotg9k87enwj","_id":"cmjwbsw64000erotg3f433jxc"},{"post_id":"cmjwbsw5y0001rotg6wa2er36","category_id":"cmjwbsw600004rotg9k87enwj","_id":"cmjwbsw64000irotge3fd6ucl"},{"post_id":"cmjwbsw620008rotgdu2o6jbt","category_id":"cmjwbsw600004rotg9k87enwj","_id":"cmjwbsw65000lrotg5h7n2q0v"},{"post_id":"cmjwbsw63000crotgb68h54zw","category_id":"cmjwbsw600004rotg9k87enwj","_id":"cmjwbsw65000protgccvg4q3k"},{"post_id":"cmjwbsw600003rotgd3psg07w","category_id":"cmjwbsw600004rotg9k87enwj","_id":"cmjwbsw66000srotg074bhiqr"},{"post_id":"cmjwbsw64000hrotg1hafg5dv","category_id":"cmjwbsw600004rotg9k87enwj","_id":"cmjwbsw66000vrotgan7ua0wq"},{"post_id":"cmjwbsw610006rotgdbve5jpn","category_id":"cmjwbsw600004rotg9k87enwj","_id":"cmjwbsw66000yrotg2fvgd7kf"},{"post_id":"cmjwbsw65000orotg127pbvkx","category_id":"cmjwbsw65000mrotgf6up3hoh","_id":"cmjwbsw670010rotg9gpe6t9z"},{"post_id":"cmjwbsw63000drotg88nucui6","category_id":"cmjwbsw65000mrotgf6up3hoh","_id":"cmjwbsw670014rotg839zc3lk"},{"post_id":"cmjwbsw65000rrotgfnad3u8e","category_id":"cmjwbsw600004rotg9k87enwj","_id":"cmjwbsw670016rotg324f54j2"},{"post_id":"cmjwbsw66000urotg4d4d3xy7","category_id":"cmjwbsw600004rotg9k87enwj","_id":"cmjwbsw670019rotg3dj19gmb"},{"post_id":"cmjwbsw66000xrotggpd77ywm","category_id":"cmjwbsw600004rotg9k87enwj","_id":"cmjwbsw68001crotg843jgeqg"},{"post_id":"cmjwbsw66000zrotgf53kcj4o","category_id":"cmjwbsw600004rotg9k87enwj","_id":"cmjwbsw68001frotg46sn4qhj"},{"post_id":"cmjwbsw670015rotg312yaiuk","category_id":"cmjwbsw600004rotg9k87enwj","_id":"cmjwbsw68001irotg69dtg7zz"},{"post_id":"cmjwbsw670018rotgdyc079c9","category_id":"cmjwbsw600004rotg9k87enwj","_id":"cmjwbsw69001mrotg96dnd5xm"},{"post_id":"cmjwbsw68001brotgek1ka0r3","category_id":"cmjwbsw600004rotg9k87enwj","_id":"cmjwbsw69001orotgaard4yb4"},{"post_id":"cmjwbsw69001lrotgey8meop9","category_id":"cmjwbsw600004rotg9k87enwj","_id":"cmjwbsw6a001trotgbdntdjis"},{"post_id":"cmjwbsw69001nrotgbmwc3pav","category_id":"cmjwbsw600004rotg9k87enwj","_id":"cmjwbsw6a001vrotgfonw8dvl"},{"post_id":"cmjwbsw68001erotgfqr8dh3y","category_id":"cmjwbsw68001jrotg9k7a7ara","_id":"cmjwbsw6a001zrotg0gnq2x2i"},{"post_id":"cmjwbsw69001protgawlv48eh","category_id":"cmjwbsw600004rotg9k87enwj","_id":"cmjwbsw6a0021rotg1cnp54i2"},{"post_id":"cmjwbsw68001hrotghjeqdslp","category_id":"cmjwbsw69001qrotgd9i9b5nj","_id":"cmjwbsw6a0024rotg6k0kg4jc"},{"post_id":"cmjwbsw6a001urotg74p40kio","category_id":"cmjwbsw600004rotg9k87enwj","_id":"cmjwbsw6a0026rotgbtvndmnp"},{"post_id":"cmjwbsw6a001yrotg1oji1asq","category_id":"cmjwbsw600004rotg9k87enwj","_id":"cmjwbsw6a0028rotgfrsq7gp5"},{"post_id":"cmjwbsw69001srotg07gwawu9","category_id":"cmjwbsw6a001xrotg4c4hdjl8","_id":"cmjwbsw6a0029rotg8g755c2m"}],"PostTag":[{"post_id":"cmjwbsw5y0001rotg6wa2er36","tag_id":"cmjwbsw610005rotgbdf98vll","_id":"cmjwbsw63000brotgcjapcecn"},{"post_id":"cmjwbsw600003rotgd3psg07w","tag_id":"cmjwbsw62000arotg6rhkc0ay","_id":"cmjwbsw64000jrotg571eauja"},{"post_id":"cmjwbsw610006rotgdbve5jpn","tag_id":"cmjwbsw64000grotg76sf96bd","_id":"cmjwbsw65000qrotg4qrl9vvu"},{"post_id":"cmjwbsw620007rotg3v63gzbw","tag_id":"cmjwbsw65000nrotg4izkbnkp","_id":"cmjwbsw66000wrotgeig3czaw"},{"post_id":"cmjwbsw620008rotgdu2o6jbt","tag_id":"cmjwbsw66000trotg1etb6c3a","_id":"cmjwbsw670012rotg3qpp7b9e"},{"post_id":"cmjwbsw63000crotgb68h54zw","tag_id":"cmjwbsw670011rotgbovxeu69","_id":"cmjwbsw67001arotgbspyb8nb"},{"post_id":"cmjwbsw63000drotg88nucui6","tag_id":"cmjwbsw670017rotgf5i58ssk","_id":"cmjwbsw68001grotg2pc418px"},{"post_id":"cmjwbsw64000hrotg1hafg5dv","tag_id":"cmjwbsw68001drotgff255tei","_id":"cmjwbsw6a0020rotg9s45dl43"},{"post_id":"cmjwbsw64000hrotg1hafg5dv","tag_id":"cmjwbsw68001krotggqphhyw0","_id":"cmjwbsw6a0022rotg50nt1007"},{"post_id":"cmjwbsw64000hrotg1hafg5dv","tag_id":"cmjwbsw69001rrotg6s6wfk11","_id":"cmjwbsw6a0025rotg3e4w2eqg"},{"post_id":"cmjwbsw65000orotg127pbvkx","tag_id":"cmjwbsw6a001wrotg9nsde92t","_id":"cmjwbsw6b002crotgdpfih7mj"},{"post_id":"cmjwbsw65000orotg127pbvkx","tag_id":"cmjwbsw6a0023rotg08js7o1t","_id":"cmjwbsw6b002drotg3qre8r4j"},{"post_id":"cmjwbsw65000orotg127pbvkx","tag_id":"cmjwbsw6a0027rotg09zhha9s","_id":"cmjwbsw6b002frotgaken1um4"},{"post_id":"cmjwbsw65000orotg127pbvkx","tag_id":"cmjwbsw6a002arotgaysp4shy","_id":"cmjwbsw6b002grotgf133dxaz"},{"post_id":"cmjwbsw65000rrotgfnad3u8e","tag_id":"cmjwbsw6a002brotg8skr2n8b","_id":"cmjwbsw6b002irotg9lrwgkd6"},{"post_id":"cmjwbsw66000urotg4d4d3xy7","tag_id":"cmjwbsw6b002erotgfa9w9h6o","_id":"cmjwbsw6b002jrotg5g792w7h"},{"post_id":"cmjwbsw66000xrotggpd77ywm","tag_id":"cmjwbsw6b002hrotg7hak7f0j","_id":"cmjwbsw6b002lrotgf10j07cs"},{"post_id":"cmjwbsw66000zrotgf53kcj4o","tag_id":"cmjwbsw6b002krotgfz8weu09","_id":"cmjwbsw6b002qrotg5ojvgwmi"},{"post_id":"cmjwbsw66000zrotgf53kcj4o","tag_id":"cmjwbsw6b002mrotge1vp3rcx","_id":"cmjwbsw6b002rrotgbcnyfwzb"},{"post_id":"cmjwbsw66000zrotgf53kcj4o","tag_id":"cmjwbsw6b002nrotg0kei3ktm","_id":"cmjwbsw6b002trotgggo50jiv"},{"post_id":"cmjwbsw66000zrotgf53kcj4o","tag_id":"cmjwbsw6b002orotg5t8i3l5z","_id":"cmjwbsw6b002urotg04ywewqr"},{"post_id":"cmjwbsw670013rotg0yzlb9b0","tag_id":"cmjwbsw6b002protg3s281li2","_id":"cmjwbsw6b002wrotgg853hzu6"},{"post_id":"cmjwbsw670015rotg312yaiuk","tag_id":"cmjwbsw6b002srotg087v11wg","_id":"cmjwbsw6b002xrotg85s472vg"},{"post_id":"cmjwbsw670018rotgdyc079c9","tag_id":"cmjwbsw6b002vrotgh4q7hm9h","_id":"cmjwbsw6b002zrotg5wkkce1j"},{"post_id":"cmjwbsw68001brotgek1ka0r3","tag_id":"cmjwbsw6b002yrotg8dc78ttm","_id":"cmjwbsw6b0031rotgez8r95le"},{"post_id":"cmjwbsw68001hrotghjeqdslp","tag_id":"cmjwbsw6b0030rotgd65g184x","_id":"cmjwbsw6b0033rotgg5sr4bmp"},{"post_id":"cmjwbsw69001lrotgey8meop9","tag_id":"cmjwbsw6b0032rotg41ticnzk","_id":"cmjwbsw6c0036rotgbnd5h5ip"},{"post_id":"cmjwbsw69001lrotgey8meop9","tag_id":"cmjwbsw6b0034rotgc4vkb5ic","_id":"cmjwbsw6c0037rotg9qlqfolt"},{"post_id":"cmjwbsw69001nrotgbmwc3pav","tag_id":"cmjwbsw6c0035rotg2xp3840h","_id":"cmjwbsw6c0039rotgd1s6da64"},{"post_id":"cmjwbsw69001protgawlv48eh","tag_id":"cmjwbsw6c0038rotg2ire4i4t","_id":"cmjwbsw6c003brotga169112e"},{"post_id":"cmjwbsw69001srotg07gwawu9","tag_id":"cmjwbsw6c003arotg924z1r8a","_id":"cmjwbsw6c003drotg2wfdg77y"},{"post_id":"cmjwbsw6a001urotg74p40kio","tag_id":"cmjwbsw6c003crotga1hk0lf2","_id":"cmjwbsw6c003frotgbtb44uk2"},{"post_id":"cmjwbsw6a001yrotg1oji1asq","tag_id":"cmjwbsw6c003crotga1hk0lf2","_id":"cmjwbsw6c003grotg2wd054ku"}],"Tag":[{"name":"CommonJS/AMD/CMD","_id":"cmjwbsw610005rotgbdf98vll"},{"name":"用JavaScript和Emoji 做地址栏动画","_id":"cmjwbsw62000arotg6rhkc0ay"},{"name":"Promise的使用","_id":"cmjwbsw64000grotg76sf96bd"},{"name":"Vue-router核心原理","_id":"cmjwbsw65000nrotg4izkbnkp"},{"name":"— Vue中inheritAttrs，$attrs，$listeners","_id":"cmjwbsw66000trotg1etb6c3a"},{"name":"gulp和webpack区别","_id":"cmjwbsw670011rotgbovxeu69"},{"name":"hexo的基本操作","_id":"cmjwbsw670017rotgf5i58ssk"},{"name":"screenX/screenY","_id":"cmjwbsw68001drotgff255tei"},{"name":"clientX/slientY","_id":"cmjwbsw68001krotggqphhyw0"},{"name":"offsetX/offsetY","_id":"cmjwbsw69001rrotg6s6wfk11"},{"name":"hexo","_id":"cmjwbsw6a001wrotg9nsde92t"},{"name":"nexT","_id":"cmjwbsw6a0023rotg08js7o1t"},{"name":"搭建自己博客","_id":"cmjwbsw6a0027rotg09zhha9s"},{"name":"解决next主题搜索loadding问题","_id":"cmjwbsw6a002arotgaysp4shy"},{"name":"nodejs","_id":"cmjwbsw6a002brotg8skr2n8b"},{"name":"slot的使用","_id":"cmjwbsw6b002erotgfa9w9h6o"},{"name":"vue的diff算法","_id":"cmjwbsw6b002hrotg7hak7f0j"},{"name":"Vue.js 内部运行机制","_id":"cmjwbsw6b002krotgfz8weu09"},{"name":"patch","_id":"cmjwbsw6b002mrotge1vp3rcx"},{"name":"render function","_id":"cmjwbsw6b002nrotg0kei3ktm"},{"name":"diff","_id":"cmjwbsw6b002orotg5t8i3l5z"},{"name":"Vue双向绑定实现原理","_id":"cmjwbsw6b002protg3s281li2"},{"name":"vue中$emit/$on/$once/$off的使用","_id":"cmjwbsw6b002srotg087v11wg"},{"name":"vue的functionnal使用","_id":"cmjwbsw6b002vrotgh4q7hm9h"},{"name":"webpack4+","_id":"cmjwbsw6b002yrotg8dc78ttm"},{"name":"区块链理论和代码演示","_id":"cmjwbsw6b0030rotgd65g184x"},{"name":"图片懒加载","_id":"cmjwbsw6b0032rotg41ticnzk"},{"name":"函数节流3种方式","_id":"cmjwbsw6b0034rotgc4vkb5ic"},{"name":"如何清除已设置的npm淘宝镜像","_id":"cmjwbsw6c0035rotg2xp3840h"},{"name":"探究call 和 apply 的原理","_id":"cmjwbsw6c0038rotg2ire4i4t"},{"name":"神经网络","_id":"cmjwbsw6c003arotg924z1r8a"},{"name":"跨浏览器窗口,7种方式","_id":"cmjwbsw6c003crotga1hk0lf2"}]}}